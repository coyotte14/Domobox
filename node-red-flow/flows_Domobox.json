[{"id":"f44096e2.f5ad","type":"tab","label":"Backup-Flow","disabled":false,"info":""},{"id":"37cbadc6.95403a","type":"tab","label":"Status-Domobox","disabled":false,"info":""},{"id":"a6f65934.4fb04","type":"tab","label":"Status-Sonde","disabled":false,"info":""},{"id":"861fd1d6.432808","type":"tab","label":"DNS updater Chuck","disabled":false,"info":""},{"id":"97223981.e54958","type":"tab","label":"npm ros miio tasmota","disabled":false,"info":""},{"id":"bef0923b.0da65","type":"tab","label":"Geolocalisation","disabled":false,"info":""},{"id":"62fb3d03.78562c","type":"tab","label":"Meteo","disabled":false,"info":""},{"id":"ad39059d.6f22b","type":"tab","label":"Meteo2","disabled":false},{"id":"79ee2f10.bba208","type":"tab","label":"Tests"},{"id":"d516a408.b180d","type":"tab","label":"Garage-UI","disabled":false,"info":""},{"id":"65265671.c010f8","type":"tab","label":"Véranda-UI","disabled":false,"info":""},{"id":"502c9d4.9539064","type":"tab","label":"Musique-UI","disabled":false,"info":""},{"id":"77ef16e7.a27228","type":"tab","label":"VMC","disabled":true,"info":""},{"id":"9e51a2fa.b06ff","type":"tab","label":"VMC2","disabled":true,"info":""},{"id":"b882537d.e69738","type":"tab","label":"TH-9&13&DHT-2Mqtt","disabled":false,"info":""},{"id":"b5752a43.1c1f2","type":"tab","label":"Volets-rfx2Mqtt","disabled":false,"info":""},{"id":"741cb637.242018","type":"tab","label":"Volets UI"},{"id":"c558fd3a.cad55","type":"tab","label":"Sensor2ES","disabled":false,"info":""},{"id":"417d6ad8.4260bc","type":"tab","label":"T°2ES","disabled":false,"info":""},{"id":"c5a9ff80.1cad58","type":"tab","label":"Batterie2ES","disabled":false,"info":""},{"id":"9efb7b65.fb0c98","type":"tab","label":"Salon","disabled":false},{"id":"659a812a.2160a","type":"tab","label":"Xiaomi2Mqtt","disabled":false,"info":""},{"id":"b6726fbf.d6c4f","type":"tab","label":"Xiaomi-Mi-Vaccum","disabled":false,"info":""},{"id":"ee283ca8.bf07d","type":"tab","label":"Sonoff","disabled":false,"info":""},{"id":"29011ad1.210936","type":"tab","label":"Nest","disabled":false,"info":""},{"id":"d36fb347.098c6","type":"tab","label":"VMC3","disabled":false,"info":""},{"id":"7a8f2b34.bdf7c4","type":"tab","label":"Gazpar 2ES","disabled":false,"info":""},{"id":"993fef07.63c5d8","type":"ui_tab","z":"62fb3d03.78562c","name":"Météo","icon":"dashboard","order":3},{"id":"88ab92f.9c1cc7","type":"ui_tab","z":"9efb7b65.fb0c98","name":"Salon","icon":"dashboard","order":2},{"id":"f9bb790b.40c7f8","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"Helvetica Neue"},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":false},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#000000","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","dateFormat":"DD/MM/YYYY","sizes":{"sx":52,"sy":52,"gx":6,"gy":6,"cx":8,"cy":8,"px":0,"py":0}}},{"id":"8b1773d1.02b85","type":"ui_group","z":"65265671.c010f8","name":"Veranda","tab":"99b4cee4.4f15c","disp":true,"width":"6"},{"id":"133e033c.62ce2d","type":"ui_group","z":"d516a408.b180d","name":"Porte de garage","tab":"918ef0a0.b191e8","disp":true,"width":"4"},{"id":"7f2f2f2e.67c2d8","type":"ui_group","z":"62fb3d03.78562c","name":"Météo","tab":"993fef07.63c5d8","disp":true,"width":"6"},{"id":"cecc0790.67d028","type":"ui_group","z":"9efb7b65.fb0c98","name":"Salon","tab":"88ab92f.9c1cc7","order":1,"disp":true,"width":"6"},{"id":"99b4cee4.4f15c","type":"ui_tab","z":"","name":"Véranda","icon":"dashboard","order":6},{"id":"918ef0a0.b191e8","type":"ui_tab","z":"","name":"Sous sol","icon":"dashboard","order":5},{"id":"69baaef0.c77078","type":"ui_tab","z":"79ee2f10.bba208","name":"Musique","icon":"dashboard","order":7},{"id":"861b4722.d554a","type":"ui_group","z":"","name":"Billard","tab":"69baaef0.c77078","order":2,"disp":true,"width":"6"},{"id":"b4b30565.dc8c38","type":"squeezebox-server","z":"502c9d4.9539064","host":"http://192.168.1.55","port":"9000","name":"Logitech Media Server"},{"id":"c3d6a537.a4a3d8","type":"ui_group","z":"","name":"Véranda","tab":"69baaef0.c77078","order":1,"disp":true,"width":"6","collapse":false},{"id":"dbbb8203.b7fb2","type":"forecastio-credentials","z":"62fb3d03.78562c","key_identifier":"coyotte14"},{"id":"8c8320d4.5ab3d8","type":"ui_tab","z":"","name":"Home","icon":"dashboard","order":1},{"id":"b622e15c.61edb","type":"ui_group","z":"","name":"Home","tab":"8c8320d4.5ab3d8","order":1,"disp":true,"width":"5"},{"id":"9087c797.52481","type":"ui_tab","z":"","name":"VMC","icon":"dashboard","order":8},{"id":"8aa34793.811b08","type":"ui_group","z":"","name":"VMC","tab":"9087c797.52481","disp":true,"width":"6"},{"id":"ccb045e6.fb3018","type":"ui_tab","z":"","name":"Volets","icon":"dashboard","order":10},{"id":"9267186.e0de468","type":"ui_group","z":"","name":"Volets cuisine","tab":"ccb045e6.fb3018","order":2,"disp":true,"width":"6"},{"id":"31059561.bfd482","type":"ui_group","z":"","name":"Volets Véranda","tab":"ccb045e6.fb3018","order":4,"disp":true,"width":"6"},{"id":"eb04833d.a40868","type":"ui_group","z":"","name":"Volets chambre parents","tab":"ccb045e6.fb3018","order":6,"disp":true,"width":"6"},{"id":"4788be41.3da578","type":"ui_group","z":"","name":"Volets salle de bain","tab":"ccb045e6.fb3018","order":9,"disp":true,"width":"6"},{"id":"3bec75bf.d008d2","type":"ui_group","z":"","name":"Volets chambre Sarah","tab":"ccb045e6.fb3018","order":7,"disp":true,"width":"6"},{"id":"53831c5e.fc1994","type":"ui_group","z":"","name":"Volets chambre Anaïs","tab":"ccb045e6.fb3018","order":8,"disp":true,"width":"6"},{"id":"f181328d.2b1328","type":"ui_group","z":"","name":"Commande générale","tab":"ccb045e6.fb3018","order":1,"disp":true,"width":"6"},{"id":"6a10efbc.51b2d","type":"ui_tab","z":"","name":"Météo de la semaine","icon":"dashboard","order":4},{"id":"2c6fed05.f231ea","type":"ui_group","z":"","name":"Météo de la semaine","tab":"6a10efbc.51b2d","disp":true,"width":"6"},{"id":"9c9224ce.733908","type":"mqtt-broker","z":"","name":"","broker":"domobox","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"2","birthRetain":"true","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"224c87be.78cf08","type":"google-api-config","z":""},{"id":"d327a67.36659d8","type":"ui_group","z":"","name":"Volets salon","tab":"ccb045e6.fb3018","order":3,"disp":true,"width":"6"},{"id":"d1dfcb1.8efa2b8","type":"ui_group","z":"","name":"Volets bureau","tab":"ccb045e6.fb3018","order":5,"disp":true,"width":"6"},{"id":"ee1296bd.5dc6e","type":"pushbullet-config","z":"","name":"PushBullet"},{"id":"a67ca531.70e5a8","type":"xiaomi-configurator","z":"","name":"Xiaomi-Gateway","ip":"192.168.1.10","sid":"","deviceList":[{"sid":"158d000224f9a2","desc":"M-Salon-présence","model":"motion"},{"sid":"158d000224f9b4","desc":"M-Cuisine-présence","model":"motion"},{"sid":"158d000224f833","desc":"M-Véranda-présence","model":"motion"},{"sid":"158d00022b387b","desc":"P-Cuisine-baie-sud","model":"magnet"},{"sid":"158d000201e367","desc":"P-Véranda-baie-est","model":"magnet"},{"sid":"158d000201e1e1","desc":"P-Véranda-baie-sud","model":"magnet"},{"sid":"158d00020138a3c","desc":"SDB-inondation","model":"sensor_ht"},{"sid":"158d00020910dd","desc":"VMC-marche-forcée","model":"magnet"},{"sid":"158d00020926ac","desc":"Garage-petite-porte","model":"magnet"},{"sid":"158d00021304a9","desc":"Cuisine-inondation","model":"sensor_ht"}],"key":"f2rxkru01223alf2"},{"id":"154cb229.a4d1fe","type":"rfxtrx-port","z":"","port":"/dev/ttyUSB0","enableDebug":false},{"id":"66107b1.f275904","type":"ui_tab","z":"","name":"Aspirateur","icon":"dashboard","order":11},{"id":"fb08d572.6ed218","type":"ui_group","z":"","name":"Commandes","tab":"66107b1.f275904","order":4,"disp":true,"width":"6","collapse":false},{"id":"1bc2c7d8.cc8488","type":"ui_group","z":"","name":"Status aspiration","tab":"66107b1.f275904","order":2,"disp":true,"width":"6","collapse":false},{"id":"26b230b8.58d348","type":"ui_group","z":"","name":"Puissance","tab":"66107b1.f275904","order":3,"disp":true,"width":"6","collapse":false},{"id":"2f1b591a.11a0ae","type":"ui_group","z":"","name":"Do Not Disturb mode","tab":"66107b1.f275904","order":6,"disp":true,"width":"6","collapse":false},{"id":"8e86de68.f6ebc","type":"ui_group","z":"","name":"Status général","tab":"66107b1.f275904","order":1,"disp":true,"width":"6","collapse":false},{"id":"d87fc009.71c59","type":"ui_tab","z":"","name":"Volet","icon":"dashboard","order":9},{"id":"55a686e9.047b2","type":"ui_group","z":"","name":"Commande générale","tab":"d87fc009.71c59","order":1,"disp":false,"width":"6","collapse":false},{"id":"7a5b734b.cacc04","type":"ui_group","z":"","name":"Mode tapis","tab":"66107b1.f275904","order":5,"disp":true,"width":"6","collapse":false},{"id":"b7bac8c3.504c4","type":"ui_group","z":"","name":"Thermostat","tab":"e44ebf58.986d3","order":2,"disp":true,"width":"6","collapse":false},{"id":"e44ebf58.986d3","type":"ui_tab","z":"","name":"Thermostat","icon":"dashboard"},{"id":"5492d81f.51f628","type":"rfxtrx-port","z":"","port":"/dev/ttyUSB0"},{"id":"11c00037.18f258","type":"PT2262-device-list","z":"","name":"conf","devices":[]},{"id":"37f65fc8.5bf318","type":"PT2262-device-list","z":"","name":"config","devices":[{"device":["PT2262","guir"],"payload":"","rawData":"0xd216b1","pulseWidth":370}]},{"id":"7e80569d.347bd8","type":"rfxtrx-port","z":"","port":"/dev/ttyUSB0"},{"id":"a90e6307.90e6d","type":"rfxtrx-port","z":"","port":"/dev/ttyUSB0"},{"id":"d187a6e6.ba1e2","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"fd58ed3.21dad1","type":"ui_tab","z":"","name":"Home","icon":"dashboard"},{"id":"e86e47ea.21cff8","type":"ui_group","z":"","name":"Espeasy device list","tab":"fd58ed3.21dad1","order":1,"disp":false,"width":"14","collapse":false},{"id":"40afb052.d0137","type":"ui_group","z":"","name":"Enter the IP of a GHOST device and press DELETE to delete it","tab":"fd58ed3.21dad1","order":2,"disp":true,"width":"14","collapse":false},{"id":"be6f6178.583a58","type":"mqtt in","z":"bef0923b.0da65","name":"","topic":"owntracks/HP/HP/#","qos":"2","broker":"9c9224ce.733908","x":125.5,"y":87.5,"wires":[["34b628ca.41744","48bc6eba.0e924"]]},{"id":"b007a51f.d741a","type":"geofence","z":"bef0923b.0da65","name":"Geofence Home","mode":"circle","inside":"both","rad":27.038727652962418,"points":[],"centre":{"latitude":49.211517336554856,"longitude":-0.40698766708374023},"x":123,"y":662,"wires":[["3c3a05b6.cbb20a","c8541d1c.ee4e2"]]},{"id":"34b628ca.41744","type":"function","z":"bef0923b.0da65","name":"Lat-Long","func":"var loc=JSON.parse(msg.payload);\n\nif ( loc._type == \"location\" ) {\n    msg.location = {\n      lon: 0,\n      lat: 50\n    };\n\n    msg.location.lon=loc.lon;\n    msg.location.lat=loc.lat;\n    \n    return msg;\n}","outputs":1,"noerr":0,"x":110,"y":561,"wires":[["b007a51f.d741a","1240527a.037a26","dd21b3c0.f1027","e736305c.8748e8","1b3fc818.0b7cd","8d2e4870.a5a508"]]},{"id":"1240527a.037a26","type":"google geocoding","z":"bef0923b.0da65","name":"","geocodeBy":"coordinates","address":"","lat":"","lon":"","googleAPI":"224c87be.78cf08","bounds":"","language":"","region":"","components":"","x":550,"y":220,"wires":[["84dbbdd7.2ac008"]]},{"id":"84dbbdd7.2ac008","type":"debug","z":"bef0923b.0da65","name":"","active":false,"console":"false","complete":"false","x":771,"y":220,"wires":[]},{"id":"3c3a05b6.cbb20a","type":"debug","z":"bef0923b.0da65","name":"","active":false,"console":"false","complete":"false","x":321,"y":618,"wires":[]},{"id":"61754051.08ba7","type":"ui_text","z":"65265671.c010f8","group":"8b1773d1.02b85","order":5,"width":"","height":"","name":"Humidité","label":"Humidité","format":"{{msg.payload}}%","layout":"","x":320,"y":549,"wires":[]},{"id":"91327024.382318","type":"mqtt in","z":"65265671.c010f8","name":"Humidité RFX","topic":"Veranda/RFX/Humidity","qos":"2","broker":"9c9224ce.733908","x":110,"y":593,"wires":[["61754051.08ba7","5ad2a635.268c1","488cff3.18ad08"]]},{"id":"e4f87653.44629","type":"mqtt in","z":"65265671.c010f8","name":"Temperature RFX","topic":"Veranda/RFX/Temperature","qos":"2","broker":"9c9224ce.733908","x":110,"y":200,"wires":[["70444022.c80c98","7ddd2f99.15b1b8","ac362951.e42e1","6169de6f.e26e58","602d5169.be3d9"]]},{"id":"70444022.c80c98","type":"ui_text","z":"65265671.c010f8","group":"8b1773d1.02b85","order":2,"width":"","height":"","name":"Température","label":"Température","format":"{{msg.payload}}°C","layout":"","x":472,"y":169.99998474121094,"wires":[]},{"id":"7ddd2f99.15b1b8","type":"function","z":"65265671.c010f8","name":"Date","func":"MaDate = new Date();\ndayString = MaDate.toString();\ntimeString = dayString.substring( 16 , 21 );\nmsg.payload = timeString;\n\n//msg.h = timeString;\n\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":122,"wires":[["fd5f56d7.a0d7b8"]]},{"id":"fd5f56d7.a0d7b8","type":"ui_text","z":"65265671.c010f8","group":"8b1773d1.02b85","order":1,"width":"","height":"","name":"Mise à jour","label":"Mise à jour","format":"{{msg.payload}}","layout":"","x":470,"y":122,"wires":[]},{"id":"ac362951.e42e1","type":"ui_chart","z":"65265671.c010f8","name":"Chart-Température","group":"8b1773d1.02b85","order":14,"width":"","height":"","label":"Température","chartType":"line","legend":"true","xformat":"HH","interpolate":"linear","nodata":"Température","ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":"","x":490.5,"y":219.29998779296875,"wires":[[],[]]},{"id":"5c0f0bde.8ded04","type":"ui_text","z":"65265671.c010f8","group":"8b1773d1.02b85","order":3,"width":"","height":"","name":"T° Max","label":"Température max","format":"{{msg.payload}}°C","layout":"","x":460,"y":266,"wires":[]},{"id":"38ae009c.ee6568","type":"ui_text","z":"65265671.c010f8","group":"8b1773d1.02b85","order":4,"width":"","height":"","name":"T° Min","label":"Température min","format":"{{msg.payload}}°C","layout":"","x":454,"y":344,"wires":[]},{"id":"ed2b4486.60743","type":"openweathermap in","z":"62fb3d03.78562c","name":"","lon":"","lat":"","city":"Saint-Contest","country":"FR","x":125.5,"y":202.33999633789062,"wires":[["85a640eb.20d83","3da584fe.bbee0c","7fa46f17.909ea","ae9826ba.32fa68","b5d1d04e.7755e","1e69fdab.f4e4f2","8e794e0e.6d2808","8345213.0b001e","a78a7936.d3c7e","3fc55177.4a56b6","8f0cc95e.9d8a2","418ba2e6.4e7cb4","b347ff7a.e9ad8","7d803bc2.d201fc"]]},{"id":"85a640eb.20d83","type":"debug","z":"62fb3d03.78562c","name":"","active":true,"console":"false","complete":"false","x":402.5,"y":96.03999328613281,"wires":[]},{"id":"3da584fe.bbee0c","type":"function","z":"62fb3d03.78562c","name":"T-ext","func":"msg.payload = msg.payload.tempc;\n    node.status({text:msg.payload});\n//return {payload:msg.payload.tempc};\nreturn msg;","outputs":1,"noerr":0,"x":377.5,"y":212.05999755859375,"wires":[["3d83c936.f01a86"]]},{"id":"3d83c936.f01a86","type":"ui_text","z":"62fb3d03.78562c","group":"7f2f2f2e.67c2d8","order":2,"width":"","height":"","name":"Température extérieure","label":"Température extérieure","format":"{{msg.payload}}°C","layout":"","x":607.5,"y":211.29998779296875,"wires":[]},{"id":"7fa46f17.909ea","type":"function","z":"62fb3d03.78562c","name":"T-max","func":"kelvin=msg.payload.maxtemp;\ntemperature = parseFloat(kelvin) - 273,15;\ntemperature=temperature.toPrecision(3)\nmsg.payload=temperature;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":378,"y":265,"wires":[["a8e62e09.d4e348"]]},{"id":"a8e62e09.d4e348","type":"ui_text","z":"62fb3d03.78562c","group":"7f2f2f2e.67c2d8","order":4,"width":"","height":"","name":"Température max","label":"Température max","format":"{{msg.payload}}°C","layout":"","x":583,"y":265.239990234375,"wires":[]},{"id":"ae9826ba.32fa68","type":"function","z":"62fb3d03.78562c","name":"T-min","func":"\nkelvin=msg.payload.mintemp;\n\n// °F = 9/5(°K - 273) + 32\n// °C = 9/5(°K - 273)\n//temperature = (parseFloat(kelvin) - 273,15);\n//temperature = 9*(parseFloat(kelvin) - 273)/5;\n//temperature = 9*parseFloat(kelvin - 273)/5;\ntemperature = parseFloat(kelvin - 273);\n//temperature = parseInt(kelvin);\ntemperature=temperature.toPrecision(3);\nmsg.payload=temperature;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":322,"wires":[["fc8b7ee4.f9ad48"]]},{"id":"fc8b7ee4.f9ad48","type":"ui_text","z":"62fb3d03.78562c","group":"7f2f2f2e.67c2d8","order":3,"width":"","height":"","name":"Température min","label":"Température min","format":"{{msg.payload}}°C","layout":"","x":579,"y":321.239990234375,"wires":[]},{"id":"f05535a0.a9adb","type":"comment","z":"d516a408.b180d","name":"Porte garage 2","info":"","x":120,"y":60,"wires":[]},{"id":"6169de6f.e26e58","type":"smooth","z":"65265671.c010f8","name":"","action":"min","count":"800","round":false,"x":298.5,"y":343.45001220703125,"wires":[["38ae009c.ee6568"]]},{"id":"602d5169.be3d9","type":"smooth","z":"65265671.c010f8","name":"","action":"max","count":"800","round":false,"x":303.5,"y":267.4499816894531,"wires":[["5c0f0bde.8ded04","e6abcf94.4e34"]]},{"id":"c8f024e3.74e7b8","type":"ui_text","z":"62fb3d03.78562c","group":"7f2f2f2e.67c2d8","order":1,"width":"","height":"","name":"Mise à jour","label":"Mise à jour","format":"{{msg.payload}}","layout":"","x":570,"y":158,"wires":[]},{"id":"b5d1d04e.7755e","type":"function","z":"62fb3d03.78562c","name":"Date","func":"MaDate = new Date();\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\n//msg.payload = timeString\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":379,"y":157.00001525878906,"wires":[["c8f024e3.74e7b8","b58ac996.85c628"]]},{"id":"1e69fdab.f4e4f2","type":"function","z":"62fb3d03.78562c","name":"Force-Vent","func":"vent=msg.payload.windspeed;\nvent = (parseFloat(vent)*3.6);\nforcevent=vent.toPrecision(2);\nmsg.payload = forcevent + \" km/h\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":392,"y":390,"wires":[["823a1d2a.ca56a"]]},{"id":"823a1d2a.ca56a","type":"ui_text","z":"62fb3d03.78562c","group":"7f2f2f2e.67c2d8","order":5,"width":"","height":"","name":"Force du vent","label":"Force du vent","format":"{{msg.payload}}","layout":"","x":569,"y":389.239990234375,"wires":[]},{"id":"8e794e0e.6d2808","type":"function","z":"62fb3d03.78562c","name":"Lever-soleil","func":"var sec = msg.payload.sunrise;\nvar date = new Date(sec * 1000);\nMaDate = date.toLocaleTimeString();\ndateString = MaDate.toString();\ntimeString = MaDate.substring( 0 , 5 );\nmsg.payload = timeString\n    node.status({text:msg.payload});\n\nreturn msg;\n","outputs":1,"noerr":0,"x":388,"y":454,"wires":[[]]},{"id":"64332764.780dc","type":"ui_text","z":"62fb3d03.78562c","group":"7f2f2f2e.67c2d8","order":6,"width":"","height":"","name":"Lever du soleil","label":"Lever du soleil","format":"{{msg.payload}}","layout":"","x":566,"y":454.239990234375,"wires":[]},{"id":"cfba215d.8b92a8","type":"ui_text","z":"9efb7b65.fb0c98","group":"cecc0790.67d028","order":6,"width":"","height":"","name":"Humidité","label":"Humidité","format":"{{msg.payload}}%","layout":"row-spread","x":540,"y":602.2598876953125,"wires":[]},{"id":"9c1561c2.6954f","type":"mqtt in","z":"9efb7b65.fb0c98","name":"Salon/RFX/Humidity","topic":"Salon/RFX/Humidity","qos":"2","broker":"9c9224ce.733908","x":135,"y":605.9799194335938,"wires":[["cfba215d.8b92a8","1289f68c.c0ca59"]]},{"id":"68ad87b4.88fe4","type":"mqtt in","z":"9efb7b65.fb0c98","name":"Temperature RFX","topic":"Salon/RFX/Temperature","qos":"2","broker":"9c9224ce.733908","x":124.5,"y":163.95999145507812,"wires":[["ad82035f.b44ed","40c99168.24c908","cef8a7d5.8169e","23b02796.80ce5","1d8e3fb8.7d5668","cd26a7c.2bf0dd8"]]},{"id":"ad82035f.b44ed","type":"ui_text","z":"9efb7b65.fb0c98","group":"cecc0790.67d028","order":2,"width":"","height":"","name":"Température","label":"Température","format":"{{msg.payload}}°C","layout":"row-spread","x":542.5,"y":167.95997619628906,"wires":[]},{"id":"1e368a40.a159be","type":"debug","z":"9efb7b65.fb0c98","name":"","active":false,"console":"false","complete":"false","x":543,"y":42,"wires":[]},{"id":"40c99168.24c908","type":"function","z":"9efb7b65.fb0c98","name":"Date","func":"MaDate = new Date();\ndayString = MaDate.toString();\ntimeString = dayString.substring( 16 , 21 );\nmsg.payload = timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":326.5,"y":104.95999145507812,"wires":[["2685383.ff60748","1e368a40.a159be"]]},{"id":"2685383.ff60748","type":"ui_text","z":"9efb7b65.fb0c98","group":"cecc0790.67d028","order":1,"width":"","height":"","name":"Mise à jour","label":"Mise à jour","format":"{{msg.payload}}","layout":"row-spread","x":543.5,"y":104.95997619628906,"wires":[]},{"id":"1289f68c.c0ca59","type":"ui_chart","z":"9efb7b65.fb0c98","name":"Chart-Humidité","group":"cecc0790.67d028","order":8,"width":"","height":"","label":"Humidité","chartType":"line","xformat":"HH:mm:ss","interpolate":"linear","nodata":"No Data","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":"","useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":true,"x":557.5,"y":653.9598999023438,"wires":[[],[]]},{"id":"cef8a7d5.8169e","type":"ui_chart","z":"9efb7b65.fb0c98","name":"Chart-Température","group":"cecc0790.67d028","order":7,"width":"","height":"","label":"Température","chartType":"line","xformat":"HH:mm:ss","interpolate":"linear","nodata":"No Data","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":"","useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":true,"x":563,"y":229.25997924804688,"wires":[[],[]]},{"id":"790f9636.0dc6f8","type":"ui_text","z":"9efb7b65.fb0c98","group":"cecc0790.67d028","order":3,"width":"","height":"","name":"T° Max","label":"Température max","format":"{{msg.payload}}°C","layout":"row-spread","x":533.5,"y":275.9599914550781,"wires":[]},{"id":"d2817d6d.631348","type":"ui_text","z":"9efb7b65.fb0c98","group":"cecc0790.67d028","order":4,"width":"","height":"","name":"T° Min","label":"Température min","format":"{{msg.payload}}°C","layout":"row-spread","x":525.5,"y":348.9599609375,"wires":[]},{"id":"23b02796.80ce5","type":"smooth","z":"9efb7b65.fb0c98","name":"","action":"min","count":"800","round":false,"x":331,"y":349.4100341796875,"wires":[["d2817d6d.631348"]]},{"id":"1d8e3fb8.7d5668","type":"smooth","z":"9efb7b65.fb0c98","name":"","action":"max","count":"800","round":false,"x":328,"y":275.40997314453125,"wires":[["790f9636.0dc6f8"]]},{"id":"f9a45485.83b688","type":"mqtt in","z":"9efb7b65.fb0c98","name":"Fenetre","topic":"/DHT-Salon/Door_1/Door/#","qos":"2","broker":"9c9224ce.733908","x":107.5,"y":819.1499328613281,"wires":[["b0051408.5467a8","5510e3e7.0dc0c4"]]},{"id":"b0051408.5467a8","type":"function","z":"9efb7b65.fb0c98","name":"Ouvert-Fermé","func":"if (msg.payload == 1) {\n    msg.payload=\"ouverte\";\n    } \nelse {\n    msg.payload=\"fermée\";\n    }\nreturn msg;","outputs":1,"noerr":0,"x":332.5,"y":821.4499206542969,"wires":[["2b5475d8.8f98fa","f6620089.6f599"]]},{"id":"f6620089.6f599","type":"ui_text","z":"9efb7b65.fb0c98","group":"cecc0790.67d028","order":5,"width":"","height":"","name":"Fenêtre","label":"Fenêtre","format":"{{msg.payload}}","layout":"row-spread","x":548.5,"y":822.2499694824219,"wires":[]},{"id":"5510e3e7.0dc0c4","type":"debug","z":"9efb7b65.fb0c98","name":"","active":false,"console":"false","complete":"false","x":336.5,"y":934.2999572753906,"wires":[]},{"id":"91187cc4.0e9f08","type":"ui_toast","z":"9efb7b65.fb0c98","outputs":0,"name":"","x":718.5,"y":875.2499694824219,"wires":[]},{"id":"2b5475d8.8f98fa","type":"function","z":"9efb7b65.fb0c98","name":"MSG ouvert/fermé","func":"msg.payload = \"Fenêtre salon \" + msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":502.5,"y":876.4499816894531,"wires":[["91187cc4.0e9f08"]]},{"id":"3bb79c2b.c19cf4","type":"comment","z":"a6f65934.4fb04","name":"Status sonde sur topic /+/status","info":"","x":136.5,"y":154,"wires":[]},{"id":"1d0ca7bf.939a98","type":"mqtt in","z":"a6f65934.4fb04","name":"Status /+/status","topic":"/+/status","qos":"0","broker":"9c9224ce.733908","x":93,"y":206,"wires":[["83e73e80.0f7f9","fde3df75.77b54"]]},{"id":"83e73e80.0f7f9","type":"debug","z":"a6f65934.4fb04","name":"","active":true,"console":"false","complete":"false","x":283,"y":206,"wires":[]},{"id":"8459b77a.f34a4","type":"adv ping","z":"a6f65934.4fb04","name":"ping sonde","host":"","x":430.5,"y":315,"wires":[["c1ce7cb5.a6e78","d8b1c589.2cb508"]]},{"id":"c1ce7cb5.a6e78","type":"debug","z":"a6f65934.4fb04","name":"","active":true,"console":"false","complete":"payload","x":430,"y":369,"wires":[]},{"id":"fd05ec27.c66ab8","type":"function","z":"a6f65934.4fb04","name":"hostname sonde","func":"var dataStr = msg.payload;\n\n//if individual node selected - the destination id should be last part of topic\n\n//split msg by /\nvar tokens = msg.topic.split(\"/\");\n\ncontext.sysname = tokens[1];\nmsg.host = context.sysname;\n    node.status({text:msg.host});\n    \nreturn msg;","outputs":1,"noerr":0,"x":250.5,"y":315,"wires":[["8459b77a.f34a4"]]},{"id":"d8b1c589.2cb508","type":"switch","z":"a6f65934.4fb04","name":"","property":"payload","propertyType":"msg","rules":[{"t":"false"},{"t":"else"}],"checkall":"true","outputs":2,"x":585,"y":315,"wires":[["81c35fbb.9f87a"],["a093eb32.b1c6d8"]]},{"id":"f85a6e55.043da","type":"comment","z":"a6f65934.4fb04","name":"ping KO","info":"","x":586,"y":271,"wires":[]},{"id":"4cc943d3.93dc94","type":"comment","z":"a6f65934.4fb04","name":"Anti-Spam","info":"","x":853,"y":152,"wires":[]},{"id":"81c35fbb.9f87a","type":"delay","z":"a6f65934.4fb04","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"5","nbRateUnits":"","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":737,"y":276,"wires":[["49ab7948.c8f68"]]},{"id":"49ab7948.c8f68","type":"delay","z":"a6f65934.4fb04","name":"","pauseType":"rate","timeout":"4","timeoutUnits":"seconds","rate":"10","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":905,"y":276,"wires":[["692f1762.556ac"]]},{"id":"692f1762.556ac","type":"template","z":"a6f65934.4fb04","name":"Ping message","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Serveur {{topic}} indisponible ! ","x":1085,"y":276,"wires":[["219846f9.e2cc32","d2cb39b6.45487"]]},{"id":"bb01227a.30d9a","type":"comment","z":"a6f65934.4fb04","name":"Construction du message","info":"","x":1113,"y":151,"wires":[]},{"id":"a134af9c.ecdba8","type":"comment","z":"a6f65934.4fb04","name":"Transmission","info":"","x":1312,"y":150,"wires":[]},{"id":"219846f9.e2cc32","type":"e-mail","z":"a6f65934.4fb04","server":"smtp.gmail.com","port":"465","secure":true,"name":"coyotte14@gmail.com","dname":"Email Alert","x":1299,"y":277,"wires":[]},{"id":"8c625665.60261","type":"comment","z":"a6f65934.4fb04","name":"Hostname Sonde","info":"","x":259,"y":274,"wires":[]},{"id":"e70ffbc9.abe4","type":"comment","z":"a6f65934.4fb04","name":"ping Hostname Sonde","info":"","x":460,"y":158,"wires":[]},{"id":"8cb48dc1.e85ff","type":"comment","z":"a6f65934.4fb04","name":"ping OK","info":"","x":589,"y":370,"wires":[]},{"id":"a093eb32.b1c6d8","type":"delay","z":"a6f65934.4fb04","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"5","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":736,"y":363,"wires":[["f13cb7d4.c35398"]]},{"id":"f13cb7d4.c35398","type":"delay","z":"a6f65934.4fb04","name":"","pauseType":"rate","timeout":"4","timeoutUnits":"seconds","rate":"10","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":903,"y":363,"wires":[["d4659f77.4a5a28"]]},{"id":"d4659f77.4a5a28","type":"template","z":"a6f65934.4fb04","name":"Ping message","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"Serveur {{topic}} connexion MQTT indisponible ! ","x":1083,"y":363,"wires":[["219846f9.e2cc32","d2cb39b6.45487"]]},{"id":"d2cb39b6.45487","type":"debug","z":"a6f65934.4fb04","name":"","active":true,"console":"false","complete":"false","x":1300,"y":351,"wires":[]},{"id":"a3a35701.68b2f8","type":"comment","z":"a6f65934.4fb04","name":"Test MQTT indisponible :  Last Will testament : message \"Connection Lost\" sur topic /+/status quand connexion MQTT perdue","info":"mosquitto_pub -t /T-Veranda/status -m \"7\"\nmosquitto_pub -t /T-Salon/status -m \"hs\"\nmosquitto_pub -t /P-Garage1/status -m \"ok\"","x":425,"y":26,"wires":[]},{"id":"b58ac996.85c628","type":"debug","z":"62fb3d03.78562c","name":"","active":false,"console":"false","complete":"false","x":684.5,"y":72,"wires":[]},{"id":"93fba07a.da7a2","type":"ui_text","z":"62fb3d03.78562c","group":"7f2f2f2e.67c2d8","order":9,"width":"","height":"","name":"Qualité de l'air","label":"Qualité de l'air","format":"{{msg.payload}}","layout":"","x":880,"y":763.239990234375,"wires":[]},{"id":"8345213.0b001e","type":"file in","z":"62fb3d03.78562c","name":"qair.txt","filename":"/var/www/html/qair/qair.txt","format":"utf8","sendError":true,"x":271.5,"y":752,"wires":[["269bbf65.b8b52","64843c3b.af9d84"]]},{"id":"269bbf65.b8b52","type":"debug","z":"62fb3d03.78562c","name":"","active":true,"console":"false","complete":"filename","x":436,"y":820,"wires":[]},{"id":"64843c3b.af9d84","type":"switch","z":"62fb3d03.78562c","name":"Select air quality","property":"payload","rules":[{"t":"btwn","v":0,"v2":4},{"t":"btwn","v":5,"v2":7},{"t":"btwn","v":8,"v2":10}],"checkall":"true","outputs":3,"x":480,"y":751,"wires":[["e7f7c34b.e5af48"],["6f301b36.e11c2c"],["ce01b2a6.b4b56"]]},{"id":"6f301b36.e11c2c","type":"function","z":"62fb3d03.78562c","name":"Add warning","func":"msg.payload =  msg.payload + \"(Air pollué)\"\nreturn msg;","outputs":1,"noerr":0,"x":675.77783203125,"y":763.111083984375,"wires":[["93fba07a.da7a2"]]},{"id":"ce01b2a6.b4b56","type":"function","z":"62fb3d03.78562c","name":"Add danger","func":"msg.payload = msg.payload + \"(Air très pollué)\"\nreturn msg;","outputs":1,"noerr":0,"x":673,"y":803.111083984375,"wires":[["93fba07a.da7a2"]]},{"id":"e7f7c34b.e5af48","type":"function","z":"62fb3d03.78562c","name":"Add ok","func":"msg.payload = msg.payload + \" (Air correct)\"\nreturn msg;","outputs":1,"noerr":0,"x":670.5555419921875,"y":724.7777099609375,"wires":[["93fba07a.da7a2"]]},{"id":"a78a7936.d3c7e","type":"function","z":"62fb3d03.78562c","name":"Couche-soleil","func":"var sec = msg.payload.sunset;\nvar date = new Date(sec * 1000);\n\nMaDate = date.toLocaleTimeString();\ndateString = MaDate.toString();\ntimeString = MaDate.substring( 0 , 5 );\nmsg.payload = timeString\n    node.status({text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":393,"y":560,"wires":[[]]},{"id":"1c761691.2a7409","type":"ui_text","z":"62fb3d03.78562c","group":"7f2f2f2e.67c2d8","order":7,"width":"","height":"","name":"Coucher du soleil","label":"Coucher du soleil","format":"{{msg.payload}}","layout":"","x":589,"y":569,"wires":[]},{"id":"dd35df49.7aea28","type":"mqtt in","z":"d516a408.b180d","name":"P-Garage2 relay","topic":"/P-Garage2/gpio/12","qos":"0","broker":"9c9224ce.733908","x":383.5,"y":201,"wires":[["7aba43c9.69c6cc","f282d150.d58c4"]]},{"id":"7aba43c9.69c6cc","type":"debug","z":"d516a408.b180d","name":"","active":true,"console":"false","complete":"false","x":615.5,"y":195,"wires":[]},{"id":"68cdc3d.d0df9bc","type":"ui_button","z":"d516a408.b180d","name":"Porte garage","group":"133e033c.62ce2d","order":1,"width":"4","height":"1","label":"Fermer / Ouvrir","color":"","bgcolor":"","icon":"","payload":"1","payloadType":"str","topic":"/P-garage2/gpio/12","x":359,"y":491,"wires":[["a3d86959.6aac48"]]},{"id":"a3d86959.6aac48","type":"mqtt out","z":"d516a408.b180d","name":"","topic":"/P-Garage2/gpio/12","qos":"0","retain":"","broker":"9c9224ce.733908","x":615.5,"y":492,"wires":[]},{"id":"c04d7a92.bfb128","type":"mqtt in","z":"d516a408.b180d","name":"Garage2/XIAOMI/Door","topic":"Garage2/XIAOMI/Door","qos":"2","broker":"9c9224ce.733908","x":399,"y":272,"wires":[["7aba43c9.69c6cc","7225696a.087ac"]]},{"id":"7225696a.087ac","type":"function","z":"d516a408.b180d","name":"Ouvert-Fermé","func":"if (msg.payload == 1) {\n    msg.payload=\"ouvert\";\n    } \nelse {\n    msg.payload=\"fermé\";\n    }\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":639,"y":272,"wires":[["67715a98.587f74"]]},{"id":"67715a98.587f74","type":"ui_text","z":"d516a408.b180d","group":"133e033c.62ce2d","order":3,"width":"4","height":"1","name":"","label":"Grande porte","format":"{{msg.payload}}","layout":"","x":840.5,"y":271.93994140625,"wires":[]},{"id":"23762abb.99a376","type":"comment","z":"d516a408.b180d","name":"gpio12 : relay","info":"","x":102,"y":197,"wires":[]},{"id":"c6c74b11.e50158","type":"comment","z":"d516a408.b180d","name":"gpio1 : Grande porte switch","info":"","x":150,"y":276,"wires":[]},{"id":"76d1601b.6feb68","type":"squeezebox-out","z":"502c9d4.9539064","squeezebox_server":"b4b30565.dc8c38","player_name":"veranda","command":"","x":486,"y":153,"wires":[["18ebc69e.02fde1"]]},{"id":"18ebc69e.02fde1","type":"debug","z":"502c9d4.9539064","name":"","active":false,"console":"false","complete":"false","x":656,"y":152,"wires":[]},{"id":"94b5a5b6.8267f","type":"ui_switch","z":"502c9d4.9539064","name":"","label":"Play-Pause","group":"c3d6a537.a4a3d8","order":0,"width":0,"height":0,"topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":135,"y":95,"wires":[["d6f3b7fd.4ebcf8"]]},{"id":"478a525e.a92974","type":"ui_slider","z":"502c9d4.9539064","name":"","label":"Volume","group":"c3d6a537.a4a3d8","order":0,"width":0,"height":0,"topic":"","min":0,"max":10,"x":126,"y":152,"wires":[["c1dbea64.92e2d8"]]},{"id":"d6f3b7fd.4ebcf8","type":"function","z":"502c9d4.9539064","name":"Play/Pause","func":"if (msg.payload === true) {\n    msg.payload=\"play\";\n    } \nelse {\n    msg.payload=\"stop\";\n    }\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":318,"y":96,"wires":[["76d1601b.6feb68"]]},{"id":"c1dbea64.92e2d8","type":"function","z":"502c9d4.9539064","name":"Volume","func":"volume = msg.payload *10\nmsg.payload = [\"mixer\",\"volume\",volume]\n\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":305,"y":152,"wires":[["76d1601b.6feb68"]]},{"id":"ec96808e.c9d258","type":"function","z":"502c9d4.9539064","name":"Status","func":"msg.payload = [\"status\"]\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":295,"y":208,"wires":[["76d1601b.6feb68"]]},{"id":"19a38138.d92b0f","type":"comment","z":"502c9d4.9539064","name":"Squeezbox Véranda","info":"","x":95,"y":41,"wires":[]},{"id":"e8a4dbe1.2191d","type":"squeezebox-out","z":"502c9d4.9539064","squeezebox_server":"b4b30565.dc8c38","player_name":"cuisine","command":"","x":486,"y":378,"wires":[["616d1453.6500d4"]]},{"id":"616d1453.6500d4","type":"debug","z":"502c9d4.9539064","name":"","active":false,"console":"false","complete":"false","x":656,"y":378,"wires":[]},{"id":"87aa2bdf.6006f8","type":"ui_switch","z":"502c9d4.9539064","name":"","label":"Play-Pause","group":"861b4722.d554a","order":0,"width":0,"height":0,"topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":135,"y":347,"wires":[["5e628325.dee4f4"]]},{"id":"f16b31ed.a01098","type":"ui_slider","z":"502c9d4.9539064","name":"","label":"Volume","group":"861b4722.d554a","order":0,"width":0,"height":0,"topic":"","min":0,"max":10,"x":126,"y":404,"wires":[["7fed9a1e.df3d04"]]},{"id":"5e628325.dee4f4","type":"function","z":"502c9d4.9539064","name":"Play/Pause","func":"if (msg.payload === true) {\n    msg.payload=\"play\";\n    } \nelse {\n    msg.payload=\"stop\";\n    }\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":318,"y":348,"wires":[["e8a4dbe1.2191d"]]},{"id":"7fed9a1e.df3d04","type":"function","z":"502c9d4.9539064","name":"Volume","func":"volume = msg.payload *10\nmsg.payload = [\"mixer\",\"volume\",volume]\n\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":305,"y":404,"wires":[["e8a4dbe1.2191d"]]},{"id":"93816317.015cc","type":"comment","z":"502c9d4.9539064","name":"Squeezbox cuisine","info":"","x":95,"y":293,"wires":[]},{"id":"e0a17b94.0fd768","type":"mqtt out","z":"d516a408.b180d","name":"","topic":"/P-Garage2/gpio/13","qos":"2","retain":"","broker":"9c9224ce.733908","x":759,"y":558,"wires":[]},{"id":"c5763606.c283a","type":"ui_switch","z":"d516a408.b180d","name":"","label":"Led de test","group":"133e033c.62ce2d","order":4,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":361,"y":558,"wires":[["2c77cd8a.650072"]]},{"id":"2c77cd8a.650072","type":"function","z":"d516a408.b180d","name":"On/Off","func":"if (msg.payload === true) {\n    msg.payload=\"0\";\n    } \nelse {\n    msg.payload=\"1\";\n    }\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":561,"y":558,"wires":[["e0a17b94.0fd768"]]},{"id":"5ad2a635.268c1","type":"debug","z":"65265671.c010f8","name":"","active":false,"console":"false","complete":"false","x":330,"y":640,"wires":[]},{"id":"e531709c.9e6098","type":"http request","z":"79ee2f10.bba208","name":"","method":"POST","ret":"obj","url":"http://192.168.1.32:9200/my_sonde/sonde/_search","tls":"","x":485,"y":159,"wires":[["e80ca309.057198"]]},{"id":"a36eb614.4db338","type":"http in","z":"79ee2f10.bba208","name":"","url":"/el/sensedata","method":"get","swaggerDoc":"","x":148,"y":109.5,"wires":[["70cc4586.14df94","b80401dc.a26358"]]},{"id":"70cc4586.14df94","type":"function","z":"79ee2f10.bba208","name":"Read Criteria","func":"var fromdate = msg.req && msg.req.query.fromdate;\nvar todate = msg.req && msg.req.query.todate;\nfromdate = fromdate || 'now-1d/d';\ntodate = todate || 'now/d';\n\nmsg.payload = {\n    \"query\": {\n        \"range\" : {\n            \"timestamp\" : {\n                \"gte\" : fromdate,\n                \"lte\" :  todate,\n                \"format\": \"yyyy-MM-dd\",\n                \"time_zone\": \"+09:00\"\n            }\n        }\n    },\n    \"size\": 1000,\n    \"sort\": [\n        {\"timestamp\" : {\"order\" : \"asc\"}}\n    ]\n};\nreturn msg;","outputs":1,"noerr":0,"x":348,"y":106,"wires":[["e531709c.9e6098"]]},{"id":"c762933a.94d17","type":"debug","z":"79ee2f10.bba208","name":"","active":true,"console":"false","complete":"false","x":780,"y":177.5,"wires":[]},{"id":"a47ef91e.5883e","type":"inject","z":"79ee2f10.bba208","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":173,"y":152,"wires":[["70cc4586.14df94"]]},{"id":"7b0c518a.4961d","type":"json","z":"79ee2f10.bba208","name":"","x":753,"y":112.5,"wires":[["928a0464.156e1"]]},{"id":"e80ca309.057198","type":"function","z":"79ee2f10.bba208","name":"","func":"var drgx = /^([0-9]{4})-([0-9]{2})-([0-9]{2})[\\s|T]([0-9]{2}):([0-9]{2}):([0-9]{2}).[0-9]*(Z?)/;\nvar eresult = msg.payload.hits.hits;\nvar result = [];\nfor(var i=0; i<eresult.length; i++){\n    result.push(eresult[i]._source)\n    var args = drgx.exec(result[i].timestamp);\n    if(args[7] === 'Z') {\n        //result[i].timestamp = Date.UTC(args[1], args[2] - 1, args[3], args[4], args[5], args[6]);\n    } else {\n        //result[i].timestamp = new Date(args[1], args[2] - 1, args[3], args[4], args[5], args[6]).getTime();\n    }\n}\nmsg.payload = result;\nreturn msg;","outputs":1,"noerr":0,"x":619,"y":114,"wires":[["c762933a.94d17","7b0c518a.4961d"]]},{"id":"b80401dc.a26358","type":"debug","z":"79ee2f10.bba208","name":"","active":true,"console":"false","complete":"req.query","x":342,"y":199.5,"wires":[]},{"id":"5adb007f.d84c7","type":"comment","z":"79ee2f10.bba208","name":"Search with ElasticSearch","info":"","x":164,"y":70,"wires":[]},{"id":"928a0464.156e1","type":"switch","z":"79ee2f10.bba208","name":"","property":"res","rules":[{"t":"nnull"}],"checkall":"false","outputs":1,"x":871,"y":114.5,"wires":[["f66bed92.1a70c8"]]},{"id":"f66bed92.1a70c8","type":"http response","z":"79ee2f10.bba208","name":"","x":993,"y":114.5,"wires":[]},{"id":"34945cac.a94dfc","type":"http request","z":"79ee2f10.bba208","name":"Save Data","method":"POST","ret":"obj","url":"http://192.168.1.31:9200/my_sonde/sonde/{{{msg.id}}}","tls":"","x":773,"y":434,"wires":[["4cf7ed63.bb8b0c"]]},{"id":"e3f1d60a.5c208","type":"tail","z":"79ee2f10.bba208","name":"Monitor CSV","filetype":"text","split":true,"filename":"/home/poirier/senselog.csv","x":133,"y":435,"wires":[["6211f84d.a78ad8"]]},{"id":"423900bb.c36308","type":"comment","z":"79ee2f10.bba208","name":"Add Sense Data to ElasticSearch","info":"","x":190,"y":396,"wires":[]},{"id":"6211f84d.a78ad8","type":"csv","z":"79ee2f10.bba208","name":"Sense Data Log","sep":",","hdrin":false,"hdrout":false,"multi":"one","ret":"\\n","temp":"source, humidity, temperature, date","x":319,"y":434.5,"wires":[["2d7c1a35.ce25ee","bc33abb8.f4ff3"]]},{"id":"bc33abb8.f4ff3","type":"json","z":"79ee2f10.bba208","name":"","x":584,"y":437.5,"wires":[["34945cac.a94dfc","fd684e8e.e3db68"]]},{"id":"2d7c1a35.ce25ee","type":"debug","z":"79ee2f10.bba208","name":"","active":true,"console":"false","complete":"false","x":421,"y":576.5,"wires":[]},{"id":"4cf7ed63.bb8b0c","type":"debug","z":"79ee2f10.bba208","name":"","active":true,"console":"false","complete":"false","x":805,"y":538.5,"wires":[]},{"id":"fd684e8e.e3db68","type":"debug","z":"79ee2f10.bba208","name":"","active":true,"console":"false","complete":"false","x":701,"y":593,"wires":[]},{"id":"f3a91250.131408","type":"function","z":"79ee2f10.bba208","name":"","func":"id = \"{root : [\" + msg.payload; + \"]\"\nmsg.payload=id\nmsg.id = msg.payload.timestamp;\n\nreturn msg;","outputs":1,"noerr":0,"x":494,"y":341,"wires":[["bc33abb8.f4ff3","bf1d51e0.49509"]]},{"id":"bf1d51e0.49509","type":"debug","z":"79ee2f10.bba208","name":"","active":true,"console":"false","complete":"false","x":666,"y":349,"wires":[]},{"id":"a22a1e57.69321","type":"comment","z":"65265671.c010f8","name":"Véranda : température UI","info":"","x":115,"y":30,"wires":[]},{"id":"f1edaaf2.e4111","type":"comment","z":"65265671.c010f8","name":"Véranda : humidité UI","info":"","x":120,"y":522,"wires":[]},{"id":"cd26a7c.2bf0dd8","type":"function","z":"9efb7b65.fb0c98","name":"Global var temperature","func":"context.global.myTemperaturesSalon=msg.payload;\nmsg.payload = context.global.myTemperaturesSalon;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":743,"y":135,"wires":[[]]},{"id":"9630d34e.aa5398","type":"comment","z":"9efb7b65.fb0c98","name":"Salon: humidité UI","info":"","x":95,"y":565.9999694824219,"wires":[]},{"id":"4862e38d.f553f4","type":"comment","z":"9efb7b65.fb0c98","name":"Salon: température UI","info":"","x":108,"y":24,"wires":[]},{"id":"5c63e5cd.cbcacc","type":"comment","z":"9efb7b65.fb0c98","name":"Salon: fenêtre UI","info":"","x":87,"y":785,"wires":[]},{"id":"cc635a45.f57e","type":"function","z":"62fb3d03.78562c","name":"context.global.WUTempExt","func":"context.global.TempExt = msg.payload.tempc;\nmsg.payload = context.global.WUTempExt;\nreturn msg;","outputs":1,"noerr":0,"x":681.0000610351562,"y":1438,"wires":[["9706c0ae.503498"]]},{"id":"85cbdee1.850568","type":"function","z":"62fb3d03.78562c","name":"context.global.WUhumid","func":"context.global.WUhumid = parseFloat(msg.payload.humidity);\nmsg.payload = context.global.WUhumid;\nreturn msg;","outputs":1,"noerr":0,"x":647.7778549194336,"y":1471.7778706550598,"wires":[["9e7d9193.c7171"]]},{"id":"9706c0ae.503498","type":"debug","z":"62fb3d03.78562c","name":"temp","active":true,"console":"false","complete":"payload","x":863.5556869506836,"y":1438.2222065925598,"wires":[]},{"id":"9e7d9193.c7171","type":"debug","z":"62fb3d03.78562c","name":"humid","active":true,"console":"false","complete":"payload","x":858.8889770507812,"y":1471.22216796875,"wires":[]},{"id":"f2d3798c.5b2398","type":"inject","z":"62fb3d03.78562c","name":"","topic":"","payload":"","payloadType":"date","repeat":"600","crontab":"","once":false,"x":146.11116790771484,"y":1341.0000386238098,"wires":[["c453b2a.269e1d"]]},{"id":"c453b2a.269e1d","type":"wunderground","z":"62fb3d03.78562c","name":"coyotte14@gmail.com","lon":"-0.400256","lat":"49.213999","city":"","country":"","x":422.2223129272461,"y":1338.6667256355286,"wires":[["cc635a45.f57e","85cbdee1.850568","5c89ce79.4bd208"]]},{"id":"5c89ce79.4bd208","type":"debug","z":"62fb3d03.78562c","name":"","active":true,"console":"false","complete":"false","x":654,"y":1334,"wires":[]},{"id":"412ffed.742db","type":"comment","z":"62fb3d03.78562c","name":"Rain Forecaster","info":"","x":114,"y":1498,"wires":[]},{"id":"716b317f.176d88","type":"forecastio in","z":"62fb3d03.78562c","forecastio":"dbbb8203.b7fb2","name":"","key":"","lon":"-0.400256","lat":"49.213999","date":"","time":"","units":"auto","x":115,"y":1599,"wires":[["637710e8.522c88","b13f139f.4a507","7cb8d45b.cc88cc"]]},{"id":"637710e8.522c88","type":"debug","z":"62fb3d03.78562c","name":"","active":true,"complete":"false","x":248,"y":1662,"wires":[]},{"id":"b13f139f.4a507","type":"function","z":"62fb3d03.78562c","name":"Temp Max demain","func":"maxt=msg.payload.maxtemp;\ntemperature=maxt.toPrecision(2)\nmsg.payload=temperature;\n    node.status({text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":608,"y":1602,"wires":[["f9172bf1.2c1a88","cf7866e2.d52ae8"]]},{"id":"f9172bf1.2c1a88","type":"ui_text","z":"62fb3d03.78562c","group":"7f2f2f2e.67c2d8","order":13,"width":"","height":"","name":"Temp max demain","label":"Température max demain","format":"{{msg.payload}}°C","layout":"","x":827,"y":1603,"wires":[]},{"id":"7cb8d45b.cc88cc","type":"function","z":"62fb3d03.78562c","name":"Temp Min demain","func":"mint=msg.payload.mintemp;\ntemperature=mint.toPrecision(2)\nmsg.payload=temperature;\n    node.status({text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":607,"y":1654,"wires":[["7b04e468.aca684"]]},{"id":"7b04e468.aca684","type":"ui_text","z":"62fb3d03.78562c","group":"7f2f2f2e.67c2d8","order":12,"width":"","height":"","name":"Temp min demain","label":"Température min demain","format":"{{msg.payload}}°C","layout":"","x":821,"y":1653,"wires":[]},{"id":"cf7866e2.d52ae8","type":"ui_text","z":"62fb3d03.78562c","group":"7f2f2f2e.67c2d8","order":11,"width":0,"height":0,"name":"","label":"_________ Prévisions météo _________","format":"","layout":"row-spread","x":900,"y":1549,"wires":[]},{"id":"7e5d8bce.c30bd4","type":"debug","z":"62fb3d03.78562c","name":"","active":true,"complete":"false","x":697,"y":1141,"wires":[]},{"id":"3fc55177.4a56b6","type":"http request","z":"62fb3d03.78562c","name":"HTTP vigilance","method":"GET","ret":"txt","url":"http://192.168.1.30:81/vigilance/14/all","tls":"","x":215,"y":1085,"wires":[["6957b092.eb158"]]},{"id":"d9b19845.db775","type":"function","z":"62fb3d03.78562c","name":"Vigilance","func":"msg.payload = msg.payload.vigilancerisk;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":546,"y":1087,"wires":[["7e5d8bce.c30bd4","5bda1b01.b3250c"]]},{"id":"5bda1b01.b3250c","type":"ui_text","z":"62fb3d03.78562c","group":"7f2f2f2e.67c2d8","order":10,"width":"","height":"","name":"Vigilance météo","label":"Vigilance météo","format":"{{msg.payload}}","layout":"","x":856,"y":1088,"wires":[]},{"id":"6957b092.eb158","type":"json","z":"62fb3d03.78562c","name":"","x":387,"y":1086,"wires":[["d9b19845.db775"]]},{"id":"8f0cc95e.9d8a2","type":"http request","z":"62fb3d03.78562c","name":"HTTP sunset","method":"GET","ret":"txt","url":"http://192.168.1.30:81/sun/saint-contest/sunset/now","tls":"","x":377,"y":610,"wires":[["1c761691.2a7409"]]},{"id":"7d803bc2.d201fc","type":"http request","z":"62fb3d03.78562c","name":"HTTP sunrise","method":"GET","ret":"txt","url":"http://192.168.1.30:81/sun/saint-contest/sunrise/now","tls":"","x":394,"y":508,"wires":[["64332764.780dc"]]},{"id":"418ba2e6.4e7cb4","type":"http request","z":"62fb3d03.78562c","name":"HTTP dayduration","method":"GET","ret":"txt","url":"http://192.168.1.30:81/sun/saint-contest/dayduration/now","tls":"","x":398,"y":659,"wires":[["64ffeadc.376f14"]]},{"id":"64ffeadc.376f14","type":"ui_text","z":"62fb3d03.78562c","group":"7f2f2f2e.67c2d8","order":8,"width":"","height":"","name":"Durée de la journée","label":"Durée de la journée","format":"{{msg.payload}}","layout":"","x":605,"y":659,"wires":[]},{"id":"b347ff7a.e9ad8","type":"http request","z":"62fb3d03.78562c","name":"HTTP prcipitation","method":"GET","ret":"txt","url":"http://www.meteofrance.com/mf3-rpc-portlet/rest/pluie/145660","tls":"","x":216,"y":1190,"wires":[["b6622039.6a9a7","e797f9be.d1f72"]]},{"id":"ac6019a2.7f477","type":"debug","z":"62fb3d03.78562c","name":"","active":true,"console":"false","complete":"false","x":773,"y":1246,"wires":[]},{"id":"b41e677d.814ab8","type":"ui_text","z":"62fb3d03.78562c","group":"7f2f2f2e.67c2d8","order":14,"width":"","height":"","name":"Pluie dans l'heure","label":"Pluie dans l'heure","format":"{{msg.payload}}","layout":"","x":860,"y":1194,"wires":[]},{"id":"d93f5f4f.1b6b9","type":"function","z":"62fb3d03.78562c","name":"Precipitation","func":"//msg.payload = msg.payload.niveauPluieText;\npluie = msg.payload.niveauPluieText;\n\n//pluie = JSON.stringify(pluie).replace( /\\[/g , '');\npluie = JSON.stringify(pluie).replace( /Pas de précipitations/g , 'Sec');\n//pluie = JSON.stringify(pluie).replace( '^[' , '');\n//pluie = JSON.stringify(pluie).replace( /]$/ , '');\n//pluie = JSON.stringify(pluie).replace( /De/g , '');\nmsg.payload = pluie;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":588,"y":1191,"wires":[["ac6019a2.7f477","b41e677d.814ab8"]]},{"id":"e797f9be.d1f72","type":"json","z":"62fb3d03.78562c","name":"","x":412,"y":1189,"wires":[["d93f5f4f.1b6b9"]]},{"id":"b6622039.6a9a7","type":"debug","z":"62fb3d03.78562c","name":"","active":true,"console":"false","complete":"false","x":358,"y":1248,"wires":[]},{"id":"f032815f.6fdad8","type":"debug","z":"79ee2f10.bba208","name":"","active":true,"console":"false","complete":"false","x":469,"y":700,"wires":[]},{"id":"1a75b8f3.00f3b7","type":"inject","z":"79ee2f10.bba208","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":103,"y":699,"wires":[["3be0765e.5f90d2"]]},{"id":"3be0765e.5f90d2","type":"http request","z":"79ee2f10.bba208","name":"Request temp ","method":"GET","ret":"obj","url":"http://192.168.1.32:9200/my_sonde/sonde/_search -d '{     \"size\": 0,     \"aggs\": {         \"Temperatures\": {             \"stats\": {                 \"field\": \"My-Temperature\"             }         }     } }'","tls":"","x":289,"y":699,"wires":[["f032815f.6fdad8"]]},{"id":"98f3f412.ccd398","type":"mqtt in","z":"77ef16e7.a27228","name":"Humidité Salle de bain","topic":"Salledebain/RFX/Humidity","qos":"2","broker":"9c9224ce.733908","x":105,"y":206,"wires":[["8712cb30.9ae938","f508758a.c31d","bf1cc505.28db1","cade928a.e26df"]]},{"id":"acb4a712.51108","type":"switch","z":"77ef16e7.a27228","name":"Select air quality","property":"Qair","propertyType":"global","rules":[{"t":"btwn","v":"0","vt":"num","v2":"4","v2t":"num"},{"t":"btwn","v":"5","vt":"num","v2":"7","v2t":"num"},{"t":"btwn","v":"8","vt":"num","v2":"10","v2t":"num"}],"checkall":"true","outputs":3,"x":1172.5,"y":303,"wires":[["9e6d7d0f.197168"],["a56db141.9a9e1","277d6a3c.1dcb6e"],["a56db141.9a9e1","c9089994.16f73"]]},{"id":"b02e188.1dc13e8","type":"comment","z":"77ef16e7.a27228","name":"Air 0-4 : OK runVMC","info":"","x":1203,"y":256,"wires":[]},{"id":"d4f5f460.795c8","type":"comment","z":"77ef16e7.a27228","name":"Air 5-10 : Pollué stopVMC","info":"","x":1200,"y":350,"wires":[]},{"id":"8712cb30.9ae938","type":"switch","z":"77ef16e7.a27228","name":"Select humidity","property":"payload","propertyType":"msg","rules":[{"t":"lt","v":"SeuilHumid","vt":"global"},{"t":"gte","v":"SeuilHumid","vt":"global"}],"checkall":"true","outputs":2,"x":321,"y":206,"wires":[["a56db141.9a9e1","c5152055.9ba2b"],["dfe47c1.29699","80bccf55.2c03e8"]]},{"id":"def2c2da.ceb43","type":"comment","z":"77ef16e7.a27228","name":"Humidity < global.SeuilHumid : stopVMC","info":"","x":266,"y":162,"wires":[]},{"id":"c0224700.ebce28","type":"comment","z":"77ef16e7.a27228","name":"Humidity > global.SeuilHumid : runVMC","info":"","x":250,"y":299,"wires":[]},{"id":"756c2413.74a3a4","type":"mqtt out","z":"77ef16e7.a27228","name":"","topic":"/R-VMC/gpio/12","qos":"0","retain":"","broker":"9c9224ce.733908","x":1801,"y":296,"wires":[]},{"id":"3577b28e.1d4306","type":"function","z":"77ef16e7.a27228","name":"stopVMC","func":"msg.payload = \"0\"\nreturn msg;","outputs":1,"noerr":0,"x":1610,"y":201,"wires":[["756c2413.74a3a4","c2de414f.7ca508"]]},{"id":"adb279df.42df","type":"function","z":"77ef16e7.a27228","name":"runVMC","func":"msg.payload = \"1\"\nreturn msg;","outputs":1,"noerr":0,"x":1610,"y":427,"wires":[["756c2413.74a3a4","cd6c8f8a.17d008"]]},{"id":"b0f608ff.7f42b8","type":"switch","z":"77ef16e7.a27228","name":"Select T°Ext","property":"payload","propertyType":"msg","rules":[{"t":"lt","v":"SeuilTemp","vt":"global"},{"t":"gte","v":"SeuilTemp","vt":"global"}],"checkall":"true","outputs":2,"x":702,"y":305,"wires":[["a56db141.9a9e1","ea4c55ea.e7d2f8","205ef9c.786c086"],["7e174cf4.d8bc5c","f8c1bc7a.526bd"]]},{"id":"f57f3424.85f958","type":"comment","z":"77ef16e7.a27228","name":"T°Ext <global.SeuilTemp : stopVMC","info":"","x":730,"y":233,"wires":[]},{"id":"c6b43f64.14eae","type":"comment","z":"77ef16e7.a27228","name":"T°Ext >global.SeuilTemp : runVMC","info":"","x":716,"y":371,"wires":[]},{"id":"c2de414f.7ca508","type":"debug","z":"77ef16e7.a27228","name":"","active":true,"console":"false","complete":"false","x":1795,"y":203,"wires":[]},{"id":"cd6c8f8a.17d008","type":"debug","z":"77ef16e7.a27228","name":"","active":true,"console":"false","complete":"false","x":1789,"y":426,"wires":[]},{"id":"a56db141.9a9e1","type":"delay","z":"77ef16e7.a27228","name":"1 message/H","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1427,"y":200,"wires":[["3577b28e.1d4306","847f88e5.94f448"]]},{"id":"9e6d7d0f.197168","type":"delay","z":"77ef16e7.a27228","name":"1 message/H","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"1","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1425,"y":355,"wires":[["adb279df.42df","a7476f05.087f48"]]},{"id":"97983df7.6ee8e","type":"comment","z":"77ef16e7.a27228","name":"1 action max par heure","info":"","x":1421,"y":276,"wires":[]},{"id":"42bf79bf.c745d","type":"ui_text","z":"77ef16e7.a27228","group":"8aa34793.811b08","order":4,"width":0,"height":0,"name":"Etat VMC","label":"Etat VMC","format":"{{msg.payload}}","layout":"row-spread","x":1872,"y":508,"wires":[]},{"id":"a7476f05.087f48","type":"function","z":"77ef16e7.a27228","name":"Etat VMC active","func":"var msg1 =  { payload:\" active\"};\n//var msg2 = { payload:\"Humidité > 60%\"};\nvar msg2 = { payload:\"Humidité = \" + Math.trunc(context.global.Humidity) + \"% > seuil \" + Math.trunc(context.global.SeuilHumid)+ \"%\"};\nreturn [ msg1, msg2 ];","outputs":"2","noerr":0,"x":1636,"y":534,"wires":[["42bf79bf.c745d"],["5dae2606.542dd"]]},{"id":"847f88e5.94f448","type":"function","z":"77ef16e7.a27228","name":"Etat VMC non active","func":"var msg1 =  { payload:\"non active\"};\n//var msg2 = { payload:\"Humidité = \" + Math.trunc(context.global.Humidity) + \"%\"};\nvar msg2 = { payload:\"Humidité = \" + Math.trunc(context.global.Humidity) + \"% < seuil \" + Math.trunc(context.global.SeuilHumid)+ \"%\"};\n\nreturn [ msg1, msg2 ];","outputs":"2","noerr":0,"x":1655,"y":491,"wires":[["42bf79bf.c745d"],["5dae2606.542dd"]]},{"id":"5dae2606.542dd","type":"ui_text","z":"77ef16e7.a27228","group":"8aa34793.811b08","order":6,"width":0,"height":0,"name":"Raison VMC","label":"Raison","format":"{{msg.payload}}","layout":"row-spread","x":1796,"y":653,"wires":[]},{"id":"277d6a3c.1dcb6e","type":"function","z":"77ef16e7.a27228","name":"Raison air pollué","func":"msg.payload = \"air pollué\"\nreturn msg;","outputs":1,"noerr":0,"x":1536,"y":648,"wires":[["5dae2606.542dd"]]},{"id":"c9089994.16f73","type":"function","z":"77ef16e7.a27228","name":"Raison  air très pollué","func":"msg.payload = \"air très pollué\"\nreturn msg;","outputs":1,"noerr":0,"x":1548,"y":688,"wires":[["5dae2606.542dd"]]},{"id":"205ef9c.786c086","type":"function","z":"77ef16e7.a27228","name":"Raison T°Ext <global.SeuilTemp","func":"msg.payload = \"T° ext < T° seuil \" + Math.trunc(context.global.SeuilTemp) +\"°\";\nreturn msg;","outputs":1,"noerr":0,"x":1579,"y":728,"wires":[["5dae2606.542dd"]]},{"id":"6c4b0d25.440cfc","type":"function","z":"77ef16e7.a27228","name":"global.SeuilHumid","func":"context.global.SeuilHumid = msg.payload;\nmsg.payload = context.global.SeuilHumid || 30;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":158,"y":1143,"wires":[["d3ca740d.be3c78","5b598fbe.9c5c3"]]},{"id":"bbcf0836.09793","type":"debug","z":"77ef16e7.a27228","name":"","active":true,"console":"false","complete":"false","x":413,"y":1060,"wires":[]},{"id":"c5152055.9ba2b","type":"debug","z":"77ef16e7.a27228","name":"","active":true,"console":"false","complete":"false","x":551,"y":125,"wires":[]},{"id":"f508758a.c31d","type":"function","z":"77ef16e7.a27228","name":"global.Humidity","func":"context.global.Humidity = msg.payload;\nmsg.payload = context.global.Humidity;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":320,"y":253,"wires":[[]]},{"id":"dfe47c1.29699","type":"debug","z":"77ef16e7.a27228","name":"","active":true,"console":"false","complete":"false","x":550,"y":166,"wires":[]},{"id":"60a2d636.f12c2","type":"comment","z":"77ef16e7.a27228","name":"Sélection seuil humidité","info":"","x":143,"y":1012,"wires":[]},{"id":"32069c94.c252bc","type":"inject","z":"77ef16e7.a27228","name":"Test T° Ext <5","topic":"","payload":"2","payloadType":"num","repeat":"","crontab":"","once":false,"x":496,"y":331,"wires":[["b0f608ff.7f42b8"]]},{"id":"ebd48240.12049","type":"inject","z":"77ef16e7.a27228","name":"Test Q air =4 (correct)","topic":"","payload":"4","payloadType":"num","repeat":"","crontab":"","once":false,"x":603,"y":422,"wires":[["acb4a712.51108","bb7cd795.20891"]]},{"id":"1095ac17.8c7a84","type":"inject","z":"77ef16e7.a27228","name":"Test Q air =5 (pollué)","topic":"","payload":"5","payloadType":"num","repeat":"","crontab":"","once":false,"x":620,"y":464,"wires":[["acb4a712.51108","bb7cd795.20891"]]},{"id":"2e0d339.136d44c","type":"inject","z":"77ef16e7.a27228","name":"Test Q air =8 (très pollué)","topic":"","payload":"8","payloadType":"num","repeat":"","crontab":"","once":false,"x":667,"y":500,"wires":[["acb4a712.51108","bb7cd795.20891"]]},{"id":"dd7bf85c.66db1","type":"ui_template","z":"77ef16e7.a27228","group":"8aa34793.811b08","name":"","order":1,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:0px; text-align: left; margin:2px; border:2px solid white;\">\n<span style=\"width:33%;padding-top:5px;padding-left:5px;\">{{\"Hum: \" + msg.h1 +\"%\"}}</span>\n<span style=\"width:33%;padding-top:5px;padding-left:5px;\">{{\"T° Ext: \" + msg.t1 + \"°c\"}}</span>\n<span style=\"width:33%;padding-top:5px;padding-left:5px;\">{{\"Q air: \" + msg.a1 }}</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":562,"y":38,"wires":[[]]},{"id":"7fde2e4f.b3548","type":"function","z":"77ef16e7.a27228","name":"global.SeuilTemp","func":"context.global.SeuilTemp = msg.payload;\nmsg.payload = context.global.SeuilTemp || 5;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":187,"y":865,"wires":[["770dfa57.900c84","e6bc1607.a9ad38"]]},{"id":"770dfa57.900c84","type":"ui_text","z":"77ef16e7.a27228","group":"8aa34793.811b08","order":9,"width":0,"height":0,"name":"Seuil T° lancement VMC","label":"Seuil T° lancement VMC : ","format":"{{msg.payload}}°","layout":"row-spread","x":443,"y":807,"wires":[]},{"id":"ea4c55ea.e7d2f8","type":"debug","z":"77ef16e7.a27228","name":"","active":true,"console":"false","complete":"false","x":905,"y":121,"wires":[]},{"id":"7e174cf4.d8bc5c","type":"debug","z":"77ef16e7.a27228","name":"","active":true,"console":"false","complete":"false","x":912,"y":170,"wires":[]},{"id":"aa8781e7.e71f58","type":"comment","z":"77ef16e7.a27228","name":"Sélection seuil température","info":"","x":209.99998474121094,"y":684,"wires":[]},{"id":"e17f9c92.96c638","type":"ui_template","z":"65265671.c010f8","group":"8b1773d1.02b85","name":"Template Video Foscam","order":6,"width":0,"height":0,"format":"<!DOCTYPE html>\n<style>\niframe{ width:400px; height: 225px; overflow-x: hidden; overflow-y: scroll }\n</style>\n<iframe name=\"Frame3\" src=\"http://192.168.1.100:80/videostream.cgi?user=visitor&amp;pwd=bipbip14&amp;resolution=8&amp;rate=0\" frameborder=\"2\" allowfullscreen>\n</iframe>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":150,"y":920,"wires":[[]]},{"id":"488cff3.18ad08","type":"ui_chart","z":"65265671.c010f8","name":"Chart-Humidité","group":"8b1773d1.02b85","order":15,"width":0,"height":0,"label":"Humidité","chartType":"line","legend":"true","xformat":"HH","interpolate":"linear","nodata":"Humidité","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":true,"x":340,"y":600,"wires":[[],[]]},{"id":"cade928a.e26df","type":"function","z":"77ef16e7.a27228","name":"populate-Template","func":"msg = {};\nmsg.t1 =  Math.trunc(context.global.TempExt);\nmsg.h1 =  Math.trunc(context.global.Humidity);\nmsg.a1 =  context.global.Qair;\n    node.status({text:msg.t1});\nreturn msg;","outputs":"1","noerr":0,"x":294,"y":37,"wires":[["dd7bf85c.66db1"]]},{"id":"ce3eda66.3f24d","type":"comment","z":"77ef16e7.a27228","name":"Qualité de l'air","info":"","x":240.99998474121094,"y":515,"wires":[]},{"id":"bf1cc505.28db1","type":"file in","z":"77ef16e7.a27228","name":"sortie.xml","filename":"/var/www/html/qair/qair.txt","format":"utf8","sendError":true,"x":219,"y":554,"wires":[["bb7cd795.20891"]]},{"id":"bb7cd795.20891","type":"function","z":"77ef16e7.a27228","name":"global.Qair","func":"context.global.Qair = msg.payload;\nmsg.payload = context.global.Qair;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":935,"y":554,"wires":[[]]},{"id":"80bccf55.2c03e8","type":"function","z":"77ef16e7.a27228","name":"global.TempExt","func":"msg.payload = context.global.TempExt;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":533,"y":280.20001220703125,"wires":[["b0f608ff.7f42b8"]]},{"id":"f8c1bc7a.526bd","type":"function","z":"77ef16e7.a27228","name":"global.Qair","func":"msg.payload = context.global.Qair;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":943.2000122070312,"y":305.20001220703125,"wires":[["acb4a712.51108"]]},{"id":"dd401ab2.7816c","type":"ui_template","z":"65265671.c010f8","group":"8b1773d1.02b85","name":"TPL-Cam","order":7,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n<span style=\"width:40%;padding-top:5px;padding-left:5px;\">{{\"Caméra\"}}\n\n</span>\n<span style=\"width:60%; padding-top:5px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/left-blue.png\" ng-click=\"send({payload: 'left' })\" height=\"24px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/up-blue.png\" ng-click=\"send({payload: 'up' })\" height=\"24px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/down-blue.png\" ng-click=\"send({payload: 'down' })\" height=\"24px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/right-blue.png\" ng-click=\"send({payload: 'right' })\" height=\"24px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/P.png\" ng-click=\"send({payload: 'patrol' })\" height=\"24px\"/>\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":100,"y":860,"wires":[["b13ec8a5.77233","1ad61f7a.6c63b1","e17f9c92.96c638"]]},{"id":"b13ec8a5.77233","type":"debug","z":"65265671.c010f8","name":"","active":false,"console":"false","complete":"false","x":330,"y":800,"wires":[]},{"id":"1ad61f7a.6c63b1","type":"switch","z":"65265671.c010f8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"left","vt":"str"},{"t":"eq","v":"up","vt":"str"},{"t":"eq","v":"down","vt":"str"},{"t":"eq","v":"right","vt":"str"},{"t":"eq","v":"patrol","vt":"str"}],"checkall":"true","outputs":5,"x":347,"y":859,"wires":[["de5617e9.6f14c"],["23c0a68f.e66d22"],["7984daa0.30239c"],["1ea75bde.42e904"],["142e15b2.22f1d2"]]},{"id":"de5617e9.6f14c","type":"http request","z":"65265671.c010f8","name":"cam left","method":"POST","ret":"txt","url":"http://192.168.1.100/decoder_control.cgi?&amp;user=admin&amp;pwd=huup6380!&amp;command=6&amp;onestep=5","tls":"","x":526,"y":776,"wires":[["6f486b2.e3ff614"]]},{"id":"6f486b2.e3ff614","type":"debug","z":"65265671.c010f8","name":"","active":false,"console":"false","complete":"false","x":740,"y":837,"wires":[]},{"id":"23c0a68f.e66d22","type":"http request","z":"65265671.c010f8","name":"cam up","method":"POST","ret":"txt","url":"http://192.168.1.100/decoder_control.cgi?&amp;user=admin&amp;pwd=huup6380!&amp;command=0&amp;onestep=5","tls":"","x":522,"y":816,"wires":[["6f486b2.e3ff614"]]},{"id":"7984daa0.30239c","type":"http request","z":"65265671.c010f8","name":"cam down","method":"POST","ret":"txt","url":"http://192.168.1.100/decoder_control.cgi?&amp;user=admin&amp;pwd=huup6380!&amp;command=2&amp;onestep=5","tls":"","x":520,"y":862,"wires":[["6f486b2.e3ff614"]]},{"id":"1ea75bde.42e904","type":"http request","z":"65265671.c010f8","name":"cam right","method":"POST","ret":"txt","url":"http://192.168.1.100/decoder_control.cgi?&amp;user=admin&amp;pwd=huup6380!&amp;command=4&amp;onestep=5","tls":"","x":519,"y":906,"wires":[["6f486b2.e3ff614"]]},{"id":"142e15b2.22f1d2","type":"http request","z":"65265671.c010f8","name":"cam patrol","method":"POST","ret":"txt","url":"http://192.168.1.100/decoder_control.cgi?&amp;user=admin&amp;pwd=huup6380!&amp;command=28","tls":"","x":529,"y":959,"wires":[["6f486b2.e3ff614"]]},{"id":"e6abcf94.4e34","type":"debug","z":"65265671.c010f8","name":"","active":false,"console":"false","complete":"false","x":470,"y":300,"wires":[]},{"id":"cd352e04.46658","type":"inject","z":"97223981.e54958","name":"Every 7D","topic":"","payload":"","payloadType":"date","repeat":"604800","crontab":"","once":false,"onceDelay":"","x":104,"y":91,"wires":[["ad39a418.a2ba2"]]},{"id":"ad39a418.a2ba2","type":"exec","z":"97223981.e54958","command":"npm outdated  -json  --prefix /home/pi/.node-red ; npm outdated  -g -json","addpay":false,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"","x":463,"y":91,"wires":[["956af998.1886e8"],[],[]]},{"id":"dfa12347.4e9508","type":"e-mail","z":"97223981.e54958","server":"smtp.gmail.com","port":"465","secure":true,"name":"coyotte14@gmail.com","dname":"NPM Maj","x":483,"y":200,"wires":[]},{"id":"e7f4d62c.26fff","type":"debug","z":"97223981.e54958","name":"","active":true,"console":"false","complete":"false","x":491,"y":260,"wires":[]},{"id":"35fd6eec.c12ed2","type":"function","z":"97223981.e54958","name":"Mailformat","func":"var m=\"<table style='font-family:arial; font-size:14px'><tr><td style='color:blue'><b>Node</b></td><td style='color:blue'><b>Current</b></td><td style='color:blue'><b>Wanted</b></td><td style='color:blue'><b>Latest</b></td></tr>\";\nmsg.payload=JSON.parse(msg.payload);\n \nfor (var key in msg.payload)\n{\n  m+=\"<tr><td style='color:green'>\";\n  m+=key;\n  m+=\"</td><td>\";\n  var mm=msg.payload[key];\n  m+=mm.current;\n  m+=\"</td><td>\";\n  m+=mm.wanted;\n  m+=\"</td><td>\";\n  m+=mm.latest;\n  m+=\"</td></tr>\";\n}\nm+=\"</table>\";\nmsg.payload=m;\nreturn msg;","outputs":1,"noerr":0,"x":327,"y":227,"wires":[["dfa12347.4e9508","e7f4d62c.26fff"]]},{"id":"55096d26.75483c","type":"comment","z":"97223981.e54958","name":"Verification MAJ modules npm","info":"","x":141,"y":31,"wires":[]},{"id":"46332863.ca1a88","type":"comment","z":"741cb637.242018","name":"Volets Véranda","info":"","x":666,"y":722,"wires":[]},{"id":"8eafcd24.902cc8","type":"ui_template","z":"741cb637.242018","group":"31059561.bfd482","name":"TPL-Volet/veranda/est1","order":1,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volet pan fixe est\"}}\n\n</span>\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":697,"y":759,"wires":[["29377f53.16ae","3398f777.3e"]]},{"id":"3398f777.3e","type":"mqtt out","z":"741cb637.242018","name":"Volet/veranda/est1","topic":"Volet/veranda/est1","qos":"","retain":"","broker":"9c9224ce.733908","x":985,"y":778,"wires":[]},{"id":"29377f53.16ae","type":"debug","z":"741cb637.242018","name":"","active":false,"console":"false","complete":"false","x":965,"y":743,"wires":[]},{"id":"39878480.09a344","type":"ui_template","z":"741cb637.242018","group":"31059561.bfd482","name":"TPL-Volet/veranda/est2","order":2,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volet pan mobile est\"}}\n\n</span>\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":697,"y":876,"wires":[["510a08b7.13da08","d6b6abb4.16b6f"]]},{"id":"d6b6abb4.16b6f","type":"mqtt out","z":"741cb637.242018","name":"Volet/veranda/est2","topic":"Volet/veranda/est2","qos":"","retain":"","broker":"9c9224ce.733908","x":986,"y":901,"wires":[]},{"id":"510a08b7.13da08","type":"debug","z":"741cb637.242018","name":"","active":false,"console":"false","complete":"false","x":966,"y":860,"wires":[]},{"id":"537a15fe.20fea4","type":"ui_template","z":"741cb637.242018","group":"31059561.bfd482","name":"TPL-Volet/veranda/sud1","order":3,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volet pan mobile sud\"}}\n\n</span>\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":699,"y":987,"wires":[["735794c.ae53dec","5b85a67e.d523c"]]},{"id":"5b85a67e.d523c","type":"mqtt out","z":"741cb637.242018","name":"Volet/veranda/sud1","topic":"Volet/veranda/sud1","qos":"","retain":"","broker":"9c9224ce.733908","x":986,"y":1008,"wires":[]},{"id":"735794c.ae53dec","type":"debug","z":"741cb637.242018","name":"","active":false,"console":"false","complete":"false","x":966,"y":972,"wires":[]},{"id":"6bd8a703.017ea","type":"ui_template","z":"741cb637.242018","group":"31059561.bfd482","name":"TPL-Volet/veranda/sud2","order":4,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volet pan fixe sud\"}}\n\n</span>\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":702,"y":1088,"wires":[["219e4d09.cad592","9ac2fba.1078d08"]]},{"id":"9ac2fba.1078d08","type":"mqtt out","z":"741cb637.242018","name":"Volet/veranda/sud2","topic":"Volet/veranda/sud2","qos":"","retain":"","broker":"9c9224ce.733908","x":991,"y":1112,"wires":[]},{"id":"219e4d09.cad592","type":"debug","z":"741cb637.242018","name":"","active":false,"console":"false","complete":"false","x":972,"y":1076,"wires":[]},{"id":"26465ea.1b32422","type":"ui_template","z":"741cb637.242018","group":"9267186.e0de468","name":"TPL-Volet/cuisine/est","order":2,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volet est\"}}\n\n</span>\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":689,"y":182,"wires":[["370b1c27.9e65ec","64fbc705.6d58c8"]]},{"id":"64fbc705.6d58c8","type":"mqtt out","z":"741cb637.242018","name":"Volet/cuisine/est","topic":"Volet/cuisine/est","qos":"","retain":"","broker":"9c9224ce.733908","x":971,"y":201,"wires":[]},{"id":"370b1c27.9e65ec","type":"debug","z":"741cb637.242018","name":"","active":true,"console":"false","complete":"false","x":960,"y":158,"wires":[]},{"id":"52d6d6fa.259588","type":"ui_template","z":"741cb637.242018","group":"9267186.e0de468","name":"TPL-Volet/cuisine/nord","order":1,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volet nord\"}}\n\n</span>\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":691,"y":78,"wires":[["5b32191e.e1b3b","2ae141b8.5018c6"]]},{"id":"2ae141b8.5018c6","type":"mqtt out","z":"741cb637.242018","name":"Volet/cuisine/nord","topic":"Volet/cuisine/nord","qos":"","retain":"","broker":"9c9224ce.733908","x":981,"y":100,"wires":[]},{"id":"5b32191e.e1b3b","type":"debug","z":"741cb637.242018","name":"","active":false,"console":"false","complete":"false","x":960,"y":58,"wires":[]},{"id":"43090eb.198be7","type":"ui_template","z":"741cb637.242018","group":"9267186.e0de468","name":"TPL-Volet/cuisine/sud","order":3,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volet baie vitrée sud\"}}\n\n</span>\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":689,"y":283,"wires":[["81df1b46.3b7a58","f8212dd4.e3d768"]]},{"id":"f8212dd4.e3d768","type":"mqtt out","z":"741cb637.242018","name":"Volet/cuisine/sud","topic":"Volet/cuisine/sud","qos":"","retain":"","broker":"9c9224ce.733908","x":980,"y":305,"wires":[]},{"id":"81df1b46.3b7a58","type":"debug","z":"741cb637.242018","name":"","active":false,"console":"false","complete":"false","x":959,"y":268,"wires":[]},{"id":"9ba5fe20.1acd38","type":"comment","z":"741cb637.242018","name":"Volets cuisine","info":"","x":659,"y":37,"wires":[]},{"id":"be3a9840.791be8","type":"ui_template","z":"741cb637.242018","group":"4788be41.3da578","name":"TPL-générale","order":2,"width":0,"height":0,"format":"<script>\nfunction restore_icon() {\n        $(this).attr('src',$(this).attr('src').replace(\"_b.png\",\".png\"));\n    };\n \n$('.lightup').on('mousedown', function() {\n    $(this).attr('src',$(this).attr('src').replace(\".png\",\"_b.png\"));  \n    setTimeout(restore_icon.bind(this),500);\n    navigator.vibrate(100);\n    });\n</script>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":102,"y":37,"wires":[[]]},{"id":"11ce521b.b8467e","type":"ui_template","z":"741cb637.242018","group":"eb04833d.a40868","name":"TPL-Volet/chambreParents/nord","order":1,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volet nord\"}}\n</span>\n\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":724,"y":1221,"wires":[["3a18df9f.621ea","331182e1.3a56de"]]},{"id":"331182e1.3a56de","type":"mqtt out","z":"741cb637.242018","name":"Volet/chambreParents/nord","topic":"Volet/chambreParents/nord","qos":"","retain":"","broker":"9c9224ce.733908","x":1021,"y":1243,"wires":[]},{"id":"3a18df9f.621ea","type":"debug","z":"741cb637.242018","name":"","active":false,"console":"false","complete":"false","x":975,"y":1198,"wires":[]},{"id":"76774937.e1b988","type":"comment","z":"741cb637.242018","name":"Volets chambre parents","info":"","x":696,"y":1185,"wires":[]},{"id":"8b1e5584.358d9","type":"ui_template","z":"741cb637.242018","group":"4788be41.3da578","name":"TPL-Volet/salledebain/nord","order":1,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volet nord\"}}\n</span>\n\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":710,"y":1357,"wires":[["2c9c7d58.fd07c2","7d72d81e.5a3108"]]},{"id":"7d72d81e.5a3108","type":"mqtt out","z":"741cb637.242018","name":"Volet/salledebain/nord","topic":"Volet/salledebain/nord","qos":"","retain":"","broker":"9c9224ce.733908","x":989,"y":1377,"wires":[]},{"id":"2c9c7d58.fd07c2","type":"debug","z":"741cb637.242018","name":"","active":false,"console":"false","complete":"false","x":958,"y":1342,"wires":[]},{"id":"bf78d712.2e7098","type":"comment","z":"741cb637.242018","name":"Volets salle de bain","info":"","x":679,"y":1322,"wires":[]},{"id":"e6e59495.0f53f8","type":"ui_template","z":"741cb637.242018","group":"3bec75bf.d008d2","name":"TPL Volet/chambreSarah/nord","order":1,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volet nord\"}}\n</span>\n\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":719,"y":1464,"wires":[["1548ac4.4c5e154","9e0bdddb.38bf58"]]},{"id":"9e0bdddb.38bf58","type":"mqtt out","z":"741cb637.242018","name":"Volet/chambreSarah/nord","topic":"Volet/chambreSarah/nord","qos":"","retain":"","broker":"9c9224ce.733908","x":997,"y":1488,"wires":[]},{"id":"1548ac4.4c5e154","type":"debug","z":"741cb637.242018","name":"","active":false,"console":"false","complete":"false","x":960,"y":1450,"wires":[]},{"id":"780daac4.57d58c","type":"comment","z":"741cb637.242018","name":"Volets chambre Sarah","info":"","x":689,"y":1429,"wires":[]},{"id":"190d1956.3ab257","type":"ui_template","z":"741cb637.242018","group":"3bec75bf.d008d2","name":"TPL Volet/chambreSarah/est1","order":2,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volet est 1\"}}\n</span>\n\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":718,"y":1575,"wires":[["40aa4583.98bc14","2a455ee.19cb922"]]},{"id":"2a455ee.19cb922","type":"mqtt out","z":"741cb637.242018","name":"Volet/chambreSarah/est1","topic":"Volet/chambreSarah/est1","qos":"","retain":"","broker":"9c9224ce.733908","x":998,"y":1600,"wires":[]},{"id":"40aa4583.98bc14","type":"debug","z":"741cb637.242018","name":"","active":false,"console":"false","complete":"false","x":958,"y":1565,"wires":[]},{"id":"caaccf43.53b268","type":"ui_template","z":"741cb637.242018","group":"3bec75bf.d008d2","name":"TPL Volet/chambreSarah/est2","order":3,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volet est 2\"}}\n</span>\n\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":719,"y":1685,"wires":[["22343cc9.aacdec","cc9ddf6c.67bd58"]]},{"id":"cc9ddf6c.67bd58","type":"mqtt out","z":"741cb637.242018","name":"Volet/chambreSarah/est2","topic":"Volet/chambreSarah/est2","qos":"","retain":"","broker":"9c9224ce.733908","x":997,"y":1707,"wires":[]},{"id":"22343cc9.aacdec","type":"debug","z":"741cb637.242018","name":"","active":false,"console":"false","complete":"false","x":957,"y":1671,"wires":[]},{"id":"e1bd6a41.b033f8","type":"ui_template","z":"741cb637.242018","group":"53831c5e.fc1994","name":"TPL Volet/chambreAnais/sud","order":1,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n\n<img class=\"lightup\" src=\"http://domobox//icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volet sud\"}}\n</span>\n\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox//icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox//icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox//icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":709,"y":1816,"wires":[["5dc79740.caba","1ec4d57f.f67e7b"]]},{"id":"1ec4d57f.f67e7b","type":"mqtt out","z":"741cb637.242018","name":"Volet/chambreAnais/sud","topic":"Volet/chambreAnais/sud","qos":"","retain":"","broker":"9c9224ce.733908","x":995,"y":1837,"wires":[]},{"id":"5dc79740.caba","type":"debug","z":"741cb637.242018","name":"","active":false,"console":"false","complete":"false","x":956,"y":1801,"wires":[]},{"id":"7b90e8bb.4f2378","type":"comment","z":"741cb637.242018","name":"Volets chambre Anaïs","info":"","x":687,"y":1780,"wires":[]},{"id":"7e37de56.6c7be8","type":"comment","z":"741cb637.242018","name":"Volets commande générale","info":"","x":138,"y":1120,"wires":[]},{"id":"a4822e2f.3d8c58","type":"ui_template","z":"741cb637.242018","group":"f181328d.2b1328","name":"Volet/All","order":1,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Tous les volets\"}}\n</span>\n\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":95,"y":1161,"wires":[["75a2b946.9612c8"]]},{"id":"7381b705.5fb28","type":"delay","z":"741cb637.242018","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":511,"y":101,"wires":[["2ae141b8.5018c6"]]},{"id":"75a2b946.9612c8","type":"function","z":"741cb637.242018","name":"Répéteur","func":"for (i = 0; i < 3; i++) \n{\n    node.send(msg);\n}","outputs":1,"noerr":0,"x":261,"y":1157,"wires":[["7381b705.5fb28","875adea0.505fe","70cc9d06.ddb604","b84fa5bd.ac5008","d21d7457.afe0c","bb66c070.df24d","1574de4c.6e53ba","1f464ad9.28e4f5","e7411010.4f5fe","5b8dbcef.70e9b4","7bc2db5f.570ca4","140a67b3.c1a6a","125ecccd.5440c3","26697240.671dae","f0ca8964.8fdd18","acd702bd.e1b35","d72a672f.cb577"]]},{"id":"875adea0.505fe","type":"debug","z":"741cb637.242018","name":"","active":false,"console":"false","complete":"false","x":193,"y":1232,"wires":[]},{"id":"70cc9d06.ddb604","type":"delay","z":"741cb637.242018","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":510,"y":217,"wires":[["64fbc705.6d58c8"]]},{"id":"b84fa5bd.ac5008","type":"delay","z":"741cb637.242018","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":510,"y":317,"wires":[["f8212dd4.e3d768"]]},{"id":"d21d7457.afe0c","type":"delay","z":"741cb637.242018","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":525,"y":782,"wires":[["3398f777.3e"]]},{"id":"bb66c070.df24d","type":"delay","z":"741cb637.242018","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":524,"y":899,"wires":[["d6b6abb4.16b6f"]]},{"id":"1574de4c.6e53ba","type":"delay","z":"741cb637.242018","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":522,"y":1013,"wires":[["5b85a67e.d523c"]]},{"id":"1f464ad9.28e4f5","type":"delay","z":"741cb637.242018","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":522,"y":1120,"wires":[["9ac2fba.1078d08"]]},{"id":"e7411010.4f5fe","type":"delay","z":"741cb637.242018","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":523,"y":1249,"wires":[["331182e1.3a56de"]]},{"id":"5b8dbcef.70e9b4","type":"delay","z":"741cb637.242018","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":510,"y":1381,"wires":[["7d72d81e.5a3108"]]},{"id":"7bc2db5f.570ca4","type":"delay","z":"741cb637.242018","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":509,"y":1495,"wires":[["9e0bdddb.38bf58"]]},{"id":"140a67b3.c1a6a","type":"delay","z":"741cb637.242018","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":509,"y":1604,"wires":[["2a455ee.19cb922"]]},{"id":"125ecccd.5440c3","type":"delay","z":"741cb637.242018","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":510,"y":1714,"wires":[["cc9ddf6c.67bd58"]]},{"id":"26697240.671dae","type":"delay","z":"741cb637.242018","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":507,"y":1840,"wires":[["1ec4d57f.f67e7b"]]},{"id":"99d10366.8fe6d8","type":"comment","z":"741cb637.242018","name":"Volets commande rez-de-chaussée","info":"","x":158,"y":301,"wires":[]},{"id":"949a77cf.837bc","type":"ui_template","z":"741cb637.242018","group":"f181328d.2b1328","name":"Volet/rez-de-chaussée","order":1,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n\n<img class=\"lightup\" src=\"http://domobox//icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volets rez-de chaussée\"}}\n</span>\n\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox//icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox//icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox//icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":134,"y":697,"wires":[["7cf4aacd.53af6c"]]},{"id":"8a13659b.7a73c","type":"comment","z":"741cb637.242018","name":"Volets commande étage","info":"","x":132,"y":1442,"wires":[]},{"id":"cf79a351.5990c","type":"ui_template","z":"741cb637.242018","group":"f181328d.2b1328","name":"Volet/étage","order":1,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n\n<img class=\"lightup\" src=\"http://domobox//icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volets étage\"}}\n</span>\n\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox//icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox//icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox//icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":95,"y":1478,"wires":[["3d72084.ded4978"]]},{"id":"7cf4aacd.53af6c","type":"function","z":"741cb637.242018","name":"Répéteur","func":"for (i = 0; i < 3; i++) \n{\n    node.send(msg);\n}","outputs":1,"noerr":0,"x":232,"y":761,"wires":[["7381b705.5fb28","70cc9d06.ddb604","b84fa5bd.ac5008","d21d7457.afe0c","bb66c070.df24d","1574de4c.6e53ba","1f464ad9.28e4f5","67ccd043.68619","f0ca8964.8fdd18","acd702bd.e1b35","d72a672f.cb577"]]},{"id":"3d72084.ded4978","type":"function","z":"741cb637.242018","name":"Répéteur","func":"for (i = 0; i < 3; i++) \n{\n    node.send(msg);\n}","outputs":1,"noerr":0,"x":177,"y":1551,"wires":[["e7411010.4f5fe","5b8dbcef.70e9b4","7bc2db5f.570ca4","140a67b3.c1a6a","125ecccd.5440c3","26697240.671dae","29842878.6092f"]]},{"id":"29842878.6092f","type":"debug","z":"741cb637.242018","name":"","active":false,"console":"false","complete":"false","x":190,"y":1615,"wires":[]},{"id":"67ccd043.68619","type":"debug","z":"741cb637.242018","name":"","active":false,"console":"false","complete":"false","x":238,"y":825,"wires":[]},{"id":"f10c9dbf.d09338","type":"inject","z":"ad39059d.6f22b","name":"Every 5mn","topic":"","payload":"","payloadType":"date","repeat":"900","crontab":"","once":true,"x":111,"y":69,"wires":[["973ecb09.91eaf"]]},{"id":"67e55306.a2c14c","type":"function","z":"ad39059d.6f22b","name":"Set DarkSky global var","func":"try {\nvar weathertest=msg.payload.currently;\nglobal.set(\"DarkSky\",msg.payload);\nnode.send (msg);\n}\ncatch(e) {}","outputs":1,"noerr":0,"x":601,"y":70,"wires":[["ad1c724f.6db2c8"]]},{"id":"973ecb09.91eaf","type":"http request","z":"ad39059d.6f22b","name":"Darksky Json Get","method":"GET","ret":"obj","url":"https://api.darksky.net/forecast/f3ab6a06fb2ea83c99cc578d102848ac/49.213999,-0.400256?units=si&lang=fr","tls":"","x":313,"y":70,"wires":[["67e55306.a2c14c"]]},{"id":"ad1c724f.6db2c8","type":"debug","z":"ad39059d.6f22b","name":"","active":true,"console":"false","complete":"false","x":816,"y":71,"wires":[]},{"id":"97a22bae.0713c","type":"inject","z":"ad39059d.6f22b","name":"Every 5mn","topic":"","payload":"","payloadType":"date","repeat":"900","crontab":"","once":true,"x":106,"y":530,"wires":[["d31a4ca5.cc7518","278d333.6fa97cc","885bb362.97d21","61c757d7.0319b8","2ad48fc4.22d078","cb2b3b71.f40a4","cc40bcd2.db1d58","6cbb7d75.293a2c","d44cf0a4.aebd78"]]},{"id":"d31a4ca5.cc7518","type":"function","z":"ad39059d.6f22b","name":"Get DarkSky global var","func":"try {\nmsg.payload=global.get(\"DarkSky\").currently.icon;\nnode.send(msg);\n}\ncatch(e) {}","outputs":1,"noerr":0,"x":383,"y":397,"wires":[["e6cd190f.26cd88"]]},{"id":"e3f85340.158b18","type":"ui_template","z":"ad39059d.6f22b","group":"2c6fed05.f231ea","name":"TPL","order":9,"width":0,"height":0,"format":"<style>\n  .filled { \n      height: 100% !important;\n \n      padding: 0 !important;\n      margin: 0 !important;\n  }\n  .nr-dashboard-template {\n      padding: 0;\n      margin: 0;\n  }\n   \n  .rounded {\n  border-radius: 12px 12px 12px 12px;\n}\n  \n   .bigfont {\n  font-size: 18px;\n}\n \n   .smallfont {\n  font-size: 12px;\n}\n   \n</style>\n \n<script>\n$('.vibrate').on('click', function() {\n  navigator.vibrate(100);\n});\n \nfunction restore_bg(x) {\n            $(this).css(\"background-color\", x);\n    };\n \n$('.touched').on('mousedown', function() {\n    var x= $(this).css(\"background-color\");\n    $(this).css(\"background-color\", \"yellow\");\n     \n    setTimeout(restore_bg.bind(this,x),200);\n    navigator.vibrate(80);\n    });\n     \n</script>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":608,"y":345,"wires":[[]]},{"id":"278d333.6fa97cc","type":"function","z":"ad39059d.6f22b","name":"Get DarkSky global var J+1","func":"try {\nmsg.payload=global.get(\"DarkSky\").daily.data[2].icon;\nnode.send(msg);\n}\ncatch(e) {}","outputs":1,"noerr":0,"x":390,"y":443,"wires":[["f481cef6.71ca1"]]},{"id":"7ffd88e2.3f8088","type":"debug","z":"ad39059d.6f22b","name":"","active":false,"console":"false","complete":"false","x":764,"y":397,"wires":[]},{"id":"e6cd190f.26cd88","type":"ui_template","z":"ad39059d.6f22b","group":"2c6fed05.f231ea","name":"Day","order":3,"width":"1","height":"1","format":"<script src=\"/myjs/skycons.js\"></script>\n \n<canvas id=\"icon1\"  width=\"50\" height=\"50\"></canvas>\n \n<script>\nvar skycons = new Skycons({\"monochrome\": false, \n                \"colors\": { \n                      \"main\": \"#779966\", \n                      \"moon\":\"#666666\",\n                      \"fog\": \"#555522\",\n                      \"fogbank\": \"#884488\",\n                      \"cloud\": \"#999999\",\n                      \"snow\": \"#aaaaaa\",\n                      \"leaf\":\"#00ff00\",\n                      \"rain\": \"#0000ff\",\n                      \"sun\": \"#ff3300\"\n                    } });\nskycons.add(\"icon1\", Skycons.PARTLY_CLOUDY_DAY);\nskycons.play();\n \n    (function(scope) {\n        scope.$watch('msg.payload', function(data) {\n           if (data==\"clear-day\") skycons.set(\"icon1\", Skycons.CLEAR_DAY);\n           if (data==\"clear-night\") skycons.set(\"icon1\", Skycons.CLEAR_NIGHT);\n           if (data==\"partly-cloudy-day\") skycons.set(\"icon1\", Skycons.PARTLY_CLOUDY_DAY);\n           if (data==\"partly-cloudy-night\") skycons.set(\"icon1\", Skycons.PARTLY_CLOUDY_NIGHT);\n           if (data==\"cloudy\") skycons.set(\"icon1\", Skycons.CLOUDY);\n           if (data==\"rain\") skycons.set(\"icon1\", Skycons.RAIN);\n           if (data==\"sleet\") skycons.set(\"icon1\", Skycons.SLEET);\n           if (data==\"snow\") skycons.set(\"icon1\", Skycons.SNOW);\n           if (data==\"wind\") skycons.set(\"icon1\", Skycons.WIND);\n           if (data==\"fog\") skycons.set(\"icon1\", Skycons.FOG);\n        });\n    })(scope);\n \n</script>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":602,"y":397,"wires":[["7ffd88e2.3f8088"]]},{"id":"f481cef6.71ca1","type":"ui_template","z":"ad39059d.6f22b","group":"2c6fed05.f231ea","name":"Day+1","order":4,"width":"1","height":"1","format":"<canvas id=\"icon2\"  width=\"50\" height=\"50\"></canvas>\n \n<script>\nvar skycons = new Skycons({\"monochrome\": false, \n                \"colors\": { \n                      \"main\": \"#779966\", \n                      \"moon\":\"#666666\",\n                      \"fog\": \"#555522\",\n                      \"fogbank\": \"#884488\",\n                      \"cloud\": \"#999999\",\n                      \"snow\": \"#aaaaaa\",\n                      \"leaf\":\"#00ff00\",\n                      \"rain\": \"#0000ff\",\n                      \"sun\": \"#ff3300\"\n                    } });\nskycons.add(\"icon2\", Skycons.PARTLY_CLOUDY_DAY);\nskycons.play();\n \n    (function(scope) {\n        scope.$watch('msg.payload', function(data) {\n           if (data==\"clear-day\") skycons.set(\"icon2\", Skycons.CLEAR_DAY);\n           if (data==\"clear-night\") skycons.set(\"icon2\", Skycons.CLEAR_NIGHT);\n           if (data==\"partly-cloudy-day\") skycons.set(\"icon2\", Skycons.PARTLY_CLOUDY_DAY);\n           if (data==\"partly-cloudy-night\") skycons.set(\"icon2\", Skycons.PARTLY_CLOUDY_NIGHT);\n           if (data==\"cloudy\") skycons.set(\"icon2\", Skycons.CLOUDY);\n           if (data==\"rain\") skycons.set(\"icon2\", Skycons.RAIN);\n           if (data==\"sleet\") skycons.set(\"icon2\", Skycons.SLEET);\n           if (data==\"snow\") skycons.set(\"icon2\", Skycons.SNOW);\n           if (data==\"wind\") skycons.set(\"icon2\", Skycons.WIND);\n           if (data==\"fog\") skycons.set(\"icon2\", Skycons.FOG);\n        });\n    })(scope);\n \n</script>","storeOutMessages":true,"fwdInMessages":true,"x":601,"y":443,"wires":[["479af388.c1ec3c"]]},{"id":"96f96e9a.7c836","type":"ui_template","z":"ad39059d.6f22b","group":"2c6fed05.f231ea","name":"Day+2","order":5,"width":"1","height":"1","format":"<canvas id=\"icon3\"  width=\"50\" height=\"50\"></canvas>\n \n<script>\nvar skycons = new Skycons({\"monochrome\": false, \n                \"colors\": { \n                      \"main\": \"#779966\", \n                      \"moon\":\"#666666\",\n                      \"fog\": \"#555522\",\n                      \"fogbank\": \"#884488\",\n                      \"cloud\": \"#999999\",\n                      \"snow\": \"#aaaaaa\",\n                      \"leaf\":\"#00ff00\",\n                      \"rain\": \"#0000ff\",\n                      \"sun\": \"#ff3300\"\n                    } });\nskycons.add(\"icon3\", Skycons.PARTLY_CLOUDY_DAY);\nskycons.play();\n \n    (function(scope) {\n        scope.$watch('msg.payload', function(data) {\n           if (data==\"clear-day\") skycons.set(\"icon3\", Skycons.CLEAR_DAY);\n           if (data==\"clear-night\") skycons.set(\"icon3\", Skycons.CLEAR_NIGHT);\n           if (data==\"partly-cloudy-day\") skycons.set(\"icon3\", Skycons.PARTLY_CLOUDY_DAY);\n           if (data==\"partly-cloudy-night\") skycons.set(\"icon3\", Skycons.PARTLY_CLOUDY_NIGHT);\n           if (data==\"cloudy\") skycons.set(\"icon3\", Skycons.CLOUDY);\n           if (data==\"rain\") skycons.set(\"icon3\", Skycons.RAIN);\n           if (data==\"sleet\") skycons.set(\"icon3\", Skycons.SLEET);\n           if (data==\"snow\") skycons.set(\"icon3\", Skycons.SNOW);\n           if (data==\"wind\") skycons.set(\"icon3\", Skycons.WIND);\n           if (data==\"fog\") skycons.set(\"icon3\", Skycons.FOG);\n        });\n    })(scope);\n \n</script>","storeOutMessages":true,"fwdInMessages":true,"x":599,"y":494,"wires":[["f42cd93a.3cfb3"]]},{"id":"580190ad.3b3808","type":"ui_template","z":"ad39059d.6f22b","group":"2c6fed05.f231ea","name":"Day+3","order":6,"width":"1","height":"1","format":"<canvas id=\"icon4\"  width=\"50\" height=\"50\"></canvas>\n \n<script>\nvar skycons = new Skycons({\"monochrome\": false, \n                \"colors\": { \n                      \"main\": \"#779966\", \n                      \"moon\":\"#666666\",\n                      \"fog\": \"#555522\",\n                      \"fogbank\": \"#884488\",\n                      \"cloud\": \"#999999\",\n                      \"snow\": \"#aaaaaa\",\n                      \"leaf\":\"#00ff00\",\n                      \"rain\": \"#0000ff\",\n                      \"sun\": \"#ff3300\"\n                    } });\nskycons.add(\"icon4\", Skycons.PARTLY_CLOUDY_DAY);\nskycons.play();\n \n    (function(scope) {\n        scope.$watch('msg.payload', function(data) {\n           if (data==\"clear-day\") skycons.set(\"icon4\", Skycons.CLEAR_DAY);\n           if (data==\"clear-night\") skycons.set(\"icon4\", Skycons.CLEAR_NIGHT);\n           if (data==\"partly-cloudy-day\") skycons.set(\"icon4\", Skycons.PARTLY_CLOUDY_DAY);\n           if (data==\"partly-cloudy-night\") skycons.set(\"icon4\", Skycons.PARTLY_CLOUDY_NIGHT);\n           if (data==\"cloudy\") skycons.set(\"icon4\", Skycons.CLOUDY);\n           if (data==\"rain\") skycons.set(\"icon4\", Skycons.RAIN);\n           if (data==\"sleet\") skycons.set(\"icon4\", Skycons.SLEET);\n           if (data==\"snow\") skycons.set(\"icon4\", Skycons.SNOW);\n           if (data==\"wind\") skycons.set(\"icon4\", Skycons.WIND);\n           if (data==\"fog\") skycons.set(\"icon4\", Skycons.FOG);\n        });\n    })(scope);\n \n</script>","storeOutMessages":true,"fwdInMessages":true,"x":600,"y":543,"wires":[["df61437a.74ad88"]]},{"id":"540482b.bfd607c","type":"ui_template","z":"ad39059d.6f22b","group":"2c6fed05.f231ea","name":"Day+4","order":7,"width":"1","height":"1","format":"<canvas id=\"icon5\"  width=\"50\" height=\"50\"></canvas>\n \n<script>\nvar skycons = new Skycons({\"monochrome\": false, \n                \"colors\": { \n                      \"main\": \"#779966\", \n                      \"moon\":\"#666666\",\n                      \"fog\": \"#555522\",\n                      \"fogbank\": \"#884488\",\n                      \"cloud\": \"#999999\",\n                      \"snow\": \"#aaaaaa\",\n                      \"leaf\":\"#00ff00\",\n                      \"rain\": \"#0000ff\",\n                      \"sun\": \"#ff3300\"\n                    } });\nskycons.add(\"icon5\", Skycons.PARTLY_CLOUDY_DAY);\nskycons.play();\n \n    (function(scope) {\n        scope.$watch('msg.payload', function(data) {\n           if (data==\"clear-day\") skycons.set(\"icon5\", Skycons.CLEAR_DAY);\n           if (data==\"clear-night\") skycons.set(\"icon5\", Skycons.CLEAR_NIGHT);\n           if (data==\"partly-cloudy-day\") skycons.set(\"icon5\", Skycons.PARTLY_CLOUDY_DAY);\n           if (data==\"partly-cloudy-night\") skycons.set(\"icon5\", Skycons.PARTLY_CLOUDY_NIGHT);\n           if (data==\"cloudy\") skycons.set(\"icon5\", Skycons.CLOUDY);\n           if (data==\"rain\") skycons.set(\"icon5\", Skycons.RAIN);\n           if (data==\"sleet\") skycons.set(\"icon5\", Skycons.SLEET);\n           if (data==\"snow\") skycons.set(\"icon5\", Skycons.SNOW);\n           if (data==\"wind\") skycons.set(\"icon5\", Skycons.WIND);\n           if (data==\"fog\") skycons.set(\"icon5\", Skycons.FOG);\n        });\n    })(scope);\n \n</script>","storeOutMessages":true,"fwdInMessages":true,"x":600,"y":596,"wires":[["d41fdd2.665c8a"]]},{"id":"61fc2d73.66c774","type":"ui_template","z":"ad39059d.6f22b","group":"2c6fed05.f231ea","name":"Day+5","order":8,"width":"1","height":"1","format":"<canvas id=\"icon6\"  width=\"50\" height=\"50\"></canvas>\n \n<script>\nvar skycons = new Skycons({\"monochrome\": false, \n                \"colors\": { \n                      \"main\": \"#779966\", \n                      \"moon\":\"#666666\",\n                      \"fog\": \"#555522\",\n                      \"fogbank\": \"#884488\",\n                      \"cloud\": \"#999999\",\n                      \"snow\": \"#aaaaaa\",\n                      \"leaf\":\"#00ff00\",\n                      \"rain\": \"#0000ff\",\n                      \"sun\": \"#ff3300\"\n                    } });\nskycons.add(\"icon6\", Skycons.PARTLY_CLOUDY_DAY);\nskycons.play();\n \n    (function(scope) {\n        scope.$watch('msg.payload', function(data) {\n           if (data==\"clear-day\") skycons.set(\"icon6\", Skycons.CLEAR_DAY);\n           if (data==\"clear-night\") skycons.set(\"icon6\", Skycons.CLEAR_NIGHT);\n           if (data==\"partly-cloudy-day\") skycons.set(\"icon6\", Skycons.PARTLY_CLOUDY_DAY);\n           if (data==\"partly-cloudy-night\") skycons.set(\"icon6\", Skycons.PARTLY_CLOUDY_NIGHT);\n           if (data==\"cloudy\") skycons.set(\"icon6\", Skycons.CLOUDY);\n           if (data==\"rain\") skycons.set(\"icon6\", Skycons.RAIN);\n           if (data==\"sleet\") skycons.set(\"icon6\", Skycons.SLEET);\n           if (data==\"snow\") skycons.set(\"icon6\", Skycons.SNOW);\n           if (data==\"wind\") skycons.set(\"icon6\", Skycons.WIND);\n           if (data==\"fog\") skycons.set(\"icon6\", Skycons.FOG);\n        });\n    })(scope);\n \n</script>","storeOutMessages":true,"fwdInMessages":true,"x":598,"y":646,"wires":[["ee38af47.994d88"]]},{"id":"885bb362.97d21","type":"function","z":"ad39059d.6f22b","name":"Get DarkSky global var J+2","func":"try {\nmsg.payload=global.get(\"DarkSky\").daily.data[3].icon;\nnode.send(msg);\n}\ncatch(e) {}","outputs":1,"noerr":0,"x":386,"y":493,"wires":[["96f96e9a.7c836"]]},{"id":"61c757d7.0319b8","type":"function","z":"ad39059d.6f22b","name":"Get DarkSky global var J+3","func":"try {\nmsg.payload=global.get(\"DarkSky\").daily.data[4].icon;\nnode.send(msg);\n}\ncatch(e) {}","outputs":1,"noerr":0,"x":387,"y":543,"wires":[["580190ad.3b3808"]]},{"id":"2ad48fc4.22d078","type":"function","z":"ad39059d.6f22b","name":"Get DarkSky global var J+4","func":"try {\nmsg.payload=global.get(\"DarkSky\").daily.data[5].icon;\nnode.send(msg);\n}\ncatch(e) {}","outputs":1,"noerr":0,"x":390,"y":595,"wires":[["540482b.bfd607c"]]},{"id":"cb2b3b71.f40a4","type":"function","z":"ad39059d.6f22b","name":"Get DarkSky global var J+5","func":"try {\nmsg.payload=global.get(\"DarkSky\").daily.data[6].icon;\nnode.send(msg);\n}\ncatch(e) {}","outputs":1,"noerr":0,"x":390,"y":646,"wires":[["61fc2d73.66c774"]]},{"id":"479af388.c1ec3c","type":"debug","z":"ad39059d.6f22b","name":"","active":false,"console":"false","complete":"false","x":766,"y":443,"wires":[]},{"id":"f42cd93a.3cfb3","type":"debug","z":"ad39059d.6f22b","name":"","active":false,"console":"false","complete":"false","x":765,"y":494,"wires":[]},{"id":"df61437a.74ad88","type":"debug","z":"ad39059d.6f22b","name":"","active":false,"console":"false","complete":"false","x":767,"y":543,"wires":[]},{"id":"d41fdd2.665c8a","type":"debug","z":"ad39059d.6f22b","name":"","active":false,"console":"false","complete":"false","x":766,"y":595,"wires":[]},{"id":"ee38af47.994d88","type":"debug","z":"ad39059d.6f22b","name":"","active":false,"console":"false","complete":"false","x":769,"y":646,"wires":[]},{"id":"cc40bcd2.db1d58","type":"function","z":"ad39059d.6f22b","name":"Day-week","func":"(function() {\n    //var days = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];\n    //var days = ['Dimanche','Lundi','Mardi','Mercredi','jeudi','Vendredi','Samedi'];\n    //var days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];\n    var days = ['Dim','Lun','Mar','Mer','Jeu','Ven','Sam'];\n\n    var months = ['January','February','March','April','May','June','July','August','September','October','November','December'];\n\n    Date.prototype.getMonthName = function() {\n        return months[ this.getMonth() ];\n    };\n    Date.prototype.getDayName = function() {\n        return days[ this.getDay() ];\n    };\n    \n    Date.prototype.addDays = function(days) {\n        this.setDate(this.getDate() + parseInt(days));\n    return this;\n    };\n})();\n\nmsg = {};\nvar now = new Date();\n//msg.d0 = now.getDayName();\nmsg.d0 = new Date().addDays(1).getDayName() \nmsg.d1 = new Date().addDays(2).getDayName(); //+1 days\nmsg.d2 = new Date().addDays(3).getDayName(); //+2 days\nmsg.d3 = new Date().addDays(4).getDayName(); //+3 days\nmsg.d4 = new Date().addDays(5).getDayName(); //+4 days\nmsg.d5 = new Date().addDays(6).getDayName(); //+5 days\n\nmsg.payload=msg.d0;\nvar month = now.getMonthName();\n        node.status({text:msg.payload});\n        \nreturn msg;","outputs":1,"noerr":0,"x":345,"y":160,"wires":[["9403a719.d306f8","2fb08359.d8d494"]]},{"id":"9403a719.d306f8","type":"ui_template","z":"ad39059d.6f22b","group":"2c6fed05.f231ea","name":"Day-Week","order":1,"width":"6","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:0px; text-align: left; margin:2px; border:2px solid white;\">\n<span style=\"width:17%;padding-top:5px;padding-left:5px;\">{{msg.d0}}</span>\n<span style=\"width:16%;padding-top:5px;padding-left:5px;\">{{msg.d1}}</span>\n<span style=\"width:16%;padding-top:5px;padding-left:5px;\">{{msg.d2}}</span>\n<span style=\"width:16%;padding-top:5px;padding-left:5px;\">{{msg.d3}}</span>\n<span style=\"width:16%;padding-top:5px;padding-left:5px;\">{{msg.d4}}</span>\n<span style=\"width:16%;padding-top:5px;padding-left:5px;\">{{msg.d5}}</span>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":628,"y":140,"wires":[[]]},{"id":"2fb08359.d8d494","type":"debug","z":"ad39059d.6f22b","name":"","active":false,"console":"false","complete":"true","x":604,"y":190,"wires":[]},{"id":"6cbb7d75.293a2c","type":"function","z":"ad39059d.6f22b","name":"T° Min/Max","func":"try {\n    msg.tmin1=Math.round(global.get(\"DarkSky\").daily.data[1].temperatureMin);\n    msg.tmin2=Math.round(global.get(\"DarkSky\").daily.data[2].temperatureMin);\n    msg.tmin3=Math.round(global.get(\"DarkSky\").daily.data[3].temperatureMin);\n    msg.tmin4=Math.round(global.get(\"DarkSky\").daily.data[4].temperatureMin);\n    msg.tmin5=Math.round(global.get(\"DarkSky\").daily.data[5].temperatureMin);\n    msg.tmin6=Math.round(global.get(\"DarkSky\").daily.data[6].temperatureMin);\n    \n    msg.tmax1=Math.round(global.get(\"DarkSky\").daily.data[1].temperatureMax);\n    msg.tmax2=Math.round(global.get(\"DarkSky\").daily.data[2].temperatureMax);\n    msg.tmax3=Math.round(global.get(\"DarkSky\").daily.data[3].temperatureMax);\n    msg.tmax4=Math.round(global.get(\"DarkSky\").daily.data[4].temperatureMax);\n    msg.tmax5=Math.round(global.get(\"DarkSky\").daily.data[5].temperatureMax);\n    msg.tmax6=Math.round(global.get(\"DarkSky\").daily.data[6].temperatureMax);\n    \n    node.send (msg);\n}\ncatch(e) {}\n//return msg;","outputs":1,"noerr":0,"x":355,"y":258,"wires":[["72165775.8a53d","41084e8a.601e"]]},{"id":"72165775.8a53d","type":"ui_template","z":"ad39059d.6f22b","group":"2c6fed05.f231ea","name":"T° Min/Max","order":2,"width":"6","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:0px; text-align: left; margin:2px; border:2px solid white;\">\n<span style=\"width:17%;padding-top:5px;padding-left:5px;\">{{msg.tmin1 + \"°/\" + msg.tmax1 + \"°\"}}</span>\n<span style=\"width:16%;padding-top:5px;padding-left:5px;\">{{msg.tmin2 + \"°/\" + msg.tmax2 + \"°\"}}</span>\n<span style=\"width:16%;padding-top:5px;padding-left:5px;\">{{msg.tmin3 + \"°/\" + msg.tmax3 + \"°\"}}</span>\n<span style=\"width:16%;padding-top:5px;padding-left:5px;\">{{msg.tmin4 + \"°/\" + msg.tmax4 + \"°\"}}</span>\n<span style=\"width:16%;padding-top:5px;padding-left:5px;\">{{msg.tmin5 + \"°/\" + msg.tmax5 + \"°\"}}</span>\n<span style=\"width:16%;padding-top:5px;padding-left:5px;\">{{msg.tmin6 + \"°/\" + msg.tmax6 + \"°\"}}</span>\n</div>","storeOutMessages":true,"fwdInMessages":true,"x":633,"y":239,"wires":[[]]},{"id":"41084e8a.601e","type":"debug","z":"ad39059d.6f22b","name":"","active":false,"console":"false","complete":"true","x":610,"y":282,"wires":[]},{"id":"933ef1b6.c44268","type":"ui_template","z":"65265671.c010f8","group":"8b1773d1.02b85","name":"TPL-Volet/veranda/est1","order":10,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Pan fixe est\"}}\n\n</span>\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":763,"y":1257,"wires":[["e2b470d.909ff9"]]},{"id":"e2b470d.909ff9","type":"mqtt out","z":"65265671.c010f8","name":"Volet/veranda/est1","topic":"Volet/veranda/est1","qos":"","retain":"","broker":"9c9224ce.733908","x":1041,"y":1276,"wires":[]},{"id":"c800c1d1.d547f","type":"ui_template","z":"65265671.c010f8","group":"8b1773d1.02b85","name":"TPL-Volet/veranda/est2","order":11,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\" Pan mobile est\"}}\n\n</span>\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":761,"y":1374,"wires":[["43eb9230.393a34"]]},{"id":"43eb9230.393a34","type":"mqtt out","z":"65265671.c010f8","name":"Volet/veranda/est2","topic":"Volet/veranda/est2","qos":"","retain":"","broker":"9c9224ce.733908","x":1044,"y":1399,"wires":[]},{"id":"95cbfe8c.643a48","type":"ui_template","z":"65265671.c010f8","group":"8b1773d1.02b85","name":"TPL-Volet/veranda/sud1","order":12,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Pan mobile sud\"}}\n\n</span>\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":761,"y":1485,"wires":[["5ad2295d.a2f39"]]},{"id":"5ad2295d.a2f39","type":"mqtt out","z":"65265671.c010f8","name":"Volet/veranda/sud1","topic":"Volet/veranda/sud1","qos":"","retain":"","broker":"9c9224ce.733908","x":1040,"y":1506,"wires":[]},{"id":"b9aceac.5546d18","type":"ui_template","z":"65265671.c010f8","group":"8b1773d1.02b85","name":"TPL-Volet/veranda/sud2","order":13,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Pan fixe sud\"}}\n\n</span>\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":764,"y":1586,"wires":[["e3de42b0.418ba8"]]},{"id":"e3de42b0.418ba8","type":"mqtt out","z":"65265671.c010f8","name":"Volet/veranda/sud2","topic":"Volet/veranda/sud2","qos":"","retain":"","broker":"9c9224ce.733908","x":1042,"y":1610,"wires":[]},{"id":"b2d9a8f0.4a126","type":"delay","z":"65265671.c010f8","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":585,"y":1280,"wires":[["e2b470d.909ff9"]]},{"id":"f54c8c98.1c7fa","type":"delay","z":"65265671.c010f8","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":584,"y":1397,"wires":[["43eb9230.393a34"]]},{"id":"ccc85ef9.5641f","type":"delay","z":"65265671.c010f8","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":582,"y":1511,"wires":[["5ad2295d.a2f39"]]},{"id":"4ae4abb.3d5b9d4","type":"delay","z":"65265671.c010f8","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":582,"y":1618,"wires":[["e3de42b0.418ba8"]]},{"id":"c53c23e5.256518","type":"comment","z":"65265671.c010f8","name":"Volets véranda","info":"","x":100,"y":1160,"wires":[]},{"id":"60b0677e.19ee2","type":"ui_template","z":"65265671.c010f8","group":"8b1773d1.02b85","name":"Volet/Véranda","order":9,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Tous\"}}\n</span>\n\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":94,"y":1336,"wires":[["6722676c.a29d28"]]},{"id":"6722676c.a29d28","type":"function","z":"65265671.c010f8","name":"Répéteur","func":"for (i = 0; i < 1; i++) \n{\n    node.send(msg);\n}\n","outputs":1,"noerr":0,"x":311,"y":1337,"wires":[["b2d9a8f0.4a126","f54c8c98.1c7fa","ccc85ef9.5641f","4ae4abb.3d5b9d4","47276f4a.e43fa"]]},{"id":"47276f4a.e43fa","type":"debug","z":"65265671.c010f8","name":"","active":false,"console":"false","complete":"false","x":317,"y":1401,"wires":[]},{"id":"17ba0862.082cb","type":"ui_template","z":"65265671.c010f8","group":"8b1773d1.02b85","name":"TPL-générale","order":17,"width":"1","height":"1","format":"<script>\nfunction restore_icon() {\n        $(this).attr('src',$(this).attr('src').replace(\"_b.png\",\".png\"));\n    };\n \n$('.lightup').on('mousedown', function() {\n    $(this).attr('src',$(this).attr('src').replace(\".png\",\"_b.png\"));  \n    setTimeout(restore_icon.bind(this),500);\n    navigator.vibrate(100);\n    });\n</script>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":99,"y":1512,"wires":[[]]},{"id":"5ce171d5.3416a","type":"comment","z":"65265671.c010f8","name":"Véranda : Caméra","info":"","x":110,"y":780,"wires":[]},{"id":"d44cf0a4.aebd78","type":"function","z":"ad39059d.6f22b","name":"Get DarkSky global var J Moon","func":"try {\nmsg.payload=global.get(\"DarkSky\").daily.data[0].moonPhase;\nnode.send(msg);\n}\ncatch(e) {}","outputs":1,"noerr":0,"x":403,"y":833,"wires":[["559a1c40.a0198c"]]},{"id":"559a1c40.a0198c","type":"debug","z":"ad39059d.6f22b","name":"","active":true,"console":"false","complete":"payload","x":677,"y":835,"wires":[]},{"id":"d3ca740d.be3c78","type":"ui_text","z":"77ef16e7.a27228","group":"8aa34793.811b08","order":13,"width":0,"height":0,"name":"Seuil humidité lancement VMC","label":"Seuil humidité lancement VMC : ","format":"{{msg.payload}}%","layout":"row-spread","x":469,"y":1104,"wires":[]},{"id":"1d7b7b25.f148bd","type":"owntracks","z":"bef0923b.0da65","x":530,"y":89,"wires":[["7aeaa618.f2c938"]]},{"id":"48bc6eba.0e924","type":"json","z":"bef0923b.0da65","name":"","x":342,"y":88,"wires":[["1d7b7b25.f148bd"]]},{"id":"7aeaa618.f2c938","type":"debug","z":"bef0923b.0da65","name":"","active":true,"console":"false","complete":"false","x":747.5,"y":89,"wires":[]},{"id":"c4dfeab9.4f3208","type":"comment","z":"bef0923b.0da65","name":"Message MQTT envoye si geolocalisation dans la zone Home Work near ou Out Geofence","info":"","x":342,"y":517,"wires":[]},{"id":"584d8df0.4feadc","type":"comment","z":"bef0923b.0da65","name":"Coordonnees geolocalisation","info":"","x":550,"y":180,"wires":[]},{"id":"e7320485.506ff","type":"comment","z":"bef0923b.0da65","name":"Message owntracks","info":"","x":541.5,"y":42,"wires":[]},{"id":"87e00261.15363","type":"ui_template","z":"65265671.c010f8","group":"8b1773d1.02b85","name":"Volet/Véranda MY","order":8,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volets véranda MY\"}}\n</span>\n\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-my.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":114,"y":1217,"wires":[["6d82efdf.1aa748","6722676c.a29d28"]]},{"id":"6d82efdf.1aa748","type":"delay","z":"65265671.c010f8","name":"Delay MY","pauseType":"delay","timeout":"17","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":304,"y":1220,"wires":[["12eb2a16.bc0abe","d5f90531.cccd1"]]},{"id":"12eb2a16.bc0abe","type":"debug","z":"65265671.c010f8","name":"","active":false,"console":"false","complete":"false","x":330,"y":1160,"wires":[]},{"id":"d5f90531.cccd1","type":"function","z":"65265671.c010f8","name":"Volet-stop","func":"msg.payload = \"stop\"\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":474,"y":1218,"wires":[["6722676c.a29d28"]]},{"id":"d72af6c8.8f53c8","type":"mqtt out","z":"d516a408.b180d","name":"","topic":"/P-Garage2/gpio/12","qos":"0","retain":"","broker":"9c9224ce.733908","x":1114,"y":107,"wires":[]},{"id":"99c9dc1a.ab02f8","type":"function","z":"d516a408.b180d","name":"Relais down","func":"if (msg.payload == \"1\") {\n    msg.payload = \"0\";\n    } \n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":893,"y":107,"wires":[["d72af6c8.8f53c8","5dbef003.146bb"]]},{"id":"5dbef003.146bb","type":"debug","z":"d516a408.b180d","name":"","active":true,"console":"false","complete":"false","x":1115,"y":40,"wires":[]},{"id":"b5cade.3f3d7d2","type":"comment","z":"d516a408.b180d","name":"Fonctionnement type bouton poussoir","info":"","x":686,"y":55,"wires":[]},{"id":"a3876eb0.a83308","type":"delay","z":"d516a408.b180d","name":"500ms","pauseType":"delay","timeout":"500","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":734.5,"y":107,"wires":[["99c9dc1a.ab02f8"]]},{"id":"f282d150.d58c4","type":"switch","z":"d516a408.b180d","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"eq","v":"1","vt":"str"}],"checkall":"true","outputs":2,"x":586.5,"y":100,"wires":[[],["a3876eb0.a83308"]]},{"id":"f866264d.6a536","type":"comment","z":"d516a408.b180d","name":"Ouverture","info":"","x":90,"y":488,"wires":[]},{"id":"2e505c16.705f1c","type":"comment","z":"d516a408.b180d","name":"Test led","info":"","x":76,"y":558,"wires":[]},{"id":"6c30ebee.58ec8c","type":"mqtt in","z":"d516a408.b180d","name":"Garage1/XIAOMI/Door","topic":"Garage1/XIAOMI/Door","qos":"2","broker":"9c9224ce.733908","x":400,"y":359,"wires":[["c58ec01.299c8c"]]},{"id":"c58ec01.299c8c","type":"function","z":"d516a408.b180d","name":"Ouvert-Fermé","func":"if (msg.payload == 1) {\n    msg.payload=\"ouvert\";\n    } \nelse {\n    msg.payload=\"fermé\";\n    }\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":630,"y":358,"wires":[["88e2176c.e8e98"]]},{"id":"88e2176c.e8e98","type":"ui_text","z":"d516a408.b180d","group":"133e033c.62ce2d","order":2,"width":"4","height":"1","name":"","label":"Petite porte","format":"{{msg.payload}}","layout":"","x":821.5,"y":357.93994140625,"wires":[]},{"id":"7bbd7877.657c68","type":"comment","z":"d516a408.b180d","name":"gpio1 : Petite porte switch","info":"","x":141,"y":360,"wires":[]},{"id":"2cb86347.e8473c","type":"ui_switch","z":"d516a408.b180d","name":"","label":"Activer","group":"133e033c.62ce2d","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":345,"y":702,"wires":[[]]},{"id":"6a7b184b.2e1e88","type":"ui_switch","z":"d516a408.b180d","name":"","label":"Géolocaliser","group":"133e033c.62ce2d","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":357,"y":756,"wires":[[]]},{"id":"e20468c3.85dc58","type":"mqtt in","z":"bef0923b.0da65","name":"","topic":"owntracks/CP/CP/#","qos":"2","broker":"9c9224ce.733908","x":144,"y":1505,"wires":[["83a80e4c.530b18"]]},{"id":"8eaa0413.6ef378","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":617,"y":133,"wires":[]},{"id":"86292088.0dbcb","type":"function","z":"b5752a43.1c1f2","name":"VR Cuisine est","func":"//msg.payload = \"down\"\n//msg.payload = \"up\"\n//msg.payload = \"stop\"\nmsg.volet = msg.payload;\nmsg.topic=\"rfy/050502/01 \";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":364,"y":156,"wires":[["8eaa0413.6ef378","47d3e642.f5f18"]]},{"id":"984575e.bfc3f08","type":"bigtimer","z":"b5752a43.1c1f2","outtopic":"","outpayload1":"up","outpayload2":"down","name":"Volets up & down week hivers","lat":"49.213999","lon":"-0.400256","starttime":"5003","endtime":"5004","startoff":"-15","endoff":"+20","offs":0,"outtext1":"up","outtext2":"down","timeout":1440,"sun":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":false,"jan":true,"feb":true,"mar":true,"apr":true,"may":false,"jun":false,"jul":false,"aug":false,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":false,"odd":false,"even":false,"x":370,"y":1740,"wires":[["481ab483.f25724","6c961451.a17894","c4ebef1f.cc6a78"],[],[]]},{"id":"481ab483.f25724","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"console":"false","complete":"payload","x":1258,"y":2374,"wires":[]},{"id":"f2025e33.129398","type":"inject","z":"b5752a43.1c1f2","name":"Up","topic":"on","payload":"on","payloadType":"str","repeat":"","crontab":"","once":false,"x":114,"y":1833.5,"wires":[["984575e.bfc3f08","e99cd782.2597e8","45c09455.91cdcc","10fc720e.7cbc1e"]]},{"id":"6899550c.0fba8c","type":"inject","z":"b5752a43.1c1f2","name":"Down","topic":"off","payload":"off","payloadType":"str","repeat":"","crontab":"","once":false,"x":112,"y":1874.5,"wires":[["984575e.bfc3f08","e99cd782.2597e8","45c09455.91cdcc","10fc720e.7cbc1e"]]},{"id":"8f361046.2a58b","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/cuisine/est","topic":"Volet/cuisine/est","qos":"","retain":"","broker":"9c9224ce.733908","x":1071,"y":1700,"wires":[]},{"id":"8146c159.b2f5","type":"comment","z":"b5752a43.1c1f2","name":"Volet/cuisine/est","info":"","x":90,"y":120,"wires":[]},{"id":"c78256d8.8c73a8","type":"inject","z":"b5752a43.1c1f2","name":"Auto","topic":"","payload":"auto","payloadType":"str","repeat":"","crontab":"","once":false,"x":111,"y":1911.5,"wires":[["984575e.bfc3f08","e99cd782.2597e8","45c09455.91cdcc","10fc720e.7cbc1e"]]},{"id":"19cfd17e.93dd4f","type":"mqtt in","z":"b5752a43.1c1f2","name":"","topic":"Volet/cuisine/est","qos":"2","broker":"9c9224ce.733908","x":87,"y":156,"wires":[["86292088.0dbcb"]]},{"id":"c4ebef1f.cc6a78","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"console":"false","complete":"topic","x":1246,"y":2318,"wires":[]},{"id":"6d6faca8.f46c1c","type":"bigtimer","z":"b5752a43.1c1f2","outtopic":"","outpayload1":"up","outpayload2":"","name":"Volets up only week hivers","lat":"49.213999","lon":"-0.400256","starttime":"5003","endtime":"5004","startoff":"-15","endoff":"+30","offs":0,"outtext1":"up","outtext2":"","timeout":1440,"sun":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":false,"jan":true,"feb":true,"mar":true,"apr":true,"may":false,"jun":false,"jul":false,"aug":false,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":false,"x":378,"y":2443,"wires":[["481ab483.f25724","3b885189.089986","953a54ae.5f6428"],[],[]]},{"id":"3b0203cb.2baa4c","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":618,"y":38,"wires":[]},{"id":"6aee2ca9.8cb2dc","type":"function","z":"b5752a43.1c1f2","name":"VR Cuisine nord","func":"//msg.payload = \"down\"\n//msg.payload = \"up\"\n//msg.payload = \"stop\"\nmsg.volet = msg.payload;\nmsg.topic=\"rfy/050501/01 \";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":366,"y":57,"wires":[["3b0203cb.2baa4c","fd2da12e.9fdb7"]]},{"id":"1e76f7a8.cd1178","type":"comment","z":"b5752a43.1c1f2","name":"Volet/cuisine/nord","info":"","x":105,"y":23,"wires":[]},{"id":"89fd7f4d.414a28","type":"mqtt in","z":"b5752a43.1c1f2","name":"","topic":"Volet/cuisine/nord","qos":"2","broker":"9c9224ce.733908","x":105,"y":57,"wires":[["6aee2ca9.8cb2dc"]]},{"id":"ca50cd34.eb43f8","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/cuisine/nord","topic":"Volet/cuisine/nord","qos":"","retain":"","broker":"9c9224ce.733908","x":1085,"y":1643,"wires":[]},{"id":"ea6dd7d8.1d76a","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":615,"y":229,"wires":[]},{"id":"76f6296b.eeaa8","type":"function","z":"b5752a43.1c1f2","name":"VR Cuisine sud","func":"//msg.payload = \"down\"\n//msg.payload = \"up\"\n//msg.payload = \"stop\"\nmsg.volet = msg.payload;\nmsg.topic=\"rfy/050503/01 \";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":364,"y":249,"wires":[["ea6dd7d8.1d76a","23d11f92.db9178"]]},{"id":"991655bd.592758","type":"comment","z":"b5752a43.1c1f2","name":"Volet/cuisine/sud (baie vitrée)","info":"","x":127,"y":213,"wires":[]},{"id":"2d870433.bc0db4","type":"mqtt in","z":"b5752a43.1c1f2","name":"","topic":"Volet/cuisine/sud","qos":"2","broker":"9c9224ce.733908","x":87,"y":248,"wires":[["76f6296b.eeaa8"]]},{"id":"5a0b1f96.d3beb","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/cuisine/sud","topic":"Volet/cuisine/sud","qos":"","retain":"","broker":"9c9224ce.733908","x":1036,"y":2516,"wires":[]},{"id":"1353c7d0.b7d1e","type":"bigtimer","z":"b5752a43.1c1f2","outtopic":"","outpayload1":"","outpayload2":"down","name":"Volets down only été","lat":"49.213999","lon":"-0.400256","starttime":"5003","endtime":"5004","startoff":"-15","endoff":"+30","offs":0,"outtext1":"","outtext2":"down","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":false,"feb":false,"mar":false,"apr":false,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":false,"nov":false,"dec":false,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":false,"odd":false,"even":false,"x":332,"y":2963,"wires":[["481ab483.f25724","c4ebef1f.cc6a78","72905414.4c27c4","5e2e5876.ef58c"],[],[]]},{"id":"62310e08.a8f1f8","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/veranda/sud2","topic":"Volet/veranda/sud2","qos":"","retain":"","broker":"9c9224ce.733908","x":1073,"y":1852.5,"wires":[]},{"id":"777b884a.ba62c","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/veranda/est1","topic":"Volet/veranda/est1","qos":"","retain":"","broker":"9c9224ce.733908","x":1072,"y":1903.5,"wires":[]},{"id":"f9a4cdc.9e6d2b","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/salledebain/nord","topic":"Volet/salledebain/nord","qos":"","retain":"","broker":"9c9224ce.733908","x":1081,"y":1956.5,"wires":[]},{"id":"6cb0c561.3d5f3c","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/veranda/sud1","topic":"Volet/veranda/sud1","qos":"","retain":"","broker":"9c9224ce.733908","x":1034,"y":2570,"wires":[]},{"id":"cced4aa4.535b2","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/veranda/est2","topic":"Volet/veranda/est2","qos":"","retain":"","broker":"9c9224ce.733908","x":1031,"y":2617,"wires":[]},{"id":"4f352a9c.78c17c","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/chambreParents/nord","topic":"Volet/chambreParents/nord","qos":"","retain":"","broker":"9c9224ce.733908","x":1099,"y":2860,"wires":[]},{"id":"d1d659c9.1ac4e","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/chambreSarah/nord","topic":"Volet/chambreSarah/nord","qos":"","retain":"","broker":"9c9224ce.733908","x":1086,"y":2911,"wires":[]},{"id":"d37be34e.722b58","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/chambreSarah/est1","topic":"Volet/chambreSarah/est1","qos":"","retain":"","broker":"9c9224ce.733908","x":1086,"y":2962,"wires":[]},{"id":"26f21765.3b05e","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/chambreSarah/est2","topic":"Volet/chambreSarah/est2","qos":"","retain":"","broker":"9c9224ce.733908","x":1080,"y":3018,"wires":[]},{"id":"7dd05115.86a008","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/chambreAnais/sud","topic":"Volet/chambreAnais/sud","qos":"","retain":"","broker":"9c9224ce.733908","x":1083,"y":3075,"wires":[]},{"id":"c9deca67.df4e9","type":"inject","z":"b5752a43.1c1f2","name":"Up","topic":"on","payload":"on","payloadType":"str","repeat":"","crontab":"","once":false,"x":97,"y":2961,"wires":[["1353c7d0.b7d1e","24b51e89.9f7ce2","765c3662.ebc86"]]},{"id":"c06c2f6f.2e7cd","type":"inject","z":"b5752a43.1c1f2","name":"Down","topic":"off","payload":"off","payloadType":"str","repeat":"","crontab":"","once":false,"x":96,"y":3002,"wires":[["1353c7d0.b7d1e","24b51e89.9f7ce2","765c3662.ebc86"]]},{"id":"41ef7796.aa6b1","type":"inject","z":"b5752a43.1c1f2","name":"Up","topic":"on","payload":"on","payloadType":"str","repeat":"","crontab":"","once":false,"x":110,"y":2534,"wires":[["6d6faca8.f46c1c","d243cea0.61eb98","7f115f.4e4576a","e5ee7f9b.dd9818"]]},{"id":"49ff2735.990da","type":"inject","z":"b5752a43.1c1f2","name":"Down","topic":"off","payload":"off","payloadType":"str","repeat":"","crontab":"","once":false,"x":107,"y":2574,"wires":[["6d6faca8.f46c1c","d243cea0.61eb98","7f115f.4e4576a","e5ee7f9b.dd9818"]]},{"id":"b48eeae9.56469","type":"inject","z":"b5752a43.1c1f2","name":"Auto","topic":"","payload":"auto","payloadType":"str","repeat":"","crontab":"","once":false,"x":104,"y":2616,"wires":[["6d6faca8.f46c1c","d243cea0.61eb98","7f115f.4e4576a","e5ee7f9b.dd9818"]]},{"id":"567b7880.469fd","type":"inject","z":"b5752a43.1c1f2","name":"Auto","topic":"","payload":"auto","payloadType":"str","repeat":"","crontab":"","once":false,"x":91,"y":3046,"wires":[["1353c7d0.b7d1e","24b51e89.9f7ce2","765c3662.ebc86"]]},{"id":"157b12dc.63dffd","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":620,"y":700,"wires":[]},{"id":"6a5b1d3e.93cd7c","type":"function","z":"b5752a43.1c1f2","name":"Volet/veranda/est1","func":"//msg.payload = \"down\"\n//msg.payload = \"up\"\n//msg.payload = \"stop\"\nmsg.volet = msg.payload;\nmsg.topic=\"rfy/050504/01 \";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":373,"y":719,"wires":[["157b12dc.63dffd","ef224b54.fec0e8"]]},{"id":"2a989ce.aacc764","type":"comment","z":"b5752a43.1c1f2","name":"Volet/veranda/est1 (pan fixe)","info":"","x":131,"y":683,"wires":[]},{"id":"f8f30647.4702c","type":"mqtt in","z":"b5752a43.1c1f2","name":"","topic":"Volet/veranda/est1","qos":"2","broker":"9c9224ce.733908","x":101,"y":718,"wires":[["6a5b1d3e.93cd7c"]]},{"id":"db117621.a6a76","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":623,"y":795,"wires":[]},{"id":"7cba396.7b4b748","type":"function","z":"b5752a43.1c1f2","name":"Volet/veranda/est2","func":"//msg.payload = \"down\"\n//msg.payload = \"up\"\n//msg.payload = \"stop\"\nmsg.volet = msg.payload;\nmsg.topic=\"rfy/050505/01 \";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":373,"y":816,"wires":[["db117621.a6a76","574198c6.219d48"]]},{"id":"3be6f45a.7b8614","type":"comment","z":"b5752a43.1c1f2","name":"Volet/veranda/est2 (pan mobile)","info":"","x":141,"y":781,"wires":[]},{"id":"de1e756d.4b681","type":"mqtt in","z":"b5752a43.1c1f2","name":"","topic":"Volet/veranda/est2","qos":"2","broker":"9c9224ce.733908","x":101,"y":815,"wires":[["7cba396.7b4b748"]]},{"id":"b4b78977.fa8cd8","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":620,"y":889,"wires":[]},{"id":"8c2c06de.e8ca88","type":"function","z":"b5752a43.1c1f2","name":"Volet/veranda/sud1","func":"//msg.payload = \"down\"\n//msg.payload = \"up\"\n//msg.payload = \"stop\"\nmsg.volet = msg.payload;\nmsg.topic=\"rfy/050506/01 \";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":373,"y":905,"wires":[["b4b78977.fa8cd8","10bd8ce6.664cdb"]]},{"id":"12c91543.cdacdb","type":"comment","z":"b5752a43.1c1f2","name":"Volet/veranda/sud1 (pan mobile)","info":"","x":141,"y":869,"wires":[]},{"id":"570b27a6.86d4","type":"mqtt in","z":"b5752a43.1c1f2","name":"","topic":"Volet/veranda/sud1","qos":"2","broker":"9c9224ce.733908","x":101,"y":904,"wires":[["8c2c06de.e8ca88"]]},{"id":"de250ad7.6d56b8","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":620,"y":978,"wires":[]},{"id":"73c66acf.d49324","type":"function","z":"b5752a43.1c1f2","name":"Volet/veranda/sud2","func":"//msg.payload = \"down\"\n//msg.payload = \"up\"\n//msg.payload = \"stop\"\nmsg.volet = msg.payload;\nmsg.topic=\"rfy/050507/01 \";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":373,"y":996,"wires":[["de250ad7.6d56b8","99a94eb9.00b8b"]]},{"id":"2af76db.7816292","type":"comment","z":"b5752a43.1c1f2","name":"Volet/veranda/sud2 (pan fixe)","info":"","x":131,"y":960,"wires":[]},{"id":"2789645c.46375c","type":"mqtt in","z":"b5752a43.1c1f2","name":"","topic":"Volet/veranda/sud2","qos":"2","broker":"9c9224ce.733908","x":101,"y":995,"wires":[["73c66acf.d49324"]]},{"id":"b0cbfb37.b2105","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":620,"y":1080,"wires":[]},{"id":"c0fae5f8.3c9f78","type":"function","z":"b5752a43.1c1f2","name":"Volet/chambreParents/nord","func":"//msg.payload = \"down\"\n//msg.payload = \"up\"\n//msg.payload = \"stop\"\nmsg.volet = msg.payload;\nmsg.topic=\"rfy/060601/01 \";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":403,"y":1098,"wires":[["b0cbfb37.b2105","5907d765.8159a8"]]},{"id":"76f9d6a0.17044","type":"comment","z":"b5752a43.1c1f2","name":"Volet/chambreParents/nord","info":"","x":131,"y":1062,"wires":[]},{"id":"af22a9b5.5a3468","type":"mqtt in","z":"b5752a43.1c1f2","name":"","topic":"Volet/chambreParents/nord","qos":"2","broker":"9c9224ce.733908","x":131,"y":1097,"wires":[["c0fae5f8.3c9f78"]]},{"id":"c8e6ad36.5f3ea8","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":620,"y":1173,"wires":[]},{"id":"e6b87673.cc8388","type":"function","z":"b5752a43.1c1f2","name":"Volet/salledebain/nord","func":"//msg.payload = \"down\"\n//msg.payload = \"up\"\n//msg.payload = \"stop\"\nmsg.volet = msg.payload;\nmsg.topic=\"rfy/060602/01 \";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":383,"y":1188,"wires":[["c8e6ad36.5f3ea8","25f1a917.61df26"]]},{"id":"7139276b.0963f8","type":"comment","z":"b5752a43.1c1f2","name":"Volet/salledebain/nord","info":"","x":111,"y":1152,"wires":[]},{"id":"2d59bbe3.2e0d24","type":"mqtt in","z":"b5752a43.1c1f2","name":"","topic":"Volet/salledebain/nord","qos":"2","broker":"9c9224ce.733908","x":111,"y":1187,"wires":[["e6b87673.cc8388"]]},{"id":"63f42b33.e93fdc","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":620,"y":1264,"wires":[]},{"id":"2bd416f4.8f58b2","type":"function","z":"b5752a43.1c1f2","name":"Volet/chambreSarah/nord","func":"//msg.payload = \"down\"\n//msg.payload = \"up\"\n//msg.payload = \"stop\"\nmsg.volet = msg.payload;\nmsg.topic=\"rfy/060603/01 \";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":393,"y":1282,"wires":[["63f42b33.e93fdc","11e182a9.f2bb2d"]]},{"id":"2413dfb7.222098","type":"comment","z":"b5752a43.1c1f2","name":"Volet/chambreSarah/nord","info":"","x":121,"y":1246,"wires":[]},{"id":"7443c2ca.e6d62c","type":"mqtt in","z":"b5752a43.1c1f2","name":"","topic":"Volet/chambreSarah/nord","qos":"2","broker":"9c9224ce.733908","x":121,"y":1281,"wires":[["2bd416f4.8f58b2"]]},{"id":"2ade4a81.d81be6","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":620,"y":1362,"wires":[]},{"id":"2bff0832.b133d","type":"function","z":"b5752a43.1c1f2","name":"Volet/chambreSarah/est1","func":"//msg.payload = \"down\"\n//msg.payload = \"up\"\n//msg.payload = \"stop\"\nmsg.volet = msg.payload;\nmsg.topic=\"rfy/060604/01 \";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":393,"y":1380,"wires":[["2ade4a81.d81be6","415221c7.7378e"]]},{"id":"412a650b.fa921c","type":"comment","z":"b5752a43.1c1f2","name":"Volet/chambreSarah/est1","info":"","x":121,"y":1344,"wires":[]},{"id":"fd58f426.ee1a5","type":"mqtt in","z":"b5752a43.1c1f2","name":"","topic":"Volet/chambreSarah/est1","qos":"2","broker":"9c9224ce.733908","x":121,"y":1379,"wires":[["2bff0832.b133d"]]},{"id":"42b1a016.fb239","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":620,"y":1455,"wires":[]},{"id":"31fbddf6.c2ecba","type":"function","z":"b5752a43.1c1f2","name":"Volet/chambreSarah/est2","func":"//msg.payload = \"down\"\n//msg.payload = \"up\"\n//msg.payload = \"stop\"\nmsg.volet = msg.payload;\nmsg.topic=\"rfy/060605/01 \";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":393,"y":1471,"wires":[["42b1a016.fb239","dc3b543d.47fa5"]]},{"id":"2e91911.19c23ee","type":"comment","z":"b5752a43.1c1f2","name":"Volet/chambreSarah/est2","info":"","x":121,"y":1435,"wires":[]},{"id":"cf2126d3.f7ae6","type":"mqtt in","z":"b5752a43.1c1f2","name":"","topic":"Volet/chambreSarah/est2","qos":"2","broker":"9c9224ce.733908","x":121,"y":1470,"wires":[["31fbddf6.c2ecba"]]},{"id":"435dbd26.6672dc","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":620,"y":1547,"wires":[]},{"id":"1c0f29a3.3595fe","type":"function","z":"b5752a43.1c1f2","name":"Volet/chambreAnais/sud","func":"//msg.payload = \"down\"\n//msg.payload = \"up\"\n//msg.payload = \"stop\"\nmsg.volet = msg.payload;\nmsg.topic=\"rfy/060606/01 \";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":393,"y":1560,"wires":[["435dbd26.6672dc","7f62dc87.c4f954"]]},{"id":"7ef9a16.492916","type":"comment","z":"b5752a43.1c1f2","name":"Volet/chambreAnais/sud","info":"","x":121,"y":1524,"wires":[]},{"id":"1bd576d8.cae419","type":"mqtt in","z":"b5752a43.1c1f2","name":"","topic":"Volet/chambreAnais/sud","qos":"2","broker":"9c9224ce.733908","x":121,"y":1559,"wires":[["1c0f29a3.3595fe"]]},{"id":"df8efb97.1e198","type":"comment","z":"b5752a43.1c1f2","name":"Automatisme : volets ouverts et fermés matin et soir","info":"","x":218,"y":1685.5,"wires":[]},{"id":"5642d2ae.b40cb4","type":"comment","z":"b5752a43.1c1f2","name":"Automatisme : volets ouverts le  matin","info":"","x":186,"y":2372,"wires":[]},{"id":"6b0ca9d4.e89b58","type":"comment","z":"b5752a43.1c1f2","name":"Automatisme : volets fermés le soir","info":"","x":163,"y":2823,"wires":[]},{"id":"6c961451.a17894","type":"function","z":"b5752a43.1c1f2","name":"Répéteur","func":"for (i = 0; i < 2; i++) \n{\n    node.send(msg);\n}","outputs":1,"noerr":0,"x":707,"y":1823.5,"wires":[["e9a7e699.b37d68","a48b9d4e.6f51a8","8e398960.89a128","411efd23.d9d0dc","8201de2d.bc70e8"]]},{"id":"e9a7e699.b37d68","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":877,"y":1643,"wires":[["ca50cd34.eb43f8"]]},{"id":"a48b9d4e.6f51a8","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":875,"y":1701,"wires":[["8f361046.2a58b"]]},{"id":"8e398960.89a128","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":871,"y":1851.5,"wires":[["62310e08.a8f1f8"]]},{"id":"411efd23.d9d0dc","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":872,"y":1904.5,"wires":[["777b884a.ba62c"]]},{"id":"8201de2d.bc70e8","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":872,"y":1957.5,"wires":[["f9a4cdc.9e6d2b"]]},{"id":"a7e8b107.84b3c","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":851,"y":2517,"wires":[["5a0b1f96.d3beb"]]},{"id":"3b885189.089986","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":852,"y":2569,"wires":[["6cb0c561.3d5f3c"]]},{"id":"144f3430.72a27c","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":851,"y":2618,"wires":[["cced4aa4.535b2"]]},{"id":"14b26891.59a6df","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":856,"y":2860,"wires":[["4f352a9c.78c17c"]]},{"id":"18200421.1e0f7c","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":853,"y":2910,"wires":[["d1d659c9.1ac4e"]]},{"id":"aaef5cef.40da28","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":853,"y":2962,"wires":[["d37be34e.722b58"]]},{"id":"a290343f.c3bce","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":854,"y":3017,"wires":[["26f21765.3b05e"]]},{"id":"4004fa86.9dcb94","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":858,"y":3074,"wires":[["7dd05115.86a008"]]},{"id":"7cecbc61.6e41a4","type":"http request","z":"b5752a43.1c1f2","name":"HTTP Week-end","method":"GET","ret":"txt","url":"http://192.168.1.30:81/weekend/now","tls":"","x":306,"y":4569,"wires":[["f90b8736.1ee6"]]},{"id":"f90b8736.1ee6","type":"switch","z":"b5752a43.1c1f2","name":"Week-end","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"},{"t":"eq","v":"False","vt":"str"}],"checkall":"true","outputs":2,"x":525.5,"y":4569,"wires":[["2b39cb9e.5d18bc"],["eda8185e.0595d"]]},{"id":"2b39cb9e.5d18bc","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"console":"false","complete":"payload","x":708,"y":4523,"wires":[]},{"id":"eda8185e.0595d","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"console":"false","complete":"payload","x":701,"y":4596,"wires":[]},{"id":"b288fa0b.16f888","type":"inject","z":"b5752a43.1c1f2","name":"","topic":"","payload":"8","payloadType":"str","repeat":"","crontab":"","once":false,"x":104,"y":4570,"wires":[["7cecbc61.6e41a4","f36ebefa.17caa"]]},{"id":"f36ebefa.17caa","type":"http request","z":"b5752a43.1c1f2","name":"HTTP sunrise","method":"GET","ret":"txt","url":"http://192.168.1.30:81/sun/saint-contest/sunrise/now","tls":"","x":296,"y":4691,"wires":[["db796b07.7fe58"]]},{"id":"4ad911ed.19b78","type":"switch","z":"b5752a43.1c1f2","name":"Sunrise avant 7H","property":"payload","propertyType":"msg","rules":[{"t":"lt","v":"7","vt":"str"},{"t":"gte","v":"7","vt":"str"}],"checkall":"true","outputs":2,"x":723,"y":4692,"wires":[["d7aacae6.e52858"],["82d9e060.9f71f"]]},{"id":"d7aacae6.e52858","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"console":"false","complete":"payload","x":926,"y":4670,"wires":[]},{"id":"82d9e060.9f71f","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"console":"false","complete":"payload","x":919,"y":4727,"wires":[]},{"id":"2f63160e.6b5222","type":"debug","z":"b5752a43.1c1f2","name":"","active":false,"console":"false","complete":"payload","x":703,"y":4744,"wires":[]},{"id":"db796b07.7fe58","type":"function","z":"b5752a43.1c1f2","name":"HeureSunrise","func":"//msg.payload = msg.payload.substring( 0 , 1 );\n\n//var numval = msg.payload.value || -1;\nvar heuresunrise = parseFloat(msg.payload.substring( 0 , 1 )) || -1;\n//msg.payload = numval.toFixed(2);\nmsg.payload=heuresunrise;\nreturn msg;\n\n//heure = parseint (msg.payload);\n//heure= msg.payload.value.toFixed(2);\n//heure = parseFloat(msg.payload.toFixed(1));\n//return heure;","outputs":1,"noerr":0,"x":492.5,"y":4692,"wires":[["2f63160e.6b5222","4ad911ed.19b78"]]},{"id":"a382ca5a.7d819","type":"comment","z":"b5752a43.1c1f2","name":"Week-end","info":"","x":693,"y":4483,"wires":[]},{"id":"49f1b2c3.2b0f3c","type":"comment","z":"b5752a43.1c1f2","name":"Semaine","info":"","x":694,"y":4637,"wires":[]},{"id":"d243cea0.61eb98","type":"bigtimer","z":"b5752a43.1c1f2","outtopic":"","outpayload1":"up","outpayload2":"","name":"Volets up only week-end hivers","lat":"49.213999","lon":"-0.400256","starttime":"5003","endtime":"5004","startoff":"-15","endoff":"+30","offs":0,"outtext1":"up","outtext2":"","timeout":1440,"sun":true,"mon":false,"tue":false,"wed":false,"thu":false,"fri":false,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":false,"jun":false,"jul":false,"aug":false,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":false,"x":382,"y":2518,"wires":[["953a54ae.5f6428"],[],[]]},{"id":"e99cd782.2597e8","type":"bigtimer","z":"b5752a43.1c1f2","outtopic":"","outpayload1":"up","outpayload2":"down","name":"Volets up & down week-end hivers","lat":"49.213999","lon":"-0.400256","starttime":"5003","endtime":"5004","startoff":"-15","endoff":"+20","offs":0,"outtext1":"up","outtext2":"down","timeout":1440,"sun":true,"mon":false,"tue":false,"wed":false,"thu":true,"fri":false,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":false,"jun":false,"jul":false,"aug":false,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":false,"odd":false,"even":false,"x":374,"y":1812.5,"wires":[["6c961451.a17894"],[],[]]},{"id":"45c09455.91cdcc","type":"bigtimer","z":"b5752a43.1c1f2","outtopic":"","outpayload1":"up","outpayload2":"down","name":"Volets up & down week été","lat":"49.213999","lon":"-0.400256","starttime":"405","endtime":"5004","startoff":"0","endoff":"+35","offs":0,"outtext1":"up","outtext2":"down","timeout":1440,"sun":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":false,"jan":false,"feb":false,"mar":false,"apr":false,"may":true,"jun":true,"jul":true,"aug":true,"sep":false,"oct":false,"nov":false,"dec":false,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":false,"odd":false,"even":false,"x":354,"y":1883.5,"wires":[["6c961451.a17894"],[],[]]},{"id":"10fc720e.7cbc1e","type":"bigtimer","z":"b5752a43.1c1f2","outtopic":"","outpayload1":"up","outpayload2":"down","name":"Volets up & down week-end été","lat":"49.213999","lon":"-0.400256","starttime":"525","endtime":"5004","startoff":"-15","endoff":"+40","offs":0,"outtext1":"up","outtext2":"down","timeout":1440,"sun":true,"mon":false,"tue":false,"wed":false,"thu":true,"fri":false,"sat":true,"jan":false,"feb":false,"mar":false,"apr":false,"may":true,"jun":true,"jul":true,"aug":true,"sep":false,"oct":false,"nov":false,"dec":false,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":false,"odd":false,"even":false,"x":365,"y":1956.5,"wires":[["6c961451.a17894"],[],[]]},{"id":"7f115f.4e4576a","type":"bigtimer","z":"b5752a43.1c1f2","outtopic":"","outpayload1":"up","outpayload2":"","name":"Volets up only week été","lat":"49.213999","lon":"-0.400256","starttime":"405","endtime":"5004","startoff":"0","endoff":"+30","offs":0,"outtext1":"up","outtext2":"","timeout":1440,"sun":false,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":false,"jan":false,"feb":false,"mar":false,"apr":false,"may":true,"jun":true,"jul":true,"aug":true,"sep":false,"oct":false,"nov":false,"dec":false,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":false,"odd":false,"even":false,"x":360,"y":2601,"wires":[["953a54ae.5f6428"],[],[]]},{"id":"e5ee7f9b.dd9818","type":"bigtimer","z":"b5752a43.1c1f2","outtopic":"","outpayload1":"up","outpayload2":"","name":"Volets up only week-end été","lat":"49.213999","lon":"-0.400256","starttime":"480","endtime":"5004","startoff":"0","endoff":"+30","offs":0,"outtext1":"up","outtext2":"","timeout":1440,"sun":true,"mon":false,"tue":false,"wed":false,"thu":false,"fri":false,"sat":true,"jan":false,"feb":false,"mar":false,"apr":false,"may":true,"jun":true,"jul":true,"aug":true,"sep":false,"oct":false,"nov":false,"dec":false,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":false,"x":364,"y":2679,"wires":[["953a54ae.5f6428"],[],[]]},{"id":"953a54ae.5f6428","type":"function","z":"b5752a43.1c1f2","name":"Répéteur","func":"for (i = 0; i < 2; i++) \n{\n    node.send(msg);\n}","outputs":1,"noerr":0,"x":641,"y":2562,"wires":[["a7e8b107.84b3c","3b885189.089986","144f3430.72a27c"]]},{"id":"24b51e89.9f7ce2","type":"bigtimer","z":"b5752a43.1c1f2","outtopic":"","outpayload1":"","outpayload2":"down","name":"Volets down only hivers","lat":"49.213999","lon":"-0.400256","starttime":"5003","endtime":"5004","startoff":"-15","endoff":"+25","offs":0,"outtext1":"","outtext2":"down","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":false,"jun":false,"jul":false,"aug":false,"sep":false,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":false,"odd":false,"even":false,"x":338,"y":3043,"wires":[["72905414.4c27c4","5e2e5876.ef58c"],[],[]]},{"id":"72905414.4c27c4","type":"function","z":"b5752a43.1c1f2","name":"Répéteur","func":"for (i = 0; i < 2; i++) \n{\n    node.send(msg);\n}","outputs":1,"noerr":0,"x":609,"y":2992,"wires":[["14b26891.59a6df","18200421.1e0f7c","aaef5cef.40da28","a290343f.c3bce","4004fa86.9dcb94","f8498dc4.8191a","1ee783cd.c8156c"]]},{"id":"898599dc.392328","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":620,"y":340,"wires":[]},{"id":"2dd6c297.9ab67e","type":"function","z":"b5752a43.1c1f2","name":"VR Salon sud","func":"//msg.payload = \"down\"\n//msg.payload = \"up\"\n//msg.payload = \"stop\"\nmsg.volet = msg.payload;\nmsg.topic=\"rfy/050508/01 \";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":369,"y":360,"wires":[["898599dc.392328","7167c1b9.5d6a5"]]},{"id":"96de9e8f.ec71a","type":"comment","z":"b5752a43.1c1f2","name":"Volet/salon/sud","info":"","x":92,"y":324,"wires":[]},{"id":"244dbd5c.c69982","type":"mqtt in","z":"b5752a43.1c1f2","name":"","topic":"Volet/salon/sud","qos":"2","broker":"9c9224ce.733908","x":92,"y":359,"wires":[["2dd6c297.9ab67e"]]},{"id":"47e5dffe.090af8","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":620,"y":440,"wires":[]},{"id":"d41707e7.bcf6d8","type":"function","z":"b5752a43.1c1f2","name":"VR Salon ouest","func":"//msg.payload = \"down\"\n//msg.payload = \"up\"\n//msg.payload = \"stop\"\nmsg.volet = msg.payload;\nmsg.topic=\"rfy/050509/01 \";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":369,"y":460,"wires":[["47e5dffe.090af8","845f99e7.2a2f98"]]},{"id":"89e945a2.ddad3","type":"comment","z":"b5752a43.1c1f2","name":"Volet/salon/ouest","info":"","x":92,"y":424,"wires":[]},{"id":"9b91788e.9dcf3","type":"mqtt in","z":"b5752a43.1c1f2","name":"","topic":"Volet/salon/ouest","qos":"2","broker":"9c9224ce.733908","x":92,"y":459,"wires":[["d41707e7.bcf6d8"]]},{"id":"fe8329f3.bd743","type":"debug","z":"b5752a43.1c1f2","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":620,"y":540,"wires":[]},{"id":"1f470d3e.997b1b","type":"function","z":"b5752a43.1c1f2","name":"VR Bureau ouest","func":"//msg.payload = \"down\"\n//msg.payload = \"up\"\n//msg.payload = \"stop\"\nmsg.volet = msg.payload;\nmsg.topic=\"rfy/05050A/01\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":379,"y":560,"wires":[["fe8329f3.bd743","74757682.224ad8"]]},{"id":"eb17c43a.ace868","type":"comment","z":"b5752a43.1c1f2","name":"Volet/bureau/ouest","info":"","x":102,"y":524,"wires":[]},{"id":"29bb3021.9c1ae8","type":"mqtt in","z":"b5752a43.1c1f2","name":"","topic":"Volet/bureau/ouest","qos":"2","broker":"9c9224ce.733908","x":102,"y":559,"wires":[["1f470d3e.997b1b"]]},{"id":"9e35c0e6.87604","type":"comment","z":"b5752a43.1c1f2","name":"Automatisme : volets salon My 6s sur down hivers","info":"","x":335,"y":3281,"wires":[]},{"id":"64884840.602e3","type":"comment","z":"b5752a43.1c1f2","name":"Automatisme : volets salon Up &  down été","info":"","x":363,"y":3324,"wires":[]},{"id":"1572c880.2206e8","type":"file in","z":"f44096e2.f5ad","name":"flows_vps.json","filename":"/home/pi/.node-red/flows_Domobox.json","format":"utf8","sendError":true,"x":278,"y":88,"wires":[["1204fa5.553c486"]]},{"id":"cd72ba6f.d3a038","type":"file","z":"f44096e2.f5ad","name":"","filename":"","appendNewline":false,"createDir":false,"overwriteFile":"true","x":657,"y":88,"wires":[[]]},{"id":"f5737c48.4e7c98","type":"inject","z":"f44096e2.f5ad","name":"","topic":"","payload":"restarted","payloadType":"str","repeat":"","crontab":"","once":true,"x":111,"y":103,"wires":[["1572c880.2206e8","e3c254f5.40a3e"]]},{"id":"1204fa5.553c486","type":"function","z":"f44096e2.f5ad","name":"backupFlow","func":"msg.filename = \"/home/pi/backup-flow/backup_\"+(new Date().toLocaleString().replace(':', '_').replace(':', '_').replace(' ', '_').replace(/\\..+/, ''))+\"_flows_Domobox.json\";\nreturn msg;\n","outputs":1,"noerr":0,"x":482,"y":88,"wires":[["cd72ba6f.d3a038"]]},{"id":"e3c254f5.40a3e","type":"file in","z":"f44096e2.f5ad","name":"flows_vps_cred.json","filename":"/home/pi/.node-red/flows_Domobox_cred.json","format":"utf8","sendError":true,"x":296,"y":132,"wires":[["65b840aa.dd5c08"]]},{"id":"d1449f00.47a5","type":"file","z":"f44096e2.f5ad","name":"","filename":"","appendNewline":false,"createDir":false,"overwriteFile":"true","x":662,"y":132,"wires":[[]]},{"id":"65b840aa.dd5c08","type":"function","z":"f44096e2.f5ad","name":"backupFlowCred","func":"msg.filename = \"/home/pi/backup-flow/backup_\"+(new Date().toLocaleString().replace(':', '_').replace(':', '_').replace(' ', '_').replace(/\\..+/, ''))+\"_flows_Domobox_cred.json\";\nreturn msg;\n","outputs":1,"noerr":0,"x":502,"y":132,"wires":[["d1449f00.47a5"]]},{"id":"13a3a249.133526","type":"ui_template","z":"741cb637.242018","group":"d327a67.36659d8","name":"TPL-Volet/salon/ouest","order":3,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volet salon ouest\"}}\n\n</span>\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":687,"y":420,"wires":[["259a5819.c06be8","15c68264.fe28d6"]]},{"id":"15c68264.fe28d6","type":"mqtt out","z":"741cb637.242018","name":"Volet/salon/ouest","topic":"Volet/salon/ouest","qos":"","retain":"","broker":"9c9224ce.733908","x":980,"y":442,"wires":[]},{"id":"259a5819.c06be8","type":"debug","z":"741cb637.242018","name":"","active":false,"console":"false","complete":"false","x":959,"y":405,"wires":[]},{"id":"21acaaa8.83089e","type":"comment","z":"741cb637.242018","name":"Volets salon","info":"","x":657,"y":380,"wires":[]},{"id":"f0ca8964.8fdd18","type":"delay","z":"741cb637.242018","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":510,"y":460,"wires":[["15c68264.fe28d6"]]},{"id":"9c85410c.e7782","type":"ui_template","z":"741cb637.242018","group":"d327a67.36659d8","name":"TPL-Volet/salon/sud","order":3,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volet salon sud\"}}\n\n</span>\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":687,"y":520,"wires":[["9cc6082a.b6fc48","c091ad63.55417"]]},{"id":"c091ad63.55417","type":"mqtt out","z":"741cb637.242018","name":"Volet/salon/sud","topic":"Volet/salon/sud","qos":"","retain":"","broker":"9c9224ce.733908","x":970,"y":542,"wires":[]},{"id":"9cc6082a.b6fc48","type":"debug","z":"741cb637.242018","name":"","active":false,"console":"false","complete":"false","x":959,"y":505,"wires":[]},{"id":"acd702bd.e1b35","type":"delay","z":"741cb637.242018","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":510,"y":553,"wires":[["c091ad63.55417"]]},{"id":"32900079.460cb8","type":"comment","z":"741cb637.242018","name":"Volets bureau","info":"","x":656,"y":612,"wires":[]},{"id":"e6b255a6.0318b8","type":"ui_template","z":"741cb637.242018","group":"d1dfcb1.8efa2b8","name":"TPL-Volet/bureau/ouest","order":3,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volet bureau ouest\"}}\n\n</span>\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":697,"y":648,"wires":[["d251a49a.d86d5","89bb81a5.e162c8"]]},{"id":"89bb81a5.e162c8","type":"mqtt out","z":"741cb637.242018","name":"Volet/bureau/ouest","topic":"Volet/bureau/ouest","qos":"","retain":"","broker":"9c9224ce.733908","x":980,"y":670,"wires":[]},{"id":"d251a49a.d86d5","type":"debug","z":"741cb637.242018","name":"","active":false,"console":"false","complete":"false","x":959,"y":633,"wires":[]},{"id":"d72a672f.cb577","type":"delay","z":"741cb637.242018","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":516,"y":692,"wires":[["89bb81a5.e162c8"]]},{"id":"c8541d1c.ee4e2","type":"function","z":"bef0923b.0da65","name":"Home","func":"msg.payload = \"Maison\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":301,"y":662,"wires":[["7b5d02b5.4f58f4","3e83cc3a.4491d4"]]},{"id":"7b5d02b5.4f58f4","type":"mqtt out","z":"bef0923b.0da65","name":"presence/HP","topic":"presence/HP","qos":"0","retain":"true","broker":"9c9224ce.733908","x":996,"y":719,"wires":[]},{"id":"23342460.883d04","type":"geofence","z":"bef0923b.0da65","name":"Geofence Work","mode":"circle","inside":"true","rad":116.53399508589413,"points":[],"centre":{"latitude":49.179178630445506,"longitude":-0.392535924911499},"x":322,"y":805,"wires":[["258b7cbc.f92da4"]]},{"id":"beb382f.baf3b8","type":"geofence","z":"bef0923b.0da65","name":"Geofence Home","mode":"circle","inside":"true","rad":27.672932984682546,"points":[],"centre":{"latitude":49.211506823339036,"longitude":-0.40698230266571045},"x":151,"y":1603,"wires":[["c082e6c5.d69d8"]]},{"id":"ba6bb5a1.9bd88","type":"debug","z":"bef0923b.0da65","name":"","active":false,"console":"false","complete":"false","x":968,"y":1158,"wires":[]},{"id":"c8fe860c.ddc51","type":"comment","z":"bef0923b.0da65","name":"Message MQTT envoye si geolocalisation dans la zone Home Work near ou Out Geofence","info":"","x":314,"y":1463,"wires":[]},{"id":"c082e6c5.d69d8","type":"function","z":"bef0923b.0da65","name":"Home","func":"msg.payload = \"Maison\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":306,"y":1603,"wires":[["f4558ab3.cab06","78c1cfcf.4cc8f8"]]},{"id":"f4558ab3.cab06","type":"mqtt out","z":"bef0923b.0da65","name":"presence/CP","topic":"presence/CP","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1003,"y":1650,"wires":[]},{"id":"13ed6164.473f97","type":"function","z":"bef0923b.0da65","name":"Work","func":"msg.payload = \"Travail\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":498,"y":1726,"wires":[["4ccdaabc.e54454"]]},{"id":"e60f0d9e.24a458","type":"geofence","z":"bef0923b.0da65","name":"Geofence Ecole","mode":"circle","inside":"true","rad":99.6431623281249,"points":[],"centre":{"latitude":49.214233175755275,"longitude":-0.3996062278747558},"x":335,"y":1726,"wires":[["13ed6164.473f97"]]},{"id":"83a80e4c.530b18","type":"function","z":"bef0923b.0da65","name":"Lat-Long","func":"var loc=JSON.parse(msg.payload);\n\nif ( loc._type == \"location\" ) {\n    msg.location = {\n      lon: 0,\n      lat: 50\n    };\n\n    msg.location.lon=loc.lon;\n    msg.location.lat=loc.lat;\n    \n    return msg;\n}","outputs":1,"noerr":0,"x":319,"y":1505,"wires":[["beb382f.baf3b8","1240527a.037a26","1bb6ec12.5a3c54","f8cb320.e66cad","7e4b9c46.2a444c"]]},{"id":"e736305c.8748e8","type":"geofence","z":"bef0923b.0da65","name":"Geofence out","mode":"circle","inside":"false","rad":1397.954970395107,"points":[],"centre":{"latitude":49.21138907525443,"longitude":-0.4066679472452961},"x":123,"y":804,"wires":[["23342460.883d04","ba7b663.cd0e598"]]},{"id":"7d276d58.f9f0fc","type":"function","z":"bef0923b.0da65","name":"Detect Presence HP","func":"const triggers = 10;\nconst MAC = \"08:c5:e1:23:fa:84\";\nvar count = context.count||0;\n\nif(msg.payload.indexOf(MAC)>0){\n    if(count < 1){\n        msg.payload = 1;\n        count = triggers;\n        context.count = count;\n        return msg;\n    }else count = triggers;\n    \n}else{\n    count -= 1;\n    if(count === 0){\n        msg.payload = 0;\n        context.count = count;\n        return msg;\n    }else if(count < 0){\n        count = 0; \n    }\n}\ncontext.count = count;\n","outputs":1,"noerr":0,"x":430,"y":1098,"wires":[["4cae6ec6.31d1e8"]]},{"id":"6b2a3e87.bb24f8","type":"exec","z":"bef0923b.0da65","command":"sudo arp-scan --interface=ens160 --localnet","addpay":false,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"Arp-Scan","x":228,"y":1111.5,"wires":[["7d276d58.f9f0fc","28be6744.290f9","c6e5aef1.b33528"],[],[]]},{"id":"48800fb5.b9ce6","type":"inject","z":"bef0923b.0da65","name":"","topic":"","payload":"true","payloadType":"bool","repeat":"60","crontab":"","once":true,"onceDelay":"","x":83,"y":1112,"wires":[["6b2a3e87.bb24f8"]]},{"id":"99c2c8fb.cd9428","type":"debug","z":"bef0923b.0da65","name":"","active":false,"console":"false","complete":"false","x":970,"y":1100,"wires":[]},{"id":"28be6744.290f9","type":"debug","z":"bef0923b.0da65","name":"","active":false,"console":"false","complete":"false","x":401,"y":1039,"wires":[]},{"id":"13ae38e7.702b67","type":"comment","z":"bef0923b.0da65","name":"Detection presence avec arp-scan du telephone  sur reseau local en wifi. 0 : absent, 1 : present","info":"","x":309,"y":997,"wires":[]},{"id":"4cae6ec6.31d1e8","type":"switch","z":"bef0923b.0da65","name":"Switch present ?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":656,"y":1098,"wires":[[],["c8541d1c.ee4e2","99c2c8fb.cd9428"]]},{"id":"c6e5aef1.b33528","type":"function","z":"bef0923b.0da65","name":"Detect Presence CP","func":"const triggers = 10;\nconst MAC = \"bc:6e:64:b0:11:a4\";\nvar count = context.count||0;\n\nif(msg.payload.indexOf(MAC)>0){\n    if(count < 1){\n        msg.payload = 1;\n        count = triggers;\n        context.count = count;\n        return msg;\n    }else count = triggers;\n    \n}else{\n    count -= 1;\n    if(count === 0){\n        msg.payload = 0;\n        context.count = count;\n        return msg;\n    }else if(count < 0){\n        count = 0; \n    }\n}\ncontext.count = count;\n","outputs":1,"noerr":0,"x":426,"y":1152,"wires":[["1bed4de0.715ee2"]]},{"id":"1bed4de0.715ee2","type":"switch","z":"bef0923b.0da65","name":"Switch present ?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":651,"y":1153,"wires":[[],["c082e6c5.d69d8","ba6bb5a1.9bd88"]]},{"id":"dd21b3c0.f1027","type":"geofence","z":"bef0923b.0da65","name":"Geofence near","mode":"polyline","inside":"true","rad":0,"points":[{"latitude":49.21388275327473,"longitude":-0.40434837341308594},{"latitude":49.21323796941996,"longitude":-0.40561437606811523},{"latitude":49.2122988126724,"longitude":-0.4058504104614257},{"latitude":49.211794183767346,"longitude":-0.4046487808227539},{"latitude":49.211275532024914,"longitude":-0.40524959564208984},{"latitude":49.21114937267021,"longitude":-0.40539979934692383},{"latitude":49.21070080346833,"longitude":-0.4058504104614257},{"latitude":49.21084098178113,"longitude":-0.4062795639038086},{"latitude":49.21093910636362,"longitude":-0.4065585136413574},{"latitude":49.211023212993574,"longitude":-0.4068160057067871},{"latitude":49.21123347894246,"longitude":-0.4072451591491699},{"latitude":49.211696060882055,"longitude":-0.40816783905029297},{"latitude":49.21333608924474,"longitude":-0.4079532623291015},{"latitude":49.214457444839155,"longitude":-0.40821075439453125},{"latitude":49.21552270909227,"longitude":-0.407867431640625},{"latitude":49.21613943053532,"longitude":-0.41172981262207026},{"latitude":49.213840702410145,"longitude":-0.41439056396484375},{"latitude":49.20638311678337,"longitude":-0.4119873046875},{"latitude":49.204925111448574,"longitude":-0.4081249237060547},{"latitude":49.204420407277674,"longitude":-0.4052925109863281},{"latitude":49.20453256420526,"longitude":-0.40340423583984375},{"latitude":49.20498118937177,"longitude":-0.40203094482421875},{"latitude":49.205934504336255,"longitude":-0.4001426696777344},{"latitude":49.20812145157189,"longitude":-0.3973960876464844},{"latitude":49.21081294615036,"longitude":-0.3999710083007812},{"latitude":49.21284548817323,"longitude":-0.40203094482421875}],"centre":{},"x":124,"y":726,"wires":[["cebe7682.dc8bd"]]},{"id":"cebe7682.dc8bd","type":"function","z":"bef0923b.0da65","name":"Near","func":"msg.payload = \"Near\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":298,"y":726,"wires":[["7b5d02b5.4f58f4","3e83cc3a.4491d4"]]},{"id":"1378e077.eb033","type":"inject","z":"861fd1d6.432808","name":"Every 30 minutes","topic":"","payload":"","payloadType":"none","repeat":"1800","crontab":"","once":true,"x":167,"y":42,"wires":[["46ae2996.a5b8a"]]},{"id":"50ccd9f.a1b45a8","type":"http request","z":"861fd1d6.432808","name":"Update DuckDNS","method":"GET","url":"https://www.duckdns.org/update?domains=domobox.duckdns.org&token=8073545a-de6f-46ab-9c6d-fbcd8125198d&ip=","tls":"","x":355,"y":274,"wires":[["be859b74.7ab398"]]},{"id":"be859b74.7ab398","type":"switch","z":"861fd1d6.432808","name":"Was update sucessful?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"OK","vt":"str"},{"t":"neq","v":"OK","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":334,"y":329,"wires":[["b6a98233.749278"],["89d97c18.8b136","2109745c.b9ba14"]]},{"id":"ea1e9855.7e272","type":"delay","z":"861fd1d6.432808","name":"One notification/day","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":340,"y":435,"wires":[["e48726f0.b2e09"]]},{"id":"e48726f0.b2e09","type":"pushbullet","z":"861fd1d6.432808","config":"ee1296bd.5dc6e","pushtype":"","title":"DuckDNS update failed","chan":"","name":"DuckDNS update failed","x":350,"y":486,"wires":[]},{"id":"24758df2.533c72","type":"comment","z":"861fd1d6.432808","name":"No","info":"","x":88,"y":385,"wires":[]},{"id":"b6f9d5c8.f57488","type":"comment","z":"861fd1d6.432808","name":"Yes?","info":"","x":563,"y":322,"wires":[]},{"id":"89d97c18.8b136","type":"debug","z":"861fd1d6.432808","name":"","active":true,"console":false,"complete":false,"x":648,"y":377,"wires":[]},{"id":"b6a98233.749278","type":"function","z":"861fd1d6.432808","name":"Reset fail counter","func":"context.duckdnsfails=0;\nreturn msg;\n","outputs":"0","x":733,"y":321,"wires":[]},{"id":"2109745c.b9ba14","type":"function","z":"861fd1d6.432808","name":"Increment fail counter, check if >5","func":"duckdnsfails = context.duckdnsfails || 0;\nduckdnsfails++;\ncontext.duckdnsfails = duckdnsfails;\n\n//Fsiled to update 5+ times?\nif(duckdnsfails <=6) {\n\treturn [msg,null];\n}\nelse {\n    //shout out last known IP\n    msg.payload=context.lastip;\n\treturn [null,msg];\n}","outputs":"2","x":301,"y":387,"wires":[[],["ea1e9855.7e272"]]},{"id":"526fa9e5.91c93","type":"function","z":"861fd1d6.432808","name":"Has IP Changed?","func":"context.lastip = context.lastip || 'initial';\nvar currentip = msg.payload;\n\nif (context.lastip == 'initial') \n{\n    context.lastip = currentip;\n}\nelse if (context.lastip != currentip) \n{\n    msg.payload = currentip;\n    context.lastip = currentip;\n        \n    return msg;\n}\n    node.status({text:msg.payload});\n\n","outputs":"1","noerr":0,"x":345,"y":211.5,"wires":[["50ccd9f.a1b45a8","244d361b.e950a2","afbff84e.61fd58"]]},{"id":"46ae2996.a5b8a","type":"exec","z":"861fd1d6.432808","command":"wget -qO- http://ipv4bot.whatismyipaddress.com/ ; echo","addpay":false,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"Check my IP - whatismyipaddress.com","x":284,"y":106.5,"wires":[["e4b987d3.f2a37","ac8719eb.77951"],[],[]]},{"id":"e4b987d3.f2a37","type":"switch","z":"861fd1d6.432808","name":"Integrity check","property":"payload","rules":[{"t":"regex","v":"\\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\b"},{"t":"else"}],"checkall":"true","outputs":2,"x":358,"y":160.5,"wires":[["526fa9e5.91c93","b46737bd.6f477"],[]]},{"id":"ac8719eb.77951","type":"debug","z":"861fd1d6.432808","name":"","active":true,"console":"false","complete":"false","x":658,"y":68,"wires":[]},{"id":"b46737bd.6f477","type":"debug","z":"861fd1d6.432808","name":"","active":false,"console":"false","complete":"false","x":648,"y":122,"wires":[]},{"id":"fde3df75.77b54","type":"switch","z":"a6f65934.4fb04","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"Connected","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":93,"y":309,"wires":[[],["fd05ec27.c66ab8"]]},{"id":"6c348f8d.7709a8","type":"comment","z":"a6f65934.4fb04","name":"Connection Lost","info":"","x":179,"y":364,"wires":[]},{"id":"2a94a78d.be4a7","type":"function","z":"bef0923b.0da65","name":"Out","func":"msg.payload = \"Out\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":494,"y":1797,"wires":[["6e26355e.abd37c"]]},{"id":"46181ff.ae4d16","type":"function","z":"bef0923b.0da65","name":"Near","func":"msg.payload = \"Near\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":301,"y":1659,"wires":[["f4558ab3.cab06","78c1cfcf.4cc8f8"]]},{"id":"244d361b.e950a2","type":"pushbullet","z":"861fd1d6.432808","config":"ee1296bd.5dc6e","pushtype":"","title":"DuckDNS update ","chan":"","name":"DuckDNS update","x":839,"y":209,"wires":[]},{"id":"2008f01d.fc3c08","type":"comment","z":"861fd1d6.432808","name":"Notif new address","info":"","x":619,"y":211,"wires":[]},{"id":"f070d0cc.f0fd18","type":"comment","z":"861fd1d6.432808","name":"Notif DNS Update failed","info":"","x":105,"y":486,"wires":[]},{"id":"e0ba1175.320a8","type":"comment","z":"bef0923b.0da65","name":"Oui","info":"","x":821,"y":1080,"wires":[]},{"id":"486b37ac.dc641","type":"comment","z":"bef0923b.0da65","name":"Oui","info":"","x":829,"y":1180,"wires":[]},{"id":"1d274153.882b2f","type":"http in","z":"37cbadc6.95403a","name":"Watchdog","url":"/myjs/","method":"get","upload":false,"swaggerDoc":"","x":114,"y":138,"wires":[["bbb33748.9783f8"]]},{"id":"bbb33748.9783f8","type":"template","z":"37cbadc6.95403a","name":"Up.html page","field":"payload","fieldType":"msg","format":"html","syntax":"mustache","template":"<!DOCTYPE HTML>\n<html>\n <head>\n  <meta charset=\"utf-8\" />\n  <meta HTTP-EQUIV=\"CACHE-CONTROL\" CONTENT=\"NO-CACHE\" />\n </head>\n <body>\n Domobox UP\n </body>\n</html>","output":"str","x":276,"y":138,"wires":[["f9da3779.f62b58"]]},{"id":"f9da3779.f62b58","type":"http response","z":"37cbadc6.95403a","name":"","statusCode":"","headers":{},"x":452,"y":138,"wires":[]},{"id":"99f4828a.473508","type":"http response","z":"37cbadc6.95403a","name":"","x":454,"y":200,"wires":[]},{"id":"5e9f10cb.82fd88","type":"http in","z":"37cbadc6.95403a","name":"","url":"/myjs/","method":"get","upload":false,"swaggerDoc":"","x":114,"y":201.2333526611328,"wires":[["7fadf7de.48cc"]]},{"id":"7fadf7de.48cc","type":"template","z":"37cbadc6.95403a","name":"Webpage Contents","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"<!--\n#***************************************************************************\n# Copyright 2016 IBM\n#\n#   Building a Webpage with HTTP nodes in Node-RED\n#\n#   By JeanCarl Bisson (@dothewww)\n#   More info: https://ibm.biz/node-red-webpage/\n#\n#   Licensed under the Apache License, Version 2.0 (the \"License\");\n#   you may not use this file except in compliance with the License.\n#   You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n#   Unless required by applicable law or agreed to in writing, software\n#   distributed under the License is distributed on an \"AS IS\" BASIS,\n#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n#   See the License for the specific language governing permissions and\n#***************************************************************************\n-->\n<html>\n  <head>\n    <title>Hello!</title>\n  </head>\n  <body>\n    <h1>Hello <span id=\"name\">{{payload.name}}</span>!</h1>\n    <p>This is my first webpage!</p>\n    <p><i>JeanCarl</i></p>\n    {{^payload.name}}\n    <script>\n      // Prompt visitor for their name.\n      var name = prompt('What is your name?');\n\n      // Populate HTML tag with ID name with visitor name.\n      document.getElementById('name').innerHTML = name;\n    </script>\n    {{/payload.name}}\n  </body>\n</html>\n","x":295,"y":200.76666259765625,"wires":[["99f4828a.473508"]]},{"id":"b7f48c70.3388b8","type":"comment","z":"37cbadc6.95403a","name":"Status node-red : tester avec page HTML dynamique http://domobox:1880/myjs/","info":"","x":331,"y":83,"wires":[]},{"id":"e83ee285.9a06e8","type":"comment","z":"bef0923b.0da65","name":"Presence  maison","info":"","x":97,"y":2080,"wires":[]},{"id":"494cde65.9858e8","type":"mqtt in","z":"bef0923b.0da65","name":"","topic":"presence/CP","qos":"0","broker":"9c9224ce.733908","x":95,"y":2240,"wires":[["386478e9.5c8b3"]]},{"id":"aad975f9.3db608","type":"mqtt in","z":"bef0923b.0da65","name":"","topic":"presence/HP","qos":"0","broker":"9c9224ce.733908","x":92,"y":2121,"wires":[["386478e9.5c8b3"]]},{"id":"386478e9.5c8b3","type":"function","z":"bef0923b.0da65","name":"present ?","func":"context.data = context.data || {};\nswitch (msg.topic)\n{\n    case \"presence/HP\" :\n      context.presenceHP = msg.payload;\n      node.status({text:msg.payload});\n      break;\n    case \"presence/CP\" :\n      context.presenceCP = msg.payload;\n      node.status({text:msg.payload});\n      break;\n}\n\nif (context.presenceHP != \"Maison\" && context.presenceCP != \"Maison\")\n{\n    presence=0;\n}\nelse\n{\n    presence=1;\n}\nmsg.payload = presence;\nnode.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":267,"y":2182,"wires":[["9159f918.11077","e464d94c.4315b8","fe52ef05.de7ae8"]]},{"id":"9159f918.11077","type":"debug","z":"bef0923b.0da65","name":"","active":false,"console":"false","complete":"false","x":478,"y":2035,"wires":[]},{"id":"e464d94c.4315b8","type":"mqtt out","z":"bef0923b.0da65","name":"presence/maison","topic":"presence/maison","qos":"2","retain":"true","broker":"9c9224ce.733908","x":694,"y":2178,"wires":[]},{"id":"ff2154bf.1cfed","type":"comment","z":"bef0923b.0da65","name":"0 : Absent","info":"","x":849,"y":2151,"wires":[]},{"id":"74fc3299.62740c","type":"comment","z":"bef0923b.0da65","name":"1 : Present","info":"","x":838,"y":2207,"wires":[]},{"id":"1bb6ec12.5a3c54","type":"geofence","z":"bef0923b.0da65","name":"Geofence near","mode":"polyline","inside":"true","rad":0,"points":[{"latitude":49.211822218841675,"longitude":-0.40203094482421875},{"latitude":49.211850253900046,"longitude":-0.4017305374145508},{"latitude":49.21173811357104,"longitude":-0.40181636810302734},{"latitude":49.21199042895362,"longitude":-0.4022026062011719},{"latitude":49.2122988126724,"longitude":-0.4022884368896484},{"latitude":49.212579159838256,"longitude":-0.4024171829223633},{"latitude":49.21319591800686,"longitude":-0.40340423583984375},{"latitude":49.21350429420556,"longitude":-0.40411233901977534},{"latitude":49.211275532024914,"longitude":-0.40524959564208984},{"latitude":49.21114937267021,"longitude":-0.40539979934692383},{"latitude":49.21070080346833,"longitude":-0.4058504104614257},{"latitude":49.21084098178113,"longitude":-0.4062795639038086},{"latitude":49.21093910636362,"longitude":-0.4065585136413574},{"latitude":49.211023212993574,"longitude":-0.4068160057067871},{"latitude":49.21123347894246,"longitude":-0.4072451591491699},{"latitude":49.211696060882055,"longitude":-0.40816783905029297},{"latitude":49.21333608924474,"longitude":-0.4079532623291015},{"latitude":49.214457444839155,"longitude":-0.40821075439453125},{"latitude":49.21552270909227,"longitude":-0.407867431640625},{"latitude":49.21613943053532,"longitude":-0.41172981262207026},{"latitude":49.213840702410145,"longitude":-0.41439056396484375},{"latitude":49.20638311678337,"longitude":-0.4119873046875},{"latitude":49.204925111448574,"longitude":-0.4081249237060547},{"latitude":49.204420407277674,"longitude":-0.4052925109863281},{"latitude":49.20453256420526,"longitude":-0.40340423583984375},{"latitude":49.20498118937177,"longitude":-0.40203094482421875},{"latitude":49.205934504336255,"longitude":-0.4001426696777344},{"latitude":49.20812145157189,"longitude":-0.3973960876464844},{"latitude":49.21081294615036,"longitude":-0.3999710083007812},{"latitude":49.21204649886376,"longitude":-0.4022026062011719}],"centre":{},"x":142,"y":1659,"wires":[["46181ff.ae4d16"]]},{"id":"f8cb320.e66cad","type":"geofence","z":"bef0923b.0da65","name":"Geofence out","mode":"polyline","inside":"false","rad":0,"points":[{"latitude":49.2024015390802,"longitude":-0.399627685546875},{"latitude":49.20457742622053,"longitude":-0.3864612558390945},{"latitude":49.21142972635457,"longitude":-0.3908729553222656},{"latitude":49.2127754019084,"longitude":-0.3989410400390625},{"latitude":49.21372856659632,"longitude":-0.40301799774169916},{"latitude":49.21815773782178,"longitude":-0.4065799713134765},{"latitude":49.21781014564613,"longitude":-0.4194202402140945},{"latitude":49.2015491026317,"longitude":-0.417360303690657}],"centre":{},"x":136,"y":1725,"wires":[["e60f0d9e.24a458","2a94a78d.be4a7","e5af3056.5aef1"]]},{"id":"c46f7f29.e1b33","type":"function","z":"bef0923b.0da65","name":"Home Distance","func":"// latFrom et lonFrom : domicile\nvar latFrom = 49.21144409999999;\nvar lonFrom = -0.4065946000000622;\nvar latTo = msg.payload.lat;\nvar lonTo = msg.payload.lon;\n\nmsg.distance = \"http://domobox/geodistance/geodistance.php?latFrom=\"+latFrom+\"&lonFrom=\"+lonFrom+\"&latTo=\"+latTo+\"&lonTo=\"+lonTo;\nmsg.url = msg.distance;\n    node.status({text:msg.url});\nreturn msg;\n","outputs":"1","noerr":0,"x":313,"y":429,"wires":[["b99335c5.63aaf"]]},{"id":"258b7cbc.f92da4","type":"function","z":"bef0923b.0da65","name":"Work","func":"msg.payload = \"Travail\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":490,"y":806,"wires":[["863e8fe7.d23988"]]},{"id":"ba7b663.cd0e598","type":"function","z":"bef0923b.0da65","name":"Out","func":"msg.payload = \"Out\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":490,"y":860,"wires":[["3033ba2.2f820c6"]]},{"id":"863e8fe7.d23988","type":"delay","z":"bef0923b.0da65","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":635,"y":806,"wires":[["3033ba2.2f820c6"]]},{"id":"6e26355e.abd37c","type":"delay","z":"bef0923b.0da65","name":"","pauseType":"delay","timeout":"50","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":770,"y":1797,"wires":[["78c1cfcf.4cc8f8","f4558ab3.cab06"]]},{"id":"4ccdaabc.e54454","type":"delay","z":"bef0923b.0da65","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":649,"y":1725,"wires":[["6e26355e.abd37c"]]},{"id":"4c068378.58845c","type":"debug","z":"bef0923b.0da65","name":"","active":false,"console":"false","complete":"false","x":862,"y":343,"wires":[]},{"id":"1b3fc818.0b7cd","type":"debug","z":"bef0923b.0da65","name":"","active":false,"console":"false","complete":"false","x":326,"y":559,"wires":[]},{"id":"8d2e4870.a5a508","type":"json","z":"bef0923b.0da65","name":"","pretty":false,"x":147,"y":429,"wires":[["c46f7f29.e1b33"]]},{"id":"7dee5001.5d885","type":"http request","z":"bef0923b.0da65","name":"","method":"GET","ret":"txt","url":"","tls":"","x":673,"y":429,"wires":[["4c068378.58845c","3c9cb383.c4b18c","1749ddb7.2fcbd2"]]},{"id":"b99335c5.63aaf","type":"change","z":"bef0923b.0da65","name":"","rules":[{"t":"set","p":"query","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":501,"y":429,"wires":[["7dee5001.5d885"]]},{"id":"3c9cb383.c4b18c","type":"mqtt out","z":"bef0923b.0da65","name":"distance/HP","topic":"distance/HP","qos":"0","retain":"true","broker":"9c9224ce.733908","x":856,"y":416,"wires":[]},{"id":"8855a0c0.e1954","type":"comment","z":"bef0923b.0da65","name":"Message MQTT distance HP domicile","info":"","x":192,"y":391,"wires":[]},{"id":"56fbb2f4.c0656c","type":"function","z":"bef0923b.0da65","name":"Home Distance","func":"// latFrom et lonFrom : domicile\nvar latFrom = 49.21144409999999;\nvar lonFrom = -0.4065946000000622;\nvar latTo = msg.payload.lat;\nvar lonTo = msg.payload.lon;\n\nmsg.distance = \"http://domobox/geodistance/geodistance.php?latFrom=\"+latFrom+\"&lonFrom=\"+lonFrom+\"&latTo=\"+latTo+\"&lonTo=\"+lonTo;\nmsg.url = msg.distance;\n    node.status({text:msg.url});\nreturn msg;\n","outputs":"1","noerr":0,"x":309,"y":1327,"wires":[["371703b1.f44ea4"]]},{"id":"acbb0075.8c37e8","type":"debug","z":"bef0923b.0da65","name":"","active":false,"console":"false","complete":"false","x":848,"y":1294,"wires":[]},{"id":"7e4b9c46.2a444c","type":"json","z":"bef0923b.0da65","name":"","pretty":false,"x":143,"y":1327,"wires":[["56fbb2f4.c0656c"]]},{"id":"96c09814.9b40f","type":"http request","z":"bef0923b.0da65","name":"","method":"GET","ret":"txt","url":"","tls":"","x":669,"y":1327,"wires":[["acbb0075.8c37e8","87e9e43c.439ad","759b5df1.23292c"]]},{"id":"371703b1.f44ea4","type":"change","z":"bef0923b.0da65","name":"","rules":[{"t":"set","p":"query","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":497,"y":1327,"wires":[["96c09814.9b40f"]]},{"id":"87e9e43c.439ad","type":"mqtt out","z":"bef0923b.0da65","name":"distance/CP","topic":"distance/CP","qos":"0","retain":"true","broker":"9c9224ce.733908","x":850,"y":1382,"wires":[]},{"id":"695754fb.8b0bb4","type":"comment","z":"bef0923b.0da65","name":"Message MQTT distance CP domicile","info":"","x":188,"y":1289,"wires":[]},{"id":"3033ba2.2f820c6","type":"delay","z":"bef0923b.0da65","name":"","pauseType":"delay","timeout":"50","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":790,"y":860,"wires":[["7b5d02b5.4f58f4","3e83cc3a.4491d4"]]},{"id":"182897c0.1c6ba8","type":"mqtt in","z":"bef0923b.0da65","name":"owntracks/+/+/event","topic":"owntracks/+/+/event","qos":"2","broker":"9c9224ce.733908","x":128,"y":2745,"wires":[["650e89de.e12a88","19b2c7dd.02066"]]},{"id":"650e89de.e12a88","type":"debug","z":"bef0923b.0da65","name":"","active":true,"complete":false,"x":579.9999847412109,"y":2684.0000076293945,"wires":[]},{"id":"2c701202.19a97e","type":"mqtt in","z":"bef0923b.0da65","name":"WayPoints Home Smartphone","topic":"owntracks/+/+/event","qos":"2","broker":"9c9224ce.733908","x":157,"y":2687.083251953125,"wires":[["650e89de.e12a88","19b2c7dd.02066"]]},{"id":"b5773a26.031488","type":"inject","z":"bef0923b.0da65","name":"Test Domicile shared enter","topic":"","payload":"{\"_type\": \"transition\", \"tid\":\"HP\",\"lat\": \"49.213999\", \"lon\": \"-0.400256\", \"tst\": \"1505580540\", \"acc\": \"500.0\", \"batt\": \"48\", \"desc\": \"Domicile\", \"event\": \"enter\"}","payloadType":"str","repeat":"","crontab":"","once":false,"x":163,"y":2801,"wires":[["19b2c7dd.02066"]]},{"id":"85c5df35.40148","type":"inject","z":"bef0923b.0da65","name":"Test Private Waypoint Tour Eiffel","topic":"","payload":"{\"_type\": \"transition\", \"lat\": \"48.858844\", \"lon\": \"2.294351\", \"tst\": \"1391715492\", \"acc\": \"500.0\", \"batt\": \"48\", \"event\": \"enter\"}","payloadType":"str","repeat":"","crontab":"","once":false,"x":177,"y":2898,"wires":[["19b2c7dd.02066"]]},{"id":"e8ea7c52.6d05d8","type":"comment","z":"bef0923b.0da65","name":"Message owntracks entrée et sortie de region domicile (waypoint)","info":"","x":255,"y":2598,"wires":[]},{"id":"becd09a8.e5e16","type":"switch","z":"bef0923b.0da65","name":"Domicile ?","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"Domicile","vt":"str"}],"checkall":"true","outputs":1,"x":558,"y":2777,"wires":[["ada96df1.a27e3"]]},{"id":"ada96df1.a27e3","type":"switch","z":"bef0923b.0da65","name":"enter/leave ?","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"enter","vt":"str"},{"t":"cont","v":"leave","vt":"str"}],"checkall":"true","outputs":2,"x":750,"y":2777,"wires":[["cb9af742.f5336","9e723929.74ba9"],["ba923422.83e69","9e723929.74ba9"]]},{"id":"c28b3b23.759c6","type":"comment","z":"bef0923b.0da65","name":"Message owntracks connexion wifi en dehors du domicile : Out ---- au domicile : Maison","info":"","x":310,"y":3285,"wires":[]},{"id":"19b2c7dd.02066","type":"function","z":"bef0923b.0da65","name":"transition ?","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\ndata = JSON.parse(msg.payload);\n\nif ( (data._type == \"transition\") && (data.event !== undefined ) ) {\n\t    \n    return msg;\n }","outputs":1,"noerr":0,"x":394,"y":2778,"wires":[["becd09a8.e5e16"]]},{"id":"e548d45e.ba311","type":"inject","z":"bef0923b.0da65","name":"Test Domicile shared leave","topic":"","payload":"{\"_type\": \"transition\" ,\"tid\":\"CP\", \"lat\": \"49.213999\", \"lon\": \"-0.400256\", \"tst\": \"1391715492\", \"acc\": \"500.0\", \"batt\": \"48\", \"desc\": \"Domicile\", \"event\": \"leave\"}","payloadType":"str","repeat":"","crontab":"","once":false,"x":161,"y":2847,"wires":[["19b2c7dd.02066"]]},{"id":"9e723929.74ba9","type":"debug","z":"bef0923b.0da65","name":"","active":true,"complete":false,"x":650,"y":2877,"wires":[]},{"id":"cb9af742.f5336","type":"switch","z":"bef0923b.0da65","name":"tid ?","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"CP","vt":"str"},{"t":"cont","v":"HP","vt":"str"},{"t":"cont","v":"AP","vt":"str"},{"t":"cont","v":"SP","vt":"str"}],"checkall":"true","outputs":4,"x":949,"y":2668,"wires":[["d27579b4.70725","3cf9a864.d3c38"],["cdcd2c1c.ea60b","2057115b.62708e"],["999fe0f5.b84cd","4403fec8.c93f68"],["d11e723d.be204","2925881b.ccc22"]]},{"id":"ba923422.83e69","type":"switch","z":"bef0923b.0da65","name":"tid ?","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"CP","vt":"str"},{"t":"cont","v":"HP","vt":"str"},{"t":"cont","v":"AP","vt":"str"},{"t":"cont","v":"SP","vt":"str"}],"checkall":"true","outputs":4,"x":958,"y":3079,"wires":[["6a0753e0.e080ec","3cf9a864.d3c38"],["9ea3a2c7.ebe228","2057115b.62708e"],["740c25e7.7d50d4","4403fec8.c93f68"],["8a6a3f1b.b395b","2925881b.ccc22"]]},{"id":"d27579b4.70725","type":"function","z":"bef0923b.0da65","name":"Home","func":"msg.payload = \"Maison\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":1092,"y":2598,"wires":[["6d7eba4e.979874"]]},{"id":"6a0753e0.e080ec","type":"function","z":"bef0923b.0da65","name":"Out","func":"msg.payload = \"Out\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":1090,"y":3009,"wires":[["108924ac.cddd23"]]},{"id":"6d7eba4e.979874","type":"mqtt out","z":"bef0923b.0da65","name":"presence/CP","topic":"presence/HP","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1245,"y":2597,"wires":[]},{"id":"36b16d18.d80b2a","type":"mqtt out","z":"bef0923b.0da65","name":"presence/HP","topic":"presence/HP","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1242,"y":2645,"wires":[]},{"id":"2f1013e6.8c87c4","type":"mqtt out","z":"bef0923b.0da65","name":"presence/AP","topic":"presence/AP","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1243,"y":2692,"wires":[]},{"id":"72d40a4.2febf74","type":"mqtt out","z":"bef0923b.0da65","name":"presence/SP","topic":"presence/SP","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1246,"y":2740,"wires":[]},{"id":"cdcd2c1c.ea60b","type":"function","z":"bef0923b.0da65","name":"Home","func":"msg.payload = \"Maison\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":1092,"y":2645,"wires":[["36b16d18.d80b2a"]]},{"id":"999fe0f5.b84cd","type":"function","z":"bef0923b.0da65","name":"Home","func":"msg.payload = \"Maison\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":1091,"y":2692,"wires":[["2f1013e6.8c87c4"]]},{"id":"d11e723d.be204","type":"function","z":"bef0923b.0da65","name":"Home","func":"msg.payload = \"Maison\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":1093,"y":2740,"wires":[["72d40a4.2febf74"]]},{"id":"9ea3a2c7.ebe228","type":"function","z":"bef0923b.0da65","name":"Out","func":"msg.payload = \"Out\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":1091,"y":3056,"wires":[["da674b73.89a428"]]},{"id":"740c25e7.7d50d4","type":"function","z":"bef0923b.0da65","name":"Out","func":"msg.payload = \"Out\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":1090,"y":3102,"wires":[["c0411ce4.83276"]]},{"id":"8a6a3f1b.b395b","type":"function","z":"bef0923b.0da65","name":"Out","func":"msg.payload = \"Out\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":1089,"y":3149,"wires":[["ab25e729.ffe1a8"]]},{"id":"108924ac.cddd23","type":"mqtt out","z":"bef0923b.0da65","name":"presence/CP","topic":"presence/HP","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1246,"y":3009,"wires":[]},{"id":"da674b73.89a428","type":"mqtt out","z":"bef0923b.0da65","name":"presence/HP","topic":"presence/HP","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1243,"y":3056,"wires":[]},{"id":"c0411ce4.83276","type":"mqtt out","z":"bef0923b.0da65","name":"presence/AP","topic":"presence/AP","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1244,"y":3102,"wires":[]},{"id":"ab25e729.ffe1a8","type":"mqtt out","z":"bef0923b.0da65","name":"presence/SP","topic":"presence/SP","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1247,"y":3149,"wires":[]},{"id":"5bb81423.7f8d74","type":"comment","z":"bef0923b.0da65","name":"enter","info":"","x":830,"y":2700,"wires":[]},{"id":"553796e1.7694e8","type":"comment","z":"bef0923b.0da65","name":"leave","info":"","x":870,"y":2900,"wires":[]},{"id":"d321019.5dc388","type":"mqtt out","z":"bef0923b.0da65","name":"presence/CP/lastupdate","topic":"presence/CP/lastupdate","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1284,"y":2801,"wires":[]},{"id":"3cf9a864.d3c38","type":"function","z":"bef0923b.0da65","name":"Date tst","func":"data = JSON.parse(msg.payload);\nvar MaDate = new Date(parseInt(data.tst)*1000);\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":1099,"y":2801,"wires":[["d321019.5dc388"]]},{"id":"2057115b.62708e","type":"function","z":"bef0923b.0da65","name":"Date tst","func":"data = JSON.parse(msg.payload);\nvar MaDate = new Date(parseInt(data.tst)*1000);\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":1099,"y":2847,"wires":[["ef5b8af8.ba538"]]},{"id":"ef5b8af8.ba538","type":"mqtt out","z":"bef0923b.0da65","name":"presence/HP/lastupdate","topic":"presence/HP/lastupdate","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1284,"y":2847,"wires":[]},{"id":"4403fec8.c93f68","type":"function","z":"bef0923b.0da65","name":"Date tst","func":"data = JSON.parse(msg.payload);\nvar MaDate = new Date(parseInt(data.tst)*1000);\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":1099,"y":2896,"wires":[["d1e05c05.7a7368"]]},{"id":"d1e05c05.7a7368","type":"mqtt out","z":"bef0923b.0da65","name":"presence/AP/lastupdate","topic":"presence/AP/lastupdate","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1284,"y":2896,"wires":[]},{"id":"2925881b.ccc22","type":"function","z":"bef0923b.0da65","name":"Date tst","func":"data = JSON.parse(msg.payload);\nvar MaDate = new Date(parseInt(data.tst)*1000);\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":1100,"y":2941,"wires":[["58b671e1.7436a"]]},{"id":"58b671e1.7436a","type":"mqtt out","z":"bef0923b.0da65","name":"presence/SP/lastupdate","topic":"presence/SP/lastupdate","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1286,"y":2941,"wires":[]},{"id":"634ef8f0.7c0278","type":"mqtt in","z":"bef0923b.0da65","name":"owntracks/+/+","topic":"owntracks/+/+","qos":"2","broker":"9c9224ce.733908","x":79,"y":3370,"wires":[["1c7c7b3f.cdd45d","cfcfddc7.14a14","f559dd9e.0685e8"]]},{"id":"1c7c7b3f.cdd45d","type":"function","z":"bef0923b.0da65","name":"location wifi","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\ndata = JSON.parse(msg.payload);\n\nif ( data._type == \"location\")  {\n    if (data.conn == \"w\") {\n        // connexion wifi\n        msg.payload = 1;\n        return msg;\n    }\n    else {\n        msg.payload = 0;\n        return msg;\n    }\n }","outputs":1,"noerr":0,"x":163,"y":3434,"wires":[["31b1001a.488ae8"]]},{"id":"31b1001a.488ae8","type":"switch","z":"bef0923b.0da65","name":"Switch wifi?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","outputs":2,"x":270,"y":3376,"wires":[[],["bb1dbb47.9aa4a8","4465acbc.9c693c"]]},{"id":"b319384e.1e3a9","type":"comment","z":"bef0923b.0da65","name":"Oui","info":"","x":310,"y":3420,"wires":[]},{"id":"8d5a2270.626d4","type":"debug","z":"bef0923b.0da65","name":"","active":false,"console":"false","complete":"false","x":841,"y":3265,"wires":[]},{"id":"74f34c62.eedafc","type":"switch","z":"bef0923b.0da65","name":"Switch wifi local?","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"41:7b:67","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":745,"y":3362,"wires":[["2754fc11.c1b854","8d5a2270.626d4","465e3fa7.eb958"],["2754fc11.c1b854","461dacd.f73d154"]]},{"id":"8ce77ed8.890eb8","type":"comment","z":"bef0923b.0da65","name":"Oui","info":"","x":803,"y":3322,"wires":[]},{"id":"465e3fa7.eb958","type":"function","z":"bef0923b.0da65","name":"Home","func":"msg.payload = \"Maison\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":949,"y":3310,"wires":[["2e334953.137546"]]},{"id":"2e334953.137546","type":"mqtt out","z":"bef0923b.0da65","name":"presence/HP","topic":"presence/HP","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1095,"y":3310,"wires":[]},{"id":"7492ef2b.45acc","type":"function","z":"bef0923b.0da65","name":"Out","func":"msg.payload = \"Out\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":943,"y":3415,"wires":[["73782ea9.c89c1"]]},{"id":"73782ea9.c89c1","type":"mqtt out","z":"bef0923b.0da65","name":"presence/HP","topic":"presence/HP","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1096,"y":3414,"wires":[]},{"id":"6683fa6e.41581c","type":"comment","z":"bef0923b.0da65","name":"Non","info":"","x":800,"y":3407,"wires":[]},{"id":"2754fc11.c1b854","type":"function","z":"bef0923b.0da65","name":"Date","func":"MaDate = new Date();\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\n//msg.payload = timeString\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":945,"y":3361,"wires":[["cef36f15.197898"]]},{"id":"cef36f15.197898","type":"mqtt out","z":"bef0923b.0da65","name":"presence/HP/lastupdate","topic":"presence/HP/lastupdate","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1139,"y":3361,"wires":[]},{"id":"c019a40b.bc4b9","type":"switch","z":"bef0923b.0da65","name":"Switch wifi local?","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"b0:11:a4","vt":"str"},{"t":"else"}],"checkall":"true","outputs":2,"x":772,"y":3672,"wires":[["ebef6c3.a70139","b776973f.a697d","9a5d77fb.9bec48"],["ebef6c3.a70139","4294e5d3.ca69c4"]]},{"id":"62fd49cf.0effd","type":"comment","z":"bef0923b.0da65","name":"Oui","info":"","x":833,"y":3628,"wires":[]},{"id":"9a5d77fb.9bec48","type":"function","z":"bef0923b.0da65","name":"Home","func":"msg.payload = \"Maison\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":969,"y":3624,"wires":[["1d4005a9.d6535a"]]},{"id":"1d4005a9.d6535a","type":"mqtt out","z":"bef0923b.0da65","name":"presence/CP","topic":"presence/CP","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1115,"y":3624,"wires":[]},{"id":"84d2fffc.910ae8","type":"function","z":"bef0923b.0da65","name":"Out","func":"msg.payload = \"Out\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":974,"y":3725,"wires":[["83dd44e5.dc2df8"]]},{"id":"83dd44e5.dc2df8","type":"mqtt out","z":"bef0923b.0da65","name":"presence/CP","topic":"presence/CP","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1127,"y":3724,"wires":[]},{"id":"fe241632.434418","type":"comment","z":"bef0923b.0da65","name":"Non","info":"","x":851,"y":3712,"wires":[]},{"id":"ebef6c3.a70139","type":"function","z":"bef0923b.0da65","name":"Date","func":"MaDate = new Date();\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\n//msg.payload = timeString\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":972,"y":3671,"wires":[["e8277c8c.71925"]]},{"id":"e8277c8c.71925","type":"mqtt out","z":"bef0923b.0da65","name":"presence/CP/lastupdate","topic":"presence/CP/lastupdate","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1166,"y":3671,"wires":[]},{"id":"bb1dbb47.9aa4a8","type":"exec","z":"bef0923b.0da65","command":"sudo arp-scan --retry 10 --quiet --interface=ens160 --localnet | grep  -s -i \"41:7b:67\"","addpay":false,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"Check HP on Home wifi","x":502,"y":3375,"wires":[["74f34c62.eedafc"],[],[]]},{"id":"1749ddb7.2fcbd2","type":"function","z":"bef0923b.0da65","name":"Date","func":"MaDate = new Date();\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\n//msg.payload = timeString\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":835,"y":485,"wires":[["78341c62.07e554"]]},{"id":"78341c62.07e554","type":"mqtt out","z":"bef0923b.0da65","name":"distance/HP/lastupdate","topic":"distance/HP/lastupdate","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1042,"y":485,"wires":[]},{"id":"759b5df1.23292c","type":"function","z":"bef0923b.0da65","name":"Date","func":"MaDate = new Date();\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\n//msg.payload = timeString\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":829,"y":1447,"wires":[["aa690c74.8ee8a8"]]},{"id":"aa690c74.8ee8a8","type":"mqtt out","z":"bef0923b.0da65","name":"distance/CP/lastupdate","topic":"distance/CP/lastupdate","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1036,"y":1447,"wires":[]},{"id":"3e83cc3a.4491d4","type":"function","z":"bef0923b.0da65","name":"Date","func":"MaDate = new Date();\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\n//msg.payload = timeString\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":829,"y":637,"wires":[["dc86ac73.befe78"]]},{"id":"dc86ac73.befe78","type":"mqtt out","z":"bef0923b.0da65","name":"presence/HP/lastupdate","topic":"presence/HP/lastupdate","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1036,"y":637,"wires":[]},{"id":"78c1cfcf.4cc8f8","type":"function","z":"bef0923b.0da65","name":"Date","func":"MaDate = new Date();\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\n//msg.payload = timeString\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":831,"y":1586,"wires":[["5fe201b8.a22b38"]]},{"id":"5fe201b8.a22b38","type":"mqtt out","z":"bef0923b.0da65","name":"presence/CP/lastupdate","topic":"presence/CP/lastupdate","qos":"0","retain":"true","broker":"9c9224ce.733908","x":1038,"y":1586,"wires":[]},{"id":"fe52ef05.de7ae8","type":"function","z":"bef0923b.0da65","name":"Date","func":"MaDate = new Date();\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\n//msg.payload = timeString\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":506,"y":2101,"wires":[["c0bd91b4.26447"]]},{"id":"c0bd91b4.26447","type":"mqtt out","z":"bef0923b.0da65","name":"presence/maison/lastupdate","topic":"presence/maison/lastupdate","qos":"0","retain":"true","broker":"9c9224ce.733908","x":723,"y":2101,"wires":[]},{"id":"4465acbc.9c693c","type":"exec","z":"bef0923b.0da65","command":"sudo arp-scan --retry 10 --quiet --interface=ens160 --localnet | grep  -s -i \"b0:11:a4\"","addpay":false,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"Check CP on Home wifi","x":508,"y":3685,"wires":[["c019a40b.bc4b9"],[],[]]},{"id":"b776973f.a697d","type":"debug","z":"bef0923b.0da65","name":"","active":false,"console":"false","complete":"false","x":908,"y":3578,"wires":[]},{"id":"cfcfddc7.14a14","type":"function","z":"bef0923b.0da65","name":"niveau batterie HP","func":"data = JSON.parse(msg.payload);\n\nif ( data._type == \"location\")  {\n    if ( data.tid == \"HP\")  {\n        // niveau batterie\n        msg.payload = parseInt(data.batt);\n            node.status({text:msg.payload});\n        return msg;\n    }\n }","outputs":1,"noerr":0,"x":135,"y":4015,"wires":[["1afc11e1.530e3e"]]},{"id":"f559dd9e.0685e8","type":"function","z":"bef0923b.0da65","name":"niveau batterie CP","func":"data = JSON.parse(msg.payload);\n\nif ( data._type == \"location\")  {\n    if ( data.tid == \"CP\")  {\n        // niveau batterie\n        msg.payload = parseInt(data.batt);\n            node.status({text:msg.payload});\n        return msg;\n    }\n }","outputs":1,"noerr":0,"x":115,"y":4292,"wires":[["2dfe47c0.43cf5"]]},{"id":"4294e5d3.ca69c4","type":"switch","z":"bef0923b.0da65","name":"battCP > 10","property":"battCP","propertyType":"global","rules":[{"t":"gt","v":"10","vt":"num"},{"t":"else"}],"checkall":"true","outputs":2,"x":784,"y":3805,"wires":[["84d2fffc.910ae8"],[]]},{"id":"1afc11e1.530e3e","type":"function","z":"bef0923b.0da65","name":"Global var battHP","func":"context.global.battHP=msg.payload;\nmsg.payload = context.global.battHP;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":344,"y":4014,"wires":[["d09d8bf8.0995e"]]},{"id":"2dfe47c0.43cf5","type":"function","z":"bef0923b.0da65","name":"Global var battCP","func":"context.global.battCP=msg.payload;\nmsg.payload = context.global.battCP;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":323,"y":4292,"wires":[["837bd966.adbbb8"]]},{"id":"461dacd.f73d154","type":"switch","z":"bef0923b.0da65","name":"battHP > 10","property":"battHP","propertyType":"global","rules":[{"t":"gt","v":"10","vt":"num"},{"t":"else"}],"checkall":"true","outputs":2,"x":755,"y":3489,"wires":[["7492ef2b.45acc"],[]]},{"id":"f623c90c.f7ecd8","type":"comment","z":"bef0923b.0da65","name":"Oui","info":"","x":879,"y":3456,"wires":[]},{"id":"94db2c6f.de8cb","type":"comment","z":"bef0923b.0da65","name":"Oui","info":"","x":914,"y":3776,"wires":[]},{"id":"23d8aa57.2f15f6","type":"comment","z":"bef0923b.0da65","name":"Alerte batterie HP","info":"","x":594,"y":3941,"wires":[]},{"id":"960251ff.7b7e1","type":"comment","z":"bef0923b.0da65","name":"Notif batterie faible","info":"","x":1036,"y":3974,"wires":[]},{"id":"878c62e7.29df58","type":"pushbullet","z":"bef0923b.0da65","config":"ee1296bd.5dc6e","pushtype":"","title":"HP Batterie faible","chan":"","name":"HP Batterie faible","x":1037,"y":4019,"wires":[]},{"id":"ef422e85.0c7448","type":"delay","z":"bef0923b.0da65","name":"One notification/day","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":808,"y":4019,"wires":[["878c62e7.29df58"]]},{"id":"d09d8bf8.0995e","type":"switch","z":"bef0923b.0da65","name":"battHP > 15","property":"battHP","propertyType":"global","rules":[{"t":"gt","v":"15","vt":"num"},{"t":"else"}],"checkall":"true","outputs":2,"x":582,"y":4014,"wires":[[],["ef422e85.0c7448","cd843257.5b1298"]]},{"id":"a38817e3.ae34d8","type":"comment","z":"bef0923b.0da65","name":"Non","info":"","x":680,"y":4055,"wires":[]},{"id":"cd843257.5b1298","type":"debug","z":"bef0923b.0da65","name":"","active":true,"console":"false","complete":"false","x":696,"y":4102,"wires":[]},{"id":"2be2bfa0.65bd38","type":"comment","z":"bef0923b.0da65","name":"Alerte batterie CP","info":"","x":587,"y":4236,"wires":[]},{"id":"bf01ba4.935f0c8","type":"comment","z":"bef0923b.0da65","name":"Notif batterie faible","info":"","x":1030,"y":4252,"wires":[]},{"id":"31258e7f.304052","type":"pushbullet","z":"bef0923b.0da65","config":"ee1296bd.5dc6e","pushtype":"","title":"CP Batterie faible","chan":"","name":"CP Batterie faible","x":1031,"y":4297,"wires":[]},{"id":"f265ef12.b6e418","type":"delay","z":"bef0923b.0da65","name":"One notification/day","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":802,"y":4297,"wires":[["31258e7f.304052"]]},{"id":"837bd966.adbbb8","type":"switch","z":"bef0923b.0da65","name":"battCP > 15","property":"battCP","propertyType":"global","rules":[{"t":"gt","v":"15","vt":"num"},{"t":"else"}],"checkall":"true","outputs":2,"x":576,"y":4292,"wires":[[],["f265ef12.b6e418","d36a385d.fc76"]]},{"id":"8d66fb0.ea32b88","type":"comment","z":"bef0923b.0da65","name":"Non","info":"","x":674,"y":4333,"wires":[]},{"id":"d36a385d.fc76","type":"debug","z":"bef0923b.0da65","name":"","active":true,"console":"false","complete":"false","x":690,"y":4380,"wires":[]},{"id":"e5af3056.5aef1","type":"debug","z":"bef0923b.0da65","name":"","active":true,"console":"false","complete":"false","x":290,"y":1820,"wires":[]},{"id":"5c654076.4ff2b8","type":"delay","z":"b5752a43.1c1f2","name":"Delay MY 6s","pauseType":"delay","timeout":"6","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":881,"y":3541,"wires":[["cec17e56.a37478"]]},{"id":"cec17e56.a37478","type":"function","z":"b5752a43.1c1f2","name":"Volet-stop","func":"msg.payload = \"stop\"\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":1054,"y":3541,"wires":[["bd2e940b.c2d518"]]},{"id":"bd2e940b.c2d518","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/salon/ouest","topic":"Volet/salon/ouest","qos":"","retain":"","broker":"9c9224ce.733908","x":1078,"y":3467,"wires":[]},{"id":"15a9367c.f323aa","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":859,"y":3467,"wires":[["bd2e940b.c2d518","a4c6bcc2.7807b8"]]},{"id":"5e2e5876.ef58c","type":"function","z":"b5752a43.1c1f2","name":"Répéteur","func":"for (i = 0; i < 1; i++) \n{\n    node.send(msg);\n}","outputs":1,"noerr":0,"x":681,"y":3466,"wires":[["15a9367c.f323aa"]]},{"id":"a4c6bcc2.7807b8","type":"switch","z":"b5752a43.1c1f2","name":"My-Hivers","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"down","vt":"str"}],"checkall":"true","outputs":1,"x":679,"y":3540,"wires":[["5c654076.4ff2b8"]]},{"id":"f162d34.228f2b","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/salon/ouest","topic":"Volet/salon/ouest","qos":"","retain":"","broker":"9c9224ce.733908","x":1073,"y":3408,"wires":[]},{"id":"c133943.e107d68","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":857,"y":3408,"wires":[["f162d34.228f2b"]]},{"id":"649c774e.cbe598","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/bureau/ouest","topic":"Volet/bureau/ouest","qos":"","retain":"","broker":"9c9224ce.733908","x":1065,"y":3137,"wires":[]},{"id":"f8498dc4.8191a","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":857,"y":3136,"wires":[["649c774e.cbe598"]]},{"id":"fadb607e.a08ee8","type":"delay","z":"b5752a43.1c1f2","name":"Delay MY 20s","pauseType":"delay","timeout":"20","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":884,"y":3339,"wires":[["27c6a601.82e6e2"]]},{"id":"27c6a601.82e6e2","type":"function","z":"b5752a43.1c1f2","name":"Volet-stop","func":"msg.payload = \"stop\"\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":1046,"y":3339,"wires":[["ed1225ed.a9db38"]]},{"id":"ed1225ed.a9db38","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/salon/sud","topic":"Volet/salon/sud","qos":"","retain":"","broker":"9c9224ce.733908","x":1056,"y":3266,"wires":[]},{"id":"c3ac1abb.65cec","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":857,"y":3265,"wires":[["ed1225ed.a9db38","ecf80f17.e83a38"]]},{"id":"ffcb134.391a17","type":"function","z":"b5752a43.1c1f2","name":"Répéteur","func":"for (i = 0; i < 1; i++) \n{\n    node.send(msg);\n}","outputs":1,"noerr":0,"x":676,"y":3266,"wires":[["c3ac1abb.65cec"]]},{"id":"ecf80f17.e83a38","type":"switch","z":"b5752a43.1c1f2","name":"My-Hivers","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"down","vt":"str"}],"checkall":"true","outputs":1,"x":678,"y":3338,"wires":[["fadb607e.a08ee8"]]},{"id":"7746efd1.c78be","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/salon/sud","topic":"Volet/salon/sud","qos":"","retain":"","broker":"9c9224ce.733908","x":1056,"y":3205,"wires":[]},{"id":"1ee783cd.c8156c","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":859,"y":3204,"wires":[["7746efd1.c78be"]]},{"id":"7e70f179.b7bb48","type":"comment","z":"b5752a43.1c1f2","name":"Automatisme : week-end non utilisé","info":"","x":153,"y":4482,"wires":[]},{"id":"765c3662.ebc86","type":"bigtimer","z":"b5752a43.1c1f2","outtopic":"","outpayload1":"","outpayload2":"down","name":"Volets down only plein hivers","lat":"49.213999","lon":"-0.400256","starttime":"5003","endtime":"5004","startoff":"-15","endoff":"+25","offs":0,"outtext1":"","outtext2":"down","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":false,"may":false,"jun":false,"jul":false,"aug":false,"sep":false,"oct":false,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":false,"odd":false,"even":false,"x":352,"y":2887,"wires":[[],[],[]]},{"id":"3a04339e.98b1dc","type":"xiaomi-gateway in","z":"659a812a.2160a","name":"Xiaomi-Gateway","gateway":"a67ca531.70e5a8","ip":"192.168.1.10","x":100,"y":40,"wires":[["6ba63f9e.0b4a8","1e1a0b6a.1aee45","3568ad98.00cee2","c874321c.2f4c5","a79941d1.709bf8","d566b67d.b17268","567d57ae.02f6c","eedbd67c.307ed","f35751f9.989e9"]]},{"id":"f35751f9.989e9","type":"xiaomi-motion","z":"659a812a.2160a","gateway":"a67ca531.70e5a8","name":"Salon-présence","sid":"158d000224f9a2","motionmsg":"","nomotionmsg":"","output":"0","x":155,"y":1495,"wires":[["85fc82a2.d05b5","47475374.49264c","94a12f8a.d70d78","85cbe9ac.3fcd1","3be4535e.b6f5d4"]]},{"id":"c81f7aac.662c1","type":"debug","z":"659a812a.2160a","name":"","active":false,"console":"false","complete":"true","x":285,"y":160,"wires":[]},{"id":"d63e4bc1.2eec48","type":"comment","z":"659a812a.2160a","name":"Capteurs ouverture portes / fenêtres","info":"","x":415,"y":240,"wires":[]},{"id":"6ba63f9e.0b4a8","type":"xiaomi-all","z":"659a812a.2160a","gateway":"a67ca531.70e5a8","name":"","onlyModels":[],"excludedSids":[],"x":135,"y":160,"wires":[["c81f7aac.662c1","9f620490.b17bc8","e7565e2b.0b0cf"]]},{"id":"76737e2c.221f78","type":"function","z":"659a812a.2160a","name":"Etat","func":"msg.payload = msg.payload.data.status;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":352,"y":302,"wires":[["bc150a08.891038"]]},{"id":"5b8e3ac6.83d404","type":"mqtt out","z":"659a812a.2160a","name":"Cuisine-baie-sud/XIAOMI/Door","topic":"Cuisine-baie-sud/XIAOMI/Door","qos":"","retain":"true","broker":"9c9224ce.733908","x":833,"y":297,"wires":[]},{"id":"bc150a08.891038","type":"switch","z":"659a812a.2160a","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"open","vt":"str"},{"t":"eq","v":"close","vt":"str"}],"checkall":"true","outputs":2,"x":471,"y":302,"wires":[["bd478474.0aadd"],["d98d29c2.0ac4d"]]},{"id":"85fc82a2.d05b5","type":"debug","z":"659a812a.2160a","name":"","active":false,"console":"false","complete":"true","x":174,"y":1373,"wires":[]},{"id":"c59bc2ac.78867","type":"function","z":"659a812a.2160a","name":"Lux","func":"msg.payload = msg.payload.data.lux\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":518,"y":1542,"wires":[["6028b3b6.e87ccc"]]},{"id":"8c5efc30.f42448","type":"function","z":"659a812a.2160a","name":"no_motion","func":"if (msg.payload == \"motion\")\n{\n    msg.payload = 0;\n    node.status({text:msg.payload});\n    return msg;\n}\nelse\n{\ntry {\n    msg.payload = msg.payload.data.no_motion;\n    node.status({text:msg.payload});\n    return msg;\n}\ncatch(e) {}\n}","outputs":1,"noerr":0,"x":545,"y":1474,"wires":[["1bdf20d4.36d3f7"]]},{"id":"134e674a.e39609","type":"function","z":"659a812a.2160a","name":"motion","func":"msg.payload = msg.payload.data.status\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":1405,"wires":[["8d80fde3.343c98","8c5efc30.f42448"]]},{"id":"8d80fde3.343c98","type":"mqtt out","z":"659a812a.2160a","name":"Salon/XIAOMI/Motion","topic":"Salon/XIAOMI/Motion","qos":"","retain":"","broker":"9c9224ce.733908","x":735,"y":1404,"wires":[]},{"id":"1bdf20d4.36d3f7","type":"mqtt out","z":"659a812a.2160a","name":"Salon/XIAOMI/no_motion","topic":"Salon/XIAOMI/no_motion","qos":"","retain":"","broker":"9c9224ce.733908","x":745,"y":1474,"wires":[]},{"id":"6028b3b6.e87ccc","type":"mqtt out","z":"659a812a.2160a","name":"Salon/XIAOMI/Lux","topic":"Salon/XIAOMI/Lux","qos":"","retain":"true","broker":"9c9224ce.733908","x":723,"y":1542,"wires":[]},{"id":"9c76223b.697728","type":"mqtt out","z":"659a812a.2160a","name":"Salon/XIAOMI/Battery","topic":"Salon/XIAOMI/Battery","qos":"","retain":"","broker":"9c9224ce.733908","x":733,"y":1606,"wires":[]},{"id":"24ac3d8d.e5eaaa","type":"function","z":"659a812a.2160a","name":"Date","func":"MaDate = new Date();\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\n//msg.payload = timeString\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":531,"y":1347,"wires":[["a62665f6.9fcb2"]]},{"id":"a62665f6.9fcb2","type":"mqtt out","z":"659a812a.2160a","name":"Salon/XIAOMI/Lastupdate","topic":"Salon/XIAOMI/Lastupdate","qos":"2","retain":"","broker":"9c9224ce.733908","x":742,"y":1348,"wires":[]},{"id":"47475374.49264c","type":"switch","z":"659a812a.2160a","name":"switch motion","property":"payload.data.status","propertyType":"msg","rules":[{"t":"cont","v":"motion","vt":"str"}],"checkall":"true","outputs":1,"x":361,"y":1377,"wires":[["134e674a.e39609","24ac3d8d.e5eaaa"]]},{"id":"94a12f8a.d70d78","type":"switch","z":"659a812a.2160a","name":"switch no_motion","property":"payload.data.no_motion","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","outputs":1,"x":359,"y":1473,"wires":[["8c5efc30.f42448"]]},{"id":"85cbe9ac.3fcd1","type":"switch","z":"659a812a.2160a","name":"switch lux","property":"msg.payload.data.lux","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","outputs":1,"x":331,"y":1542,"wires":[["c59bc2ac.78867"]]},{"id":"3be4535e.b6f5d4","type":"switch","z":"659a812a.2160a","name":"switch batteryLevel","property":"payload.data.batteryLevel","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","outputs":1,"x":354,"y":1607,"wires":[["2501637e.117b9c"]]},{"id":"c70c2e68.221e","type":"function","z":"659a812a.2160a","name":"Etat","func":"msg.payload = msg.payload.data.status;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":337,"y":492,"wires":[["c407b0be.eaf53"]]},{"id":"3cca7bf0.dbfad4","type":"mqtt out","z":"659a812a.2160a","name":"Veranda-baie-est/XIAOMI/Door","topic":"Veranda-baie-est/XIAOMI/Door","qos":"","retain":"true","broker":"9c9224ce.733908","x":828,"y":488,"wires":[]},{"id":"c407b0be.eaf53","type":"switch","z":"659a812a.2160a","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"open","vt":"str"},{"t":"eq","v":"close","vt":"str"}],"checkall":"true","outputs":2,"x":459,"y":492,"wires":[["162e208e.a9cad7"],["5ad96288.9176fc"]]},{"id":"8ca76ebd.17d9a8","type":"function","z":"659a812a.2160a","name":"Etat","func":"msg.payload = msg.payload.data.status;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":339,"y":662,"wires":[["c6869187.480d5"]]},{"id":"63e4ca9b.848ccc","type":"mqtt out","z":"659a812a.2160a","name":"Varanda-baie-sud/XIAOMI/Door","topic":"Veranda-baie-sud/XIAOMI/Door","qos":"","retain":"true","broker":"9c9224ce.733908","x":821,"y":660,"wires":[]},{"id":"c6869187.480d5","type":"switch","z":"659a812a.2160a","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"open","vt":"str"},{"t":"eq","v":"close","vt":"str"}],"checkall":"true","outputs":2,"x":459,"y":662,"wires":[["3d4425a7.3752f2"],["1fc44a70.929c8e"]]},{"id":"9e74cd4f.2826b","type":"comment","z":"659a812a.2160a","name":"Capteurs présence / luminosité","info":"","x":327.20001220703125,"y":1301.2000122070312,"wires":[]},{"id":"1e1a0b6a.1aee45","type":"xiaomi-magnet","z":"659a812a.2160a","gateway":"a67ca531.70e5a8","name":"P-Véranda-baie-est","sid":"158d000201e367","x":166,"y":491,"wires":[["c70c2e68.221e","97428c31.780568"]]},{"id":"c874321c.2f4c5","type":"xiaomi-magnet","z":"659a812a.2160a","gateway":"a67ca531.70e5a8","name":"P-Véranda-baie-sud","sid":"158d000201e1e1","x":166,"y":661,"wires":[["8ca76ebd.17d9a8","a0b9ff23.44a18"]]},{"id":"68402560.a98e3c","type":"Sonoff device","z":"ee283ca8.bf07d","mode":"0","broker":"9c9224ce.733908","device":"sonoff-Salon","name":"","onValue":"ON","offValue":"OFF","cmdPrefix":"cmnd","statPrefix":"stat","telePrefix":"tele","x":266,"y":83,"wires":[["a2132653.b67da8"]]},{"id":"b12da4ae.5198b8","type":"inject","z":"ee283ca8.bf07d","name":"On","topic":"","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":false,"x":98.5,"y":66,"wires":[["68402560.a98e3c"]]},{"id":"f6982253.5d9228","type":"inject","z":"ee283ca8.bf07d","name":"Off","topic":"","payload":"OFF","payloadType":"str","repeat":"","crontab":"","once":false,"x":98.5,"y":104,"wires":[["68402560.a98e3c"]]},{"id":"a2132653.b67da8","type":"debug","z":"ee283ca8.bf07d","name":"","active":true,"console":"false","complete":"false","x":461.5,"y":82,"wires":[]},{"id":"37a1e1f.085c19e","type":"inject","z":"ee283ca8.bf07d","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":142,"y":410,"wires":[["39be2570.27a092"]]},{"id":"39be2570.27a092","type":"http request","z":"ee283ca8.bf07d","name":"Relay off","method":"GET","ret":"txt","url":"http://192.168.1.72/cm?cmnd=POWER OFF","tls":"","x":342,"y":410,"wires":[[]]},{"id":"cb6cd47f.c6d7d","type":"inject","z":"ee283ca8.bf07d","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":142,"y":450,"wires":[["6d83ecb7.d2fac4"]]},{"id":"6d83ecb7.d2fac4","type":"http request","z":"ee283ca8.bf07d","name":"Relay on","method":"GET","ret":"txt","url":"http://192.168.1.72/cm?cmnd=POWER ON","tls":"","x":342,"y":450,"wires":[[]]},{"id":"61f7a719.d41cf8","type":"http request","z":"ee283ca8.bf07d","name":"Relay toggle","method":"GET","ret":"txt","url":"http://192.168.1.72/cm?cmnd=POWER TOGGLE","tls":"","x":352,"y":490,"wires":[[]]},{"id":"5edba620.6ecca","type":"inject","z":"ee283ca8.bf07d","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":142,"y":490,"wires":[["61f7a719.d41cf8"]]},{"id":"38af4f05.7492b","type":"http request","z":"ee283ca8.bf07d","name":"Status","method":"GET","ret":"txt","url":"http://192.168.1.25/cm?cmnd=STATUS","tls":"","x":332,"y":550,"wires":[["31a4f120.72e8ae"]]},{"id":"ea2a21e6.8661a","type":"inject","z":"ee283ca8.bf07d","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":142,"y":550,"wires":[["38af4f05.7492b"]]},{"id":"31a4f120.72e8ae","type":"debug","z":"ee283ca8.bf07d","name":"","active":true,"console":"false","complete":"false","x":532,"y":550,"wires":[]},{"id":"f5a54ebd.a97c2","type":"comment","z":"ee283ca8.bf07d","name":"HTTP control","info":"Controlling the relay via HTTP\nHTTP API in the admin page need to be turned off\nCopy the api key from the admin page\n\nURL http://<ip>/api/relay/0?apikey=<api key>&value=0\naccepted values (at the end):\n0: off\n1: on\n2: toggle","x":90,"y":320,"wires":[]},{"id":"3568ad98.00cee2","type":"xiaomi-magnet","z":"659a812a.2160a","gateway":"a67ca531.70e5a8","name":"P-Cuisine-baie-sud","sid":"158d00022b387b","x":177,"y":302,"wires":[["76737e2c.221f78","62660bcf.c5127c","c8e7ea00.e3d9c"]]},{"id":"e145c1fd.4e9ee8","type":"mqtt in","z":"ee283ca8.bf07d","name":"","topic":"stat/sonoff-Salon/#","qos":"0","broker":"9c9224ce.733908","x":141,"y":798,"wires":[["80056ea3.32cb88"]]},{"id":"949654a6.9a38f8","type":"debug","z":"ee283ca8.bf07d","name":"","active":true,"console":"false","complete":"false","x":761,"y":858,"wires":[]},{"id":"b2d2ae88.5bdb48","type":"mqtt out","z":"ee283ca8.bf07d","name":"","topic":"cmnd/sonoff-Salon/POWER","qos":"0","retain":"","broker":"9c9224ce.733908","x":391,"y":1018,"wires":[]},{"id":"6ede59a0.def3a8","type":"inject","z":"ee283ca8.bf07d","name":"","topic":"","payload":"off","payloadType":"str","repeat":"","crontab":"","once":false,"x":141,"y":1018,"wires":[["b2d2ae88.5bdb48"]]},{"id":"752e06d9.fe4cc","type":"inject","z":"ee283ca8.bf07d","name":"","topic":"","payload":"on","payloadType":"str","repeat":"","crontab":"","once":false,"x":141,"y":1058,"wires":[["b2d2ae88.5bdb48"]]},{"id":"3675fc7d.731eec","type":"inject","z":"ee283ca8.bf07d","name":"","topic":"","payload":"toggle","payloadType":"str","repeat":"","crontab":"","once":false,"x":141,"y":1098,"wires":[["b2d2ae88.5bdb48"]]},{"id":"537690c6.24cc88","type":"comment","z":"ee283ca8.bf07d","name":"Subscribe to all messages","info":"This is just to subscribe to all messages \ncoming from ESPurna. You can turn this off\nonce you are completed the setup.\n\nHere I put the same topic ID as what I entered\non the UI and # at the end.","x":121,"y":758,"wires":[]},{"id":"561c3fd3.7c5d38","type":"comment","z":"ee283ca8.bf07d","name":"MQTT Power control","info":"Controlling the relay via MQTT\n\nroot topic followed by relay/0/set\naccepted messages:\n0: off\n1: on\n2: toggle","x":121,"y":978,"wires":[]},{"id":"22bd9f7b.47147","type":"mqtt out","z":"ee283ca8.bf07d","name":"","topic":"cmnd/sonoff-Salon/status","qos":"0","retain":"","broker":"9c9224ce.733908","x":361,"y":918,"wires":[]},{"id":"b5fd5fb0.6cfad","type":"inject","z":"ee283ca8.bf07d","name":"","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"x":121,"y":918,"wires":[["22bd9f7b.47147"]]},{"id":"4bf36dd5.12b494","type":"json","z":"ee283ca8.bf07d","name":"","pretty":false,"x":581,"y":798,"wires":[["949654a6.9a38f8"]]},{"id":"80056ea3.32cb88","type":"switch","z":"ee283ca8.bf07d","name":"JSON format?","property":"$substring(msg.payload, 0, 1)=\"{\"","propertyType":"jsonata","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","outputs":2,"x":351,"y":798,"wires":[["4bf36dd5.12b494"],["949654a6.9a38f8"]]},{"id":"488588f9.e9c8c8","type":"mqtt in","z":"ee283ca8.bf07d","name":"","topic":"tele/sonoff-Salon/#","qos":"0","broker":"9c9224ce.733908","x":141,"y":858,"wires":[["80056ea3.32cb88"]]},{"id":"f84f39f2.510078","type":"comment","z":"659a812a.2160a","name":"Gateway Xiaomi","info":"","x":317,"y":38,"wires":[]},{"id":"366d5986.19729e","type":"comment","z":"9efb7b65.fb0c98","name":"Salon: éclairage ","info":"1 : allumer\n0 : éteindre","x":93,"y":1055,"wires":[]},{"id":"3783c1fb.f67a2e","type":"comment","z":"9efb7b65.fb0c98","name":"on","info":"","x":479,"y":1270,"wires":[]},{"id":"cd7d2461.554c18","type":"comment","z":"9efb7b65.fb0c98","name":"off","info":"","x":482,"y":1406,"wires":[]},{"id":"99b60629.59c75","type":"Sonoff device","z":"9efb7b65.fb0c98","mode":"0","broker":"9c9224ce.733908","device":"sonoff-Salon","name":"","onValue":"ON","offValue":"OFF","cmdPrefix":"cmnd","statPrefix":"stat","telePrefix":"tele","x":817,"y":1379,"wires":[["cd4c512e.e1bdb8"]]},{"id":"b9c90095.91ee7","type":"change","z":"9efb7b65.fb0c98","name":"to ON","rules":[{"t":"set","p":"payload","pt":"msg","to":"ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":603,"y":1290,"wires":[["99b60629.59c75","cd4c512e.e1bdb8"]]},{"id":"31ee21f8.d9187e","type":"change","z":"9efb7b65.fb0c98","name":"to OFF","rules":[{"t":"set","p":"payload","pt":"msg","to":"OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":603,"y":1379,"wires":[["99b60629.59c75","cd4c512e.e1bdb8"]]},{"id":"cd4c512e.e1bdb8","type":"debug","z":"9efb7b65.fb0c98","name":"","active":false,"console":"false","complete":"false","x":820,"y":1288,"wires":[]},{"id":"9f45639c.24008","type":"mqtt in","z":"9efb7b65.fb0c98","name":"Salon/XIAOMI/Motion","topic":"Salon/XIAOMI/Motion","qos":"2","broker":"9c9224ce.733908","x":109.5,"y":1344,"wires":[["2b1f7d93.cad85a","d6b42179.a8613"]]},{"id":"f990c970.5b9f5","type":"mqtt in","z":"9efb7b65.fb0c98","name":"Salon/XIAOMI/Lux","topic":"Salon/XIAOMI/Lux","qos":"2","broker":"9c9224ce.733908","x":110.5,"y":1168,"wires":[["9d9ca9d1.be3f48","3e02f95d.4c9666"]]},{"id":"9d9ca9d1.be3f48","type":"function","z":"9efb7b65.fb0c98","name":"Global var SalonLux","func":"context.global.SalonLux=msg.payload;\nmsg.payload = context.global.SalonLux;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":389,"y":1167,"wires":[[]]},{"id":"2b1f7d93.cad85a","type":"switch","z":"9efb7b65.fb0c98","name":"VerandaLux < 10","property":"VerandaLux","propertyType":"global","rules":[{"t":"lt","v":"10","vt":"num"},{"t":"else"}],"checkall":"true","outputs":2,"x":378,"y":1343,"wires":[["b9c90095.91ee7"],["31ee21f8.d9187e"]]},{"id":"24a3bf24.9502a8","type":"inject","z":"9efb7b65.fb0c98","name":"On","topic":"","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":false,"x":605,"y":1456,"wires":[["99b60629.59c75"]]},{"id":"c3200dcb.64f12","type":"inject","z":"9efb7b65.fb0c98","name":"Off","topic":"","payload":"OFF","payloadType":"str","repeat":"","crontab":"","once":false,"x":605,"y":1494,"wires":[["99b60629.59c75"]]},{"id":"dd8d0ed.a3a09f","type":"mqtt in","z":"9efb7b65.fb0c98","name":"Salon/XIAOMI/no_motion","topic":"Salon/XIAOMI/no_motion","qos":"2","broker":"9c9224ce.733908","x":122,"y":1491,"wires":[["6c83e5ab.864614","8058486d.05ab38"]]},{"id":"6c83e5ab.864614","type":"switch","z":"9efb7b65.fb0c98","name":"no motion > 300s","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"300","vt":"num"}],"checkall":"true","outputs":1,"x":368,"y":1491,"wires":[["31ee21f8.d9187e"]]},{"id":"f73c9c4e.0256a8","type":"function","z":"659a812a.2160a","name":"Battery","func":"msg.payload = msg.payload.data.voltage\n\nmax_volt = 3300;\nmin_volt = 2600;\nvoltage = msg.payload;\npercent = ((voltage - min_volt) / (max_volt - min_volt)) * 100;\npercent = percent.toPrecision(2);\nmsg.payload = percent;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":603,"y":363,"wires":[["10cf5f25.cdd3f9"]]},{"id":"62660bcf.c5127c","type":"switch","z":"659a812a.2160a","name":"switch batteryLevel","property":"payload.data.batteryLevel","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","outputs":1,"x":434,"y":363,"wires":[["f73c9c4e.0256a8"]]},{"id":"10cf5f25.cdd3f9","type":"mqtt out","z":"659a812a.2160a","name":"Cuisine-baie-sud/XIAOMI/Battery","topic":"Cuisine-baie-sud/XIAOMI/Battery","qos":"","retain":"","broker":"9c9224ce.733908","x":822,"y":363,"wires":[]},{"id":"97428c31.780568","type":"switch","z":"659a812a.2160a","name":"switch batteryLevel","property":"payload.data.batteryLevel","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","outputs":1,"x":423,"y":547,"wires":[["c6c72e2a.414f78"]]},{"id":"10e972ef.364ead","type":"mqtt out","z":"659a812a.2160a","name":"Veranda-baie-est/XIAOMI/Battery","topic":"Veranda-baie-est/XIAOMI/Battery","qos":"","retain":"","broker":"9c9224ce.733908","x":817,"y":547,"wires":[]},{"id":"a0b9ff23.44a18","type":"switch","z":"659a812a.2160a","name":"switch batteryLevel","property":"payload.data.batteryLevel","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","outputs":1,"x":414,"y":723,"wires":[["d04440bf.3efe4"]]},{"id":"1b65cc0b.34b64c","type":"mqtt out","z":"659a812a.2160a","name":"Veranda-baie-sud/XIAOMI/Battery","topic":"Veranda-baie-sud/XIAOMI/Battery","qos":"","retain":"","broker":"9c9224ce.733908","x":813,"y":723,"wires":[]},{"id":"c8e7ea00.e3d9c","type":"debug","z":"659a812a.2160a","name":"","active":false,"console":"false","complete":"true","x":233,"y":366,"wires":[]},{"id":"b17f9b3b.8e2bd","type":"debug","z":"659a812a.2160a","name":"","active":false,"console":"false","complete":"true","x":209,"y":1805,"wires":[]},{"id":"e5f22211.3f6618","type":"function","z":"659a812a.2160a","name":"Lux","func":"msg.payload = msg.payload.data.lux\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":1898,"wires":[["657898c5.aebe48"]]},{"id":"91c09ca8.5eb138","type":"function","z":"659a812a.2160a","name":"no_motion","func":"if (msg.payload == \"motion\")\n{\n    msg.payload = 0;\n    node.status({text:msg.payload});\n    return msg;\n}\nelse\n{\ntry {\n    msg.payload = msg.payload.data.no_motion;\n    node.status({text:msg.payload});\n    return msg;\n}\ncatch(e) {}\n}","outputs":1,"noerr":0,"x":577,"y":1828,"wires":[["86bb23ca.7395b"]]},{"id":"966b6666.2decd","type":"function","z":"659a812a.2160a","name":"motion","func":"msg.payload = msg.payload.data.status\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":562,"y":1761,"wires":[["91c09ca8.5eb138","2ea9d9cb.ffa856"]]},{"id":"2ea9d9cb.ffa856","type":"mqtt out","z":"659a812a.2160a","name":"Cuisine/XIAOMI/Motion","topic":"Cuisine/XIAOMI/Motion","qos":"","retain":"","broker":"9c9224ce.733908","x":766,"y":1760,"wires":[]},{"id":"86bb23ca.7395b","type":"mqtt out","z":"659a812a.2160a","name":"Cuisine/XIAOMI/no_motion","topic":"Cuisine/XIAOMI/no_motion","qos":"","retain":"","broker":"9c9224ce.733908","x":786,"y":1828,"wires":[]},{"id":"657898c5.aebe48","type":"mqtt out","z":"659a812a.2160a","name":"Cuisine/XIAOMI/Lux","topic":"Cuisine/XIAOMI/Lux","qos":"","retain":"true","broker":"9c9224ce.733908","x":754,"y":1898,"wires":[]},{"id":"32bf657e.44d7e2","type":"mqtt out","z":"659a812a.2160a","name":"Cuisine/XIAOMI/Battery","topic":"Cuisine/XIAOMI/Battery","qos":"","retain":"","broker":"9c9224ce.733908","x":774,"y":1962,"wires":[]},{"id":"a561832.0af7c8","type":"function","z":"659a812a.2160a","name":"Date","func":"MaDate = new Date();\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\n//msg.payload = timeString\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":563,"y":1703,"wires":[["18024614.7525c2"]]},{"id":"18024614.7525c2","type":"mqtt out","z":"659a812a.2160a","name":"Cuisine/XIAOMI/Lastupdate","topic":"Cuisine/XIAOMI/Lastupdate","qos":"2","retain":"","broker":"9c9224ce.733908","x":783,"y":1703,"wires":[]},{"id":"e5c128ed.1196f8","type":"switch","z":"659a812a.2160a","name":"switch motion","property":"payload.data.status","propertyType":"msg","rules":[{"t":"cont","v":"motion","vt":"str"}],"checkall":"true","outputs":1,"x":399,"y":1732,"wires":[["966b6666.2decd","a561832.0af7c8"]]},{"id":"d6c8bc0a.73ab48","type":"switch","z":"659a812a.2160a","name":"switch no_motion","property":"payload.data.no_motion","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","outputs":1,"x":397,"y":1828,"wires":[["91c09ca8.5eb138"]]},{"id":"5b0deeb9.7343d8","type":"switch","z":"659a812a.2160a","name":"switch lux","property":"msg.payload.data.lux","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","outputs":1,"x":369,"y":1897,"wires":[["e5f22211.3f6618"]]},{"id":"896696ca.faee18","type":"switch","z":"659a812a.2160a","name":"switch batteryLevel","property":"payload.data.batteryLevel","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","outputs":1,"x":392,"y":1962,"wires":[["e0a378a2.c36658"]]},{"id":"c175ce11.bb58d","type":"mqtt in","z":"b5752a43.1c1f2","name":"Cuisine-baie-sud/XIAOMI/Door","topic":"Cuisine-baie-sud/XIAOMI/Door","qos":"2","broker":"9c9224ce.733908","x":155,"y":3665,"wires":[["1e7e3d7f.17ec0b"]]},{"id":"d58ae85c.ad2e3","type":"comment","z":"b5752a43.1c1f2","name":"Baie vitrée ouvrante : ouverte ou fermée ?","info":"0 : ouverte : pas d'acttion sur les volets\n1 : fermée : fermeture des volets","x":187,"y":3612,"wires":[]},{"id":"1e7e3d7f.17ec0b","type":"function","z":"b5752a43.1c1f2","name":"Global var PCuisineBaieSud","func":"context.global.PCuisineBaieSud=msg.payload;\nmsg.payload = context.global.PCuisineBaieSud;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":467,"y":3665,"wires":[["bdbd2ec9.1965d"]]},{"id":"599055e3.c2e6fc","type":"function","z":"b5752a43.1c1f2","name":"Global var PVerandaBaieEst","func":"context.global.PVerandaBaieEst=msg.payload;\nmsg.payload = context.global.PVerandaBaieEst;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":469,"y":3717,"wires":[[]]},{"id":"feaf1939.c202f8","type":"function","z":"b5752a43.1c1f2","name":"Global var PVerandaBaieSud","func":"context.global.PVerandaBaieSud=msg.payload;\nmsg.payload = context.global.PVerandaBaieSud;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":473,"y":3763,"wires":[[]]},{"id":"b7252cad.3308f8","type":"mqtt in","z":"b5752a43.1c1f2","name":"Veranda-baie-est/XIAOMI/Door","topic":"Veranda-baie-est/XIAOMI/Door","qos":"2","broker":"9c9224ce.733908","x":154,"y":3717,"wires":[["599055e3.c2e6fc"]]},{"id":"45377dc5.6d09f4","type":"mqtt in","z":"b5752a43.1c1f2","name":"Veranda-baie-sud/XIAOMI/Door","topic":"Veranda-baie-sud/XIAOMI/Door","qos":"2","broker":"9c9224ce.733908","x":154,"y":3763,"wires":[["feaf1939.c202f8"]]},{"id":"b7353217.58d61","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/cuisine/sud","topic":"Volet/cuisine/sud","qos":"","retain":"","broker":"9c9224ce.733908","x":1495,"y":3891,"wires":[]},{"id":"210c6f30.e6fab","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/veranda/sud1","topic":"Volet/veranda/sud1","qos":"","retain":"","broker":"9c9224ce.733908","x":1072,"y":4065,"wires":[]},{"id":"5d7979e2.d7bdd","type":"mqtt out","z":"b5752a43.1c1f2","name":"Volet/veranda/est2","topic":"Volet/veranda/est2","qos":"","retain":"","broker":"9c9224ce.733908","x":1075,"y":4248,"wires":[]},{"id":"531e8b3f.82501c","type":"inject","z":"b5752a43.1c1f2","name":"Up","topic":"on","payload":"on","payloadType":"str","repeat":"","crontab":"","once":false,"x":95,"y":3942,"wires":[["a8786a6d.e94ab","3b7dbada.1fa95e"]]},{"id":"e6e42b64.fad6f","type":"inject","z":"b5752a43.1c1f2","name":"Down","topic":"off","payload":"off","payloadType":"str","repeat":"","crontab":"","once":false,"x":92,"y":3982,"wires":[["a8786a6d.e94ab","3b7dbada.1fa95e"]]},{"id":"f2240562.adae68","type":"inject","z":"b5752a43.1c1f2","name":"Auto","topic":"","payload":"auto","payloadType":"str","repeat":"","crontab":"","once":false,"x":89,"y":4024,"wires":[["a8786a6d.e94ab","3b7dbada.1fa95e"]]},{"id":"5f97ec1a.9e0cf4","type":"comment","z":"b5752a43.1c1f2","name":"Automatisme : volets fermés le soir si baie fermée","info":"","x":217,"y":3832,"wires":[]},{"id":"fddcbd9d.6dc988","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1330,"y":3892,"wires":[["b7353217.58d61"]]},{"id":"aa670f3c.d9c2e","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":892,"y":4065,"wires":[["210c6f30.e6fab"]]},{"id":"de2b671f.1f5928","type":"delay","z":"b5752a43.1c1f2","name":"R 1-5","pauseType":"random","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":893,"y":4249,"wires":[["5d7979e2.d7bdd"]]},{"id":"d3ff6cd0.955e5","type":"function","z":"b5752a43.1c1f2","name":"Répéteur","func":"for (i = 0; i < 2; i++) \n{\n    node.send(msg);\n}","outputs":1,"noerr":0,"x":1199,"y":3893,"wires":[["fddcbd9d.6dc988"]]},{"id":"a8786a6d.e94ab","type":"bigtimer","z":"b5752a43.1c1f2","outtopic":"","outpayload1":"","outpayload2":"down","name":"Volets down only hivers","lat":"49.213999","lon":"-0.400256","starttime":"5003","endtime":"5004","startoff":"-15","endoff":"+25","offs":0,"outtext1":"","outtext2":"down","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":false,"jun":false,"jul":false,"aug":false,"sep":false,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":false,"odd":false,"even":false,"x":316,"y":3906,"wires":[["cb7fe3f2.a3626","684fd75e.9be1d","1359a40f.09d21c"],[],[]]},{"id":"3b7dbada.1fa95e","type":"bigtimer","z":"b5752a43.1c1f2","outtopic":"","outpayload1":"","outpayload2":"down","name":"Volets down only été","lat":"49.213999","lon":"-0.400256","starttime":"5003","endtime":"5004","startoff":"-15","endoff":"+40","offs":0,"outtext1":"","outtext2":"down","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":false,"feb":false,"mar":false,"apr":false,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":false,"nov":false,"dec":false,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":false,"odd":false,"even":false,"x":298,"y":4055,"wires":[["cb7fe3f2.a3626","684fd75e.9be1d","1359a40f.09d21c"],[],[]]},{"id":"cb7fe3f2.a3626","type":"switch","z":"b5752a43.1c1f2","name":"PCuisineBaieSud","property":"PCuisineBaieSud","propertyType":"global","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","outputs":2,"x":555,"y":3894,"wires":[["7e2d9252.d9bbc4"],["33f18561.0c749a"]]},{"id":"7e2d9252.d9bbc4","type":"switch","z":"b5752a43.1c1f2","name":"PVerandaBaieEst","property":"PVerandaBaieEst","propertyType":"global","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","outputs":2,"x":761,"y":3893,"wires":[["a919465c.890ac"],["33f18561.0c749a"]]},{"id":"a919465c.890ac","type":"switch","z":"b5752a43.1c1f2","name":"PVerandaBaieSud","property":"PVerandaBaieSud","propertyType":"global","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","outputs":2,"x":992,"y":3893,"wires":[["d3ff6cd0.955e5"],["33f18561.0c749a"]]},{"id":"d2477f66.17c53","type":"comment","z":"b5752a43.1c1f2","name":"close","info":"","x":596,"y":3854,"wires":[]},{"id":"78308de1.9e689c","type":"comment","z":"b5752a43.1c1f2","name":"close","info":"","x":796,"y":3853,"wires":[]},{"id":"f350dc2a.5dde68","type":"comment","z":"b5752a43.1c1f2","name":"close","info":"","x":998,"y":3852,"wires":[]},{"id":"684fd75e.9be1d","type":"switch","z":"b5752a43.1c1f2","name":"PVerandaBaieSud","property":"PVerandaBaieSud","propertyType":"global","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","outputs":2,"x":545,"y":4067,"wires":[["5d84fd36.2bef54"],["1422cbe1.81b364"]]},{"id":"1359a40f.09d21c","type":"switch","z":"b5752a43.1c1f2","name":"PVerandaBaieEst","property":"PVerandaBaieEst","propertyType":"global","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"else"}],"checkall":"true","outputs":2,"x":544,"y":4251,"wires":[["50c1aa66.154444"],["3050a73a.e8fe78"]]},{"id":"5d84fd36.2bef54","type":"function","z":"b5752a43.1c1f2","name":"Répéteur","func":"for (i = 0; i < 2; i++) \n{\n    node.send(msg);\n}","outputs":1,"noerr":0,"x":744,"y":4066,"wires":[["aa670f3c.d9c2e"]]},{"id":"50c1aa66.154444","type":"function","z":"b5752a43.1c1f2","name":"Répéteur","func":"for (i = 0; i < 2; i++) \n{\n    node.send(msg);\n}","outputs":1,"noerr":0,"x":742,"y":4250,"wires":[["de2b671f.1f5928"]]},{"id":"58b666f0.a030d8","type":"comment","z":"b5752a43.1c1f2","name":"close","info":"","x":586,"y":4028,"wires":[]},{"id":"45567ee4.646d","type":"comment","z":"b5752a43.1c1f2","name":"close","info":"","x":582,"y":4213,"wires":[]},{"id":"75287860.7ffe","type":"inject","z":"ee283ca8.bf07d","name":"stat","topic":"","payload":"stat","payloadType":"str","repeat":"","crontab":"","once":false,"x":91,"y":155,"wires":[["68402560.a98e3c"]]},{"id":"e1beb900.0330b","type":"inject","z":"ee283ca8.bf07d","name":"cmnd=POWER TOGGLE","topic":"","payload":"POWER TOGGLE","payloadType":"str","repeat":"","crontab":"","once":false,"x":151,"y":195,"wires":[["68402560.a98e3c"]]},{"id":"7e6891e7.53dee8","type":"inject","z":"ee283ca8.bf07d","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":140,"y":360,"wires":[["1f56460a.e78ae2"]]},{"id":"1f56460a.e78ae2","type":"http request","z":"ee283ca8.bf07d","name":"Power status","method":"GET","ret":"txt","url":"http://192.168.1.72/cm?cmnd=POWER","tls":"","x":350,"y":360,"wires":[["31a4f120.72e8ae"]]},{"id":"a79941d1.709bf8","type":"xiaomi-motion","z":"659a812a.2160a","gateway":"a67ca531.70e5a8","name":"M-Cuisine-présence","sid":"158d000224f9b4","motionmsg":"","nomotionmsg":"","output":"0","x":178,"y":1852,"wires":[["e5c128ed.1196f8","d6c8bc0a.73ab48","5b0deeb9.7343d8","896696ca.faee18","b17f9b3b.8e2bd"]]},{"id":"935f637b.8e671","type":"debug","z":"659a812a.2160a","name":"","active":false,"console":"false","complete":"true","x":205,"y":2142,"wires":[]},{"id":"78060bb.b622af4","type":"function","z":"659a812a.2160a","name":"Lux","func":"msg.payload = msg.payload.data.lux\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":545,"y":2237,"wires":[["8852b33e.087768"]]},{"id":"b0e7fb79.2be318","type":"function","z":"659a812a.2160a","name":"no_motion","func":"if (msg.payload == \"motion\")\n{\n    msg.payload = 0;\n    node.status({text:msg.payload});\n    return msg;\n}\nelse\n{\ntry {\n    msg.payload = msg.payload.data.no_motion;\n    node.status({text:msg.payload});\n    return msg;\n}\ncatch(e) {}\n}","outputs":1,"noerr":0,"x":572,"y":2169,"wires":[["fb177778.35061"]]},{"id":"cf3ccead.6f4aa","type":"function","z":"659a812a.2160a","name":"motion","func":"msg.payload = msg.payload.data.status\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":557,"y":2100,"wires":[["b0e7fb79.2be318","63f0e1e0.00909"]]},{"id":"63f0e1e0.00909","type":"mqtt out","z":"659a812a.2160a","name":"Veranda/XIAOMI/Motion","topic":"Veranda/XIAOMI/Motion","qos":"","retain":"","broker":"9c9224ce.733908","x":783,"y":2099,"wires":[]},{"id":"fb177778.35061","type":"mqtt out","z":"659a812a.2160a","name":"Veranda/XIAOMI/no_motion","topic":"Veranda/XIAOMI/no_motion","qos":"","retain":"","broker":"9c9224ce.733908","x":793,"y":2169,"wires":[]},{"id":"8852b33e.087768","type":"mqtt out","z":"659a812a.2160a","name":"Veranda/XIAOMI/Lux","topic":"Veranda/XIAOMI/Lux","qos":"","retain":"true","broker":"9c9224ce.733908","x":771,"y":2237,"wires":[]},{"id":"cfa6ce2b.6f58a8","type":"mqtt out","z":"659a812a.2160a","name":"Veranda/XIAOMI/Battery","topic":"Veranda/XIAOMI/Battery","qos":"","retain":"","broker":"9c9224ce.733908","x":781,"y":2301,"wires":[]},{"id":"e6375ceb.a620b","type":"function","z":"659a812a.2160a","name":"Date","func":"MaDate = new Date();\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\n//msg.payload = timeString\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":558,"y":2042,"wires":[["f0dd445b.6e6d78"]]},{"id":"f0dd445b.6e6d78","type":"mqtt out","z":"659a812a.2160a","name":"Veranda/XIAOMI/Lastupdate","topic":"Veranda/XIAOMI/Lastupdate","qos":"2","retain":"","broker":"9c9224ce.733908","x":790,"y":2043,"wires":[]},{"id":"716a38bb.548748","type":"switch","z":"659a812a.2160a","name":"switch motion","property":"payload.data.status","propertyType":"msg","rules":[{"t":"cont","v":"motion","vt":"str"}],"checkall":"true","outputs":1,"x":395,"y":2072,"wires":[["cf3ccead.6f4aa","e6375ceb.a620b"]]},{"id":"2eb0eaf3.198716","type":"switch","z":"659a812a.2160a","name":"switch no_motion","property":"payload.data.no_motion","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","outputs":1,"x":393,"y":2168,"wires":[["b0e7fb79.2be318"]]},{"id":"5f48a083.d82f1","type":"switch","z":"659a812a.2160a","name":"switch lux","property":"msg.payload.data.lux","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","outputs":1,"x":365,"y":2237,"wires":[["78060bb.b622af4"]]},{"id":"72d98e7b.a6fee8","type":"switch","z":"659a812a.2160a","name":"switch batteryLevel","property":"payload.data.batteryLevel","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","outputs":1,"x":388,"y":2302,"wires":[["f9c2a3dc.8a7cc"]]},{"id":"d566b67d.b17268","type":"xiaomi-motion","z":"659a812a.2160a","gateway":"a67ca531.70e5a8","name":"M-Véranda-présence","sid":"158d000224f833","motionmsg":"","nomotionmsg":"","output":"0","x":177,"y":2191,"wires":[["716a38bb.548748","2eb0eaf3.198716","5f48a083.d82f1","72d98e7b.a6fee8","935f637b.8e671"]]},{"id":"22bd1700.5512da","type":"mqtt in","z":"9efb7b65.fb0c98","name":"Veranda/XIAOMI/Lux","topic":"Veranda/XIAOMI/Lux","qos":"2","broker":"9c9224ce.733908","x":112,"y":1116,"wires":[["8b6549e6.85e2d8"]]},{"id":"8b6549e6.85e2d8","type":"function","z":"9efb7b65.fb0c98","name":"Global var VerandaLux","func":"context.global.VerandaLux=msg.payload;\nmsg.payload = context.global.VerandaLux;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":400.5,"y":1115,"wires":[[]]},{"id":"e6bc1607.a9ad38","type":"ui_slider","z":"77ef16e7.a27228","name":"","label":"Seuil T°","group":"8aa34793.811b08","order":11,"width":"6","height":"1","passthru":true,"topic":"","min":"-5","max":10,"step":1,"x":174,"y":805,"wires":[["380fb03d.60c858","7fde2e4f.b3548","770dfa57.900c84"]]},{"id":"380fb03d.60c858","type":"debug","z":"77ef16e7.a27228","name":"","active":false,"console":"false","complete":"false","x":407,"y":762,"wires":[]},{"id":"5b598fbe.9c5c3","type":"ui_slider","z":"77ef16e7.a27228","name":"","label":"Seuil Hum","group":"8aa34793.811b08","order":15,"width":"6","height":"1","passthru":true,"topic":"","min":"0","max":"100","step":"5","x":148,"y":1083,"wires":[["6c4b0d25.440cfc","bbcf0836.09793","d3ca740d.be3c78"]]},{"id":"3e02f95d.4c9666","type":"ui_chart","z":"9efb7b65.fb0c98","name":"Chart-Salon-Lux","group":"cecc0790.67d028","order":8,"width":"","height":"","label":"Lux","chartType":"line","xformat":"HH","interpolate":"linear","nodata":"No Data","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":"","useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":true,"x":340,"y":1220,"wires":[[],[]]},{"id":"89e68f89.374af","type":"comment","z":"65265671.c010f8","name":"Véranda : éclairage ","info":"1 : allumer\n0 : éteindre","x":110,"y":1700,"wires":[]},{"id":"7d5ac828.70a8f8","type":"mqtt in","z":"65265671.c010f8","name":"Veranda/XIAOMI/Lux","topic":"Veranda/XIAOMI/Lux","qos":"2","broker":"9c9224ce.733908","x":119,"y":1761,"wires":[["18fb0f26.7b5b01"]]},{"id":"18fb0f26.7b5b01","type":"ui_chart","z":"65265671.c010f8","name":"Chart-Veranda-Lux","group":"8b1773d1.02b85","order":16,"width":"","height":"","label":"Lux","chartType":"line","xformat":"HH","interpolate":"linear","nodata":"No Data","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"86400","cutout":"","useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":true,"x":335,"y":1761,"wires":[[],[]]},{"id":"37aa25e4.407622","type":"inject","z":"77ef16e7.a27228","name":"","topic":"","payload":"restarted","payloadType":"str","repeat":"","crontab":"","once":true,"x":105,"y":1353,"wires":[["465295b1.785774"]]},{"id":"8c861ad6.edb1c","type":"comment","z":"77ef16e7.a27228","name":"Qualité de l'air","info":"","x":268,"y":1312,"wires":[]},{"id":"465295b1.785774","type":"file in","z":"77ef16e7.a27228","name":"sortie.xml","filename":"/var/www/html/qair/qair.txt","format":"utf8","sendError":true,"x":265.00001525878906,"y":1353,"wires":[["cba4c763.66813"]]},{"id":"cba4c763.66813","type":"function","z":"77ef16e7.a27228","name":"global.Qair","func":"context.global.Qair = msg.payload;\nmsg.payload = context.global.Qair;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":431,"y":1353,"wires":[[]]},{"id":"3d8d13ec.594e34","type":"comment","z":"9e51a2fa.b06ff","name":"Qualité de l'air","info":"","x":132,"y":441,"wires":[]},{"id":"6010dd8a.8ddbac","type":"file in","z":"9e51a2fa.b06ff","name":"qair.txt","filename":"/var/www/html/qair/qair.txt","format":"utf8","sendError":true,"x":285,"y":436,"wires":[["1363d416.628e5c"]]},{"id":"3046ec10.536944","type":"function","z":"9e51a2fa.b06ff","name":"global.Qair","func":"context.global.Qair = msg.payload;\nmsg.payload = context.global.Qair;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":603,"y":546,"wires":[["77dc6565.687bf4"]]},{"id":"2e414471.8201b4","type":"mqtt in","z":"9e51a2fa.b06ff","name":"Humidité Salle de bain","topic":"Salledebain/RFX/Humidity","qos":"2","broker":"9c9224ce.733908","x":110,"y":381,"wires":[["6010dd8a.8ddbac","c054c587.a0c29","19ab9461.4eaef4"]]},{"id":"23892051.02a0b","type":"function","z":"9e51a2fa.b06ff","name":"global.Humidity","func":"context.global.Humidity = Math.trunc(msg.payload);\nmsg.payload = context.global.Humidity;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":457,"y":382,"wires":[[]]},{"id":"c054c587.a0c29","type":"function","z":"9e51a2fa.b06ff","name":"populate-Template","func":"msg = {};\nmsg.t1 =  Math.trunc(context.global.MyTemperatureExt);\nmsg.h1 =  Math.trunc(context.global.Humidity);\nmsg.a1 =  context.global.Qair;\n    node.status({text:msg.t1});\nreturn msg;","outputs":"1","noerr":0,"x":333,"y":320,"wires":[["f4bff3a3.fd91f8"]]},{"id":"f4bff3a3.fd91f8","type":"ui_template","z":"9e51a2fa.b06ff","group":"8aa34793.811b08","name":"","order":2,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:0px; text-align: left; margin:2px; border:2px solid white;\">\n<span style=\"width:33%;padding-top:5px;padding-left:5px;\">{{\"Hum: \" + msg.h1 +\"%\"}}</span>\n<span style=\"width:33%;padding-top:5px;padding-left:5px;\">{{\"T° Ext: \" + msg.t1 + \"°c\"}}</span>\n<span style=\"width:33%;padding-top:5px;padding-left:5px;\">{{\"Q air: \" + msg.a1 }}</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":506,"y":320,"wires":[[]]},{"id":"77dc6565.687bf4","type":"switch","z":"9e51a2fa.b06ff","name":"Select air quality","property":"Qair","propertyType":"global","rules":[{"t":"btwn","v":"0","vt":"num","v2":"4","v2t":"num"},{"t":"btwn","v":"5","vt":"num","v2":"7","v2t":"num"},{"t":"gt","v":"7","vt":"str"}],"checkall":"true","outputs":3,"x":144.300048828125,"y":1170.7999877929688,"wires":[["7c8e0f05.3bf3e","9d2b636b.f84ff8"],["52103ef.5111dc"],["7d2c2bc8.dc30e4"]]},{"id":"956903fb.c728e","type":"comment","z":"9e51a2fa.b06ff","name":"Air 0-4 : OK runVMC","info":"","x":188,"y":1129,"wires":[]},{"id":"cb7d6f10.0ea43","type":"comment","z":"9e51a2fa.b06ff","name":"Air 5-10 : Pollué stopVMC","info":"","x":156,"y":1213,"wires":[]},{"id":"3228ceca.e2f402","type":"comment","z":"9e51a2fa.b06ff","name":"1 action max par heure","info":"","x":618,"y":1273,"wires":[]},{"id":"e0ed8a91.0b2a08","type":"delay","z":"9e51a2fa.b06ff","name":"1 message/H","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":608,"y":1213,"wires":[["35c29c8.45632e4"]]},{"id":"35c29c8.45632e4","type":"function","z":"9e51a2fa.b06ff","name":"stopVMC","func":"context.global.VMCState = \"OFF\";\nmsg.payload = context.global.VMCState;\n    node.status({text:msg.payload});\nmsg.payload = \"OFF\";\nreturn msg;","outputs":1,"noerr":0,"x":758,"y":1213,"wires":[["ee0d32f7.27d4b8","df73878f.4411a","66f5c682.397968","c33a06e5.319658"]]},{"id":"ee0d32f7.27d4b8","type":"debug","z":"9e51a2fa.b06ff","name":"","active":true,"console":"false","complete":"false","x":928.800048828125,"y":1194.7999877929688,"wires":[]},{"id":"4609b14f.aea76","type":"mqtt in","z":"9e51a2fa.b06ff","name":"VMC/XIAOMI/MarcheForcee","topic":"VMC/XIAOMI/MarcheForcee","qos":"2","broker":"9c9224ce.733908","x":137,"y":846,"wires":[["be3b69bb.81f5c"]]},{"id":"cb2602b7.b13e18","type":"switch","z":"9e51a2fa.b06ff","name":"VMCMarcheForcee","property":"VMCMarcheForcee","propertyType":"global","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":819,"y":846,"wires":[["34a6be5b.a2726a"],[]]},{"id":"3b30e794.4f34b8","type":"comment","z":"9e51a2fa.b06ff","name":"on","info":"","x":848,"y":807,"wires":[]},{"id":"98a9f34.3fec01","type":"comment","z":"9e51a2fa.b06ff","name":"off","info":"","x":909,"y":883,"wires":[]},{"id":"db929189.5b9328","type":"Sonoff device","z":"9e51a2fa.b06ff","mode":"0","broker":"9c9224ce.733908","device":"sonoff-vmc","name":"","onValue":"ON","offValue":"OFF","cmdPrefix":"cmnd","statPrefix":"stat","telePrefix":"tele","x":634,"y":846,"wires":[["cb2602b7.b13e18","74115a69.2b860c"]]},{"id":"6ad0e2ac.5cfedc","type":"mqtt out","z":"9e51a2fa.b06ff","name":"qair/value","topic":"qair/value","qos":"","retain":"","broker":"9c9224ce.733908","x":620,"y":437,"wires":[]},{"id":"c80e08c5.9f1d58","type":"comment","z":"9e51a2fa.b06ff","name":"VMC - Valeur en entrée : qualité de l'air T° ext, humidité sdb","info":"","x":225,"y":280,"wires":[]},{"id":"345cbdf3.c4692a","type":"comment","z":"9e51a2fa.b06ff","name":"Marche forcée : appuie poussoir cuisine pour aspiration maxi","info":"","x":232,"y":709,"wires":[]},{"id":"7f13cdb8.0465e4","type":"delay","z":"9e51a2fa.b06ff","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":674,"y":943,"wires":[["af1ed1e0.653b4"]]},{"id":"4f0f247d.8e02f4","type":"mqtt out","z":"9e51a2fa.b06ff","name":"VMC/XIAOMI/MarcheForcee","topic":"VMC/XIAOMI/MarcheForcee","qos":"","retain":"","broker":"9c9224ce.733908","x":760,"y":1000,"wires":[]},{"id":"f1c3792c.2728f8","type":"comment","z":"9e51a2fa.b06ff","name":"Qalité air ?","info":"","x":78,"y":1073,"wires":[]},{"id":"df73878f.4411a","type":"Sonoff device","z":"9e51a2fa.b06ff","mode":"0","broker":"9c9224ce.733908","device":"sonoff-vmc","name":"","onValue":"ON","offValue":"OFF","cmdPrefix":"cmnd","statPrefix":"stat","telePrefix":"tele","x":928,"y":1233,"wires":[[]]},{"id":"97c2effc.9c70f8","type":"comment","z":"9e51a2fa.b06ff","name":"on","info":"","x":192,"y":1432,"wires":[]},{"id":"12be788.8ac9e88","type":"switch","z":"9e51a2fa.b06ff","name":"VMCMarcheForcee","property":"VMCMarcheForcee","propertyType":"global","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":138,"y":1473,"wires":[["b2975d22.30007","7a56e98e.bc9398"],["b2975d22.30007","92da83e8.d2e4c"]]},{"id":"69e55d0d.bdde84","type":"function","z":"9e51a2fa.b06ff","name":"startVMC","func":"context.global.VMCState = \"ON\";\nmsg.payload = context.global.VMCState;\n    node.status({text:msg.payload});\nmsg.payload = \"ON\";\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":1452,"wires":[["b29e248c.820c08","c094c715.c96658"]]},{"id":"b29e248c.820c08","type":"Sonoff device","z":"9e51a2fa.b06ff","mode":"0","broker":"9c9224ce.733908","device":"sonoff-vmc","name":"","onValue":"ON","offValue":"OFF","cmdPrefix":"cmnd","statPrefix":"stat","telePrefix":"tele","x":718.199951171875,"y":1481.199951171875,"wires":[["48082ea3.bba0b","66f5c682.397968","c33a06e5.319658"]]},{"id":"c094c715.c96658","type":"debug","z":"9e51a2fa.b06ff","name":"","active":true,"console":"false","complete":"false","x":723,"y":1415,"wires":[]},{"id":"48082ea3.bba0b","type":"delay","z":"9e51a2fa.b06ff","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":882,"y":1497,"wires":[["3709754.378b80a"]]},{"id":"1be06c6f.3fee44","type":"function","z":"9e51a2fa.b06ff","name":"stopVMC","func":"context.global.VMCState = \"OFF\";\nmsg.payload = context.global.VMCState;\n    node.status({text:msg.payload});\nmsg.payload = \"OFF\";\nreturn msg;","outputs":1,"noerr":0,"x":842,"y":1572,"wires":[["b29e248c.820c08"]]},{"id":"ae32e49f.d880a8","type":"comment","z":"9e51a2fa.b06ff","name":"off","info":"","x":182,"y":1511,"wires":[]},{"id":"4e0a2206.3e1b34","type":"inject","z":"9e51a2fa.b06ff","name":"Test Q air =4 (correct)","topic":"","payload":"4","payloadType":"num","repeat":"","crontab":"","once":false,"x":221,"y":510,"wires":[["3046ec10.536944"]]},{"id":"f23a6808.f24498","type":"inject","z":"9e51a2fa.b06ff","name":"Test Q air =5 (pollué)","topic":"","payload":"5","payloadType":"num","repeat":"","crontab":"","once":false,"x":217,"y":551,"wires":[["3046ec10.536944"]]},{"id":"a1a90ed3.0ca7d","type":"inject","z":"9e51a2fa.b06ff","name":"Test Q air =8 (très pollué)","topic":"","payload":"8","payloadType":"num","repeat":"","crontab":"","once":false,"x":228,"y":588,"wires":[["3046ec10.536944"]]},{"id":"af1ed1e0.653b4","type":"function","z":"9e51a2fa.b06ff","name":"stopVMC","func":"context.global.VMCState = \"OFF\";\nmsg.payload = context.global.VMCState;\n    node.status({text:msg.payload});\nmsg.payload = \"OFF\";\nreturn msg;","outputs":1,"noerr":0,"x":818,"y":940,"wires":[["4f0f247d.8e02f4","cdd32c30.b0feb8"]]},{"id":"346218c7.d7d098","type":"comment","z":"9e51a2fa.b06ff","name":"Run immédiat VMC","info":"","x":519,"y":1498,"wires":[]},{"id":"78153de7.4d5d34","type":"comment","z":"9e51a2fa.b06ff","name":"Arrêt marche forcée VMC après 1H","info":"","x":1024,"y":1453,"wires":[]},{"id":"b2975d22.30007","type":"debug","z":"9e51a2fa.b06ff","name":"","active":true,"console":"false","complete":"false","x":350,"y":1540,"wires":[]},{"id":"458b9db0.c04d6c","type":"inject","z":"9e51a2fa.b06ff","name":"Test marche forcée ON (0)","topic":"","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":"","x":174,"y":752,"wires":[["be3b69bb.81f5c"]]},{"id":"4c36b9c.d097648","type":"inject","z":"9e51a2fa.b06ff","name":"Test marche forcée OFF (1)","topic":"","payload":"OFF","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":"","x":167,"y":795,"wires":[["be3b69bb.81f5c"]]},{"id":"e912316e.56fd8","type":"function","z":"9e51a2fa.b06ff","name":"startVMC","func":"context.global.VMCState = \"ON\";\nmsg.payload = context.global.VMCState;\n    node.status({text:msg.payload});\nmsg.payload = \"ON\";\nreturn msg;","outputs":1,"noerr":0,"x":515,"y":943,"wires":[["7f13cdb8.0465e4","4f0f247d.8e02f4"]]},{"id":"34a6be5b.a2726a","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCStateLabel","func":"context.global.VMCStateLabel = \"Marche forcée\";\nmsg.payload = context.global.VMCStateLabel;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":1028,"y":844,"wires":[["66f5c682.397968","e912316e.56fd8"]]},{"id":"52103ef.5111dc","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCStateLabel","func":"context.global.VMCStateLabel = \"air pollué\";\nmsg.payload = context.global.VMCStateLabel;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":400,"y":1200,"wires":[["e0ed8a91.0b2a08"]]},{"id":"7d2c2bc8.dc30e4","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCStateLabel","func":"context.global.VMCStateLabel = \"air très pollué\";\nmsg.payload = context.global.VMCStateLabel;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":401,"y":1243,"wires":[["e0ed8a91.0b2a08"]]},{"id":"7a56e98e.bc9398","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCStateLabel","func":"context.global.VMCStateLabel = \"Marche forcée\";\nmsg.payload = context.global.VMCStateLabel;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":376,"y":1452,"wires":[["69e55d0d.bdde84"]]},{"id":"1363d416.628e5c","type":"json","z":"9e51a2fa.b06ff","name":"","pretty":false,"x":459.5,"y":437,"wires":[["6ad0e2ac.5cfedc","3046ec10.536944"]]},{"id":"e12b4ff1.c1ab3","type":"inject","z":"9e51a2fa.b06ff","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":110,"y":128,"wires":[["bffe76cf.cdab3","e4978723.74111","746b3a12.9cf064"]]},{"id":"bffe76cf.cdab3","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCStateLabel","func":"context.global.VMCStateLabel = \" \";\nmsg.payload = context.global.VMCStateLabel;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":327,"y":80,"wires":[[]]},{"id":"e4978723.74111","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCState","func":"context.global.VMCState = \" \";\nmsg.payload = context.global.VMCState;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":316,"y":128,"wires":[[]]},{"id":"cdd32c30.b0feb8","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCStateLabel","func":"context.global.VMCStateLabel = \" \";\nmsg.payload = context.global.VMCStateLabel;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":1029,"y":939,"wires":[["66f5c682.397968"]]},{"id":"77420bbe.efad1c","type":"switch","z":"9e51a2fa.b06ff","name":"Select humidity","property":"Humidity","propertyType":"global","rules":[{"t":"lt","v":"SeuilHumid","vt":"global"},{"t":"gte","v":"SeuilHumid","vt":"global"}],"checkall":"true","outputs":2,"x":165,"y":3040,"wires":[["d827cb7.1176ab8","504b4871.1b5a38"],["d827cb7.1176ab8","6abfb5b7.569c9c"]]},{"id":"82f2fc85.e2d32","type":"comment","z":"9e51a2fa.b06ff","name":"Humidity < global.SeuilHumid : stopVMC","info":"","x":200,"y":3000,"wires":[]},{"id":"2b822f15.ca48b","type":"comment","z":"9e51a2fa.b06ff","name":"Humidity > global.SeuilHumid : runVMC","info":"","x":190,"y":3080,"wires":[]},{"id":"6abfb5b7.569c9c","type":"switch","z":"9e51a2fa.b06ff","name":"Select T°Ext","property":"MyTemperatureExt","propertyType":"global","rules":[{"t":"lt","v":"SeuilTemp","vt":"global"},{"t":"gte","v":"SeuilTemp","vt":"global"}],"checkall":"true","outputs":2,"x":430,"y":3047,"wires":[["b3e025d2.58be9"],["b35d6fec.4d9418"]]},{"id":"cd6fa18f.17c6f","type":"comment","z":"9e51a2fa.b06ff","name":"T°Ext <global.SeuilTemp : stopVMC","info":"","x":542,"y":3001,"wires":[]},{"id":"7f2289f4.6ba2b","type":"comment","z":"9e51a2fa.b06ff","name":"T°Ext >global.SeuilTemp : runVMC","info":"","x":543,"y":3087,"wires":[]},{"id":"da652e13.852678","type":"debug","z":"9e51a2fa.b06ff","name":"","active":true,"console":"false","complete":"false","x":1097,"y":2940,"wires":[]},{"id":"5f864cab.211aa4","type":"debug","z":"9e51a2fa.b06ff","name":"","active":true,"console":"false","complete":"false","x":1080,"y":3183,"wires":[]},{"id":"797277f1.9b8dd","type":"delay","z":"9e51a2fa.b06ff","name":"1 message/H","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":850,"y":2999,"wires":[["a5d488fd.6ef1c"]]},{"id":"b35d6fec.4d9418","type":"delay","z":"9e51a2fa.b06ff","name":"1 message/H","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":619,"y":3132,"wires":[["c6aba617.a1e76"]]},{"id":"40756839.c7e54","type":"comment","z":"9e51a2fa.b06ff","name":"1 action max par heure","info":"","x":878,"y":2951,"wires":[]},{"id":"95ec7542.9ccb58","type":"function","z":"9e51a2fa.b06ff","name":"Etat VMC active","func":"var msg1 =  { payload:\" active\"};\nvar msg2 = { payload:\"Humidité = \" + Math.trunc(context.global.Humidity) + \"% > seuil \" + Math.trunc(context.global.SeuilHumid)+ \"%\"};\nreturn [ msg1, msg2 ];","outputs":"2","noerr":0,"x":1100,"y":2519,"wires":[[],[]]},{"id":"3b6523d8.d56bec","type":"function","z":"9e51a2fa.b06ff","name":"Etat VMC non active","func":"var msg1 =  { payload:\"non active\"};\nvar msg2 = { payload:\"Humidité = \" + Math.trunc(context.global.Humidity) + \"% < seuil \" + Math.trunc(context.global.SeuilHumid)+ \"%\"};\n\nreturn [ msg1, msg2 ];","outputs":"2","noerr":0,"x":1113,"y":2477,"wires":[[],[]]},{"id":"c5db02fe.70cf4","type":"comment","z":"9e51a2fa.b06ff","name":"toute l'année-Jour - VMC on si Hum > seuil, et T° ext > seuil","info":"","x":240,"y":2860,"wires":[]},{"id":"a5d488fd.6ef1c","type":"function","z":"9e51a2fa.b06ff","name":"stopVMC","func":"context.global.VMCState = \"OFF\";\nmsg.payload = context.global.VMCState;\n    node.status({text:msg.payload});\nmsg.payload = \"OFF\";\nreturn msg;","outputs":1,"noerr":0,"x":1008,"y":2998,"wires":[["da652e13.852678","6165a527.e8ece4"]]},{"id":"6165a527.e8ece4","type":"Sonoff device","z":"9e51a2fa.b06ff","mode":"0","broker":"9c9224ce.733908","device":"sonoff-vmc","name":"","onValue":"ON","offValue":"OFF","cmdPrefix":"cmnd","statPrefix":"stat","telePrefix":"tele","x":1170,"y":3055,"wires":[["c33a06e5.319658","66f5c682.397968"]]},{"id":"3aa7a963.df7a9e","type":"function","z":"9e51a2fa.b06ff","name":"startVMC","func":"context.global.VMCState = \"ON\";\nmsg.payload = context.global.VMCState;\n    node.status({text:msg.payload});\nmsg.payload = \"ON\";\nreturn msg;","outputs":1,"noerr":0,"x":1012,"y":3133,"wires":[["5f864cab.211aa4","6165a527.e8ece4"]]},{"id":"504b4871.1b5a38","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCStateLabel","func":"context.global.VMCStateLabel = \"Humidité \" + Math.trunc(context.global.Humidity) + \"% < seuil \" + Math.trunc(context.global.SeuilHumid)+ \"%\";\nmsg.payload = context.global.VMCStateLabel;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":636,"y":2949,"wires":[["797277f1.9b8dd"]]},{"id":"c6aba617.a1e76","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCStateLabel","func":"context.global.VMCStateLabel = \"Humidité \" + Math.trunc(context.global.Humidity) + \"% >= seuil \" + Math.trunc(context.global.SeuilHumid)+ \"%\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":823,"y":3133,"wires":[["3aa7a963.df7a9e"]]},{"id":"bb0845a5.a6976","type":"comment","z":"9e51a2fa.b06ff","name":"Marche forcée OFF et Qalité air OK ","info":"","x":152,"y":1683,"wires":[]},{"id":"3709754.378b80a","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCStateLabel","func":"context.global.VMCStateLabel = \"Fin marche forcée\";\nmsg.payload = context.global.VMCStateLabel;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":642,"y":1572,"wires":[["1be06c6f.3fee44"]]},{"id":"7c8e0f05.3bf3e","type":"debug","z":"9e51a2fa.b06ff","name":"","active":true,"console":"false","complete":"false","x":368,"y":1093,"wires":[]},{"id":"e27f3bbc.41e19","type":"function","z":"9e51a2fa.b06ff","name":"global.SeuilHumid","func":"context.global.SeuilHumid = msg.payload;\nmsg.payload = context.global.SeuilHumid || 50;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":3660,"wires":[["c8696bfe.e25338","566f411.7eb52c"]]},{"id":"eb815c0c.f96a7","type":"debug","z":"9e51a2fa.b06ff","name":"","active":true,"console":"false","complete":"false","x":405,"y":3577,"wires":[]},{"id":"e72d089e.bf1e3","type":"comment","z":"9e51a2fa.b06ff","name":"Sélection seuil humidité","info":"","x":132,"y":3556,"wires":[]},{"id":"11b5bf0.9982841","type":"function","z":"9e51a2fa.b06ff","name":"global.SeuilTemp","func":"context.global.SeuilTemp = msg.payload;\nmsg.payload = context.global.SeuilTemp || 5;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":170,"y":3420,"wires":[["cae84f75.8b1f18","2ac7c89f.19b6a8"]]},{"id":"cae84f75.8b1f18","type":"ui_text","z":"9e51a2fa.b06ff","group":"8aa34793.811b08","order":10,"width":0,"height":0,"name":"Seuil T° lancement VMC","label":"Seuil T° lancement VMC : ","format":"{{msg.payload}}°","layout":"row-spread","x":426,"y":3362,"wires":[]},{"id":"d1ca4872.38385","type":"comment","z":"9e51a2fa.b06ff","name":"Sélection seuil température","info":"","x":146.99998474121094,"y":3309,"wires":[]},{"id":"c8696bfe.e25338","type":"ui_text","z":"9e51a2fa.b06ff","group":"8aa34793.811b08","order":14,"width":0,"height":0,"name":"Seuil humidité lancement VMC","label":"Seuil humidité lancement VMC : ","format":"{{msg.payload}}%","layout":"row-spread","x":461,"y":3621,"wires":[]},{"id":"2ac7c89f.19b6a8","type":"ui_slider","z":"9e51a2fa.b06ff","name":"","label":"Seuil T°","group":"8aa34793.811b08","order":12,"width":"6","height":"1","passthru":true,"topic":"","min":"-5","max":"12","step":1,"x":157,"y":3360,"wires":[["621865cb.2c291c","11b5bf0.9982841","cae84f75.8b1f18"]]},{"id":"621865cb.2c291c","type":"debug","z":"9e51a2fa.b06ff","name":"","active":false,"console":"false","complete":"false","x":390,"y":3317,"wires":[]},{"id":"566f411.7eb52c","type":"ui_slider","z":"9e51a2fa.b06ff","name":"","label":"Seuil Hum","group":"8aa34793.811b08","order":16,"width":"6","height":"1","passthru":true,"topic":"","min":"0","max":"100","step":"5","x":140,"y":3600,"wires":[["e27f3bbc.41e19","eb815c0c.f96a7","c8696bfe.e25338"]]},{"id":"cca0ff38.7251c","type":"time-range-switch","z":"9e51a2fa.b06ff","name":"Nuit","lat":"49.213999","lon":"-0.400256","startTime":"21:00","endTime":"06:00","startOffset":0,"endOffset":0,"x":105,"y":2376,"wires":[["6df2804.9b62f"],["332e9c6f.138c34"]]},{"id":"cdcad702.a24578","type":"comment","z":"9e51a2fa.b06ff","name":"Non","info":"","x":185,"y":2430,"wires":[]},{"id":"dc110b6e.1d5f88","type":"comment","z":"9e51a2fa.b06ff","name":"Oui","info":"","x":199,"y":2336,"wires":[]},{"id":"92da83e8.d2e4c","type":"http request","z":"9e51a2fa.b06ff","name":"HTTP sunrise","method":"GET","ret":"txt","url":"http://domogeek.entropialux.com/season","tls":"","x":117,"y":1987,"wires":[["5d1840ff.3e2368"]]},{"id":"5d1840ff.3e2368","type":"switch","z":"9e51a2fa.b06ff","name":"Switch season","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"winter","vt":"str"},{"t":"eq","v":"summer","vt":"str"},{"t":"eq","v":"autumn","vt":"str"},{"t":"eq","v":"spring","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":5,"x":308,"y":1986,"wires":[["981845f5.888888","cca0ff38.7251c"],["361fdd45.84e7a2","981845f5.888888"],["332e9c6f.138c34","981845f5.888888"],["332e9c6f.138c34","981845f5.888888"],["981845f5.888888"]]},{"id":"981845f5.888888","type":"debug","z":"9e51a2fa.b06ff","name":"","active":false,"console":"false","complete":"false","x":770,"y":2020,"wires":[]},{"id":"b95edeae.a49318","type":"comment","z":"9e51a2fa.b06ff","name":"Hivers","info":"","x":85,"y":2316,"wires":[]},{"id":"14b4ebd8.0b2c8c","type":"comment","z":"9e51a2fa.b06ff","name":"Eté","info":"","x":85,"y":2596,"wires":[]},{"id":"b4095bcb.2a006","type":"comment","z":"9e51a2fa.b06ff","name":"Hiver-Nuits - VMC off","info":"","x":235,"y":2466,"wires":[]},{"id":"aca36dd2.8ff0d","type":"function","z":"9e51a2fa.b06ff","name":"stopVMC","func":"context.global.VMCState = \"OFF\";\nmsg.payload = context.global.VMCState;\n    node.status({text:msg.payload});\nmsg.payload = \"OFF\";\nreturn msg;","outputs":1,"noerr":0,"x":484,"y":2370,"wires":[["d158cde9.765008"]]},{"id":"d158cde9.765008","type":"Sonoff device","z":"9e51a2fa.b06ff","mode":"0","broker":"9c9224ce.733908","device":"sonoff-vmc","name":"","onValue":"ON","offValue":"OFF","cmdPrefix":"cmnd","statPrefix":"stat","telePrefix":"tele","x":605,"y":2496,"wires":[["66f5c682.397968","c33a06e5.319658"]]},{"id":"361fdd45.84e7a2","type":"time-range-switch","z":"9e51a2fa.b06ff","name":"Nuit","lat":"49.213999","lon":"-0.400256","startTime":"21:00","endTime":"06:00","startOffset":0,"endOffset":0,"x":105,"y":2656,"wires":[["919f7118.6b9b98"],["332e9c6f.138c34"]]},{"id":"72b003cc.2902d4","type":"comment","z":"9e51a2fa.b06ff","name":"Non","info":"","x":185,"y":2702,"wires":[]},{"id":"9ba90d0b.7144d","type":"comment","z":"9e51a2fa.b06ff","name":"Oui","info":"","x":193,"y":2618,"wires":[]},{"id":"fbce5495.83fb78","type":"function","z":"9e51a2fa.b06ff","name":"startVMC","func":"context.global.VMCState = \"ON\";\nmsg.payload = context.global.VMCState;\n    node.status({text:msg.payload});\nmsg.payload = \"ON\";\nreturn msg;","outputs":1,"noerr":0,"x":506,"y":2649,"wires":[["d158cde9.765008"]]},{"id":"d62825c0.f5ba1","type":"comment","z":"9e51a2fa.b06ff","name":"été-Nuits - VMC on","info":"","x":225,"y":2736,"wires":[]},{"id":"6df2804.9b62f","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCStateLabel","func":"context.global.VMCStateLabel = \"Nuit d'hiver\";\nmsg.payload = context.global.VMCStateLabel;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":295,"y":2370,"wires":[["aca36dd2.8ff0d"]]},{"id":"919f7118.6b9b98","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCStateLabel","func":"context.global.VMCStateLabel = \"Nuit d'été\";\nmsg.payload = context.global.VMCStateLabel;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":315,"y":2649,"wires":[["fbce5495.83fb78"]]},{"id":"8b1beccd.633f98","type":"ui_text","z":"9e51a2fa.b06ff","group":"8aa34793.811b08","order":7,"width":0,"height":0,"name":"Raison VMC","label":"Raison","format":"{{msg.payload}}","layout":"row-spread","x":1168,"y":2102,"wires":[]},{"id":"66f5c682.397968","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCStateLabel","func":"msg.payload = context.global.VMCStateLabel;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":601,"y":2103,"wires":[["8b1beccd.633f98","5e20f6cb.5d486"]]},{"id":"c33a06e5.319658","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCState","func":"msg.payload = context.global.VMCState;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":586,"y":2152,"wires":[["f1cd2ebc.c05c8"]]},{"id":"9d2b636b.f84ff8","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCStateLabel","func":"context.global.VMCStateLabel = \"air sain\";\nmsg.payload = context.global.VMCStateLabel;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":400,"y":1149,"wires":[["12be788.8ac9e88"]]},{"id":"27880915.74ae1e","type":"comment","z":"9e51a2fa.b06ff","name":"Saison ?","info":"","x":97,"y":1947,"wires":[]},{"id":"746b3a12.9cf064","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCMarcheForcee","func":"context.global.VMCMarcheForcee = \"OFF\";\nmsg.payload = context.global.VMCMarcheForcee;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":344,"y":174,"wires":[[]]},{"id":"b2790aaf.fdb908","type":"comment","z":"9e51a2fa.b06ff","name":"Marche forcée  ?","info":"","x":102,"y":1392,"wires":[]},{"id":"28d329c3.dfeb9e","type":"comment","z":"9e51a2fa.b06ff","name":"Printemps - automne - VMC on si Hum > seuil, et T° ext > seuil","info":"","x":240,"y":2900,"wires":[]},{"id":"d827cb7.1176ab8","type":"debug","z":"9e51a2fa.b06ff","name":"","active":true,"console":"false","complete":"false","x":375,"y":3188,"wires":[]},{"id":"c968b9d1.60e7a","type":"inject","z":"9e51a2fa.b06ff","name":"Test hiver","topic":"","payload":"winter","payloadType":"str","repeat":"","crontab":"","once":false,"x":203,"y":1740,"wires":[["92da83e8.d2e4c"]]},{"id":"2201f4ea.1b3c0c","type":"inject","z":"9e51a2fa.b06ff","name":"Test été","topic":"","payload":"summer","payloadType":"str","repeat":"","crontab":"","once":false,"x":193,"y":1780,"wires":[["92da83e8.d2e4c"]]},{"id":"b1679f32.990888","type":"inject","z":"9e51a2fa.b06ff","name":"Test printemps","topic":"","payload":"spring","payloadType":"str","repeat":"","crontab":"","once":false,"x":223,"y":1820,"wires":[["92da83e8.d2e4c"]]},{"id":"fd21e245.050328","type":"inject","z":"9e51a2fa.b06ff","name":"Test automne","topic":"","payload":"autumn","payloadType":"str","repeat":"","crontab":"","once":false,"x":208,"y":1870,"wires":[["92da83e8.d2e4c"]]},{"id":"b3e025d2.58be9","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCStateLabel","func":"context.global.VMCStateLabel = \"T° ext \" + context.global.MyTemperatureExt + \"° < T° seuil \" + Math.trunc(context.global.SeuilTemp) +\"°\";\nmsg.payload = context.global.VMCStateLabel;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":640,"y":3041,"wires":[["797277f1.9b8dd"]]},{"id":"19ab9461.4eaef4","type":"json","z":"9e51a2fa.b06ff","name":"","pretty":false,"x":300.5,"y":382,"wires":[["23892051.02a0b"]]},{"id":"332e9c6f.138c34","type":"function","z":"9e51a2fa.b06ff","name":"global.Humidity","func":"\nmsg.payload = context.global.Humidity;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":131,"y":2955,"wires":[["77420bbe.efad1c"]]},{"id":"672d12ce.a5e45c","type":"exec","z":"b6726fbf.d6c4f","command":"ssh rancher@192.168.1.30 'docker run --rm  python-miio-xiaomi mirobo'","addpay":false,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"mirobo status","x":336,"y":624,"wires":[["3ce86983.c57fa6","866cb00a.cf2b98","8ca5ff31.8fb838","d1e5ad03.f69408","34ed2de8.1656ba","89f6f992.4ea458"],[],[]]},{"id":"1da1426f.6afa9e","type":"debug","z":"b6726fbf.d6c4f","name":"","active":true,"console":"false","complete":"false","x":733,"y":529,"wires":[]},{"id":"12b22687.d24979","type":"inject","z":"b6726fbf.d6c4f","name":"Status","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":115,"y":624,"wires":[["672d12ce.a5e45c"]]},{"id":"a93a960f.dec31","type":"exec","z":"b6726fbf.d6c4f","command":"/usr/local/bin/mirobo --ip 192.168.1.36 --token 56464a35707930523162795137613848","addpay":true,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"mirobo cmd","x":389,"y":1275,"wires":[["4038528e.ac0efc","d3983fbc.03caa8"],[],[]]},{"id":"d551466d.a8938","type":"exec","z":"b6726fbf.d6c4f","command":"/usr/local/bin/mirobo --ip 192.168.1.36 --token 56464a35707930523162795137613848","addpay":true,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"mirobo cmd","x":350,"y":2200,"wires":[["b347ce80.5ddf9"],[],[]]},{"id":"452e3088.10bc18","type":"exec","z":"b6726fbf.d6c4f","command":"ssh rancher@192.168.1.30 'docker run --rm  python-miio-xiaomi mirobo cleaning-history'","addpay":false,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"mirobo cleaning_history","x":156,"y":201,"wires":[["2acd618e.cd5c56","1129e21e.c6fb0e","ce49e473.9d304","657cbfea.772af"],[],[]]},{"id":"ba80098c.27665","type":"inject","z":"b6726fbf.d6c4f","name":"Consommables","topic":"","payload":"consumables","payloadType":"str","repeat":"","crontab":"","once":false,"x":171,"y":2165,"wires":[["d551466d.a8938"]]},{"id":"bf91c79e.be8b38","type":"inject","z":"b6726fbf.d6c4f","name":"Timer","topic":"","payload":"timer","payloadType":"str","repeat":"","crontab":"","once":false,"x":140,"y":2221,"wires":[["d551466d.a8938"]]},{"id":"4038528e.ac0efc","type":"debug","z":"b6726fbf.d6c4f","name":"","active":true,"console":"false","complete":"false","x":608,"y":1285,"wires":[]},{"id":"b347ce80.5ddf9","type":"debug","z":"b6726fbf.d6c4f","name":"","active":true,"console":"false","complete":"false","x":577,"y":2187,"wires":[]},{"id":"2acd618e.cd5c56","type":"debug","z":"b6726fbf.d6c4f","name":"","active":true,"console":"false","complete":"false","x":414,"y":67,"wires":[]},{"id":"3a5536cf.549d2a","type":"ui_text","z":"b6726fbf.d6c4f","group":"1bc2c7d8.cc8488","order":1,"width":0,"height":0,"name":"","label":"status","format":"{{msg.payload}}","layout":"row-spread","x":773,"y":600,"wires":[]},{"id":"3ce86983.c57fa6","type":"debug","z":"b6726fbf.d6c4f","name":"","active":true,"console":"false","complete":"false","x":491,"y":540,"wires":[]},{"id":"866cb00a.cf2b98","type":"string","z":"b6726fbf.d6c4f","name":"State","methods":[{"name":"between","params":[{"type":"str","value":"State:"},{"type":"str","value":"\\n"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":548,"y":599,"wires":[["1da1426f.6afa9e","3a5536cf.549d2a"]]},{"id":"8ca5ff31.8fb838","type":"string","z":"b6726fbf.d6c4f","name":"Battery","methods":[{"name":"between","params":[{"type":"str","value":"Battery:"},{"type":"str","value":"\\n"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":557,"y":642,"wires":[["949694b.550c7e8"]]},{"id":"949694b.550c7e8","type":"ui_text","z":"b6726fbf.d6c4f","group":"1bc2c7d8.cc8488","order":3,"width":0,"height":0,"name":"","label":"batterie","format":"{{msg.payload}}","layout":"row-spread","x":778,"y":643,"wires":[]},{"id":"d1e5ad03.f69408","type":"string","z":"b6726fbf.d6c4f","name":"Puissance aspiration","methods":[{"name":"between","params":[{"type":"str","value":"Fanspeed:"},{"type":"str","value":"\\n"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":591,"y":688,"wires":[["82e441cf.63d3a"]]},{"id":"82e441cf.63d3a","type":"ui_text","z":"b6726fbf.d6c4f","group":"26b230b8.58d348","order":6,"width":0,"height":0,"name":"","label":"Puissance d'aspiration","format":"{{msg.payload}}","layout":"row-spread","x":820,"y":688,"wires":[]},{"id":"34ed2de8.1656ba","type":"string","z":"b6726fbf.d6c4f","name":"Durée aspiration","methods":[{"name":"between","params":[{"type":"str","value":"Cleaning since:"},{"type":"str","value":"\\n"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":576,"y":737,"wires":[["928f018f.f0ba1"]]},{"id":"89f6f992.4ea458","type":"string","z":"b6726fbf.d6c4f","name":"surface aspirée","methods":[{"name":"between","params":[{"type":"str","value":"Cleaned area:"},{"type":"str","value":"\\n"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":564,"y":780,"wires":[["4021b7eb.6b6788"]]},{"id":"928f018f.f0ba1","type":"ui_text","z":"b6726fbf.d6c4f","group":"1bc2c7d8.cc8488","order":2,"width":0,"height":0,"name":"","label":"durée aspiration","format":"{{msg.payload}}","layout":"row-spread","x":801,"y":737,"wires":[]},{"id":"4021b7eb.6b6788","type":"ui_text","z":"b6726fbf.d6c4f","group":"1bc2c7d8.cc8488","order":4,"width":0,"height":0,"name":"","label":"surface aspirée","format":"{{msg.payload}}","layout":"row-spread","x":800,"y":780,"wires":[]},{"id":"68e053d5.03bbf4","type":"ui_button","z":"b6726fbf.d6c4f","name":"","group":"26b230b8.58d348","order":2,"width":"1","height":"1","passthru":false,"label":"Quiet","color":"","bgcolor":"","icon":"","payload":"30","payloadType":"num","topic":"","x":114,"y":886,"wires":[["35c08012.bdf3"]]},{"id":"6086684e.609008","type":"ui_button","z":"b6726fbf.d6c4f","name":"","group":"26b230b8.58d348","order":3,"width":"2","height":"1","passthru":false,"label":"Medium","color":"","bgcolor":"","icon":"","payload":"50","payloadType":"num","topic":"","x":121,"y":929,"wires":[["35c08012.bdf3"]]},{"id":"c92ebe7a.a0023","type":"ui_button","z":"b6726fbf.d6c4f","name":"","group":"26b230b8.58d348","order":4,"width":"2","height":"1","passthru":false,"label":"Turbo","color":"","bgcolor":"","icon":"","payload":"70","payloadType":"num","topic":"","x":113,"y":974,"wires":[["35c08012.bdf3"]]},{"id":"c120388c.e25348","type":"ui_button","z":"b6726fbf.d6c4f","name":"","group":"26b230b8.58d348","order":5,"width":"1","height":"1","passthru":false,"label":"Max","color":"","bgcolor":"","icon":"","payload":"90","payloadType":"num","topic":"","x":109,"y":1020,"wires":[["35c08012.bdf3"]]},{"id":"35c08012.bdf3","type":"exec","z":"b6726fbf.d6c4f","command":"/usr/local/bin/mirobo --ip 192.168.1.36 --token 56464a35707930523162795137613848 fanspeed","addpay":true,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"mirobo puissance","x":318,"y":958,"wires":[["99badeaa.435328","672d12ce.a5e45c"],[],[]]},{"id":"99badeaa.435328","type":"debug","z":"b6726fbf.d6c4f","name":"","active":true,"console":"false","complete":"payload","x":529,"y":945,"wires":[]},{"id":"8cbac85a.22e48","type":"ui_button","z":"b6726fbf.d6c4f","name":"","group":"fb08d572.6ed218","order":1,"width":"1","height":"1","passthru":false,"label":"Start","color":"","bgcolor":"","icon":"","payload":"start","payloadType":"str","topic":"","x":93,"y":1198,"wires":[["a93a960f.dec31"]]},{"id":"83fc8ca9.87b81","type":"ui_button","z":"b6726fbf.d6c4f","name":"","group":"fb08d572.6ed218","order":2,"width":"2","height":"1","passthru":false,"label":"Base","color":"","bgcolor":"","icon":"","payload":"home","payloadType":"str","topic":"","x":93,"y":1248,"wires":[["a93a960f.dec31"]]},{"id":"d3983fbc.03caa8","type":"delay","z":"b6726fbf.d6c4f","name":"Delay 1mn","pauseType":"delay","timeout":"1","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":610,"y":1236,"wires":[["672d12ce.a5e45c"]]},{"id":"26f1fbd3.afcef4","type":"ui_button","z":"b6726fbf.d6c4f","name":"","group":"fb08d572.6ed218","order":3,"width":"2","height":"1","passthru":false,"label":"Pause","color":"","bgcolor":"","icon":"","payload":"pause","payloadType":"str","topic":"","x":92,"y":1295,"wires":[["a93a960f.dec31"]]},{"id":"32392beb.76fdf4","type":"ui_button","z":"b6726fbf.d6c4f","name":"","group":"fb08d572.6ed218","order":4,"width":"1","height":"1","passthru":false,"label":"Stop","color":"","bgcolor":"","icon":"","payload":"stop","payloadType":"str","topic":"","x":89,"y":1342,"wires":[["a93a960f.dec31"]]},{"id":"55f2cc.8e149d34","type":"inject","z":"b6726fbf.d6c4f","name":"map","topic":"","payload":"map","payloadType":"str","repeat":"","crontab":"","once":false,"x":97,"y":1449,"wires":[["a93a960f.dec31"]]},{"id":"dbf16c13.c8ba4","type":"ui_button","z":"b6726fbf.d6c4f","name":"","group":"fb08d572.6ed218","order":5,"width":"6","height":"1","passthru":false,"label":"Localiser aspirateur","color":"","bgcolor":"","icon":"","payload":"find","payloadType":"str","topic":"","x":134,"y":1396,"wires":[["a93a960f.dec31"]]},{"id":"40486ad5.80f194","type":"ui_text","z":"b6726fbf.d6c4f","group":"2f1b591a.11a0ae","order":1,"width":"5","height":"1","name":"DND-Text","label":"","format":"{{msg.payload}}","layout":"row-spread","x":1145,"y":1761,"wires":[]},{"id":"5c36eb34.2f402c","type":"exec","z":"b6726fbf.d6c4f","command":"/usr/local/bin/mirobo --ip 192.168.1.36 --token 56464a35707930523162795137613848","addpay":true,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"mirobo cmd","x":970,"y":1800,"wires":[["40486ad5.80f194","443b98b2.168c9","3fef1cfa.278d2c"],[],[]]},{"id":"f41858dc.4ea08","type":"ui_switch","z":"b6726fbf.d6c4f","name":"DND","label":"","group":"2f1b591a.11a0ae","order":2,"width":"1","height":"1","passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":107,"y":1802,"wires":[["72474687.b28ce8","f56c9e88.370428"]]},{"id":"f190bed8.80584","type":"ui_button","z":"b6726fbf.d6c4f","name":"","group":"8e86de68.f6ebc","order":4,"width":"6","height":"1","passthru":false,"label":"Actualiser","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":102,"y":684,"wires":[["672d12ce.a5e45c","452e3088.10bc18"]]},{"id":"72474687.b28ce8","type":"function","z":"b6726fbf.d6c4f","name":"On/Off","func":"if (msg.payload === true) {\n    msg.payload=\"on\";\n    } \nelse {\n    msg.payload=\"dnd off\";\n    }\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":113,"y":1925,"wires":[["c20da56c.017128"]]},{"id":"f56c9e88.370428","type":"function","z":"b6726fbf.d6c4f","name":"DND status","func":"msg.payload=\"dnd\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":1800,"wires":[["5c36eb34.2f402c"]]},{"id":"4a3a770a.ec45e","type":"ui_dropdown","z":"b6726fbf.d6c4f","name":"DND début","label":"","place":"DND début","group":"2f1b591a.11a0ae","order":3,"width":"3","height":"1","passthru":true,"options":[{"label":"0 H","value":0,"type":"num"},{"label":"1 H","value":1,"type":"num"},{"label":"2 H","value":2,"type":"num"},{"label":"3 H","value":3,"type":"num"},{"label":"4 H","value":4,"type":"num"},{"label":"5 H","value":5,"type":"num"},{"label":"6 H","value":6,"type":"num"},{"label":"7 H","value":7,"type":"num"},{"label":"8 H","value":8,"type":"num"},{"label":"9 H","value":9,"type":"num"},{"label":"10 H","value":10,"type":"num"},{"label":"11 H","value":11,"type":"num"},{"label":"12 H","value":12,"type":"num"},{"label":"13 H","value":13,"type":"num"},{"label":"14 H","value":14,"type":"num"},{"label":"15 H","value":15,"type":"num"},{"label":"16 H","value":16,"type":"num"},{"label":"17 H","value":17,"type":"num"},{"label":"18 H","value":18,"type":"num"},{"label":"19 H","value":19,"type":"num"},{"label":"20 H","value":"20","type":"str"},{"label":"21 H","value":21,"type":"num"},{"label":"22 H","value":22,"type":"num"},{"label":"23 H","value":23,"type":"num"}],"payload":"","topic":"","x":296,"y":2010,"wires":[["9fbd0b65.3d76f8"]]},{"id":"9083e093.629fd","type":"ui_dropdown","z":"b6726fbf.d6c4f","name":"DND fin","label":"","place":"DND fin","group":"2f1b591a.11a0ae","order":4,"width":"3","height":"1","passthru":true,"options":[{"label":"0 H","value":0,"type":"num"},{"label":"1 H","value":1,"type":"num"},{"label":"2 H","value":2,"type":"num"},{"label":"3 H","value":3,"type":"num"},{"label":"4 H","value":4,"type":"num"},{"label":"5 H","value":5,"type":"num"},{"label":"6 H","value":6,"type":"num"},{"label":"7 H","value":7,"type":"num"},{"label":"8 H","value":8,"type":"num"},{"label":"9 H","value":9,"type":"num"},{"label":"10 H","value":10,"type":"num"},{"label":"11 H","value":11,"type":"num"},{"label":"12 H","value":12,"type":"num"},{"label":"13 H","value":13,"type":"num"},{"label":"14 H","value":14,"type":"num"},{"label":"15 H","value":15,"type":"num"},{"label":"16 H","value":16,"type":"num"},{"label":"17 H","value":17,"type":"num"},{"label":"18 H","value":18,"type":"num"},{"label":"19 H","value":19,"type":"num"},{"label":"20 H","value":20,"type":"num"},{"label":"21 H","value":21,"type":"num"},{"label":"22 H","value":22,"type":"num"},{"label":"23 H","value":23,"type":"num"}],"payload":"","topic":"","x":750,"y":2009,"wires":[["d9fb5e4c.5c9bb8"]]},{"id":"c20da56c.017128","type":"switch","z":"b6726fbf.d6c4f","name":"switch DND","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"off","vt":"str"},{"t":"cont","v":"on","vt":"str"}],"checkall":"true","outputs":2,"x":280,"y":1925,"wires":[["5c36eb34.2f402c"],["7a57c893.3aa5f8"]]},{"id":"7a57c893.3aa5f8","type":"change","z":"b6726fbf.d6c4f","name":"Change 21H","rules":[{"t":"set","p":"payload","pt":"msg","to":"21","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":132,"y":2010,"wires":[["4a3a770a.ec45e"]]},{"id":"fbbd3a0b.e893c8","type":"change","z":"b6726fbf.d6c4f","name":"Change 9H","rules":[{"t":"set","p":"payload","pt":"msg","to":"9","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":2010,"wires":[["9083e093.629fd"]]},{"id":"379224c3.846bc4","type":"comment","z":"b6726fbf.d6c4f","name":"DND Off","info":"","x":348,"y":1885,"wires":[]},{"id":"41f5ab05.c3f6cc","type":"comment","z":"b6726fbf.d6c4f","name":"DND On","info":"","x":351,"y":1958,"wires":[]},{"id":"9fbd0b65.3d76f8","type":"function","z":"b6726fbf.d6c4f","name":"dndmsg","func":"//msg =  { payload:\"dnd on \" + msg.payload + \" 0\"};\nmsg.payload = \"dnd on \" + msg.payload + \" 0\";\ncontext.global.dndmsg = msg.payload;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":451,"y":2010,"wires":[["fbbd3a0b.e893c8"]]},{"id":"d9fb5e4c.5c9bb8","type":"function","z":"b6726fbf.d6c4f","name":"dndmsg","func":"msg.payload =  context.global.dndmsg + \" \" + msg.payload + \" 0\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":900,"y":2009,"wires":[["5c36eb34.2f402c","13ed8c9f.fbe1db"]]},{"id":"13ed8c9f.fbe1db","type":"delay","z":"b6726fbf.d6c4f","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1067,"y":2007,"wires":[["f56c9e88.370428"]]},{"id":"1129e21e.c6fb0e","type":"string","z":"b6726fbf.d6c4f","name":"Total clean count","methods":[{"name":"between","params":[{"type":"str","value":"Total clean count:"},{"type":"str","value":"\\n"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":422,"y":368,"wires":[["53cc0764.90d5a8"]]},{"id":"ce49e473.9d304","type":"string","z":"b6726fbf.d6c4f","name":"area m²","methods":[{"name":"between","params":[{"type":"str","value":"area:"},{"type":"str","value":"\\n"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":402,"y":312,"wires":[["cac4c046.7f4c6"]]},{"id":"cac4c046.7f4c6","type":"function","z":"b6726fbf.d6c4f","name":"Format m²","func":"surface= parseInt(msg.payload);\nmsg.payload = surface + \" m²\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":571,"y":313,"wires":[["be144d5f.94b1a8"]]},{"id":"657cbfea.772af","type":"string","z":"b6726fbf.d6c4f","name":"Total time","methods":[{"name":"between","params":[{"type":"str","value":"Cleaned for:"},{"type":"str","value":" (area:"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":404,"y":110,"wires":[["fbda1e52.bd5"]]},{"id":"b7b4b416.670928","type":"function","z":"b6726fbf.d6c4f","name":"Format days","func":"totaltime= (parseInt(msg.payload)*24*60);\nmsg.d1=totaltime;\n    node.status({text:msg.d1});\nreturn msg;","outputs":1,"noerr":0,"x":911,"y":110,"wires":[["9bcc56c5.009b3"]]},{"id":"5cbf9bf2.68ce24","type":"string","z":"b6726fbf.d6c4f","name":"Total day","methods":[{"name":"trimLeft","params":[]},{"name":"between","params":[{"type":"str","value":""},{"type":"str","value":" days"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":757,"y":110,"wires":[["b7b4b416.670928"]]},{"id":"9bcc56c5.009b3","type":"string","z":"b6726fbf.d6c4f","name":"Total h","methods":[{"name":"trimLeft","params":[]},{"name":"between","params":[{"type":"str","value":"days, "},{"type":"str","value":":"}]}],"prop":"cleaninghistory","propout":"payload","object":"global","objectout":"msg","x":746,"y":169,"wires":[["c947ea93.db60f8"]]},{"id":"8d0b70c.77c641","type":"string","z":"b6726fbf.d6c4f","name":"Total m","methods":[{"name":"trimRight","params":[]},{"name":"between","params":[{"type":"str","value":":"},{"type":"str","value":":"}]}],"prop":"cleaninghistory","propout":"payload","object":"global","objectout":"msg","x":753,"y":238,"wires":[["c73574e0.f87e88"]]},{"id":"c947ea93.db60f8","type":"function","z":"b6726fbf.d6c4f","name":"Format h","func":"totalh= (parseInt(msg.payload)*60);\nmsg.h1=totalh;\n    node.status({text:msg.h1});\nreturn msg;","outputs":1,"noerr":0,"x":901,"y":170,"wires":[["8d0b70c.77c641"]]},{"id":"c73574e0.f87e88","type":"function","z":"b6726fbf.d6c4f","name":"Format m","func":"totalm= parseInt(msg.payload);\nmsg.m1=totalm;\n    node.status({text:msg.m1});\nreturn msg;","outputs":1,"noerr":0,"x":904,"y":238,"wires":[["53220cf2.3ca254"]]},{"id":"53220cf2.3ca254","type":"function","z":"b6726fbf.d6c4f","name":"Format total","func":"msg.payload = parseInt(msg.d1) + parseInt(msg.h1) + parseInt(msg.m1);\nmsg.payload = msg.payload + \" mn\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":1057,"y":238,"wires":[["20499d97.fd1d92"]]},{"id":"fbda1e52.bd5","type":"function","z":"b6726fbf.d6c4f","name":"cleaninghistory","func":"context.global.cleaninghistory = msg.payload;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":581,"y":110,"wires":[["5cbf9bf2.68ce24"]]},{"id":"20499d97.fd1d92","type":"ui_text","z":"b6726fbf.d6c4f","group":"8e86de68.f6ebc","order":1,"width":0,"height":0,"name":"","label":"Temps total de nettoyage","format":"{{msg.payload}}","layout":"row-spread","x":1263,"y":238,"wires":[]},{"id":"be144d5f.94b1a8","type":"ui_text","z":"b6726fbf.d6c4f","group":"8e86de68.f6ebc","order":2,"width":0,"height":0,"name":"","label":"Surface aspirée","format":"{{msg.payload}}","layout":"row-spread","x":751,"y":313,"wires":[]},{"id":"53cc0764.90d5a8","type":"ui_text","z":"b6726fbf.d6c4f","group":"8e86de68.f6ebc","order":3,"width":0,"height":0,"name":"","label":"Nombre de nettoyages","format":"{{msg.payload}}","layout":"row-spread","x":768,"y":368,"wires":[]},{"id":"443b98b2.168c9","type":"ui_text","z":"b6726fbf.d6c4f","group":"2f1b591a.11a0ae","order":1,"width":"3","height":"1","name":"DND-start","label":"Start","format":"","layout":"row-spread","x":1140,"y":1817,"wires":[]},{"id":"3fef1cfa.278d2c","type":"ui_text","z":"b6726fbf.d6c4f","group":"2f1b591a.11a0ae","order":1,"width":"3","height":"1","name":"DND-stop","label":"Stop","format":"","layout":"row-spread","x":1141,"y":1864,"wires":[]},{"id":"2401db07.dadce4","type":"comment","z":"b6726fbf.d6c4f","name":"DND mode","info":"","x":80,"y":1600,"wires":[]},{"id":"617ac1d3.c602d","type":"comment","z":"b6726fbf.d6c4f","name":"Command","info":"","x":82,"y":1156,"wires":[]},{"id":"b7df4cbc.e49168","type":"comment","z":"b6726fbf.d6c4f","name":"Puissance","info":"","x":93,"y":844,"wires":[]},{"id":"6de9a776.559b5","type":"comment","z":"b6726fbf.d6c4f","name":"Status aspiration","info":"","x":85,"y":545,"wires":[]},{"id":"16bb1e60.f45e4a","type":"comment","z":"b6726fbf.d6c4f","name":"Status général","info":"","x":92,"y":31,"wires":[]},{"id":"154dbbc6.da4054","type":"comment","z":"b6726fbf.d6c4f","name":"Divers","info":"","x":77,"y":2130,"wires":[]},{"id":"f1cd2ebc.c05c8","type":"switch","z":"9e51a2fa.b06ff","name":"VMC ON OFF ?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"true","outputs":2,"x":787,"y":2151,"wires":[["be7d2e2d.95cd8","c14434b3.8df3d","8a0bd3ac.263198"],["77ded535.cc6c3c","c14434b3.8df3d","8a0bd3ac.263198"]]},{"id":"be7d2e2d.95cd8","type":"change","z":"9e51a2fa.b06ff","name":"URL VMC icon on","rules":[{"t":"set","p":"payload","pt":"msg","to":"http://domobox/icones/vmc_on3.png","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":984,"y":2127,"wires":[["577c0531.abd3c4"]]},{"id":"77ded535.cc6c3c","type":"change","z":"9e51a2fa.b06ff","name":"URL VMC icon off","rules":[{"t":"set","p":"payload","pt":"msg","to":"http://domobox/icones/vmc_off3.png","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":982,"y":2173,"wires":[["577c0531.abd3c4"]]},{"id":"b35cc9ac.fee5e","type":"ui_template","z":"77ef16e7.a27228","group":"8aa34793.811b08","name":"TPL Etat VMC on","order":3,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Etat VMC\"}}\n\n</span>\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"{{{msg.payload}}}\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":980,"y":632,"wires":[[]]},{"id":"577c0531.abd3c4","type":"ui_template","z":"9e51a2fa.b06ff","group":"8aa34793.811b08","name":"TPL-VMC-On-Off","order":5,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n<span style=\"width:90%;padding-top:5px;padding-left:1px;\">{{\"Etat VMC\"}}\n\n</span>\n<span style=\"width:10%; padding-right:2px;\">\n    <img class=\"lightup\" src=\"{{msg.payload}}\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":1187,"y":2144,"wires":[[]]},{"id":"be3b69bb.81f5c","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCMarcheForcee","func":"context.global.VMCMarcheForcee = msg.payload;\nmsg.payload = context.global.VMCMarcheForcee;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":411,"y":846,"wires":[["db929189.5b9328"]]},{"id":"4ede819c.ee898","type":"comment","z":"9e51a2fa.b06ff","name":"VMC - init valeurs globales","info":"","x":115,"y":30,"wires":[]},{"id":"6edf6c74.4f2c64","type":"comment","z":"b5752a43.1c1f2","name":"open","info":"","x":582,"y":4289,"wires":[]},{"id":"3050a73a.e8fe78","type":"delay","z":"b5752a43.1c1f2","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":543,"y":4326,"wires":[["1359a40f.09d21c"]]},{"id":"68681c3.65774e4","type":"comment","z":"b5752a43.1c1f2","name":"open","info":"","x":598,"y":3933,"wires":[]},{"id":"33f18561.0c749a","type":"delay","z":"b5752a43.1c1f2","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":559,"y":3970,"wires":[["cb7fe3f2.a3626"]]},{"id":"1422cbe1.81b364","type":"delay","z":"b5752a43.1c1f2","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":545,"y":4147,"wires":[["684fd75e.9be1d"]]},{"id":"519a0dad.e6075c","type":"comment","z":"b5752a43.1c1f2","name":"open","info":"","x":584,"y":4110,"wires":[]},{"id":"ea5dec0c.20ead8","type":"mqtt out","z":"ee283ca8.bf07d","name":"","topic":"cmnd/sonoff-Salon/Ledpower","qos":"0","retain":"","broker":"9c9224ce.733908","x":387,"y":1213,"wires":[]},{"id":"f1b67757.880fc","type":"inject","z":"ee283ca8.bf07d","name":"","topic":"","payload":"off","payloadType":"str","repeat":"","crontab":"","once":false,"x":127,"y":1213,"wires":[["ea5dec0c.20ead8"]]},{"id":"fe23f94f.599478","type":"inject","z":"ee283ca8.bf07d","name":"","topic":"","payload":"on","payloadType":"str","repeat":"","crontab":"","once":false,"x":127,"y":1253,"wires":[["ea5dec0c.20ead8"]]},{"id":"5da3e7c0.62af98","type":"comment","z":"ee283ca8.bf07d","name":"MQTT Led control","info":"Controlling the led via MQTT\n\naccepted messages:\n0: off\n1: on","x":107,"y":1173,"wires":[]},{"id":"36cd7a6c.9f821e","type":"inject","z":"ee283ca8.bf07d","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":139,"y":606,"wires":[["392b43e1.8af44c"]]},{"id":"392b43e1.8af44c","type":"http request","z":"ee283ca8.bf07d","name":"Led on","method":"GET","ret":"txt","url":"http://192.168.1.72/cm?cmnd=LedPower on","tls":"","x":336,"y":606,"wires":[["31a4f120.72e8ae"]]},{"id":"3f4a2af4.a28816","type":"http request","z":"ee283ca8.bf07d","name":"Led off","method":"GET","ret":"txt","url":"http://192.168.1.72/cm?cmnd=LedPower off","tls":"","x":336,"y":661,"wires":[["31a4f120.72e8ae"]]},{"id":"75343f97.44fae","type":"inject","z":"ee283ca8.bf07d","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":139,"y":661,"wires":[["3f4a2af4.a28816"]]},{"id":"c14434b3.8df3d","type":"mqtt out","z":"9e51a2fa.b06ff","name":"","topic":"cmnd/sonoff-vmc/Ledpower","qos":"0","retain":"","broker":"9c9224ce.733908","x":1008,"y":2220,"wires":[]},{"id":"8a0bd3ac.263198","type":"mqtt out","z":"9e51a2fa.b06ff","name":"","topic":"VMC/state","qos":"0","retain":"","broker":"9c9224ce.733908","x":966,"y":2284,"wires":[]},{"id":"5e20f6cb.5d486","type":"mqtt out","z":"9e51a2fa.b06ff","name":"","topic":"VMC/infos","qos":"0","retain":"","broker":"9c9224ce.733908","x":1169,"y":2057,"wires":[]},{"id":"bdbd2ec9.1965d","type":"debug","z":"b5752a43.1c1f2","name":"","active":false,"console":"false","complete":"false","x":691,"y":3665,"wires":[]},{"id":"fc80a82c.8cb128","type":"function","z":"659a812a.2160a","name":"Status leak","func":"msg.payload = msg.payload.data.status;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":2520,"wires":[["9428f8b2.d0ad9","70e33070.a2bb68"]]},{"id":"9f620490.b17bc8","type":"switch","z":"659a812a.2160a","name":"water-leak-sensor ?","property":"payload.model","propertyType":"msg","rules":[{"t":"eq","v":"sensor_wleak.aq1","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":157,"y":2640,"wires":[["ceb9c33b.98ce","c4b61579.981d28"]]},{"id":"ceb9c33b.98ce","type":"switch","z":"659a812a.2160a","name":"What sensor ?","property":"payload.sid","propertyType":"msg","rules":[{"t":"eq","v":"158d0002138a3c","vt":"str"},{"t":"eq","v":"158d00021304a9","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":377,"y":2640,"wires":[["fc80a82c.8cb128"],["37e50591.022472"]]},{"id":"6399a39.962e4dc","type":"comment","z":"659a812a.2160a","name":"Salle de bain","info":"","x":377,"y":2584,"wires":[]},{"id":"9428f8b2.d0ad9","type":"mqtt out","z":"659a812a.2160a","name":"Salledebain/XIAOMI/inondation","topic":"Salledebain/XIAOMI/inondation","qos":"","retain":"true","broker":"9c9224ce.733908","x":784,"y":2420,"wires":[]},{"id":"7119e9c2.aacb58","type":"comment","z":"659a812a.2160a","name":"Cuisine","info":"","x":384,"y":2701,"wires":[]},{"id":"c4b61579.981d28","type":"debug","z":"659a812a.2160a","name":"","active":true,"console":"false","complete":"true","x":199,"y":2700,"wires":[]},{"id":"f209a821.167268","type":"pushbullet","z":"659a812a.2160a","config":"ee1296bd.5dc6e","pushtype":"","title":"Alerte inondation salle de bain","chan":"","name":"DuckDNS inondation SDB","x":764,"y":2480,"wires":[]},{"id":"70e33070.a2bb68","type":"switch","z":"659a812a.2160a","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"leak","vt":"str"},{"t":"eq","v":"no_leak","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":564,"y":2519,"wires":[["f209a821.167268"],["5152d8bd.a8b83"]]},{"id":"5152d8bd.a8b83","type":"pushbullet","z":"659a812a.2160a","config":"ee1296bd.5dc6e","pushtype":"","title":"Fin d'alerte inondation salle de bain","chan":"","name":"DuckDNS fin inondation SDB","x":774,"y":2540,"wires":[]},{"id":"803a890.8840bf8","type":"comment","z":"659a812a.2160a","name":"Capteurs inondation présence eau : notification Duckdns + clignotement rouge GW","info":"","x":321,"y":2400,"wires":[]},{"id":"956af998.1886e8","type":"switch","z":"97223981.e54958","name":"not empty ?","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":151,"y":227,"wires":[["35fd6eec.c12ed2"]]},{"id":"37e50591.022472","type":"function","z":"659a812a.2160a","name":"Status leak","func":"msg.payload = msg.payload.data.status;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":2760,"wires":[["54634558.4aa94c","1e7a3b85.e87dec"]]},{"id":"54634558.4aa94c","type":"mqtt out","z":"659a812a.2160a","name":"Cuisine/XIAOMI/inondation","topic":"Cuisine/XIAOMI/inondation","qos":"","retain":"true","broker":"9c9224ce.733908","x":777,"y":2660,"wires":[]},{"id":"539652d6.2dc5a4","type":"pushbullet","z":"659a812a.2160a","config":"ee1296bd.5dc6e","pushtype":"","title":"Alerte inondation cuisine","chan":"","name":"DuckDNS inondation cuisine","x":777,"y":2720,"wires":[]},{"id":"1e7a3b85.e87dec","type":"switch","z":"659a812a.2160a","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"leak","vt":"str"},{"t":"eq","v":"no_leak","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":567,"y":2759,"wires":[["539652d6.2dc5a4"],["366e83b9.d74f4c"]]},{"id":"366e83b9.d74f4c","type":"pushbullet","z":"659a812a.2160a","config":"ee1296bd.5dc6e","pushtype":"","title":"Fin d'alerte inondation cuisine","chan":"","name":"DuckDNS fin inondation cuisine","x":787,"y":2780,"wires":[]},{"id":"de55b4be.3a5478","type":"function","z":"659a812a.2160a","name":"Etat","func":"msg.payload = msg.payload.data.status;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":335,"y":860,"wires":[["4621a442.a66f04"]]},{"id":"4621a442.a66f04","type":"switch","z":"659a812a.2160a","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"open","vt":"str"},{"t":"eq","v":"close","vt":"str"}],"checkall":"true","outputs":2,"x":450,"y":860,"wires":[["11736880.f20c77"],["ba7a0902.a11138"]]},{"id":"94c1af60.ba599","type":"switch","z":"659a812a.2160a","name":"switch batteryLevel","property":"payload.data.batteryLevel","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","outputs":1,"x":388,"y":921,"wires":[["565c4288.1b28a4"]]},{"id":"7046ce4f.afac2","type":"function","z":"659a812a.2160a","name":"Etat","func":"msg.payload = msg.payload.data.status;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":338,"y":1040,"wires":[["d04db26.21103d"]]},{"id":"d04db26.21103d","type":"switch","z":"659a812a.2160a","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"open","vt":"str"},{"t":"eq","v":"close","vt":"str"}],"checkall":"true","outputs":2,"x":455,"y":1040,"wires":[["e9ca42c1.fd7ce"],["b242aae2.2b60f8"]]},{"id":"567d57ae.02f6c","type":"xiaomi-magnet","z":"659a812a.2160a","gateway":"a67ca531.70e5a8","name":"Garage-petite-porte","sid":"158d00020926ac","x":165,"y":1039,"wires":[["7046ce4f.afac2","df8eaf59.b45018","494648a2.f2bd18"]]},{"id":"df8eaf59.b45018","type":"switch","z":"659a812a.2160a","name":"switch batteryLevel","property":"payload.data.batteryLevel","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","outputs":1,"x":404,"y":1101,"wires":[["737fe8ce.dc58a8"]]},{"id":"737fe8ce.dc58a8","type":"function","z":"659a812a.2160a","name":"Battery","func":"msg.payload = msg.payload.data.voltage\n\nmax_volt = 3300;\nmin_volt = 2600;\nvoltage = msg.payload;\npercent = ((voltage - min_volt) / (max_volt - min_volt)) * 100;\nmsg.payload = percent;\n\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":587,"y":1101,"wires":[["5ef773b4.03367c"]]},{"id":"494648a2.f2bd18","type":"debug","z":"659a812a.2160a","name":"","active":false,"console":"false","complete":"true","x":197,"y":1100,"wires":[]},{"id":"74757682.224ad8","type":"rfx-blinds-out","z":"b5752a43.1c1f2","name":"","port":"154cb229.a4d1fe","topicSource":"msg","topic":"","x":620,"y":580,"wires":[]},{"id":"fd2da12e.9fdb7","type":"rfx-blinds-out","z":"b5752a43.1c1f2","name":"","port":"154cb229.a4d1fe","topicSource":"msg","topic":"","x":620,"y":76,"wires":[]},{"id":"47d3e642.f5f18","type":"rfx-blinds-out","z":"b5752a43.1c1f2","name":"","port":"154cb229.a4d1fe","topicSource":"msg","topic":"","x":618,"y":172,"wires":[]},{"id":"23d11f92.db9178","type":"rfx-blinds-out","z":"b5752a43.1c1f2","name":"","port":"154cb229.a4d1fe","topicSource":"msg","topic":"","x":617,"y":269,"wires":[]},{"id":"7167c1b9.5d6a5","type":"rfx-blinds-out","z":"b5752a43.1c1f2","name":"","port":"154cb229.a4d1fe","topicSource":"msg","topic":"","x":620,"y":380,"wires":[]},{"id":"845f99e7.2a2f98","type":"rfx-blinds-out","z":"b5752a43.1c1f2","name":"","port":"154cb229.a4d1fe","topicSource":"msg","topic":"","x":620,"y":480,"wires":[]},{"id":"ef224b54.fec0e8","type":"rfx-blinds-out","z":"b5752a43.1c1f2","name":"","port":"154cb229.a4d1fe","topicSource":"msg","topic":"","x":620,"y":740,"wires":[]},{"id":"574198c6.219d48","type":"rfx-blinds-out","z":"b5752a43.1c1f2","name":"","port":"154cb229.a4d1fe","topicSource":"msg","topic":"","x":623,"y":834,"wires":[]},{"id":"10bd8ce6.664cdb","type":"rfx-blinds-out","z":"b5752a43.1c1f2","name":"","port":"154cb229.a4d1fe","topicSource":"msg","topic":"","x":620,"y":927,"wires":[]},{"id":"99a94eb9.00b8b","type":"rfx-blinds-out","z":"b5752a43.1c1f2","name":"","port":"154cb229.a4d1fe","topicSource":"msg","topic":"","x":620,"y":1020,"wires":[]},{"id":"5907d765.8159a8","type":"rfx-blinds-out","z":"b5752a43.1c1f2","name":"","port":"154cb229.a4d1fe","topicSource":"msg","topic":"","x":620,"y":1120,"wires":[]},{"id":"25f1a917.61df26","type":"rfx-blinds-out","z":"b5752a43.1c1f2","name":"","port":"154cb229.a4d1fe","topicSource":"msg","topic":"","x":620,"y":1210,"wires":[]},{"id":"11e182a9.f2bb2d","type":"rfx-blinds-out","z":"b5752a43.1c1f2","name":"","port":"154cb229.a4d1fe","topicSource":"msg","topic":"","x":620,"y":1300,"wires":[]},{"id":"415221c7.7378e","type":"rfx-blinds-out","z":"b5752a43.1c1f2","name":"","port":"154cb229.a4d1fe","topicSource":"msg","topic":"","x":620,"y":1400,"wires":[]},{"id":"dc3b543d.47fa5","type":"rfx-blinds-out","z":"b5752a43.1c1f2","name":"","port":"154cb229.a4d1fe","topicSource":"msg","topic":"","x":620,"y":1495,"wires":[]},{"id":"7f62dc87.c4f954","type":"rfx-blinds-out","z":"b5752a43.1c1f2","name":"","port":"154cb229.a4d1fe","topicSource":"msg","topic":"","x":620,"y":1583,"wires":[]},{"id":"84fee53a.d9a86","type":"switch","z":"659a812a.2160a","name":"smoke-sensor ?","property":"payload.model","propertyType":"msg","rules":[{"t":"cont","v":"smoke","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":120,"y":3191,"wires":[["c9f47bec.6b411","9fcffa63.14ba88"]]},{"id":"c9f47bec.6b411","type":"debug","z":"659a812a.2160a","name":"","active":true,"console":"false","complete":"true","x":153,"y":3252,"wires":[]},{"id":"9857dedc.5bc3b8","type":"comment","z":"659a812a.2160a","name":"Couloir","info":"","x":362,"y":3105,"wires":[]},{"id":"dcc818e5.3312b","type":"comment","z":"659a812a.2160a","name":"Palier","info":"","x":367,"y":3280,"wires":[]},{"id":"9fcffa63.14ba88","type":"switch","z":"659a812a.2160a","name":"What sensor ?","property":"payload.sid","propertyType":"msg","rules":[{"t":"eq","v":"158d0001e58eaa","vt":"str"},{"t":"eq","v":"158d00023116be","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":320,"y":3191,"wires":[["35bd6625.bb37ca","782ad3dd.2ff67c"],["81529b7c.d1393","31daee57.18627a"]]},{"id":"13a76362.8793e5","type":"function","z":"659a812a.2160a","name":"Status alarm","func":"msg.payload = msg.payload.data.alarm;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":399,"y":2958,"wires":[["20ce4d21.3d4a32","81b9690b.6a9b48"]]},{"id":"a4eb847d.15015","type":"function","z":"659a812a.2160a","name":"Status alarm","func":"msg.payload = msg.payload.data.alarm;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":3400,"wires":[["106e5e45.2e8602","17510ac8.f35725"]]},{"id":"20ce4d21.3d4a32","type":"switch","z":"659a812a.2160a","name":"swich : 1 = fumée","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":502,"y":2898,"wires":[[],["bb6adaab.cdabc8"]]},{"id":"bb6adaab.cdabc8","type":"pushbullet","z":"659a812a.2160a","config":"ee1296bd.5dc6e","pushtype":"","title":"Alerte fumée couloir","chan":"","name":"PushBullet fumée couloir","x":735,"y":2905,"wires":[]},{"id":"106e5e45.2e8602","type":"switch","z":"659a812a.2160a","name":"swich : 1 = fumée","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":480,"y":3340,"wires":[[],["fc9c6aac.7e5468"]]},{"id":"fc9c6aac.7e5468","type":"pushbullet","z":"659a812a.2160a","config":"ee1296bd.5dc6e","pushtype":"","title":"Alerte fumée palier","chan":"","name":"PushBullet fumée palier","x":721,"y":3346,"wires":[]},{"id":"10114767.d144b9","type":"function","z":"659a812a.2160a","name":"Battery","func":"msg.payload = msg.payload.data.batteryLevel\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":366,"y":3460,"wires":[["747ebf28.f16328","760d0da4.58946c"]]},{"id":"be179342.1f8de","type":"function","z":"659a812a.2160a","name":"Battery","func":"msg.payload = msg.payload.data.batteryLevel\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":389,"y":3018,"wires":[["23ba0cff.1c8cec","fe0abd66.943818"]]},{"id":"81b9690b.6a9b48","type":"mqtt out","z":"659a812a.2160a","name":"Couloir/XIAOMI/smoke","topic":"Couloir/XIAOMI/smoke","qos":"","retain":"true","broker":"9c9224ce.733908","x":596,"y":2958,"wires":[]},{"id":"23ba0cff.1c8cec","type":"mqtt out","z":"659a812a.2160a","name":"Couloir/XIAOMI/Smoke/Battery","topic":"Couloir/XIAOMI/Smoke/Battery","qos":"","retain":"true","broker":"9c9224ce.733908","x":622,"y":3018,"wires":[]},{"id":"17510ac8.f35725","type":"mqtt out","z":"659a812a.2160a","name":"Palier/XIAOMI/smoke","topic":"Palier/XIAOMI/smoke","qos":"","retain":"true","broker":"9c9224ce.733908","x":574,"y":3400,"wires":[]},{"id":"747ebf28.f16328","type":"mqtt out","z":"659a812a.2160a","name":"Palier/XIAOMI/Smoke/Battery","topic":"Palier/XIAOMI/Smoke/Battery","qos":"","retain":"true","broker":"9c9224ce.733908","x":590,"y":3460,"wires":[]},{"id":"187d536.6c06cad","type":"switch","z":"659a812a.2160a","name":"Batterie > 20","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"20","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":770,"y":3078,"wires":[[],["6f1944c1.177914"]]},{"id":"fb5738d5.515898","type":"comment","z":"659a812a.2160a","name":"Non","info":"","x":862,"y":3119,"wires":[]},{"id":"6f1944c1.177914","type":"delay","z":"659a812a.2160a","name":"One notification/day","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":963,"y":3084,"wires":[["13185f4f.e91621"]]},{"id":"13185f4f.e91621","type":"pushbullet","z":"659a812a.2160a","config":"ee1296bd.5dc6e","pushtype":"","title":"Détecteur fumée couloir Batterie faible","chan":"","name":"Détecteur fumée couloir Batterie faible","x":1239,"y":3084,"wires":[]},{"id":"7842e9a.b208718","type":"comment","z":"659a812a.2160a","name":"Notif batterie faible","info":"","x":1224,"y":3118,"wires":[]},{"id":"4e26e825.fac648","type":"switch","z":"659a812a.2160a","name":"Batterie > 20","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"20","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":740,"y":3520,"wires":[[],["46903cc7.419734"]]},{"id":"77d3574c.ff4ea8","type":"comment","z":"659a812a.2160a","name":"Non","info":"","x":829,"y":3561,"wires":[]},{"id":"46903cc7.419734","type":"delay","z":"659a812a.2160a","name":"One notification/day","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":935,"y":3526,"wires":[["b8997134.016288"]]},{"id":"b8997134.016288","type":"pushbullet","z":"659a812a.2160a","config":"ee1296bd.5dc6e","pushtype":"","title":"Détecteur fumée palier Batterie faible","chan":"","name":"Détecteur fumée palier Batterie faible","x":1207,"y":3526,"wires":[]},{"id":"cdfcbb6d.c6fc48","type":"comment","z":"659a812a.2160a","name":"Notif batterie faible","info":"","x":1186,"y":3560,"wires":[]},{"id":"fe0abd66.943818","type":"switch","z":"659a812a.2160a","name":"switch batteryLevel","property":"payload.data.batteryLevel","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","outputs":1,"x":590,"y":3078,"wires":[["187d536.6c06cad"]]},{"id":"760d0da4.58946c","type":"switch","z":"659a812a.2160a","name":"switch batteryLevel","property":"payload.data.batteryLevel","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","outputs":1,"x":554,"y":3520,"wires":[["4e26e825.fac648"]]},{"id":"e7565e2b.0b0cf","type":"switch","z":"659a812a.2160a","name":"vibration-sensor ?","property":"payload.model","propertyType":"msg","rules":[{"t":"cont","v":"vibration","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":130,"y":3760,"wires":[["a0f0e679.6de638","34886d5b.1277d2","d54ad2a0.ab9ad","48388849.1728a","f0367302.951a4"]]},{"id":"a0f0e679.6de638","type":"debug","z":"659a812a.2160a","name":"","active":false,"console":"false","complete":"true","x":130,"y":3700,"wires":[]},{"id":"dc0fdec3.ec5938","type":"switch","z":"659a812a.2160a","name":"Batterie > 20","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"20","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":682,"y":3869,"wires":[[],["b85ec78e.9aa318"]]},{"id":"fc457b87.062508","type":"comment","z":"659a812a.2160a","name":"Non","info":"","x":781,"y":3910,"wires":[]},{"id":"b85ec78e.9aa318","type":"delay","z":"659a812a.2160a","name":"One notification/day","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":870,"y":3875,"wires":[["7edc3fba.f7ee3"]]},{"id":"7edc3fba.f7ee3","type":"pushbullet","z":"659a812a.2160a","config":"ee1296bd.5dc6e","pushtype":"","title":"Détecteur vibration véranda Batterie faible","chan":"","name":"Détecteur vibration véranda Batterie faible","x":1160,"y":3875,"wires":[]},{"id":"14b064a.dd28e1b","type":"comment","z":"659a812a.2160a","name":"Notif batterie faible","info":"","x":1161,"y":3909,"wires":[]},{"id":"a45c60bf.a457f","type":"function","z":"659a812a.2160a","name":"Battery","func":"msg.payload = msg.payload.data.batteryLevel\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":3869,"wires":[["dc0fdec3.ec5938","c66e62c2.5e8e9"]]},{"id":"b6f4432a.b03498","type":"function","z":"659a812a.2160a","name":"Status","func":"msg.payload = msg.payload.data.status;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":523,"y":3680,"wires":[["95580797.945ba8"]]},{"id":"34886d5b.1277d2","type":"switch","z":"659a812a.2160a","name":"switch status set","property":"payload.data.status","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":340,"y":3680,"wires":[["b6f4432a.b03498","38504e0b.605762"]]},{"id":"d54ad2a0.ab9ad","type":"switch","z":"659a812a.2160a","name":"switch coordination set","property":"payload.data.coordination","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":354,"y":3740,"wires":[["cb3f0785.c70c5"]]},{"id":"cb3f0785.c70c5","type":"function","z":"659a812a.2160a","name":"coordination","func":"msg.payload = msg.payload.data.coordination;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":544,"y":3740,"wires":[[]]},{"id":"48388849.1728a","type":"switch","z":"659a812a.2160a","name":"switch bed_activity set","property":"payload.data.bed_activity","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":355,"y":3800,"wires":[["b75369db.fba48"]]},{"id":"b75369db.fba48","type":"function","z":"659a812a.2160a","name":"bed_activity","func":"msg.payload = msg.payload.data.bed_activity;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":543,"y":3800,"wires":[[]]},{"id":"49fc1709.8f63e","type":"mqtt out","z":"659a812a.2160a","name":"Veranda/XIAOMI/Vibration/Status","topic":"Veranda/XIAOMI/Vibration/Status","qos":"","retain":"true","broker":"9c9224ce.733908","x":1093,"y":3680,"wires":[]},{"id":"818ff855.18cb7","type":"comment","z":"659a812a.2160a","name":"Notif fumée","info":"","x":725,"y":3309,"wires":[]},{"id":"9e42a1b4.7310c8","type":"comment","z":"659a812a.2160a","name":"Notif fumée","info":"","x":749,"y":2869,"wires":[]},{"id":"f0367302.951a4","type":"switch","z":"659a812a.2160a","name":"switch batteryLevel set","property":"payload.data.batteryLevel","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":355,"y":3869,"wires":[["a45c60bf.a457f"]]},{"id":"38504e0b.605762","type":"delay","z":"659a812a.2160a","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":537,"y":3620,"wires":[["c5c22450.ad9"]]},{"id":"c66e62c2.5e8e9","type":"mqtt out","z":"659a812a.2160a","name":"Veranda/XIAOMI/Vibration/Battery","topic":"Veranda/XIAOMI/Vibration/Battery","qos":"","retain":"true","broker":"9c9224ce.733908","x":719,"y":3960,"wires":[]},{"id":"95580797.945ba8","type":"switch","z":"659a812a.2160a","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"vibrate","vt":"str"},{"t":"eq","v":"tilt","vt":"str"},{"t":"eq","v":"free_fall","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":657,"y":3680,"wires":[["3d0707db.8a52a8"],["3129ee06.992492"],["e9230713.14ce18"]]},{"id":"3d0707db.8a52a8","type":"change","z":"659a812a.2160a","name":"change 2 vibrations","rules":[{"t":"set","p":"payload","pt":"msg","to":"vibrations","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":830,"y":3660,"wires":[["49fc1709.8f63e"]]},{"id":"3129ee06.992492","type":"change","z":"659a812a.2160a","name":"change 2 rotation","rules":[{"t":"set","p":"payload","pt":"msg","to":"rotation","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":820,"y":3700,"wires":[["49fc1709.8f63e"]]},{"id":"e9230713.14ce18","type":"change","z":"659a812a.2160a","name":"change 2 chute","rules":[{"t":"set","p":"payload","pt":"msg","to":"chute","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":3740,"wires":[["49fc1709.8f63e"]]},{"id":"c5c22450.ad9","type":"change","z":"659a812a.2160a","name":"change 2 néant","rules":[{"t":"set","p":"payload","pt":"msg","to":"néant","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":810,"y":3620,"wires":[["49fc1709.8f63e"]]},{"id":"491879af.d472c8","type":"mqtt in","z":"b882537d.e69738","name":"Temperature DHT Sous-sol","topic":"Sous-sol/DHT/Temperature","qos":"2","broker":"9c9224ce.733908","x":180,"y":4720,"wires":[["ceeeef70.64be4","844f5a61.741898"]]},{"id":"ceeeef70.64be4","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":31,"width":"","height":"","name":"Température sous-sol","label":"Température sous-sol","format":"{{msg.payload}} °C","layout":"","x":460,"y":4720,"wires":[]},{"id":"6e21c763.544e4","type":"comment","z":"b882537d.e69738","name":"Sous-sol","info":"\n","x":80,"y":4660,"wires":[]},{"id":"e9feb863.cace5","type":"mqtt in","z":"b882537d.e69738","name":"Humidité DHT Sous-sol","topic":"Sous-sol/DHT/Humidity","qos":"2","broker":"9c9224ce.733908","x":160,"y":4820,"wires":[["e5b128d.e7e9258"]]},{"id":"e5b128d.e7e9258","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":32,"width":"","height":"","name":"Humidité sous-sol","label":"Humidité sous-sol","format":"{{msg.payload}} %","layout":"","x":450,"y":4820,"wires":[]},{"id":"f3ff790f.a5785","type":"mqtt in","z":"b882537d.e69738","name":"Temperature DHT Billard","topic":"Billard/DHT/Temperature","qos":"2","broker":"9c9224ce.733908","x":193,"y":4502,"wires":[["aa68e0e7.9b1b48","1fc13295.38e375"]]},{"id":"aa68e0e7.9b1b48","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":28,"width":"","height":"","name":"Température billard","label":"Température billard","format":"{{msg.payload}} °C","layout":"","x":495,"y":4501,"wires":[]},{"id":"3e0c1d5d.a7bbc2","type":"comment","z":"b882537d.e69738","name":"Billard","info":"\n","x":50,"y":4460,"wires":[]},{"id":"a05b51c7.24612","type":"mqtt in","z":"b882537d.e69738","name":"Humidité DHT  Billard","topic":"Billard/DHT/Humidity","qos":"2","broker":"9c9224ce.733908","x":170,"y":4580,"wires":[["756d46d8.7d4d1","159d2a6f.3f6566"]]},{"id":"f63729e9.f32db8","type":"comment","z":"b882537d.e69738","name":"----------------------------------- DHT ----------------------------------------","info":"\n","x":240,"y":4400,"wires":[]},{"id":"756d46d8.7d4d1","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":30,"width":"0","height":"0","name":"--","label":"","format":"","layout":"","x":450,"y":4600,"wires":[]},{"id":"759d1422.c7a934","type":"rfx-sensor","z":"b882537d.e69738","name":"Véranda TH13/0xE102","port":"154cb229.a4d1fe","topicSource":"single","topic":"TH13/0xE102","x":120,"y":414,"wires":[["2d55bf5d.b622c","e25b11ae.1d40b8","3cb0192e.0615d6","ce266650.5ca0c8","45cbcac5.d1fbf4"]]},{"id":"7c18cb3f.18983c","type":"rfx-sensor","z":"b882537d.e69738","name":"Salon TH13/0xB603","port":"154cb229.a4d1fe","topicSource":"single","topic":"TH13/0xB603","x":112,"y":859,"wires":[["c019a2bb.13665","b3eb4f03.d1c7b8","41ab6ec2.d76898","14802652.499e72","440612ec.650fc4"]]},{"id":"d535b008.88df8","type":"rfx-sensor","z":"b882537d.e69738","name":"Extérieur TH13/0x7D01","port":"154cb229.a4d1fe","topicSource":"single","topic":"TH13/0x7D01","x":119,"y":1330,"wires":[["fa60e202.5ef34","190c353c.e3ff83","6ef1bf16.636ce8","7b0b83f.0a513fc","1c15478.e00c7b9"]]},{"id":"fa60e202.5ef34","type":"function","z":"b882537d.e69738","name":"T° Ext","func":"msg.payload = msg.payload.temperature.value\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":305,"y":1254,"wires":[["28f4792c.ad2fc6","b28f186d.92a36"]]},{"id":"28f4792c.ad2fc6","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":1,"width":"0","height":"0","name":"Température extèrieure","label":"Température extèrieure","format":"{{msg.payload}}°C","layout":"","x":569,"y":1253,"wires":[]},{"id":"2d55bf5d.b622c","type":"function","z":"b882537d.e69738","name":"T° véranda","func":"msg.payload = msg.payload.temperature.value\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":327,"y":351,"wires":[["9d844686.bed37","a9387cb4.7527f8"]]},{"id":"9d844686.bed37","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":4,"width":"0","height":"0","name":"Température véranda","label":"Température véranda","format":"{{msg.payload}}°C","layout":"","x":559,"y":383,"wires":[]},{"id":"c019a2bb.13665","type":"function","z":"b882537d.e69738","name":"T° salon","func":"msg.payload = msg.payload.temperature.value\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":311,"y":808,"wires":[["5f0b6e95.cd8148","ba61ea2e.1574d"]]},{"id":"5f0b6e95.cd8148","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":7,"width":"0","height":"0","name":"Température salon","label":"Température salon","format":"{{msg.payload}}°C","layout":"","x":549,"y":830,"wires":[]},{"id":"7ed49012.cc3e68","type":"debug","z":"b882537d.e69738","name":"","active":true,"console":"false","complete":"false","x":649,"y":50,"wires":[]},{"id":"d1ed915e.49b0f","type":"comment","z":"b882537d.e69738","name":"------------------ Debug all TH13 TH9 ------------------ ","info":"Pour trouver l'identifiant des sondes de température","x":209,"y":30,"wires":[]},{"id":"1c9d6506.067f33","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":2,"width":"0","height":"0","name":"Humidité extèrieure","label":"Humidité extèrieure","format":"{{msg.payload}} %","layout":"","x":550,"y":1416,"wires":[]},{"id":"190c353c.e3ff83","type":"function","z":"b882537d.e69738","name":"H Ext","func":"msg.payload = msg.payload.humidity.value\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":295,"y":1409,"wires":[["1c9d6506.067f33","78bc5b9f.19c7b4","1061be7e.9b4f02"]]},{"id":"78bc5b9f.19c7b4","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":3,"width":"0","height":"0","name":"--","label":"","format":"","layout":"","x":510,"y":1452,"wires":[]},{"id":"b3eb4f03.d1c7b8","type":"function","z":"b882537d.e69738","name":"H salon","func":"msg.payload = msg.payload.humidity.value\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":313,"y":926,"wires":[["e6ba8ffc.82d06","cc2ab737.e0f528","550b902f.f56a18"]]},{"id":"e6ba8ffc.82d06","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":8,"width":"0","height":"0","name":"Humidité salon","label":"Humidité salon","format":"{{msg.payload}} %","layout":"","x":539,"y":930,"wires":[]},{"id":"b5b9f294.16363","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":5,"width":"0","height":"0","name":"Humidité véranda","label":"Humidité véranda","format":"{{msg.payload}} %","layout":"","x":544,"y":491,"wires":[]},{"id":"cc2ab737.e0f528","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":9,"width":"0","height":"0","name":"--","label":"","format":"","layout":"","x":511,"y":972,"wires":[]},{"id":"4195819b.adede8","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":6,"width":"0","height":"0","name":"--","label":"","format":"","layout":"","x":507,"y":533,"wires":[]},{"id":"e25b11ae.1d40b8","type":"function","z":"b882537d.e69738","name":"H véranda","func":"msg.payload = msg.payload.humidity.value\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":327,"y":488,"wires":[["b5b9f294.16363","4195819b.adede8","82e585d3.c40c3"]]},{"id":"da8f519f.837bf","type":"function","z":"b882537d.e69738","name":"Global var MyTemperatureExt","func":"//context.global.MyTemperatureExt=msg.payload;\ncontext.global.MyTemperatureExt=Math.trunc(msg.payload);\nmsg.payload = context.global.MyTemperatureExt;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":849,"y":1254,"wires":[[]]},{"id":"4b639897.e6fe48","type":"mqtt out","z":"b882537d.e69738","name":"Veranda/RFX/Temperature","topic":"Veranda/RFX/Temperature","qos":"2","retain":"","broker":"9c9224ce.733908","x":800,"y":340,"wires":[]},{"id":"21484f89.be18c8","type":"mqtt out","z":"b882537d.e69738","name":"Veranda/RFX/Humidity","topic":"Veranda/RFX/Humidity","qos":"2","retain":"","broker":"9c9224ce.733908","x":777,"y":443,"wires":[]},{"id":"87636074.4b8e2","type":"mqtt out","z":"b882537d.e69738","name":"Exterieur/RFX/Temperature","topic":"Exterieur/RFX/Temperature","qos":"2","retain":"","broker":"9c9224ce.733908","x":828,"y":1202,"wires":[]},{"id":"b1026479.6ae11","type":"mqtt out","z":"b882537d.e69738","name":"Exterieur/RFX/Humidity","topic":"Exterieur/RFX/Humidity","qos":"2","retain":"","broker":"9c9224ce.733908","x":790,"y":1367,"wires":[]},{"id":"6563f5e6.74d1a4","type":"mqtt out","z":"b882537d.e69738","name":"Salon/RFX/Temperature","topic":"Salon/RFX/Temperature","qos":"2","retain":"","broker":"9c9224ce.733908","x":787,"y":782,"wires":[]},{"id":"76f96112.f7b618","type":"mqtt out","z":"b882537d.e69738","name":"Salon/RFX/Humidity","topic":"Salon/RFX/Humidity","qos":"2","retain":"","broker":"9c9224ce.733908","x":775,"y":885,"wires":[]},{"id":"1500d45.687c1ac","type":"comment","z":"b882537d.e69738","name":"Motion","info":"Caméra configurée pour faire du ftp\nvers Jeedom /home/poirier/motion\n\nSoft mqtt-camera-ftpd envoi message MQTT \nNotifying MQTT camera/poirier/motion with active\nNotifying MQTT camera/poirier/image with image\n","x":69,"y":1686,"wires":[]},{"id":"219cca8.5079936","type":"debug","z":"b882537d.e69738","name":"","active":true,"console":"false","complete":"false","x":618,"y":1722,"wires":[]},{"id":"5da38f11.546708","type":"mqtt in","z":"b882537d.e69738","name":"camera/veranda/motion","topic":"camera/veranda/motion","qos":"2","broker":"9c9224ce.733908","x":131,"y":1723,"wires":[["7e97e6a1.1bc1d8"]]},{"id":"f130764b.c9375","type":"mqtt in","z":"b882537d.e69738","name":"camera/veranda/image","topic":"camera/veranda/image","qos":"2","broker":"9c9224ce.733908","x":120,"y":1865,"wires":[["725c5e41.f33988"]]},{"id":"2c000d99.8511b2","type":"debug","z":"b882537d.e69738","name":"","active":true,"console":"false","complete":"true","x":779,"y":1830,"wires":[]},{"id":"725c5e41.f33988","type":"switch","z":"b882537d.e69738","name":"motionState","property":"motionState","propertyType":"global","rules":[{"t":"eq","v":"active","vt":"str"},{"t":"eq","v":"inactive","vt":"str"}],"checkall":"true","outputs":2,"x":342,"y":1866,"wires":[["e9babe7b.371d88"],[]]},{"id":"1316e100.90a58f","type":"debug","z":"b882537d.e69738","name":"","active":true,"console":"false","complete":"true","x":765,"y":1954,"wires":[]},{"id":"7e97e6a1.1bc1d8","type":"function","z":"b882537d.e69738","name":"Global var motionState","func":"context.global.motionState=msg.payload;\nmsg.payload = context.global.motionState;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":1723,"wires":[["219cca8.5079936"]]},{"id":"e9babe7b.371d88","type":"function","z":"b882537d.e69738","name":"Global var motionImage","func":"context.global.motionImageOld=context.global.motionImage;\ncontext.global.motionImage=msg.payload;\nmsg.payload = context.global.motionImageOld;\ncontext.global.motionState=\"inactive\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":564,"y":1831,"wires":[["2c000d99.8511b2"]]},{"id":"3cffe0d7.fb562","type":"function","z":"b882537d.e69738","name":"motionImage","func":"msg.payload = context.global.motionImageOld;\ncontext.global.motionState=\"active\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":519,"y":1898,"wires":[["1316e100.90a58f"]]},{"id":"8d8001df.df8d9","type":"mqtt out","z":"b882537d.e69738","name":"camera/veranda/image","topic":"camera/veranda/image","qos":"","retain":"","broker":"9c9224ce.733908","x":829,"y":1896,"wires":[]},{"id":"b7392395.f875b8","type":"rfx-sensor","z":"b882537d.e69738","name":"TH13/TH9/Any","port":"154cb229.a4d1fe","topicSource":"all","topic":"TH13/0x1E01","x":99,"y":130,"wires":[["3476baf3.1aed1e","2b732679.ffff7a"]]},{"id":"3cb0192e.0615d6","type":"debug","z":"b882537d.e69738","name":"","active":false,"console":"false","complete":"false","x":333,"y":306,"wires":[]},{"id":"41ab6ec2.d76898","type":"debug","z":"b882537d.e69738","name":"","active":false,"console":"false","complete":"false","x":327,"y":761,"wires":[]},{"id":"6ef1bf16.636ce8","type":"debug","z":"b882537d.e69738","name":"","active":false,"console":"false","complete":"false","x":320,"y":1189,"wires":[]},{"id":"ce266650.5ca0c8","type":"function","z":"b882537d.e69738","name":"Date","func":"MaDate = new Date();\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\n//msg.payload = timeString\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":309,"y":579,"wires":[["f5112805.a4e37"]]},{"id":"f5112805.a4e37","type":"mqtt out","z":"b882537d.e69738","name":"Veranda/RFX/lastupdate","topic":"Veranda/RFX/lastupdate","qos":"2","retain":"true","broker":"9c9224ce.733908","x":552,"y":579,"wires":[]},{"id":"de7d8b75.d054f8","type":"comment","z":"b882537d.e69738","name":"Véranda","info":"\n","x":68,"y":377,"wires":[]},{"id":"ee5397ef.66d338","type":"comment","z":"b882537d.e69738","name":"Salon","info":"\n","x":55,"y":821,"wires":[]},{"id":"ab989785.33a418","type":"comment","z":"b882537d.e69738","name":"Extérieur","info":"\n","x":67,"y":1295,"wires":[]},{"id":"14802652.499e72","type":"function","z":"b882537d.e69738","name":"Date","func":"MaDate = new Date();\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\n//msg.payload = timeString\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":299,"y":1019,"wires":[["b4c8a33e.e58e98"]]},{"id":"b4c8a33e.e58e98","type":"mqtt out","z":"b882537d.e69738","name":"Salon/RFX/lastupdate","topic":"Salon/RFX/lastupdate","qos":"2","retain":"true","broker":"9c9224ce.733908","x":549,"y":1020,"wires":[]},{"id":"7b0b83f.0a513fc","type":"function","z":"b882537d.e69738","name":"Date","func":"MaDate = new Date();\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\n//msg.payload = timeString\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":1497,"wires":[["c30d9963.adf0d8"]]},{"id":"c30d9963.adf0d8","type":"mqtt out","z":"b882537d.e69738","name":"Exterieur/RFX/lastupdate","topic":"Exterieur/RFX/lastupdate","qos":"2","retain":"","broker":"9c9224ce.733908","x":565,"y":1496,"wires":[]},{"id":"b7bdcb40.a1926","type":"comment","z":"b882537d.e69738","name":"----------------------------------- RFX Bangood TH13 ----------------------------------------","info":"\n","x":284,"y":235,"wires":[]},{"id":"e6810e31.7fb2e","type":"comment","z":"b882537d.e69738","name":"----------------------------------- RFX F007TH TH9 ----------------------------------------","info":"\n","x":299,"y":2050,"wires":[]},{"id":"cb842534.4fd64","type":"rfx-sensor","z":"b882537d.e69738","name":"Cuisine TH9/0xE001","port":"154cb229.a4d1fe","topicSource":"single","topic":"TH9/0xE001","x":140,"y":2276,"wires":[["3d0421c7.aeee3e","39ef42e.8b20cbe","a7478991.733ad8","b964c826.14542","bf9975fa.aeaf7"]]},{"id":"3d0421c7.aeee3e","type":"function","z":"b882537d.e69738","name":"T° cuisine","func":"msg.payload = msg.payload.temperature.value\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":337,"y":2167,"wires":[["5be99e3b.2f2788","8741e211.9aa788"]]},{"id":"5be99e3b.2f2788","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":10,"width":"0","height":"0","name":"Température cuisine","label":"Température cuisine","format":"{{msg.payload}}°C","layout":"","x":585,"y":2189,"wires":[]},{"id":"39ef42e.8b20cbe","type":"function","z":"b882537d.e69738","name":"H cuisine","func":"msg.payload = msg.payload.humidity.value\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":339,"y":2285,"wires":[["86e4b496.899218","6c39e11f.99b7","13224558.8f3083"]]},{"id":"86e4b496.899218","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":11,"width":"0","height":"0","name":"Humidité cuisine","label":"Humidité cuisine","format":"{{msg.payload}} %","layout":"","x":565,"y":2289,"wires":[]},{"id":"6c39e11f.99b7","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":12,"width":"0","height":"0","name":"--","label":"","format":"","layout":"","x":537,"y":2331,"wires":[]},{"id":"34ca7efa.3d4892","type":"mqtt out","z":"b882537d.e69738","name":"Cuisine/RFX/Temperature","topic":"Cuisine/RFX/Temperature","qos":"2","retain":"","broker":"9c9224ce.733908","x":810,"y":2140,"wires":[]},{"id":"58e31e90.d03a08","type":"mqtt out","z":"b882537d.e69738","name":"Cuisine/RFX/Humidity","topic":"Cuisine/RFX/Humidity","qos":"2","retain":"","broker":"9c9224ce.733908","x":800,"y":2243,"wires":[]},{"id":"a7478991.733ad8","type":"debug","z":"b882537d.e69738","name":"","active":false,"console":"false","complete":"false","x":353,"y":2120,"wires":[]},{"id":"98ecff23.71a7f8","type":"comment","z":"b882537d.e69738","name":"Cuisine","info":"\n","x":100,"y":2216,"wires":[]},{"id":"b964c826.14542","type":"function","z":"b882537d.e69738","name":"Date","func":"MaDate = new Date();\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\n//msg.payload = timeString\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":325,"y":2378,"wires":[["6f575871.940cb"]]},{"id":"6f575871.940cb","type":"mqtt out","z":"b882537d.e69738","name":"Cuisine/RFX/lastupdate","topic":"Cuisine/RFX/lastupdate","qos":"2","retain":"true","broker":"9c9224ce.733908","x":585,"y":2379,"wires":[]},{"id":"84136e1a.89b19","type":"rfx-sensor","z":"b882537d.e69738","name":"Bureau TH9/0x9602","port":"154cb229.a4d1fe","topicSource":"single","topic":"TH9/0x9602","x":129,"y":2690,"wires":[["5077d4c9.809704","7225c7f2.b5abd8","8d303796.305268","786dce90.c0ce8"]]},{"id":"5077d4c9.809704","type":"function","z":"b882537d.e69738","name":"T° bureau","func":"msg.payload = msg.payload.temperature.value\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":338,"y":2639,"wires":[["5cc1d6cd.fe6de","b00dff67.eb3a3"]]},{"id":"5cc1d6cd.fe6de","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":13,"width":"0","height":"0","name":"Température bureau","label":"Température bureau","format":"{{msg.payload}}°C","layout":"","x":576,"y":2661,"wires":[]},{"id":"7225c7f2.b5abd8","type":"function","z":"b882537d.e69738","name":"H bureau","func":"msg.payload = msg.payload.humidity.value\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":2757,"wires":[["90aa6b28.ea0e3","277b2462.373eb4","2a8e09e5.17b036"]]},{"id":"90aa6b28.ea0e3","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":14,"width":"0","height":"0","name":"Humidité bureau","label":"Humidité bureau","format":"{{msg.payload}} %","layout":"","x":556,"y":2761,"wires":[]},{"id":"277b2462.373eb4","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":15,"width":"0","height":"0","name":"--","label":"","format":"","layout":"","x":528,"y":2803,"wires":[]},{"id":"19f9f29.a2da58d","type":"mqtt out","z":"b882537d.e69738","name":"Bureau/RFX/Temperature","topic":"Bureau/RFX/Temperature","qos":"2","retain":"","broker":"9c9224ce.733908","x":808,"y":2611,"wires":[]},{"id":"a9d266df.52bb38","type":"mqtt out","z":"b882537d.e69738","name":"Bureau/RFX/Humidity","topic":"Bureau/RFX/Humidity","qos":"2","retain":"","broker":"9c9224ce.733908","x":794,"y":2720,"wires":[]},{"id":"8d303796.305268","type":"debug","z":"b882537d.e69738","name":"","active":false,"console":"false","complete":"false","x":344,"y":2592,"wires":[]},{"id":"51971f9b.ba1fe8","type":"comment","z":"b882537d.e69738","name":"Bureau","info":"\n","x":72,"y":2652,"wires":[]},{"id":"786dce90.c0ce8","type":"function","z":"b882537d.e69738","name":"Date","func":"MaDate = new Date();\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\n//msg.payload = timeString\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":316,"y":2850,"wires":[["591a5672.3aee3"]]},{"id":"591a5672.3aee3","type":"mqtt out","z":"b882537d.e69738","name":"Bureau/RFX/lastupdate","topic":"Bureau/RFX/lastupdate","qos":"2","retain":"true","broker":"9c9224ce.733908","x":576,"y":2851,"wires":[]},{"id":"8ad51c17.83855","type":"rfx-sensor","z":"b882537d.e69738","name":"Ch Parents TH9/0xC405","port":"154cb229.a4d1fe","topicSource":"single","topic":"TH9/0xC405","x":149,"y":3050,"wires":[["6b6fd65f.d1beb","79c83f25.3783b8","1b36b08c.43d597","187bc103.24849f"]]},{"id":"6b6fd65f.d1beb","type":"function","z":"b882537d.e69738","name":"T° Chambre Parents","func":"msg.payload = msg.payload.temperature.value\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":368,"y":2999,"wires":[["b538fcdc.583598","f05f6ec8.d2aeb8"]]},{"id":"b538fcdc.583598","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":16,"width":"0","height":"0","name":"Température Ch Parents","label":"Température Ch Parents","format":"{{msg.payload}}°C","layout":"","x":621,"y":3021,"wires":[]},{"id":"79c83f25.3783b8","type":"function","z":"b882537d.e69738","name":"H Chambre Parents","func":"msg.payload = msg.payload.humidity.value\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":3117,"wires":[["34dc2453.03cb2c","16dd65f7.adf56a","e9975f64.e47c88"]]},{"id":"34dc2453.03cb2c","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":17,"width":"0","height":"0","name":"Humidité Ch Parents","label":"Humidité Ch Parents","format":"{{msg.payload}} %","layout":"","x":611,"y":3121,"wires":[]},{"id":"16dd65f7.adf56a","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":18,"width":"0","height":"0","name":"--","label":"","format":"","layout":"","x":563,"y":3163,"wires":[]},{"id":"9996ff3.7a71f","type":"mqtt out","z":"b882537d.e69738","name":"ChambreParents/RFX/Temperature","topic":"ChambreParents/RFX/Temperature","qos":"2","retain":"","broker":"9c9224ce.733908","x":900,"y":2980,"wires":[]},{"id":"afcecc8.dc0bbb","type":"mqtt out","z":"b882537d.e69738","name":"ChambreParents/RFX/Humidity","topic":"ChambreParents/RFX/Humidity","qos":"2","retain":"","broker":"9c9224ce.733908","x":890,"y":3080,"wires":[]},{"id":"1b36b08c.43d597","type":"debug","z":"b882537d.e69738","name":"","active":false,"console":"false","complete":"false","x":344,"y":2952,"wires":[]},{"id":"6ed56373.8550fc","type":"comment","z":"b882537d.e69738","name":"Chambre Parents","info":"\n","x":112,"y":3012,"wires":[]},{"id":"187bc103.24849f","type":"function","z":"b882537d.e69738","name":"Date","func":"MaDate = new Date();\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\n//msg.payload = timeString\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":316,"y":3210,"wires":[["c3963a61.3cf47"]]},{"id":"c3963a61.3cf47","type":"mqtt out","z":"b882537d.e69738","name":"ChambreParents/RFX/lastupdate","topic":"ChambreParents/RFX/lastupdate","qos":"2","retain":"true","broker":"9c9224ce.733908","x":641,"y":3211,"wires":[]},{"id":"2dfd9b5b.e1713c","type":"rfx-sensor","z":"b882537d.e69738","name":"Ch Anaïs TH9/0x9704","port":"154cb229.a4d1fe","topicSource":"single","topic":"TH9/0x9704","x":139,"y":3410,"wires":[["b80c797b.1fb6","4b4c8703.cb47f8","e96660a1.aeca4","f5131ba9.e20f6"]]},{"id":"b80c797b.1fb6","type":"function","z":"b882537d.e69738","name":"T° Chambre Anaïs","func":"msg.payload = msg.payload.temperature.value\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":358,"y":3359,"wires":[["3c8445ad.54e4a2","d7260057.642148"]]},{"id":"3c8445ad.54e4a2","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":19,"width":"0","height":"0","name":"Température Ch Anaïs","label":"Température Ch Anaïs","format":"{{msg.payload}}°C","layout":"","x":611,"y":3381,"wires":[]},{"id":"4b4c8703.cb47f8","type":"function","z":"b882537d.e69738","name":"H Chambre Anaïs","func":"msg.payload = msg.payload.humidity.value\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":3477,"wires":[["e42b3fc1.848b8","1a148c73.dd394c","df6066c4.394838"]]},{"id":"e42b3fc1.848b8","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":20,"width":"0","height":"0","name":"Humidité Ch Anaïs","label":"Humidité Ch Anaïs","format":"{{msg.payload}} %","layout":"","x":601,"y":3481,"wires":[]},{"id":"1a148c73.dd394c","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":21,"width":"0","height":"0","name":"--","label":"","format":"","layout":"","x":563,"y":3523,"wires":[]},{"id":"5554e314.f4b0bc","type":"mqtt out","z":"b882537d.e69738","name":"ChambreAnais/RFX/Temperature","topic":"ChambreAnais/RFX/Temperature","qos":"2","retain":"","broker":"9c9224ce.733908","x":911,"y":3340,"wires":[]},{"id":"b26733c4.87098","type":"mqtt out","z":"b882537d.e69738","name":"ChambreAnais/RFX/Humidity","topic":"ChambreAnais/RFX/Humidity","qos":"2","retain":"","broker":"9c9224ce.733908","x":888,"y":3440,"wires":[]},{"id":"e96660a1.aeca4","type":"debug","z":"b882537d.e69738","name":"","active":false,"console":"false","complete":"false","x":344,"y":3312,"wires":[]},{"id":"1042e857.26d038","type":"comment","z":"b882537d.e69738","name":"Chambre Anaïs","info":"\n","x":102,"y":3372,"wires":[]},{"id":"f5131ba9.e20f6","type":"function","z":"b882537d.e69738","name":"Date","func":"MaDate = new Date();\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\n//msg.payload = timeString\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":316,"y":3570,"wires":[["cca1741d.ef316"]]},{"id":"cca1741d.ef316","type":"mqtt out","z":"b882537d.e69738","name":"ChambreAnais/RFX/lastupdate","topic":"ChambreAnais/RFX/lastupdate","qos":"2","retain":"true","broker":"9c9224ce.733908","x":631,"y":3571,"wires":[]},{"id":"e2d3b124.140a","type":"rfx-sensor","z":"b882537d.e69738","name":"Ch Sarah TH9/0x3603","port":"154cb229.a4d1fe","topicSource":"single","topic":"TH9/0x3603","x":119,"y":3770,"wires":[["45f151ac.1ecb78","26324ab2.66d0de","57a0d226.fafb74","2329a0b.8006f6"]]},{"id":"45f151ac.1ecb78","type":"function","z":"b882537d.e69738","name":"T° Chambre Sarah","func":"msg.payload = msg.payload.temperature.value\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":338,"y":3719,"wires":[["55a9bd60.8d145c","e37561aa.60baa8"]]},{"id":"55a9bd60.8d145c","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":22,"width":"0","height":"0","name":"Température Ch Sarah","label":"Température Ch Sarah","format":"{{msg.payload}}°C","layout":"","x":601,"y":3741,"wires":[]},{"id":"26324ab2.66d0de","type":"function","z":"b882537d.e69738","name":"H Chambre Sarah","func":"msg.payload = msg.payload.humidity.value\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":3837,"wires":[["228156a4.c9970a","e4163c6f.70fe78","658c3f30.fbec4"]]},{"id":"228156a4.c9970a","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":23,"width":"0","height":"0","name":"Humidité Ch Sarah","label":"Humidité Ch Sarah","format":"{{msg.payload}} %","layout":"","x":581,"y":3841,"wires":[]},{"id":"e4163c6f.70fe78","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":24,"width":"0","height":"0","name":"--","label":"","format":"","layout":"","x":543,"y":3883,"wires":[]},{"id":"ee052765.e4488","type":"mqtt out","z":"b882537d.e69738","name":"ChambreSarah/RFX/Temperature","topic":"ChambreSarah/RFX/Temperature","qos":"2","retain":"","broker":"9c9224ce.733908","x":900,"y":3699,"wires":[]},{"id":"f19b261d.c4607","type":"mqtt out","z":"b882537d.e69738","name":"ChambreSarah/RFX/Humidity","topic":"ChambreSarah/RFX/Humidity","qos":"2","retain":"","broker":"9c9224ce.733908","x":884,"y":3800,"wires":[]},{"id":"57a0d226.fafb74","type":"debug","z":"b882537d.e69738","name":"","active":false,"console":"false","complete":"false","x":324,"y":3672,"wires":[]},{"id":"499887db.3525b","type":"comment","z":"b882537d.e69738","name":"Chambre Sarah","info":"\n","x":95,"y":3730,"wires":[]},{"id":"2329a0b.8006f6","type":"function","z":"b882537d.e69738","name":"Date","func":"MaDate = new Date();\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\n//msg.payload = timeString\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":296,"y":3930,"wires":[["cc2043c8.2456a"]]},{"id":"cc2043c8.2456a","type":"mqtt out","z":"b882537d.e69738","name":"ChambreSarah/RFX/lastupdate","topic":"ChambreSarah/RFX/lastupdate","qos":"2","retain":"true","broker":"9c9224ce.733908","x":611,"y":3931,"wires":[]},{"id":"b0548fc2.4274f","type":"rfx-sensor","z":"b882537d.e69738","name":"Salle de bain TH9/0x4606","port":"154cb229.a4d1fe","topicSource":"single","topic":"TH9/0x4606","x":129,"y":4150,"wires":[["9fa3ff72.900f2","e92545f4.3ccc8","a0ad435d.2f9188","5c63d87f.2ba308"]]},{"id":"9fa3ff72.900f2","type":"function","z":"b882537d.e69738","name":"T°Salle de bain","func":"msg.payload = msg.payload.temperature.value\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":328,"y":4099,"wires":[["c9bf7162.483a88","a89b603a.949378"]]},{"id":"c9bf7162.483a88","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":25,"width":"0","height":"0","name":"Température Salle de bain","label":"Température Salle de bain","format":"{{msg.payload}}°C","layout":"","x":611,"y":4121,"wires":[]},{"id":"e92545f4.3ccc8","type":"function","z":"b882537d.e69738","name":"H Salle de bain","func":"msg.payload = msg.payload.humidity.value\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":4217,"wires":[["f9454470.a7329","14fc1f6f.994e91","dc689720.e3842"]]},{"id":"f9454470.a7329","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":26,"width":"0","height":"0","name":"Humidité Salle de bain","label":"Humidité Salle de bain","format":"{{msg.payload}} %","layout":"","x":591,"y":4221,"wires":[]},{"id":"14fc1f6f.994e91","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":27,"width":"0","height":"0","name":"--","label":"","format":"","layout":"","x":543,"y":4263,"wires":[]},{"id":"e6305ac2.e8e8d","type":"mqtt out","z":"b882537d.e69738","name":"Salledebain/RFX/Temperature","topic":"Salledebain/RFX/Temperature","qos":"2","retain":"","broker":"9c9224ce.733908","x":870,"y":4080,"wires":[]},{"id":"186e6b76.12a9bd","type":"mqtt out","z":"b882537d.e69738","name":"Salledebain/RFX/Humidity","topic":"Salledebain/RFX/Humidity","qos":"2","retain":"","broker":"9c9224ce.733908","x":849,"y":4180,"wires":[]},{"id":"a0ad435d.2f9188","type":"debug","z":"b882537d.e69738","name":"","active":false,"console":"false","complete":"false","x":324,"y":4052,"wires":[]},{"id":"4e802f40.dc256","type":"comment","z":"b882537d.e69738","name":"Salle de bain","info":"\n","x":72,"y":4112,"wires":[]},{"id":"5c63d87f.2ba308","type":"function","z":"b882537d.e69738","name":"Date","func":"MaDate = new Date();\ndateString = MaDate.toString();\ntimeString = dateString.substring( 16 , 21 );\ndayString = dateString.substring( 8 , 11 );\nmonthString = dateString.substring( 4 , 8 );\n//msg.payload = timeString\nmsg.payload = dayString + monthString + timeString\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":297,"y":4307,"wires":[["ad0012c2.3d6cd8"]]},{"id":"ad0012c2.3d6cd8","type":"mqtt out","z":"b882537d.e69738","name":"Salledebain/RFX/lastupdate","topic":"Salledebain/RFX/lastupdate","qos":"2","retain":"true","broker":"9c9224ce.733908","x":607,"y":4307,"wires":[]},{"id":"946d7ec3.e7fc8","type":"debug","z":"b882537d.e69738","name":"","active":false,"console":"false","complete":"status","x":649,"y":90,"wires":[]},{"id":"45cbcac5.d1fbf4","type":"function","z":"b882537d.e69738","name":"Batterie","func":"msg.payload = msg.status.battery\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":315,"y":642,"wires":[["cea66569.3d9b58"]]},{"id":"cb462df2.79cd1","type":"comment","z":"b882537d.e69738","name":"Notif batterie faible","info":"","x":978,"y":610,"wires":[]},{"id":"a7e1d7c4.c6ae3","type":"pushbullet","z":"b882537d.e69738","config":"ee1296bd.5dc6e","pushtype":"","title":"Sonde T° véranda Batterie faible","chan":"","name":"Sonde T° véranda Batterie faible","x":983,"y":648,"wires":[]},{"id":"d56fe540.09deb8","type":"delay","z":"b882537d.e69738","name":"One notification/day","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":720,"y":648,"wires":[["a7e1d7c4.c6ae3"]]},{"id":"cea66569.3d9b58","type":"switch","z":"b882537d.e69738","name":"Batterie > 2","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"2","vt":"num"},{"t":"else"}],"checkall":"true","outputs":2,"x":521,"y":642,"wires":[[],["d56fe540.09deb8"]]},{"id":"576ac12a.ffbd48","type":"comment","z":"b882537d.e69738","name":"Non","info":"","x":610,"y":680,"wires":[]},{"id":"440612ec.650fc4","type":"function","z":"b882537d.e69738","name":"Batterie","func":"msg.payload = msg.status.battery\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":305,"y":1100,"wires":[["6b65dfc5.07785"]]},{"id":"6b65dfc5.07785","type":"switch","z":"b882537d.e69738","name":"Batterie > 2","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"2","vt":"num"},{"t":"else"}],"checkall":"true","outputs":2,"x":511,"y":1100,"wires":[[],["327daa39.59c876"]]},{"id":"7bace638.c067","type":"comment","z":"b882537d.e69738","name":"Non","info":"","x":590,"y":1138,"wires":[]},{"id":"327daa39.59c876","type":"delay","z":"b882537d.e69738","name":"One notification/day","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":703,"y":1106,"wires":[["23a8849a.9c04c4"]]},{"id":"23a8849a.9c04c4","type":"pushbullet","z":"b882537d.e69738","config":"ee1296bd.5dc6e","pushtype":"","title":"Sonde T° salon Batterie faible","chan":"","name":"Sonde T° salon Batterie faible","x":963,"y":1106,"wires":[]},{"id":"9a78a2ba.c53278","type":"comment","z":"b882537d.e69738","name":"Notif batterie faible","info":"","x":967,"y":1070,"wires":[]},{"id":"1c15478.e00c7b9","type":"function","z":"b882537d.e69738","name":"Batterie","func":"msg.payload = msg.status.battery\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":288,"y":1571,"wires":[["139e8fce.289db8"]]},{"id":"139e8fce.289db8","type":"switch","z":"b882537d.e69738","name":"Batterie > 2","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"2","vt":"num"},{"t":"else"}],"checkall":"true","outputs":2,"x":494,"y":1571,"wires":[[],["af1f4cd5.e3c28"]]},{"id":"dd2791c5.c4ff2","type":"comment","z":"b882537d.e69738","name":"Non","info":"","x":589,"y":1611,"wires":[]},{"id":"af1f4cd5.e3c28","type":"delay","z":"b882537d.e69738","name":"One notification/day","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":689,"y":1577,"wires":[["ccfe1610.7eb08"]]},{"id":"ccfe1610.7eb08","type":"pushbullet","z":"b882537d.e69738","config":"ee1296bd.5dc6e","pushtype":"","title":"Sonde T° Ext Batterie faible","chan":"","name":"Sonde T° Ext Batterie faible","x":939,"y":1577,"wires":[]},{"id":"93f812ea.215ce","type":"comment","z":"b882537d.e69738","name":"Notif batterie faible","info":"","x":940,"y":1541,"wires":[]},{"id":"bf9975fa.aeaf7","type":"function","z":"b882537d.e69738","name":"Batterie","func":"msg.payload = msg.status.battery\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":2456,"wires":[["3c09cefc.04d5a2"]]},{"id":"3c09cefc.04d5a2","type":"switch","z":"b882537d.e69738","name":"Batterie > 2","property":"payload","propertyType":"msg","rules":[{"t":"gt","v":"2","vt":"num"},{"t":"else"}],"checkall":"true","outputs":2,"x":489,"y":2456,"wires":[[],["baa690e4.6b4ba"]]},{"id":"78436f29.4ad07","type":"comment","z":"b882537d.e69738","name":"Non","info":"","x":569,"y":2497,"wires":[]},{"id":"baa690e4.6b4ba","type":"delay","z":"b882537d.e69738","name":"One notification/day","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":679,"y":2462,"wires":[["b6259d85.6685a"]]},{"id":"b6259d85.6685a","type":"pushbullet","z":"b882537d.e69738","config":"ee1296bd.5dc6e","pushtype":"","title":"Sonde T° cuisine Batterie faible","chan":"","name":"Sonde T° cuisine Batterie faible","x":933,"y":2462,"wires":[]},{"id":"ab27341a.6f0a7","type":"comment","z":"b882537d.e69738","name":"Notif batterie faible","info":"","x":928,"y":2426,"wires":[]},{"id":"3476baf3.1aed1e","type":"switch","z":"b882537d.e69738","name":"TH9 ou TH13 topic","property":"topic","propertyType":"msg","rules":[{"t":"cont","v":"TH13","vt":"str"},{"t":"cont","v":"TH9","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":329,"y":130,"wires":[["7ed49012.cc3e68","946d7ec3.e7fc8"],["1b3bd2f9.86df35","49a34ad3.3fb37c"]]},{"id":"97208495.d5dc7","type":"comment","z":"b882537d.e69738","name":"TH9","info":"\n","x":489,"y":190,"wires":[]},{"id":"1b3bd2f9.86df35","type":"debug","z":"b882537d.e69738","name":"","active":false,"console":"false","complete":"false","x":649,"y":150,"wires":[]},{"id":"49a34ad3.3fb37c","type":"debug","z":"b882537d.e69738","name":"","active":false,"console":"false","complete":"status","x":649,"y":190,"wires":[]},{"id":"c9b8873b.a778e8","type":"comment","z":"b882537d.e69738","name":"TH13","info":"\n","x":489,"y":50,"wires":[]},{"id":"2b732679.ffff7a","type":"debug","z":"b882537d.e69738","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":279,"y":70,"wires":[]},{"id":"7fdb265c.c0664","type":"function","z":"b882537d.e69738","name":"Global var MyTemperatureRDC","func":"context.global.MyTemperatureRDC=Math.trunc(msg.payload);\nmsg.payload = context.global.MyTemperatureRDC;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":805,"y":738,"wires":[[]]},{"id":"159d2a6f.3f6566","type":"ui_text","z":"b882537d.e69738","group":"b622e15c.61edb","order":28,"width":"","height":"","name":"Humidité billard","label":"Humidité billard","format":"{{msg.payload}} °C","layout":"","x":480,"y":4560,"wires":[]},{"id":"aae33d8d.57b7f8","type":"function","z":"b882537d.e69738","name":"Global var MyTemperatureVeranda","func":"context.global.MyTemperatureVeranda=msg.payload;\nmsg.payload = context.global.MyTemperatureVeranda;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":820,"y":292,"wires":[[]]},{"id":"cc0c4011.df5a1","type":"function","z":"b882537d.e69738","name":"Global var MyTemperatureBillard","func":"context.global.MyTemperatureBillard=msg.payload;\nmsg.payload = context.global.MyTemperatureBillard;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":760,"y":4460,"wires":[[]]},{"id":"e58add31.c5f83","type":"function","z":"b882537d.e69738","name":"Global var MyTemperatureSouSol","func":"context.global.MyTemperatureSouSol=msg.payload;\nmsg.payload = context.global.MyTemperatureSouSol;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":4680,"wires":[[]]},{"id":"e1695624.f89e78","type":"function","z":"c558fd3a.cad55","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"presence\\\", \\\"maison\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":120,"wires":[["513da1ab.030d7"]]},{"id":"513da1ab.030d7","type":"json","z":"c558fd3a.cad55","name":"","x":607,"y":120,"wires":[["4639f14f.d862b"]]},{"id":"4639f14f.d862b","type":"http request","z":"c558fd3a.cad55","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/my_sonde/sonde/{{{msg.payload}}}","tls":"","x":743,"y":120,"wires":[["5aa07716.f67bd8"]]},{"id":"5aa07716.f67bd8","type":"debug","z":"c558fd3a.cad55","name":"","active":false,"console":"false","complete":"false","x":901,"y":119.5,"wires":[]},{"id":"dbed0456.6303c8","type":"inject","z":"c558fd3a.cad55","name":"","topic":"Test ES Write","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"x":278,"y":160,"wires":[["e1695624.f89e78"]]},{"id":"2a73721b.41c49e","type":"comment","z":"c558fd3a.cad55","name":"Présence","info":"","x":86,"y":79,"wires":[]},{"id":"f86161c8.55aef8","type":"comment","z":"c558fd3a.cad55","name":"0 : Absent","info":"","x":226,"y":78,"wires":[]},{"id":"b9347730.0f0af","type":"comment","z":"c558fd3a.cad55","name":"1 : Présent","info":"","x":365,"y":76,"wires":[]},{"id":"e4a45e67.35af98","type":"mqtt in","z":"c558fd3a.cad55","name":"presence/maison","topic":"presence/maison","qos":"2","broker":"9c9224ce.733908","x":107,"y":120,"wires":[["9087207e.e44268"]]},{"id":"9087207e.e44268","type":"delay","z":"c558fd3a.cad55","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"10","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":281,"y":120,"wires":[["e1695624.f89e78"]]},{"id":"d51b5049.e92dd","type":"comment","z":"c558fd3a.cad55","name":"Elastic Search qair","info":"","x":121,"y":258,"wires":[]},{"id":"846ce9dc.c60bf","type":"inject","z":"c558fd3a.cad55","name":"Every 1H","topic":"","payload":"","payloadType":"str","repeat":"3600","crontab":"","once":true,"onceDelay":"","x":121,"y":298,"wires":[["2b63443f.9d76cc"]]},{"id":"8b4d1222.618fd8","type":"function","z":"c558fd3a.cad55","name":"qair ES write","func":"if ( parseInt(msg.payload) <= 4) {\n    msg.quality=\"Air correct\";\n}\nelse if ( parseInt(msg.payload) <= 7) {\n        msg.quality=\"Air pollué\";\n}\nelse {\n    msg.quality=\"Air très pollué\";\n}    \nd=new Date();\nmadate=d.toJSON()\n//myTemp = context.global.myTemperatureExt;\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"air\\\", \\\"qualite-air\\\":\" + msg.payload + \", \\\"quality\\\":\\\"\" + msg.quality +\"\\\"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":616,"y":337,"wires":[["1fd483d4.42d824"]]},{"id":"1fd483d4.42d824","type":"json","z":"c558fd3a.cad55","name":"","x":757,"y":337,"wires":[["2d065afa.030396"]]},{"id":"2d065afa.030396","type":"http request","z":"c558fd3a.cad55","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/my_sonde/sonde/{{{msg.payload}}}","tls":"","x":895,"y":337,"wires":[["cc810314.3fa17"]]},{"id":"cc810314.3fa17","type":"debug","z":"c558fd3a.cad55","name":"","active":false,"console":"false","complete":"false","x":1054,"y":336.5,"wires":[]},{"id":"2b63443f.9d76cc","type":"file in","z":"c558fd3a.cad55","name":"qair.txt","filename":"/var/www/html/qair/qair.txt","format":"utf8","sendError":true,"x":258,"y":298,"wires":[["3c55dfc1.2e7c88"]]},{"id":"81529b7c.d1393","type":"switch","z":"659a812a.2160a","name":"switch batteryLevel set","property":"payload.data.batteryLevel","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":171,"y":3461,"wires":[["10114767.d144b9"]]},{"id":"35bd6625.bb37ca","type":"switch","z":"659a812a.2160a","name":"switch batteryLevel set","property":"payload.data.batteryLevel","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":194,"y":3018,"wires":[["be179342.1f8de"]]},{"id":"782ad3dd.2ff67c","type":"switch","z":"659a812a.2160a","name":"switch alarm set","property":"payload.data.alarm","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":197,"y":2959,"wires":[["13a76362.8793e5"]]},{"id":"31daee57.18627a","type":"switch","z":"659a812a.2160a","name":"switch alarm set","property":"payload.data.alarm","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":205,"y":3400,"wires":[["a4eb847d.15015"]]},{"id":"947e9a3a.1ea11","type":"delay","z":"c558fd3a.cad55","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"4","nbRateUnits":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":618,"y":278,"wires":[["8b4d1222.618fd8"]]},{"id":"3c428c24.fe891c","type":"comment","z":"c558fd3a.cad55","name":"Elastic Search uv index sondeUV","info":"","x":150,"y":460,"wires":[]},{"id":"87f60585.4f4ca8","type":"inject","z":"c558fd3a.cad55","name":"Every 30mn","topic":"","payload":"","payloadType":"str","repeat":"1800","crontab":"","once":true,"onceDelay":"","x":120,"y":503,"wires":[["c26ab708.00f298"]]},{"id":"686c966d.bd9888","type":"function","z":"c558fd3a.cad55","name":"uv ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"uv\\\", \\\"indice-uv\\\":\" + msg.payload  +\"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":623,"y":544,"wires":[["eb6a0fb3.46f718"]]},{"id":"eb6a0fb3.46f718","type":"json","z":"c558fd3a.cad55","name":"","x":759,"y":543,"wires":[["6b79e360.6ce76c"]]},{"id":"6b79e360.6ce76c","type":"http request","z":"c558fd3a.cad55","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondeuv/sonde/{{{msg.payload}}}","tls":"","x":897,"y":543,"wires":[["5c902724.7148f"]]},{"id":"5c902724.7148f","type":"debug","z":"c558fd3a.cad55","name":"","active":false,"console":"false","complete":"false","x":1055,"y":542.5,"wires":[]},{"id":"c26ab708.00f298","type":"file in","z":"c558fd3a.cad55","name":"uv.txt","filename":"/var/www/html/uv/uv.txt","format":"utf8","sendError":true,"x":265,"y":503,"wires":[["c88fb407.52d04"]]},{"id":"5516cb9d.ada6e4","type":"delay","z":"c558fd3a.cad55","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"4","nbRateUnits":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":624,"y":483,"wires":[["686c966d.bd9888"]]},{"id":"170962f3.216d45","type":"inject","z":"c558fd3a.cad55","name":"","topic":"Test ES Write","payload":"4","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":235,"y":544,"wires":[["c88fb407.52d04"]]},{"id":"13165316.46dc75","type":"ui_template","z":"741cb637.242018","group":"55a686e9.047b2","name":"Volet/All grafana","order":1,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Tous les volets\"}}\n</span>\n\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":100,"y":1060,"wires":[["75a2b946.9612c8"]]},{"id":"83db7d8e.4e0c2","type":"ui_template","z":"741cb637.242018","group":"55a686e9.047b2","name":"Volet/rez-de-chaussée Grafana","order":2,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n\n<img class=\"lightup\" src=\"http://domobox//icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volets rez-de chaussée\"}}\n</span>\n\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox//icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox//icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox//icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":170,"y":640,"wires":[["7cf4aacd.53af6c"]]},{"id":"e7936bd3.e7381","type":"ui_template","z":"741cb637.242018","group":"55a686e9.047b2","name":"Volet/étage Grafana","order":3,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n\n<img class=\"lightup\" src=\"http://domobox//icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volets étage\"}}\n</span>\n\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox//icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox//icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox//icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":120,"y":1400,"wires":[["3d72084.ded4978"]]},{"id":"ce01dc51.121e18","type":"ui_template","z":"65265671.c010f8","group":"55a686e9.047b2","name":"Volet/Véranda Grafana","order":4,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volets véranda\"}}\n</span>\n\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-down.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-stop.png\" ng-click=\"send({payload: 'stop' })\" height=\"34px\"/>\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-up.png\" ng-click=\"send({payload: 'up' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":130,"y":1440,"wires":[["6722676c.a29d28"]]},{"id":"ddb8f247.3fac1","type":"ui_template","z":"65265671.c010f8","group":"55a686e9.047b2","name":"Volet/Véranda MY Grafana","order":5,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n\n<img class=\"lightup\" src=\"http://domobox/icones/volet-v2-1.png\" height=\"34px\"/>&nbsp;\n<span style=\"width:50%;padding-top:5px;padding-left:5px;\">{{\"Volets véranda MY\"}}\n</span>\n\n<span style=\"width:50%; padding-top:2px;\">\n    <img class=\"lightup\" src=\"http://domobox/icones/volet-velux-my.png\" ng-click=\"send({payload: 'down' })\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":140,"y":1260,"wires":[["6d82efdf.1aa748","6722676c.a29d28"]]},{"id":"66a7bda2.5b34c4","type":"mqtt in","z":"c558fd3a.cad55","name":"","topic":"Salon/XIAOMI/Lux","qos":"2","broker":"9c9224ce.733908","x":112,"y":714,"wires":[["fd826677.b78128"]]},{"id":"d1fb9625.6d8c3","type":"comment","z":"c558fd3a.cad55","name":"Lux salon2 ES index sondeLux","info":"","x":142,"y":675,"wires":[]},{"id":"79e0f713.1a92e8","type":"json","z":"c558fd3a.cad55","name":"","x":661,"y":756,"wires":[["40e3699a.fec31"]]},{"id":"40e3699a.fec31","type":"http request","z":"c558fd3a.cad55","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondelux/sonde/{{{msg.payload}}}","tls":"","x":800,"y":756,"wires":[["70cc992a.9c8578"]]},{"id":"70cc992a.9c8578","type":"debug","z":"c558fd3a.cad55","name":"","active":false,"console":"false","complete":"false","x":957,"y":755.5,"wires":[]},{"id":"5d40e8d5.ab82c8","type":"function","z":"c558fd3a.cad55","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"Lux-Salon\\\", \\\"lux\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":513,"y":756,"wires":[["79e0f713.1a92e8"]]},{"id":"93ebb0b7.567ca","type":"delay","z":"c558fd3a.cad55","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"5","nbRateUnits":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":512,"y":698,"wires":[["5d40e8d5.ab82c8"]]},{"id":"a0daa161.af9d4","type":"mqtt in","z":"c558fd3a.cad55","name":"","topic":"Cuisine/XIAOMI/Lux","qos":"2","broker":"9c9224ce.733908","x":112,"y":935,"wires":[["f148cb71.69a478"]]},{"id":"6efc8182.ffcb58","type":"comment","z":"c558fd3a.cad55","name":"Lux cuisine ES index sondeLux","info":"","x":149,"y":896,"wires":[]},{"id":"415f19b5.9917c8","type":"json","z":"c558fd3a.cad55","name":"","x":657,"y":970,"wires":[["7354b10f.e7de5"]]},{"id":"7354b10f.e7de5","type":"http request","z":"c558fd3a.cad55","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondelux/sonde/{{{msg.payload}}}","tls":"","x":794,"y":970,"wires":[["153760aa.441897"]]},{"id":"153760aa.441897","type":"debug","z":"c558fd3a.cad55","name":"","active":false,"console":"false","complete":"false","x":952,"y":969.5,"wires":[]},{"id":"2a2e4621.fc6fd2","type":"function","z":"c558fd3a.cad55","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"Lux-Cuisine\\\", \\\"lux\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":512,"y":971,"wires":[["415f19b5.9917c8"]]},{"id":"7a88e0d8.c3cd4","type":"delay","z":"c558fd3a.cad55","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"5","nbRateUnits":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":509,"y":920,"wires":[["2a2e4621.fc6fd2"]]},{"id":"34863d08.29fc2a","type":"mqtt in","z":"c558fd3a.cad55","name":"","topic":"Veranda/XIAOMI/Lux","qos":"2","broker":"9c9224ce.733908","x":112,"y":1147,"wires":[["a96dfacc.da3958"]]},{"id":"e90e245c.ff26c","type":"comment","z":"c558fd3a.cad55","name":"Lux Véranda ES index sondeLux","info":"","x":147,"y":1108,"wires":[]},{"id":"2e58c8a3.a5e1f","type":"json","z":"c558fd3a.cad55","name":"","x":660,"y":1177,"wires":[["fc94e36e.141e48"]]},{"id":"fc94e36e.141e48","type":"http request","z":"c558fd3a.cad55","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondelux/sonde/{{{msg.payload}}}","tls":"","x":795,"y":1177,"wires":[["4ac53041.07c73"]]},{"id":"4ac53041.07c73","type":"debug","z":"c558fd3a.cad55","name":"","active":false,"console":"false","complete":"false","x":950,"y":1176.5,"wires":[]},{"id":"1523573d.9b7b29","type":"function","z":"c558fd3a.cad55","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"Lux-Veranda\\\", \\\"lux\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":514,"y":1177,"wires":[["2e58c8a3.a5e1f"]]},{"id":"a976bcff.c2a1c8","type":"delay","z":"c558fd3a.cad55","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"1","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":509,"y":1119,"wires":[["1523573d.9b7b29"]]},{"id":"329e73e3.a9699c","type":"comment","z":"c558fd3a.cad55","name":"Etat détecteur fumée palier 2 ES index sondeFumee","info":"","x":212,"y":1289,"wires":[]},{"id":"a858c44.b5a95b8","type":"mqtt in","z":"c558fd3a.cad55","name":"Palier/XIAOMI/smoke","topic":"Palier/XIAOMI/smoke","qos":"2","broker":"9c9224ce.733908","x":122,"y":1327,"wires":[["2cbea1a4.c7d2d6"]]},{"id":"c6385361.b340f8","type":"json","z":"c558fd3a.cad55","name":"","x":682,"y":1414,"wires":[["a3f8fd17.409e98"]]},{"id":"a3f8fd17.409e98","type":"http request","z":"c558fd3a.cad55","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondefumee/sonde/{{{msg.payload}}}","tls":"","x":818,"y":1414,"wires":[["f64e61e4.7595c8"]]},{"id":"f64e61e4.7595c8","type":"debug","z":"c558fd3a.cad55","name":"","active":false,"console":"false","complete":"false","x":974,"y":1413.5,"wires":[]},{"id":"ddc87bf7.e488c8","type":"function","z":"c558fd3a.cad55","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"SmokePalier\\\", \\\"status\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":527,"y":1414,"wires":[["c6385361.b340f8"]]},{"id":"ee185ea4.ac3238","type":"comment","z":"c558fd3a.cad55","name":"Etat détecteur fumée couloir 2 ES index sondeFumee","info":"","x":222,"y":1511,"wires":[]},{"id":"e84aabe.ad90158","type":"mqtt in","z":"c558fd3a.cad55","name":"Couloir/XIAOMI/smoke","topic":"Couloir/XIAOMI/smoke","qos":"2","broker":"9c9224ce.733908","x":124,"y":1551,"wires":[["e56eedda.03e9b8"]]},{"id":"e56eedda.03e9b8","type":"function","z":"c558fd3a.cad55","name":"Has value Changed?","func":"context.lastvaluesmokecouloir = context.lastvaluesmokecouloir || 'initial';\nvar currentvaluesmokecouloir = msg.payload;\n    //node.status({text:context.lastvaluesmokecouloir});\n\nif (context.lastvaluesmokecouloir == currentvaluesmokecouloir) \n{\n    context.lastvaluesmokecouloir = currentvaluesmokecouloir;\n    msg.payload = currentvaluesmokecouloir;\n    // no change\n        node.status({text:'no change'});\n    node.status({text:msg.payload});\n    return [ msg, null ];\n}\nelse if (context.lastvaluesmokecouloir != currentvaluesmokecouloir) \n{\n    msg.payload = currentvaluesmokecouloir;\n    context.lastvaluesmokecouloir = currentvaluesmokecouloir;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvaluesmokecouloir});\n    ","outputs":2,"noerr":0,"x":336,"y":1600,"wires":[["14a139b1.5a5976"],["bc8fa8f9.01b88"]]},{"id":"37e60de3.a3d002","type":"json","z":"c558fd3a.cad55","name":"","x":687,"y":1629,"wires":[["2e41b522.061c52"]]},{"id":"2e41b522.061c52","type":"http request","z":"c558fd3a.cad55","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondefumee/sonde/{{{msg.payload}}}","tls":"","x":824,"y":1629,"wires":[["5a8ad3fa.fdc11c"]]},{"id":"5a8ad3fa.fdc11c","type":"debug","z":"c558fd3a.cad55","name":"","active":false,"console":"false","complete":"false","x":982,"y":1628.5,"wires":[]},{"id":"bc8fa8f9.01b88","type":"function","z":"c558fd3a.cad55","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"SmokeCouloir\\\", \\\"status\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":538,"y":1629,"wires":[["37e60de3.a3d002"]]},{"id":"5b6b30ba.41b188","type":"inject","z":"c558fd3a.cad55","name":"","topic":"Test ES Write","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":128,"y":1376,"wires":[["2cbea1a4.c7d2d6"]]},{"id":"593bcd06.f4d76c","type":"inject","z":"c558fd3a.cad55","name":"","topic":"Test ES Write","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":129,"y":1601,"wires":[["e56eedda.03e9b8"]]},{"id":"5bd23e84.d8d52","type":"delay","z":"c558fd3a.cad55","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"1","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":528,"y":1348,"wires":[["ddc87bf7.e488c8"]]},{"id":"8597f34e.f6185","type":"inject","z":"c558fd3a.cad55","name":"","topic":"Test ES Write","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":129,"y":1644,"wires":[["e56eedda.03e9b8"]]},{"id":"ed24bb69.eb6628","type":"function","z":"b882537d.e69738","name":"Global var MyTemperatureEtage","func":"//context.global.MyTemperatureExt=msg.payload;\ncontext.global.MyTemperatureEtage=Math.trunc(msg.payload);\nmsg.payload = context.global.MyTemperatureEtage;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":885,"y":4030,"wires":[[]]},{"id":"d017d59d.7d3b3","type":"comment","z":"c558fd3a.cad55","name":"Change","info":"","x":361,"y":1639,"wires":[]},{"id":"102dc4a8.23f9b3","type":"comment","z":"c558fd3a.cad55","name":"No change","info":"","x":357,"y":1562,"wires":[]},{"id":"14a139b1.5a5976","type":"delay","z":"c558fd3a.cad55","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"5","nbRateUnits":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":533,"y":1569,"wires":[["bc8fa8f9.01b88"]]},{"id":"6864b04c.71927","type":"inject","z":"c558fd3a.cad55","name":"","topic":"Test ES Write","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":129,"y":1415,"wires":[["2cbea1a4.c7d2d6"]]},{"id":"2cbea1a4.c7d2d6","type":"function","z":"c558fd3a.cad55","name":"Has value Changed?","func":"context.lastvaluesmokepalier = context.lastvaluesmokepalier || 'initial';\nvar currentvaluesmokepalier = msg.payload;\n\nif (context.lastvaluesmokepalier == currentvaluesmokepalier) \n{\n    context.lastvaluesmokepalier = currentvaluesmokepalier;\n    msg.payload = currentvaluesmokepalier;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvaluesmokepalier != currentvaluesmokepalier) \n{\n    msg.payload = currentvaluesmokepalier;\n    context.lastvaluesmokepalier = currentvaluesmokepalier;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvaluesmokepalier});","outputs":2,"noerr":0,"x":333,"y":1376,"wires":[["5bd23e84.d8d52"],["ddc87bf7.e488c8"]]},{"id":"e5da5fd6.3e8268","type":"comment","z":"c558fd3a.cad55","name":"No change","info":"","x":353,"y":1339,"wires":[]},{"id":"955615c.5b0b3e8","type":"comment","z":"c558fd3a.cad55","name":"Change","info":"","x":360,"y":1413,"wires":[]},{"id":"49d495cc.da19ac","type":"comment","z":"c558fd3a.cad55","name":"No change","info":"","x":341,"y":1107,"wires":[]},{"id":"a96dfacc.da3958","type":"function","z":"c558fd3a.cad55","name":"Has value Changed?","func":"context.lastvalueluxveranda = context.lastvalueluxveranda || 'initial';\nvar currentvalueluxveranda = msg.payload;\n\nif (context.lastvalueluxveranda == currentvalueluxveranda) \n{\n    context.lastvalueluxveranda = currentvalueluxveranda;\n    msg.payload = currentvalueluxveranda;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvalueluxveranda != currentvalueluxveranda) \n{\n    msg.payload = currentvalueluxveranda;\n    context.lastvalueluxveranda = currentvalueluxveranda;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvalueluxveranda});","outputs":2,"noerr":0,"x":316,"y":1147,"wires":[["a976bcff.c2a1c8"],["1523573d.9b7b29"]]},{"id":"414d46f5.3e5f38","type":"comment","z":"c558fd3a.cad55","name":"Change","info":"","x":349,"y":1185,"wires":[]},{"id":"bb31eebe.ba327","type":"comment","z":"c558fd3a.cad55","name":"No change","info":"","x":345,"y":896,"wires":[]},{"id":"f148cb71.69a478","type":"function","z":"c558fd3a.cad55","name":"Has value Changed?","func":"context.lastvalueluxcuisine = context.lastvalueluxcuisine || 'initial';\nvar currentvalueluxcuisine = msg.payload;\n\nif (context.lastvalueluxcuisine == currentvalueluxcuisine) \n{\n    context.lastvalueluxcuisine = currentvalueluxcuisine;\n    msg.payload = currentvalueluxcuisine;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvalueluxcuisine != currentvalueluxcuisine) \n{\n    msg.payload = currentvalueluxcuisine;\n    context.lastvalueluxcuisine = currentvalueluxcuisine;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvalueluxcuisine});","outputs":2,"noerr":0,"x":317,"y":935,"wires":[["7a88e0d8.c3cd4"],["2a2e4621.fc6fd2"]]},{"id":"daaafb55.7096e8","type":"comment","z":"c558fd3a.cad55","name":"Change","info":"","x":334,"y":971,"wires":[]},{"id":"82df47bb.67cbe8","type":"comment","z":"c558fd3a.cad55","name":"No change","info":"","x":342,"y":676,"wires":[]},{"id":"fd826677.b78128","type":"function","z":"c558fd3a.cad55","name":"Has value Changed?","func":"context.lastvalueluxsalon = context.lastvalueluxsalon || 'initial';\nvar currentvalueluxsalon = msg.payload;\n\nif (context.lastvalueluxsalon == currentvalueluxsalon) \n{\n    context.lastvalueluxsalon = currentvalueluxsalon;\n    msg.payload = currentvalueluxsalon;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvalueluxsalon != currentvalueluxsalon) \n{\n    msg.payload = currentvalueluxsalon;\n    context.lastvalueluxsalon = currentvalueluxsalon;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvalueluxsalon});","outputs":2,"noerr":0,"x":318,"y":714,"wires":[["93ebb0b7.567ca"],["5d40e8d5.ab82c8"]]},{"id":"a727ede7.d57788","type":"comment","z":"c558fd3a.cad55","name":"Change","info":"","x":345,"y":753,"wires":[]},{"id":"60e1a31c.b494d4","type":"comment","z":"c558fd3a.cad55","name":"No change","info":"","x":456,"y":464,"wires":[]},{"id":"c88fb407.52d04","type":"function","z":"c558fd3a.cad55","name":"Has value Changed?","func":"context.lastvalueuv = context.lastvalueuv || 'initial';\nvar currentvalueuv = msg.payload;\n\nif (context.lastvalueuv == currentvalueuv) \n{\n    context.lastvalueuv = currentvalueuv;\n    msg.payload = currentvalueuv;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvalueuv != currentvalueuv) \n{\n    msg.payload = currentvalueuv;\n    context.lastvalueuv = currentvalueuv;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvalueuv});","outputs":2,"noerr":0,"x":436,"y":502,"wires":[["5516cb9d.ada6e4"],["686c966d.bd9888"]]},{"id":"53d93406.a95d94","type":"comment","z":"c558fd3a.cad55","name":"Change","info":"","x":466,"y":540,"wires":[]},{"id":"8f367f11.7e6878","type":"comment","z":"c558fd3a.cad55","name":"No change","info":"","x":444,"y":261,"wires":[]},{"id":"3c55dfc1.2e7c88","type":"function","z":"c558fd3a.cad55","name":"Has value Changed?","func":"context.lastvalueqair = context.lastvalueqair || 'initial';\nvar currentvalueqair = msg.payload;\n\nif (context.lastvalueqair == currentvalueqair) \n{\n    context.lastvalueqair = currentvalueqair;\n    msg.payload = currentvalueqair;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvalueqair != currentvalueqair) \n{\n    msg.payload = currentvalueqair;\n    context.lastvalueqair = currentvalueqair;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvalueqair});","outputs":2,"noerr":0,"x":425,"y":298,"wires":[["947e9a3a.1ea11"],["8b4d1222.618fd8"]]},{"id":"964cb223.5f3568","type":"comment","z":"c558fd3a.cad55","name":"Change","info":"","x":454,"y":336,"wires":[]},{"id":"3affa589.68dfe2","type":"comment","z":"c558fd3a.cad55","name":"Elastic Search vigilance risk météo  sondevigilance","info":"","x":212,"y":1931,"wires":[]},{"id":"2683cd44.848aba","type":"function","z":"c558fd3a.cad55","name":"ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"vigilanceMeteo\\\", \\\"risk\\\":\" + msg.payload  +\"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":992,"y":2019,"wires":[["73dc17ea.dd5ea"]]},{"id":"73dc17ea.dd5ea","type":"json","z":"c558fd3a.cad55","name":"","x":1141,"y":2019,"wires":[["e8cb0891.4a4eb8"]]},{"id":"e8cb0891.4a4eb8","type":"http request","z":"c558fd3a.cad55","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondevigilance/sonde/{{{msg.payload}}}","tls":"","x":1278,"y":2019,"wires":[["e67bc3d5.d051b8"]]},{"id":"e67bc3d5.d051b8","type":"debug","z":"c558fd3a.cad55","name":"","active":false,"console":"false","complete":"false","x":1433,"y":2018.5,"wires":[]},{"id":"b44b1a15.548328","type":"delay","z":"c558fd3a.cad55","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"2","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1013,"y":1958,"wires":[["2683cd44.848aba"]]},{"id":"690b6d11.a1f954","type":"comment","z":"c558fd3a.cad55","name":"No change","info":"","x":841,"y":1937,"wires":[]},{"id":"c2ed2f81.4bfdd8","type":"function","z":"c558fd3a.cad55","name":"Has value Changed?","func":"context.lastvalueriskmeteo = context.lastvalueriskmeteo || 'initial';\nvar currentvalueriskmeteo = msg.payload;\n\nif (context.lastvalueriskmeteo == currentvalueriskmeteo) \n{\n    context.lastvalueriskmeteo = currentvalueriskmeteo;\n    msg.payload = currentvalueriskmeteo;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvalueriskmeteo != currentvalueriskmeteo) \n{\n    msg.payload = currentvalueriskmeteo;\n    context.lastvalueriskmeteo = currentvalueriskmeteo;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvalueriskmeteo});","outputs":2,"noerr":0,"x":814,"y":1977,"wires":[["b44b1a15.548328"],["2683cd44.848aba"]]},{"id":"cf7cbaaa.7e0b78","type":"comment","z":"c558fd3a.cad55","name":"Change","info":"","x":847,"y":2014,"wires":[]},{"id":"cad04884.22a8","type":"http request","z":"c558fd3a.cad55","name":"HTTP vigilance risk","method":"GET","ret":"txt","url":"http://192.168.1.30:81/vigilance/14/risk","tls":"","x":305,"y":1976,"wires":[["50727dca.08d124"]]},{"id":"50727dca.08d124","type":"switch","z":"c558fd3a.cad55","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"RAS","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":463,"y":1976,"wires":[["21e14e9e.f34bc2"],["4b428520.651744"]]},{"id":"c62d9b29.7ee3e","type":"comment","z":"c558fd3a.cad55","name":"RAS : 0","info":"","x":475,"y":1935,"wires":[]},{"id":"8a60d99d.e61e8","type":"comment","z":"c558fd3a.cad55","name":"risk : 1","info":"","x":469,"y":2014,"wires":[]},{"id":"21e14e9e.f34bc2","type":"change","z":"c558fd3a.cad55","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":615,"y":1952,"wires":[["c2ed2f81.4bfdd8"]]},{"id":"4b428520.651744","type":"change","z":"c558fd3a.cad55","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":615,"y":2005,"wires":[["c2ed2f81.4bfdd8"]]},{"id":"fb118eb6.d52ef8","type":"comment","z":"c558fd3a.cad55","name":"Elastic Search vigilance inondation météo  sondevigilance","info":"","x":225,"y":1734,"wires":[]},{"id":"cbe71214.7e868","type":"function","z":"c558fd3a.cad55","name":"ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"vigilanceMeteo\\\", \\\"inondation\\\":\" + msg.payload  +\"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":1010,"y":1843,"wires":[["66d492a3.349314"]]},{"id":"66d492a3.349314","type":"json","z":"c558fd3a.cad55","name":"","x":1156,"y":1843,"wires":[["66ca37aa.ef9d4"]]},{"id":"66ca37aa.ef9d4","type":"http request","z":"c558fd3a.cad55","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondevigilance/sonde/{{{msg.payload}}}","tls":"","x":1290,"y":1843,"wires":[["a22c6779.0145e"]]},{"id":"fb389bf7.f2c268","type":"delay","z":"c558fd3a.cad55","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"2","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":1031,"y":1782,"wires":[["cbe71214.7e868"]]},{"id":"e8737793.9bd5d","type":"comment","z":"c558fd3a.cad55","name":"No change","info":"","x":857,"y":1763,"wires":[]},{"id":"f10e8fa4.d8ad38","type":"function","z":"c558fd3a.cad55","name":"Has value Changed?","func":"context.lastvalueinondation = context.lastvalueinondation || 'initial';\nvar currentvalueinondation = msg.payload;\n\nif (context.lastvalueinondation == currentvalueinondation) \n{\n    context.lastvalueinondation = currentvalueinondation;\n    msg.payload = currentvalueinondation;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvalueinondation != currentvalueinondation) \n{\n    msg.payload = currentvalueinondation;\n    context.lastvalueinondation = currentvalueinondation;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvalueinondation});","outputs":2,"noerr":0,"x":831,"y":1801,"wires":[["fb389bf7.f2c268"],["cbe71214.7e868"]]},{"id":"de9b9756.75156","type":"comment","z":"c558fd3a.cad55","name":"Change","info":"","x":859,"y":1841,"wires":[]},{"id":"dd33da28.2c156","type":"http request","z":"c558fd3a.cad55","name":"HTTP vigilance flood","method":"GET","ret":"txt","url":"http://192.168.1.30:81/vigilance/14/flood","tls":"","x":316,"y":1800,"wires":[["95449039.b4b3c8","1870dc8d.315c73"]]},{"id":"95449039.b4b3c8","type":"switch","z":"c558fd3a.cad55","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"vert","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":482,"y":1800,"wires":[["ad781909.88894"],["c6c087b3.cf6ea"]]},{"id":"a4f5dbeb.4839c","type":"comment","z":"c558fd3a.cad55","name":"vert : 0","info":"","x":487,"y":1761,"wires":[]},{"id":"6d3107b2.b830d8","type":"comment","z":"c558fd3a.cad55","name":"flood : 1","info":"","x":481,"y":1835,"wires":[]},{"id":"ad781909.88894","type":"change","z":"c558fd3a.cad55","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":634,"y":1776,"wires":[["f10e8fa4.d8ad38"]]},{"id":"c6c087b3.cf6ea","type":"change","z":"c558fd3a.cad55","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":634,"y":1829,"wires":[["f10e8fa4.d8ad38"]]},{"id":"a22c6779.0145e","type":"debug","z":"c558fd3a.cad55","name":"","active":false,"console":"false","complete":"false","x":1446,"y":1842.5,"wires":[]},{"id":"bd478474.0aadd","type":"change","z":"659a812a.2160a","name":"Set Open-1","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":614,"y":279,"wires":[["5b8e3ac6.83d404"]]},{"id":"d98d29c2.0ac4d","type":"change","z":"659a812a.2160a","name":"Set Close-0","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":614,"y":319,"wires":[["5b8e3ac6.83d404"]]},{"id":"162e208e.a9cad7","type":"change","z":"659a812a.2160a","name":"Set Open-1","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":606,"y":470,"wires":[["3cca7bf0.dbfad4"]]},{"id":"5ad96288.9176fc","type":"change","z":"659a812a.2160a","name":"Set Close-0","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":605,"y":506,"wires":[["3cca7bf0.dbfad4"]]},{"id":"3d4425a7.3752f2","type":"change","z":"659a812a.2160a","name":"Set Open-1","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":601,"y":640,"wires":[["63e4ca9b.848ccc"]]},{"id":"1fc44a70.929c8e","type":"change","z":"659a812a.2160a","name":"Set Close-0","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":601,"y":680,"wires":[["63e4ca9b.848ccc"]]},{"id":"11736880.f20c77","type":"change","z":"659a812a.2160a","name":"Set Open-on","rules":[{"t":"set","p":"payload","pt":"msg","to":"ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":588,"y":840,"wires":[["53622784.bda7f"]]},{"id":"ba7a0902.a11138","type":"change","z":"659a812a.2160a","name":"Set Close-off","rules":[{"t":"set","p":"payload","pt":"msg","to":"OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":588,"y":880,"wires":[["53622784.bda7f"]]},{"id":"e9ca42c1.fd7ce","type":"change","z":"659a812a.2160a","name":"Set Open-1","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":606,"y":1020,"wires":[["73f435f6.a1089c"]]},{"id":"b242aae2.2b60f8","type":"change","z":"659a812a.2160a","name":"Set Close-0","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":606,"y":1060,"wires":[["73f435f6.a1089c"]]},{"id":"2501637e.117b9c","type":"function","z":"659a812a.2160a","name":"Battery","func":"msg.payload = msg.payload.data.voltage\n\nmax_volt = 3300;\nmin_volt = 2600;\nvoltage = msg.payload;\npercent = ((voltage - min_volt) / (max_volt - min_volt)) * 100;\npercent = percent.toPrecision(2);\nmsg.payload = percent;\n\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":535,"y":1606,"wires":[["9c76223b.697728"]]},{"id":"e0a378a2.c36658","type":"function","z":"659a812a.2160a","name":"Battery","func":"msg.payload = msg.payload.data.voltage\n\nmax_volt = 3300;\nmin_volt = 2600;\nvoltage = msg.payload;\npercent = ((voltage - min_volt) / (max_volt - min_volt)) * 100;\npercent = percent.toPrecision(2);\nmsg.payload = percent;\n\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":565,"y":1962,"wires":[["32bf657e.44d7e2"]]},{"id":"f9c2a3dc.8a7cc","type":"function","z":"659a812a.2160a","name":"Battery","func":"msg.payload = msg.payload.data.voltage\n\nmax_volt = 3300;\nmin_volt = 2600;\nvoltage = msg.payload;\npercent = ((voltage - min_volt) / (max_volt - min_volt)) * 100;\npercent = percent.toPrecision(2);\nmsg.payload = percent;\n\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":569,"y":2302,"wires":[["cfa6ce2b.6f58a8"]]},{"id":"c6c72e2a.414f78","type":"function","z":"659a812a.2160a","name":"Battery","func":"msg.payload = msg.payload.data.voltage\n\nmax_volt = 3300;\nmin_volt = 2600;\nvoltage = msg.payload;\npercent = ((voltage - min_volt) / (max_volt - min_volt)) * 100;\npercent = percent.toPrecision(2);\nmsg.payload = percent;\n\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":597,"y":547,"wires":[["10e972ef.364ead"]]},{"id":"d04440bf.3efe4","type":"function","z":"659a812a.2160a","name":"Battery","func":"msg.payload = msg.payload.data.voltage\n\nmax_volt = 3300;\nmin_volt = 2600;\nvoltage = msg.payload;\npercent = ((voltage - min_volt) / (max_volt - min_volt)) * 100;\npercent = percent.toPrecision(2);\nmsg.payload = percent;\n\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":591,"y":723,"wires":[["1b65cc0b.34b64c"]]},{"id":"565c4288.1b28a4","type":"function","z":"659a812a.2160a","name":"Battery","func":"msg.payload = msg.payload.data.voltage\n\nmax_volt = 3300;\nmin_volt = 2600;\nvoltage = msg.payload;\npercent = ((voltage - min_volt) / (max_volt - min_volt)) * 100;\npercent = percent.toPrecision(2);\nmsg.payload = percent;\n\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":575,"y":921,"wires":[["8897154c.28ec1"]]},{"id":"e6fceaa8.3557d","type":"comment","z":"c5a9ff80.1cad58","name":"Elastich Search écriture de données des batteries des sondes","info":"","x":692,"y":36,"wires":[]},{"id":"551c0663.51f9c8","type":"comment","z":"c5a9ff80.1cad58","name":"Batterie fumée palier 2 ES index sondeBatterie","info":"","x":200,"y":100,"wires":[]},{"id":"425d8306.eb144c","type":"mqtt in","z":"c5a9ff80.1cad58","name":"Palier/XIAOMI/Smoke/Battery","topic":"Palier/XIAOMI/Smoke/Battery","qos":"2","broker":"9c9224ce.733908","x":142,"y":144,"wires":[["278eefdb.fa073"]]},{"id":"1dc6314a.2eac6f","type":"json","z":"c5a9ff80.1cad58","name":"","x":741,"y":187,"wires":[["df712863.7818d"]]},{"id":"df712863.7818d","type":"http request","z":"c5a9ff80.1cad58","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondebatterie/sonde/{{{msg.payload}}}","tls":"","x":880,"y":187,"wires":[["61b28b33.7ca93c"]]},{"id":"61b28b33.7ca93c","type":"debug","z":"c5a9ff80.1cad58","name":"","active":false,"console":"false","complete":"false","x":1039,"y":186.5,"wires":[]},{"id":"b2f1eb5f.d73018","type":"function","z":"c5a9ff80.1cad58","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"SmokePalier\\\", \\\"battery\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":592,"y":187,"wires":[["1dc6314a.2eac6f"]]},{"id":"29213fa5.3489","type":"comment","z":"c5a9ff80.1cad58","name":"Batterie fumée couloir 2 ES index sondeBatterie","info":"","x":200,"y":306,"wires":[]},{"id":"6647014a.df4188","type":"mqtt in","z":"c5a9ff80.1cad58","name":"Couloir/XIAOMI/Smoke/Battery","topic":"Couloir/XIAOMI/Smoke/Battery","qos":"2","broker":"9c9224ce.733908","x":142,"y":352,"wires":[["e9b1b7f6.c5fea"]]},{"id":"e22e4643.ea29f8","type":"json","z":"c5a9ff80.1cad58","name":"","x":725,"y":411,"wires":[["587c034f.36d5a4"]]},{"id":"587c034f.36d5a4","type":"http request","z":"c5a9ff80.1cad58","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondebatterie/sonde/{{{msg.payload}}}","tls":"","x":861,"y":411,"wires":[["344f529a.501bb6"]]},{"id":"344f529a.501bb6","type":"debug","z":"c5a9ff80.1cad58","name":"","active":false,"console":"false","complete":"false","x":1017,"y":410.5,"wires":[]},{"id":"b253ecaa.5c7e48","type":"function","z":"c5a9ff80.1cad58","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"SmokeCouloir\\\", \\\"battery\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":577,"y":411,"wires":[["e22e4643.ea29f8"]]},{"id":"bba4f812.66b1c8","type":"inject","z":"c5a9ff80.1cad58","name":"","topic":"Test ES Write","payload":"100","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":168,"y":193,"wires":[["278eefdb.fa073"]]},{"id":"3efc8c6c.1d7fbc","type":"inject","z":"c5a9ff80.1cad58","name":"","topic":"Test ES Write","payload":"100","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":170,"y":404,"wires":[["e9b1b7f6.c5fea"]]},{"id":"6afa558f.966904","type":"delay","z":"c5a9ff80.1cad58","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"5","nbRateUnits":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":585,"y":142,"wires":[["b2f1eb5f.d73018"]]},{"id":"ea278008.e13478","type":"delay","z":"c5a9ff80.1cad58","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"5","nbRateUnits":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":566,"y":360,"wires":[["b253ecaa.5c7e48"]]},{"id":"8e014d6f.7639c8","type":"comment","z":"c5a9ff80.1cad58","name":"No change","info":"","x":406,"y":136,"wires":[]},{"id":"278eefdb.fa073","type":"function","z":"c5a9ff80.1cad58","name":"Has value Changed?","func":"context.lastvaluesmokepalierbattery = context.lastvaluesmokepalierbattery || 'initial';\nvar currentvaluesmokepalierbattery = msg.payload;\n\nif (context.lastvaluesmokepalierbattery == currentvaluesmokepalierbattery) \n{\n    context.lastvaluesmokepalierbattery = currentvaluesmokepalierbattery;\n    msg.payload = currentvaluesmokepalierbattery;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvaluesmokepalierbattery != currentvaluesmokepalierbattery) \n{\n    msg.payload = currentvaluesmokepalierbattery;\n    context.lastvaluesmokepalierbattery = currentvaluesmokepalierbattery;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvaluesmokepalierbattery});","outputs":2,"noerr":0,"x":382,"y":170,"wires":[["6afa558f.966904"],["b2f1eb5f.d73018"]]},{"id":"5045b651.0a8208","type":"comment","z":"c5a9ff80.1cad58","name":"Change","info":"","x":420,"y":209,"wires":[]},{"id":"74d45d0e.41b24c","type":"comment","z":"c5a9ff80.1cad58","name":"No change","info":"","x":394,"y":344,"wires":[]},{"id":"e9b1b7f6.c5fea","type":"function","z":"c5a9ff80.1cad58","name":"Has value Changed?","func":"context.lastvaluesmokecouloirbattery = context.lastvaluesmokecouloirbattery || 'initial';\nvar currentvaluesmokecouloirbattery = msg.payload;\n\nif (context.lastvaluesmokecouloirbattery == currentvaluesmokecouloirbattery) \n{\n    context.lastvaluesmokecouloirbattery = currentvaluesmokecouloirbattery;\n    msg.payload = currentvaluesmokecouloirbattery;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvaluesmokecouloirbattery != currentvaluesmokecouloirbattery) \n{\n    msg.payload = currentvaluesmokecouloirbattery;\n    context.lastvaluesmokecouloirbattery = currentvaluesmokecouloirbattery;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvaluesmokecouloirbattery});","outputs":2,"noerr":0,"x":380,"y":381,"wires":[["ea278008.e13478"],["b253ecaa.5c7e48"]]},{"id":"f990ae0f.a4e568","type":"comment","z":"c5a9ff80.1cad58","name":"Change","info":"","x":400,"y":419,"wires":[]},{"id":"a728fa9.685cb08","type":"comment","z":"c5a9ff80.1cad58","name":"Batterie Capteurs ouverture porte cuisine baie sud  2 ES index sondeBatterie","info":"","x":290,"y":534,"wires":[]},{"id":"d7295690.666c5","type":"mqtt in","z":"c5a9ff80.1cad58","name":"Cuisine-baie-sud/XIAOMI/Battery","topic":"Cuisine-baie-sud/XIAOMI/Battery","qos":"2","broker":"9c9224ce.733908","x":150,"y":582,"wires":[["1119042e.6c64d4"]]},{"id":"2806bd46.f836ca","type":"json","z":"c5a9ff80.1cad58","name":"","x":734,"y":641,"wires":[["8a981144.24a92"]]},{"id":"8a981144.24a92","type":"http request","z":"c5a9ff80.1cad58","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondebatterie/sonde/{{{msg.payload}}}","tls":"","x":870,"y":641,"wires":[["67fef248.2c512c"]]},{"id":"67fef248.2c512c","type":"debug","z":"c5a9ff80.1cad58","name":"","active":false,"console":"false","complete":"false","x":1027,"y":640.5,"wires":[]},{"id":"7f6c967b.1e09d","type":"function","z":"c5a9ff80.1cad58","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"CuisineBaieSud\\\", \\\"battery\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":588,"y":641,"wires":[["2806bd46.f836ca"]]},{"id":"faf2baf7.11f61","type":"inject","z":"c5a9ff80.1cad58","name":"","topic":"Test ES Write","payload":"69","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":171,"y":634,"wires":[["1119042e.6c64d4"]]},{"id":"3bcab901.a14446","type":"delay","z":"c5a9ff80.1cad58","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"5","nbRateUnits":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":577,"y":590,"wires":[["7f6c967b.1e09d"]]},{"id":"cc8e41e8.3ab1d","type":"comment","z":"c5a9ff80.1cad58","name":"No change","info":"","x":413,"y":574,"wires":[]},{"id":"1119042e.6c64d4","type":"function","z":"c5a9ff80.1cad58","name":"Has value Changed?","func":"context.lastvalueCuisineBaieSudbattery = context.lastvalueCuisineBaieSudbattery || 'initial';\nvar currentvalueCuisineBaieSudbattery = msg.payload;\n\nif (context.lastvalueCuisineBaieSudbattery == currentvalueCuisineBaieSudbattery) \n{\n    context.lastvalueCuisineBaieSudbattery = currentvalueCuisineBaieSudbattery;\n    msg.payload = currentvalueCuisineBaieSudbattery;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvalueCuisineBaieSudbattery != currentvalueCuisineBaieSudbattery) \n{\n    msg.payload = currentvalueCuisineBaieSudbattery;\n    context.lastvalueCuisineBaieSudbattery = currentvalueCuisineBaieSudbattery;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvalueCuisineBaieSudbattery});","outputs":2,"noerr":0,"x":390,"y":611,"wires":[["3bcab901.a14446"],["7f6c967b.1e09d"]]},{"id":"669a680d.26ef68","type":"comment","z":"c5a9ff80.1cad58","name":"Change","info":"","x":423,"y":649,"wires":[]},{"id":"6b6db65e.15c89","type":"comment","z":"c5a9ff80.1cad58","name":"Batterie Capteurs ouverture porte véranda baie est  2 ES index sondeBatterie","info":"","x":290,"y":720,"wires":[]},{"id":"fa8d134e.f00ca8","type":"mqtt in","z":"c5a9ff80.1cad58","name":"Veranda-baie-est/XIAOMI/Battery","topic":"Veranda-baie-est/XIAOMI/Battery","qos":"2","broker":"9c9224ce.733908","x":150,"y":768,"wires":[["3acbd25e.7f6a56"]]},{"id":"5f4596a7.5bd34","type":"json","z":"c5a9ff80.1cad58","name":"","x":734,"y":827,"wires":[["adb3231e.6e8aa8"]]},{"id":"adb3231e.6e8aa8","type":"http request","z":"c5a9ff80.1cad58","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondebatterie/sonde/{{{msg.payload}}}","tls":"","x":870,"y":827,"wires":[["41f58994.ee512"]]},{"id":"41f58994.ee512","type":"debug","z":"c5a9ff80.1cad58","name":"","active":false,"console":"false","complete":"false","x":1027,"y":826.5,"wires":[]},{"id":"1d0fa897.e00be7","type":"function","z":"c5a9ff80.1cad58","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"VerandaBaieEst\\\", \\\"battery\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":588,"y":827,"wires":[["5f4596a7.5bd34"]]},{"id":"1119fcf5.b17d9b","type":"inject","z":"c5a9ff80.1cad58","name":"","topic":"Test ES Write","payload":"68","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":171,"y":820,"wires":[["3acbd25e.7f6a56"]]},{"id":"c014c9ab.b7866","type":"delay","z":"c5a9ff80.1cad58","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"5","nbRateUnits":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":577,"y":776,"wires":[["1d0fa897.e00be7"]]},{"id":"310b85fa.021522","type":"comment","z":"c5a9ff80.1cad58","name":"No change","info":"","x":413,"y":760,"wires":[]},{"id":"3acbd25e.7f6a56","type":"function","z":"c5a9ff80.1cad58","name":"Has value Changed?","func":"context.lastvalueVerandaBaieEstbattery = context.lastvalueVerandaBaieEstbattery || 'initial';\nvar currentvalueVerandaBaieEstbattery = msg.payload;\n\nif (context.lastvalueVerandaBaieEstbattery == currentvalueVerandaBaieEstbattery) \n{\n    context.lastvalueVerandaBaieEstbattery = currentvalueVerandaBaieEstbattery;\n    msg.payload = currentvalueVerandaBaieEstbattery;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvalueVerandaBaieEstbattery != currentvalueVerandaBaieEstbattery) \n{\n    msg.payload = currentvalueVerandaBaieEstbattery;\n    context.lastvalueVerandaBaieEstbattery = currentvalueVerandaBaieEstbattery;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvalueVerandaBaieEstbattery});","outputs":2,"noerr":0,"x":390,"y":797,"wires":[["c014c9ab.b7866"],["1d0fa897.e00be7"]]},{"id":"817588b.1b40378","type":"comment","z":"c5a9ff80.1cad58","name":"Change","info":"","x":423,"y":835,"wires":[]},{"id":"7d42b7f3.00d418","type":"comment","z":"c5a9ff80.1cad58","name":"Batterie Capteurs ouverture porte véranda baie sud  2 ES index sondeBatterie","info":"","x":290,"y":917,"wires":[]},{"id":"393347b5.3c1948","type":"mqtt in","z":"c5a9ff80.1cad58","name":"Veranda-baie-sud/XIAOMI/Battery","topic":"Veranda-baie-sud/XIAOMI/Battery","qos":"2","broker":"9c9224ce.733908","x":160,"y":965,"wires":[["2625aab5.7349fe"]]},{"id":"b3fced32.c9f26","type":"json","z":"c5a9ff80.1cad58","name":"","x":755,"y":1024,"wires":[["d8662cb9.b20508"]]},{"id":"d8662cb9.b20508","type":"http request","z":"c5a9ff80.1cad58","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondebatterie/sonde/{{{msg.payload}}}","tls":"","x":891,"y":1024,"wires":[["ce258205.f18a9"]]},{"id":"ce258205.f18a9","type":"debug","z":"c5a9ff80.1cad58","name":"","active":false,"console":"false","complete":"false","x":1048,"y":1023.5,"wires":[]},{"id":"5d54738c.10e43c","type":"function","z":"c5a9ff80.1cad58","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"VerandaBaieSud\\\", \\\"battery\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":609,"y":1024,"wires":[["b3fced32.c9f26"]]},{"id":"91340fd8.a32ff","type":"inject","z":"c5a9ff80.1cad58","name":"","topic":"Test ES Write","payload":"70","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":189,"y":1017,"wires":[["2625aab5.7349fe"]]},{"id":"6c65556a.c7c07c","type":"delay","z":"c5a9ff80.1cad58","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"5","nbRateUnits":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":598,"y":973,"wires":[["5d54738c.10e43c"]]},{"id":"cc86905b.ecb998","type":"comment","z":"c5a9ff80.1cad58","name":"No change","info":"","x":434,"y":957,"wires":[]},{"id":"2625aab5.7349fe","type":"function","z":"c5a9ff80.1cad58","name":"Has value Changed?","func":"context.lastvalueVerandaBaieEstbattery = context.lastvalueVerandaBaieEstbattery || 'initial';\nvar currentvalueVerandaBaieEstbattery = msg.payload;\n\nif (context.lastvalueVerandaBaieEstbattery == currentvalueVerandaBaieEstbattery) \n{\n    context.lastvalueVerandaBaieEstbattery = currentvalueVerandaBaieEstbattery;\n    msg.payload = currentvalueVerandaBaieEstbattery;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvalueVerandaBaieEstbattery != currentvalueVerandaBaieEstbattery) \n{\n    msg.payload = currentvalueVerandaBaieEstbattery;\n    context.lastvalueVerandaBaieEstbattery = currentvalueVerandaBaieEstbattery;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvalueVerandaBaieEstbattery});","outputs":2,"noerr":0,"x":411,"y":994,"wires":[["6c65556a.c7c07c"],["5d54738c.10e43c"]]},{"id":"a922a4e7.c89648","type":"comment","z":"c5a9ff80.1cad58","name":"Change","info":"","x":444,"y":1032,"wires":[]},{"id":"dfc74999.caa8a","type":"comment","z":"c5a9ff80.1cad58","name":"Batterie Capteurs présence salon  2 ES index sondeBatterie","info":"","x":240,"y":1126,"wires":[]},{"id":"c0f6bf76.e5bc78","type":"mqtt in","z":"c5a9ff80.1cad58","name":"Salon/XIAOMI/Battery","topic":"Salon/XIAOMI/Battery","qos":"2","broker":"9c9224ce.733908","x":120,"y":1174,"wires":[["6c2ac19f.7b634"]]},{"id":"91ba1e89.73d2a","type":"json","z":"c5a9ff80.1cad58","name":"","x":686,"y":1232,"wires":[["5b80df08.a3af08"]]},{"id":"5b80df08.a3af08","type":"http request","z":"c5a9ff80.1cad58","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondebatterie/sonde/{{{msg.payload}}}","tls":"","x":822,"y":1232,"wires":[["943d3d28.f146c"]]},{"id":"943d3d28.f146c","type":"debug","z":"c5a9ff80.1cad58","name":"","active":false,"console":"false","complete":"false","x":979,"y":1231.5,"wires":[]},{"id":"cd396d91.43b4b8","type":"function","z":"c5a9ff80.1cad58","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"SalonPresence\\\", \\\"battery\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":540,"y":1232,"wires":[["91ba1e89.73d2a"]]},{"id":"a663533e.5acf5","type":"inject","z":"c5a9ff80.1cad58","name":"","topic":"Test ES Write","payload":"71","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":120,"y":1220,"wires":[["6c2ac19f.7b634"]]},{"id":"c1891e94.1b23f","type":"delay","z":"c5a9ff80.1cad58","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"5","nbRateUnits":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":529,"y":1181,"wires":[["cd396d91.43b4b8"]]},{"id":"79fde801.01b9d","type":"comment","z":"c5a9ff80.1cad58","name":"No change","info":"","x":365,"y":1165,"wires":[]},{"id":"6c2ac19f.7b634","type":"function","z":"c5a9ff80.1cad58","name":"Has value Changed?","func":"context.lastvalueVerandaBaieEstbattery = context.lastvalueVerandaBaieEstbattery || 'initial';\nvar currentvalueVerandaBaieEstbattery = msg.payload;\n\nif (context.lastvalueVerandaBaieEstbattery == currentvalueVerandaBaieEstbattery) \n{\n    context.lastvalueVerandaBaieEstbattery = currentvalueVerandaBaieEstbattery;\n    msg.payload = currentvalueVerandaBaieEstbattery;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvalueVerandaBaieEstbattery != currentvalueVerandaBaieEstbattery) \n{\n    msg.payload = currentvalueVerandaBaieEstbattery;\n    context.lastvalueVerandaBaieEstbattery = currentvalueVerandaBaieEstbattery;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvalueVerandaBaieEstbattery});","outputs":2,"noerr":0,"x":342,"y":1202,"wires":[["c1891e94.1b23f"],["cd396d91.43b4b8"]]},{"id":"f5893783.b26d","type":"comment","z":"c5a9ff80.1cad58","name":"Change","info":"","x":375,"y":1240,"wires":[]},{"id":"9a22278d.86c178","type":"comment","z":"c5a9ff80.1cad58","name":"Batterie Capteurs présence véranda 2 ES index sondeBatterie","info":"","x":250,"y":1320,"wires":[]},{"id":"7171bef6.60b79","type":"mqtt in","z":"c5a9ff80.1cad58","name":"Veranda/XIAOMI/Battery","topic":"Veranda/XIAOMI/Battery","qos":"2","broker":"9c9224ce.733908","x":130,"y":1368,"wires":[["fda411a2.324db"]]},{"id":"f13098ee.665fe8","type":"json","z":"c5a9ff80.1cad58","name":"","x":700,"y":1426,"wires":[["8cf6f36f.cf8748"]]},{"id":"8cf6f36f.cf8748","type":"http request","z":"c5a9ff80.1cad58","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondebatterie/sonde/{{{msg.payload}}}","tls":"","x":836,"y":1426,"wires":[["38fb473a.fe228"]]},{"id":"38fb473a.fe228","type":"debug","z":"c5a9ff80.1cad58","name":"","active":false,"console":"false","complete":"false","x":993,"y":1425.5,"wires":[]},{"id":"866463bf.790468","type":"function","z":"c5a9ff80.1cad58","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"VerandaPresence\\\", \\\"battery\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":554,"y":1426,"wires":[["f13098ee.665fe8"]]},{"id":"a8b88680.4ad92","type":"inject","z":"c5a9ff80.1cad58","name":"","topic":"Test ES Write","payload":"72","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":135,"y":1414,"wires":[["fda411a2.324db"]]},{"id":"4b73daf.6ebae24","type":"delay","z":"c5a9ff80.1cad58","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"5","nbRateUnits":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":543,"y":1375,"wires":[["866463bf.790468"]]},{"id":"1f9541a1.ebcdce","type":"comment","z":"c5a9ff80.1cad58","name":"No change","info":"","x":379,"y":1359,"wires":[]},{"id":"fda411a2.324db","type":"function","z":"c5a9ff80.1cad58","name":"Has value Changed?","func":"context.lastvalueVerandaBaieEstbattery = context.lastvalueVerandaBaieEstbattery || 'initial';\nvar currentvalueVerandaBaieEstbattery = msg.payload;\n\nif (context.lastvalueVerandaBaieEstbattery == currentvalueVerandaBaieEstbattery) \n{\n    context.lastvalueVerandaBaieEstbattery = currentvalueVerandaBaieEstbattery;\n    msg.payload = currentvalueVerandaBaieEstbattery;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvalueVerandaBaieEstbattery != currentvalueVerandaBaieEstbattery) \n{\n    msg.payload = currentvalueVerandaBaieEstbattery;\n    context.lastvalueVerandaBaieEstbattery = currentvalueVerandaBaieEstbattery;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvalueVerandaBaieEstbattery});","outputs":2,"noerr":0,"x":356,"y":1396,"wires":[["4b73daf.6ebae24"],["866463bf.790468"]]},{"id":"11972e3d.e200a2","type":"comment","z":"c5a9ff80.1cad58","name":"Change","info":"","x":389,"y":1434,"wires":[]},{"id":"211ca015.526c88","type":"comment","z":"c5a9ff80.1cad58","name":"Batterie Capteurs présence cuisine 2 ES index sondeBatterie","info":"","x":240,"y":1520,"wires":[]},{"id":"af0b84af.c766d","type":"mqtt in","z":"c5a9ff80.1cad58","name":"Cuisine/XIAOMI/Battery","topic":"Cuisine/XIAOMI/Battery","qos":"2","broker":"9c9224ce.733908","x":120,"y":1568,"wires":[["2fd9e53d.aeddca"]]},{"id":"a5130a59.2e4ba","type":"json","z":"c5a9ff80.1cad58","name":"","x":700,"y":1626,"wires":[["e39ee228.403d7"]]},{"id":"e39ee228.403d7","type":"http request","z":"c5a9ff80.1cad58","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondebatterie/sonde/{{{msg.payload}}}","tls":"","x":836,"y":1626,"wires":[["50cbedc7.3e7a7c"]]},{"id":"50cbedc7.3e7a7c","type":"debug","z":"c5a9ff80.1cad58","name":"","active":false,"console":"false","complete":"false","x":993,"y":1625.5,"wires":[]},{"id":"99a0c7a3.5e9288","type":"function","z":"c5a9ff80.1cad58","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"CuisinePresence\\\", \\\"battery\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":554,"y":1626,"wires":[["a5130a59.2e4ba"]]},{"id":"331ce59c.55f1e2","type":"inject","z":"c5a9ff80.1cad58","name":"","topic":"Test ES Write","payload":"73","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":121,"y":1614,"wires":[["2fd9e53d.aeddca"]]},{"id":"a994e1d2.3fb7d8","type":"delay","z":"c5a9ff80.1cad58","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"5","nbRateUnits":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":543,"y":1575,"wires":[["99a0c7a3.5e9288"]]},{"id":"43f0e374.6c0354","type":"comment","z":"c5a9ff80.1cad58","name":"No change","info":"","x":379,"y":1559,"wires":[]},{"id":"2fd9e53d.aeddca","type":"function","z":"c5a9ff80.1cad58","name":"Has value Changed?","func":"context.lastvalueVerandaBaieEstbattery = context.lastvalueVerandaBaieEstbattery || 'initial';\nvar currentvalueVerandaBaieEstbattery = msg.payload;\n\nif (context.lastvalueVerandaBaieEstbattery == currentvalueVerandaBaieEstbattery) \n{\n    context.lastvalueVerandaBaieEstbattery = currentvalueVerandaBaieEstbattery;\n    msg.payload = currentvalueVerandaBaieEstbattery;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvalueVerandaBaieEstbattery != currentvalueVerandaBaieEstbattery) \n{\n    msg.payload = currentvalueVerandaBaieEstbattery;\n    context.lastvalueVerandaBaieEstbattery = currentvalueVerandaBaieEstbattery;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvalueVerandaBaieEstbattery});","outputs":2,"noerr":0,"x":356,"y":1596,"wires":[["a994e1d2.3fb7d8"],["99a0c7a3.5e9288"]]},{"id":"94a42334.0b3e28","type":"comment","z":"c5a9ff80.1cad58","name":"Change","info":"","x":389,"y":1634,"wires":[]},{"id":"2266d770.ead17","type":"comment","z":"c5a9ff80.1cad58","name":"Batterie Capteurs vibration véranda  2 ES index sondeBatterie","info":"","x":240,"y":1720,"wires":[]},{"id":"3488014b.5d8496","type":"mqtt in","z":"c5a9ff80.1cad58","name":"Veranda/XIAOMI/Vibration/Battery","topic":"Veranda/XIAOMI/Vibration/Battery","qos":"2","broker":"9c9224ce.733908","x":160,"y":1768,"wires":[["305b196b.7b9dd6"]]},{"id":"bcc1b812.47753","type":"json","z":"c5a9ff80.1cad58","name":"","x":757,"y":1826,"wires":[["4b0701e8.774b8"]]},{"id":"4b0701e8.774b8","type":"http request","z":"c5a9ff80.1cad58","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondebatterie/sonde/{{{msg.payload}}}","tls":"","x":893,"y":1826,"wires":[["886e33c9.9bc288"]]},{"id":"886e33c9.9bc288","type":"debug","z":"c5a9ff80.1cad58","name":"","active":false,"console":"false","complete":"false","x":1050,"y":1825.5,"wires":[]},{"id":"4c3d2d4b.26a2ec","type":"function","z":"c5a9ff80.1cad58","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"VerandaVibration\\\", \\\"battery\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":611,"y":1826,"wires":[["bcc1b812.47753"]]},{"id":"2ab5d1d5.2219fe","type":"inject","z":"c5a9ff80.1cad58","name":"","topic":"Test ES Write","payload":"74","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":216,"y":1814,"wires":[["305b196b.7b9dd6"]]},{"id":"444f7dc6.24a53c","type":"delay","z":"c5a9ff80.1cad58","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"5","nbRateUnits":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":600,"y":1775,"wires":[["4c3d2d4b.26a2ec"]]},{"id":"a88e9f20.963568","type":"comment","z":"c5a9ff80.1cad58","name":"No change","info":"","x":436,"y":1759,"wires":[]},{"id":"305b196b.7b9dd6","type":"function","z":"c5a9ff80.1cad58","name":"Has value Changed?","func":"context.lastvalueVerandaBaieEstbattery = context.lastvalueVerandaBaieEstbattery || 'initial';\nvar currentvalueVerandaBaieEstbattery = msg.payload;\n\nif (context.lastvalueVerandaBaieEstbattery == currentvalueVerandaBaieEstbattery) \n{\n    context.lastvalueVerandaBaieEstbattery = currentvalueVerandaBaieEstbattery;\n    msg.payload = currentvalueVerandaBaieEstbattery;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvalueVerandaBaieEstbattery != currentvalueVerandaBaieEstbattery) \n{\n    msg.payload = currentvalueVerandaBaieEstbattery;\n    context.lastvalueVerandaBaieEstbattery = currentvalueVerandaBaieEstbattery;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvalueVerandaBaieEstbattery});","outputs":2,"noerr":0,"x":413,"y":1796,"wires":[["444f7dc6.24a53c"],["4c3d2d4b.26a2ec"]]},{"id":"158ad5f3.018baa","type":"comment","z":"c5a9ff80.1cad58","name":"Change","info":"","x":446,"y":1834,"wires":[]},{"id":"f35ad162.7066e8","type":"comment","z":"c558fd3a.cad55","name":"Etat détecteur inondation cuisine 2 ES index sondeinondation","info":"","x":242,"y":2105,"wires":[]},{"id":"d4e6b6f5.bbe098","type":"json","z":"c558fd3a.cad55","name":"","x":1008,"y":2223,"wires":[["c2597e35.5f069"]]},{"id":"c2597e35.5f069","type":"http request","z":"c558fd3a.cad55","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondeinondation/sonde/{{{msg.payload}}}","tls":"","x":1144,"y":2223,"wires":[["9902ac83.a3903"]]},{"id":"9902ac83.a3903","type":"debug","z":"c558fd3a.cad55","name":"","active":false,"console":"false","complete":"false","x":1300,"y":2222.5,"wires":[]},{"id":"8ddcaf51.337cb","type":"function","z":"c558fd3a.cad55","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"CuisineInondation\\\", \\\"status\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":853,"y":2223,"wires":[["d4e6b6f5.bbe098"]]},{"id":"b67ee05f.0415d8","type":"inject","z":"c558fd3a.cad55","name":"","topic":"Test ES Write","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":442,"y":2258,"wires":[["5fb13ddb.fafd74"]]},{"id":"cfe789b9.9d8008","type":"delay","z":"c558fd3a.cad55","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"5","nbRateUnits":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":854,"y":2157,"wires":[["8ddcaf51.337cb"]]},{"id":"a01874f.a9acf88","type":"inject","z":"c558fd3a.cad55","name":"","topic":"Test ES Write","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":443,"y":2297,"wires":[["5fb13ddb.fafd74"]]},{"id":"5fb13ddb.fafd74","type":"function","z":"c558fd3a.cad55","name":"Has value Changed?","func":"context.lastvaluecuisineinondation = context.lastvaluecuisineinondation || 'initial';\nvar currentvaluecuisineinondation = msg.payload;\n\nif (context.lastvaluecuisineinondation == currentvaluecuisineinondation) \n{\n    context.lastvaluecuisineinondation = currentvaluecuisineinondation;\n    msg.payload = currentvaluecuisineinondation;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvaluecuisineinondation != currentvaluecuisineinondation) \n{\n    msg.payload = currentvaluecuisineinondation;\n    context.lastvaluecuisineinondation = currentvaluecuisineinondation;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvaluecuisineinondation});","outputs":2,"noerr":0,"x":659,"y":2185,"wires":[["cfe789b9.9d8008"],["8ddcaf51.337cb"]]},{"id":"9901eaaf.98f2b","type":"comment","z":"c558fd3a.cad55","name":"No change","info":"","x":679,"y":2148,"wires":[]},{"id":"4f8075ff.49351c","type":"comment","z":"c558fd3a.cad55","name":"Change","info":"","x":686,"y":2222,"wires":[]},{"id":"c1adab1f.5c3e28","type":"mqtt in","z":"c558fd3a.cad55","name":"Cuisine/XIAOMI/inondation","topic":"Cuisine/XIAOMI/inondation","qos":"2","broker":"9c9224ce.733908","x":119,"y":2186,"wires":[["41985fc8.7c677"]]},{"id":"72f2c137.420e4","type":"change","z":"c558fd3a.cad55","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":452,"y":2168,"wires":[["5fb13ddb.fafd74"]]},{"id":"41985fc8.7c677","type":"switch","z":"c558fd3a.cad55","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"leak","vt":"str"},{"t":"eq","v":"no_leak","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":298,"y":2186,"wires":[["72f2c137.420e4"],["35dfcc0e.5bf68c"]]},{"id":"35dfcc0e.5bf68c","type":"change","z":"c558fd3a.cad55","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":451,"y":2211,"wires":[["5fb13ddb.fafd74"]]},{"id":"19939d64.3226c3","type":"comment","z":"c558fd3a.cad55","name":"leak: 0","info":"","x":306,"y":2146,"wires":[]},{"id":"8a9bd4dd.de4fc8","type":"comment","z":"c558fd3a.cad55","name":"no leak: 1","info":"","x":296,"y":2227,"wires":[]},{"id":"a6e166a2.f8d208","type":"comment","z":"c558fd3a.cad55","name":"Etat détecteur inondation SDB 2 ES index sondeinondation","info":"","x":234,"y":2361,"wires":[]},{"id":"8d9c3d5b.48d56","type":"json","z":"c558fd3a.cad55","name":"","x":1047,"y":2478,"wires":[["534aa284.376adc"]]},{"id":"534aa284.376adc","type":"http request","z":"c558fd3a.cad55","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondeinondation/sonde/{{{msg.payload}}}","tls":"","x":1183,"y":2478,"wires":[["6219421a.78af84"]]},{"id":"5fb546ed.2514b8","type":"function","z":"c558fd3a.cad55","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"SalledebainInondation\\\", \\\"status\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":892,"y":2478,"wires":[["8d9c3d5b.48d56"]]},{"id":"c8aadef9.27f2b8","type":"inject","z":"c558fd3a.cad55","name":"","topic":"Test ES Write","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":481,"y":2513,"wires":[["dea601ba.06541"]]},{"id":"e090854e.0e469","type":"delay","z":"c558fd3a.cad55","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"5","nbRateUnits":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":893,"y":2412,"wires":[["5fb546ed.2514b8"]]},{"id":"9a1f4076.b85b7","type":"inject","z":"c558fd3a.cad55","name":"","topic":"Test ES Write","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":482,"y":2552,"wires":[["dea601ba.06541"]]},{"id":"dea601ba.06541","type":"function","z":"c558fd3a.cad55","name":"Has value Changed?","func":"context.lastvaluesdbinondation = context.lastvaluesdbinondation || 'initial';\nvar currentvaluesdbinondation = msg.payload;\n\nif (context.lastvaluesdbinondation == currentvaluesdbinondation) \n{\n    context.lastvaluesdbinondation = currentvaluesdbinondation;\n    msg.payload = currentvaluesdbinondation;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvaluesdbinondation != currentvaluesdbinondation) \n{\n    msg.payload = currentvaluesdbinondation;\n    context.lastvaluesdbinondation = currentvaluesdbinondation;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvaluesdbinondation});","outputs":2,"noerr":0,"x":698,"y":2440,"wires":[["e090854e.0e469"],["5fb546ed.2514b8"]]},{"id":"8d3429c7.1d639","type":"comment","z":"c558fd3a.cad55","name":"No change","info":"","x":718,"y":2403,"wires":[]},{"id":"1b37bd9a.3075ca","type":"comment","z":"c558fd3a.cad55","name":"Change","info":"","x":725,"y":2477,"wires":[]},{"id":"e96e62c6.358c38","type":"mqtt in","z":"c558fd3a.cad55","name":"Salledebain/XIAOMI/inondation","topic":"Salledebain/XIAOMI/inondation","qos":"2","broker":"9c9224ce.733908","x":139,"y":2441,"wires":[["4ec98dc8.56623c"]]},{"id":"94263365.b9a888","type":"change","z":"c558fd3a.cad55","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":491,"y":2423,"wires":[["dea601ba.06541"]]},{"id":"4ec98dc8.56623c","type":"switch","z":"c558fd3a.cad55","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"leak","vt":"str"},{"t":"eq","v":"no_leak","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":337,"y":2441,"wires":[["94263365.b9a888"],["a5c8a8c1.0d3c2"]]},{"id":"a5c8a8c1.0d3c2","type":"change","z":"c558fd3a.cad55","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":490,"y":2466,"wires":[["dea601ba.06541"]]},{"id":"34a87675.910c2a","type":"comment","z":"c558fd3a.cad55","name":"leak: 0","info":"","x":345,"y":2401,"wires":[]},{"id":"2edd05c8.a31eb2","type":"comment","z":"c558fd3a.cad55","name":"no leak: 1","info":"","x":335,"y":2482,"wires":[]},{"id":"6219421a.78af84","type":"debug","z":"c558fd3a.cad55","name":"","active":false,"console":"false","complete":"false","x":1339,"y":2477.5,"wires":[]},{"id":"1271b8b8.785727","type":"inject","z":"c558fd3a.cad55","name":"","topic":"Test ES Write","payload":"RISK","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":"","x":292,"y":2014,"wires":[["50727dca.08d124"]]},{"id":"831c1a4f.dbac9","type":"exec","z":"b6726fbf.d6c4f","command":"/usr/local/bin/mirobo --ip 192.168.1.36 --token 56464a35707930523162795137613848 carpet_mode","addpay":true,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"mirobo carpet_mode","x":351,"y":2439,"wires":[["2be853bb.68485c","dbf3a22.e55fe6"],[],[]]},{"id":"13b79c22.e3532c","type":"inject","z":"b6726fbf.d6c4f","name":"mode carpet true","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":153,"y":2418,"wires":[["831c1a4f.dbac9"]]},{"id":"4b1dc6a0.6895b","type":"comment","z":"b6726fbf.d6c4f","name":"Carpet mode","info":"","x":101,"y":2372,"wires":[]},{"id":"2be853bb.68485c","type":"debug","z":"b6726fbf.d6c4f","name":"","active":false,"console":"false","complete":"false","x":396,"y":2376,"wires":[]},{"id":"dbf3a22.e55fe6","type":"string","z":"b6726fbf.d6c4f","name":"Enable","methods":[{"name":"between","params":[{"type":"str","value":"mode: "},{"type":"str","value":"\\n"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":531,"y":2426,"wires":[["47a56424.d8837c"]]},{"id":"c728009b.11ca7","type":"ui_switch","z":"b6726fbf.d6c4f","name":"","label":"Mode tapis","group":"7a5b734b.cacc04","order":1,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":1017,"y":2427,"wires":[["857072ae.54df3"]]},{"id":"47a56424.d8837c","type":"switch","z":"b6726fbf.d6c4f","name":"carpet mode","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"},{"t":"eq","v":"False","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":682,"y":2425,"wires":[["c39a18d9.b7d62"],["ba39611.8a115a"]]},{"id":"c39a18d9.b7d62","type":"change","z":"b6726fbf.d6c4f","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":847,"y":2401,"wires":[["c728009b.11ca7"]]},{"id":"ba39611.8a115a","type":"change","z":"b6726fbf.d6c4f","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":848,"y":2452,"wires":[["c728009b.11ca7"]]},{"id":"b15bd652.d2b13","type":"comment","z":"b6726fbf.d6c4f","name":"true","info":"","x":811,"y":2365,"wires":[]},{"id":"6d7438fe.9292","type":"comment","z":"b6726fbf.d6c4f","name":"false","info":"","x":811,"y":2490,"wires":[]},{"id":"730944ad.47d24c","type":"inject","z":"b6726fbf.d6c4f","name":"mode carpet false","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":141,"y":2465,"wires":[["831c1a4f.dbac9"]]},{"id":"857072ae.54df3","type":"exec","z":"b6726fbf.d6c4f","command":"/usr/local/bin/mirobo --ip 192.168.1.36 --token 56464a35707930523162795137613848 carpet_mode","addpay":true,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"mirobo carpet_mode","x":1205,"y":2426,"wires":[[],[],[]]},{"id":"b9b9b8d5.f90aa","type":"exec","z":"b6726fbf.d6c4f","command":"/usr/local/bin/mirobo --ip 192.168.1.36 --token 56464a35707930523162795137613848 dnd","addpay":false,"append":"","useSpawn":"","timer":"","oldrc":false,"name":"mirobo dnd mode","x":285,"y":1668,"wires":[["6be0c288.170dd4"],[],[]]},{"id":"6be0c288.170dd4","type":"string","z":"b6726fbf.d6c4f","name":"Enable","methods":[{"name":"between","params":[{"type":"str","value":"enabled: "},{"type":"str","value":")"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":457,"y":1655,"wires":[["5137a850.42589","beae5003.d01708"]]},{"id":"5137a850.42589","type":"switch","z":"b6726fbf.d6c4f","name":"dnd mode","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"},{"t":"eq","v":"False","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":598,"y":1654,"wires":[["68138a7c.7b83e4"],["c9226ad.5f8e418"]]},{"id":"a2be7d78.16b798","type":"comment","z":"b6726fbf.d6c4f","name":"true","info":"","x":737,"y":1597,"wires":[]},{"id":"68138a7c.7b83e4","type":"change","z":"b6726fbf.d6c4f","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":759,"y":1634,"wires":[["f41858dc.4ea08"]]},{"id":"c9226ad.5f8e418","type":"change","z":"b6726fbf.d6c4f","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":1677,"wires":[["f41858dc.4ea08"]]},{"id":"60442636.86f15","type":"comment","z":"b6726fbf.d6c4f","name":"false","info":"","x":737,"y":1713,"wires":[]},{"id":"beae5003.d01708","type":"debug","z":"b6726fbf.d6c4f","name":"","active":false,"console":"false","complete":"false","x":504,"y":1611,"wires":[]},{"id":"c4c076bd.9c9f2","type":"inject","z":"b6726fbf.d6c4f","name":"mode dnd","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":"","x":101,"y":1668,"wires":[["b9b9b8d5.f90aa"]]},{"id":"f8482a53.74251","type":"inject","z":"97223981.e54958","name":"Every 24H","topic":"","payload":"","payloadType":"date","repeat":"86400","crontab":"","once":false,"onceDelay":"","x":110,"y":480,"wires":[["e66b8b8d.b626a"]]},{"id":"d2d008b3.395ca","type":"comment","z":"97223981.e54958","name":"Verification MAJ RancherOS","info":"","x":140,"y":440,"wires":[]},{"id":"e66b8b8d.b626a","type":"file in","z":"97223981.e54958","name":"ros.txt","filename":"/home/pi/versions-check/ros.txt","format":"utf8","sendError":true,"x":251,"y":480,"wires":[["a61f0f25.ccfda"]]},{"id":"a61f0f25.ccfda","type":"switch","z":"97223981.e54958","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"},{"t":"eq","v":"false","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":372,"y":480,"wires":[["e4020f30.a3b1b8"],["27688765.e24a08"]]},{"id":"486ae708.bbc2e","type":"comment","z":"97223981.e54958","name":"NewVersion : True","info":"","x":379,"y":440,"wires":[]},{"id":"3dddbfd7.051858","type":"comment","z":"97223981.e54958","name":"NewVersion :  False","info":"","x":367,"y":520,"wires":[]},{"id":"5739fcd7.223d2c","type":"e-mail","z":"97223981.e54958","server":"smtp.gmail.com","port":"465","secure":true,"name":"coyotte14@gmail.com","dname":"RancherOS Maj","x":680,"y":473,"wires":[]},{"id":"e4020f30.a3b1b8","type":"function","z":"97223981.e54958","name":"Mailformat","func":"var m=\"<table style='font-family:arial; font-size:14px'><tr><td style='color:blue'><b>RancherOS</b></td></tr>\";\n\nm+=\"<tr><td style='color:green'>\";\n  m+=\"RancherOS mise a jour disponible\";\n  m+=\"</td><tr>\";\n  m+=\"https://github.com/rancher/os/releases/\";\n  m+=\"</td></tr>\";  \nm+=\"</table>\";\nmsg.payload=m;\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":473,"wires":[["5739fcd7.223d2c","345ad1b2.b97c76"]]},{"id":"345ad1b2.b97c76","type":"debug","z":"97223981.e54958","name":"","active":true,"console":"false","complete":"false","x":670,"y":434,"wires":[]},{"id":"27688765.e24a08","type":"debug","z":"97223981.e54958","name":"","active":false,"console":"false","complete":"false","x":550,"y":520,"wires":[]},{"id":"c98ff141.30f058","type":"function","z":"b882537d.e69738","name":"Global var MyTemperatureChambreParents","func":"context.global.MyTemperatureChambreParents=Math.trunc(msg.payload);\nmsg.payload = context.global.MyTemperatureChambreParents;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":931,"y":2927,"wires":[[]]},{"id":"8d970f37.c800b","type":"function","z":"b882537d.e69738","name":"Global var MyTemperatureChambreAnais","func":"context.global.MyTemperatureChambreAnais=Math.trunc(msg.payload);\nmsg.payload = context.global.MyTemperatureChambreAnais;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":932,"y":3294,"wires":[[]]},{"id":"241d15cc.298cd2","type":"function","z":"b882537d.e69738","name":"Global var MyTemperatureChambreSarah","func":"context.global.MyTemperatureChambreSarah=Math.trunc(msg.payload);\nmsg.payload = context.global.MyTemperatureChambreSarah;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":920,"y":3652,"wires":[[]]},{"id":"b23a888f.dee4b","type":"http request","z":"417d6ad8.4260bc","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/my_sonde/sonde/{{{msg.payload}}}","tls":"","x":980,"y":680,"wires":[["b6843a9b.26f0d"]]},{"id":"b6843a9b.26f0d","type":"debug","z":"417d6ad8.4260bc","name":"","active":false,"console":"false","complete":"false","x":1140,"y":679.5,"wires":[]},{"id":"4c2e26f6.2141f8","type":"function","z":"417d6ad8.4260bc","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmyTemp = context.global.MyTemperatureVeranda;\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"T-Veranda\\\", \\\"My-Temperature\\\":\" + myTemp +  \",\\\"My-Humidity\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":697,"y":680,"wires":[["72057c20.86be6c"]]},{"id":"f8bb94a2.970ea","type":"comment","z":"417d6ad8.4260bc","name":"Véranda : T° + Hum ES write","info":"","x":161,"y":633,"wires":[]},{"id":"72057c20.86be6c","type":"json","z":"417d6ad8.4260bc","name":"","x":844.5,"y":681,"wires":[["b23a888f.dee4b"]]},{"id":"464e9be1.091124","type":"delay","z":"417d6ad8.4260bc","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"10","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":518,"y":680,"wires":[["4c2e26f6.2141f8"]]},{"id":"c3c21798.3c9dc8","type":"mqtt in","z":"417d6ad8.4260bc","name":"Veranda/RFX/Humidity","topic":"Veranda/RFX/Humidity","qos":"2","broker":"9c9224ce.733908","x":134,"y":680,"wires":[["ac9495ba.ad8d88"]]},{"id":"8ca4729e.abf63","type":"comment","z":"417d6ad8.4260bc","name":"Rez-de-chaussée:  T° + Hum ES write","info":"Ecriture 1 message toutes les 10mn\nLes sondes envoient 1 message toutes les 30s","x":189,"y":477,"wires":[]},{"id":"df0e98ab.96258","type":"function","z":"417d6ad8.4260bc","name":"T° RDC ES write","func":"d=new Date();\nmadate=d.toJSON()\nmyTemp = context.global.MyTemperatureRDC;\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"T-RDC\\\", \\\"My-Temperature\\\":\" + myTemp +  \",\\\"My-Humidity\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":695,"y":515,"wires":[["c64849a1.789228"]]},{"id":"c64849a1.789228","type":"json","z":"417d6ad8.4260bc","name":"","x":853,"y":515,"wires":[["e3b643aa.26bf58"]]},{"id":"e3b643aa.26bf58","type":"http request","z":"417d6ad8.4260bc","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/my_sonde/sonde/{{{msg.payload}}}","tls":"","x":991,"y":515,"wires":[["8cd1871e.ec397"]]},{"id":"8cd1871e.ec397","type":"debug","z":"417d6ad8.4260bc","name":"","active":false,"console":"false","complete":"false","x":1148,"y":514.5,"wires":[]},{"id":"ff695f79.da6f7","type":"inject","z":"417d6ad8.4260bc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":525,"y":555,"wires":[["df0e98ab.96258"]]},{"id":"e0c72df6.af1e08","type":"delay","z":"417d6ad8.4260bc","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"15","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":505,"y":516,"wires":[["df0e98ab.96258"]]},{"id":"1d0303b8.69ba44","type":"mqtt in","z":"417d6ad8.4260bc","name":"Salon/RFX/Humidity","topic":"Salon/RFX/Humidity","qos":"2","broker":"9c9224ce.733908","x":126,"y":516,"wires":[["69e7a779.b6c4d8"]]},{"id":"3ea1001e.0051c8","type":"comment","z":"417d6ad8.4260bc","name":"Extérieur : T° + Hum ES write","info":"Ecriture 1 message toutes les 10mn\nLes sondes envoient 1 message toutes les 30s","x":159,"y":69,"wires":[]},{"id":"c5f39eb2.cbd278","type":"function","z":"417d6ad8.4260bc","name":"T° Ext ES write","func":"d=new Date();\nmadate=d.toJSON()\nmyTemp = context.global.MyTemperatureExt;\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"T-Extérieur\\\", \\\"My-Temperature\\\":\" + myTemp +  \",\\\"My-Humidity\\\":\" + msg.payload + \"}\";\n\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":109,"wires":[["70eb5e2c.1fe09"]]},{"id":"70eb5e2c.1fe09","type":"json","z":"417d6ad8.4260bc","name":"","x":851,"y":109,"wires":[["79cc9da.c7a0e64"]]},{"id":"79cc9da.c7a0e64","type":"http request","z":"417d6ad8.4260bc","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/my_sonde/sonde/{{{msg.payload}}}","tls":"","x":987,"y":108,"wires":[["87e7e906.eae14"]]},{"id":"87e7e906.eae14","type":"debug","z":"417d6ad8.4260bc","name":"","active":false,"console":"false","complete":"false","x":1145,"y":107.5,"wires":[]},{"id":"9530da31.c8dab8","type":"delay","z":"417d6ad8.4260bc","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"10","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":523,"y":109,"wires":[["c5f39eb2.cbd278"]]},{"id":"8a69f414.9ec0a","type":"mqtt in","z":"417d6ad8.4260bc","name":"Exterieur/RFX/Humidity","topic":"Exterieur/RFX/Humidity","qos":"2","broker":"9c9224ce.733908","x":139,"y":109,"wires":[["7d898fac.27d76"]]},{"id":"d57294e.af32d68","type":"comment","z":"417d6ad8.4260bc","name":"Etage : T° + Hum ES write","info":"Ecriture 1 message toutes les 10mn\nLes sondes envoient 1 message toutes les 30s","x":149,"y":777,"wires":[]},{"id":"9546bfc8.c6d848","type":"function","z":"417d6ad8.4260bc","name":"T° Etage ES write","func":"d=new Date();\nmadate=d.toJSON()\nmyTemp = context.global.MyTemperatureEtage;\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"T-Etage\\\", \\\"My-Temperature\\\":\" + myTemp +  \",\\\"My-Humidity\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":816,"wires":[["edf1eaab.0b79a"]]},{"id":"edf1eaab.0b79a","type":"json","z":"417d6ad8.4260bc","name":"","x":865,"y":815,"wires":[["f76ae013.57aad"]]},{"id":"f76ae013.57aad","type":"http request","z":"417d6ad8.4260bc","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/my_sonde/sonde/{{{msg.payload}}}","tls":"","x":1001,"y":814,"wires":[["1a035e33.55de92"]]},{"id":"1a035e33.55de92","type":"debug","z":"417d6ad8.4260bc","name":"","active":false,"console":"false","complete":"false","x":1159,"y":813.5,"wires":[]},{"id":"bfa5e72.4033518","type":"inject","z":"417d6ad8.4260bc","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":540,"y":854,"wires":[["9546bfc8.c6d848"]]},{"id":"8db2f30.8a2f59","type":"delay","z":"417d6ad8.4260bc","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"15","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":522,"y":816,"wires":[["9546bfc8.c6d848"]]},{"id":"b1f5bacb.076308","type":"mqtt in","z":"417d6ad8.4260bc","name":"Salledebain/RFX/Humidity","topic":"Salledebain/RFX/Humidity","qos":"2","broker":"9c9224ce.733908","x":138,"y":817,"wires":[["abc65c89.6a7fe8"]]},{"id":"81361ca6.7c4e88","type":"comment","z":"417d6ad8.4260bc","name":"Elastich Search écriture de données de températures","info":"","x":539,"y":17,"wires":[]},{"id":"31902fb9.d6de5","type":"comment","z":"417d6ad8.4260bc","name":"Sous-sol : T° + Hum ES write","info":"Ecriture 1 message toutes les 10mn\nLes sondes envoient 1 message toutes les 30s","x":159,"y":194,"wires":[]},{"id":"df942e50.21bfa","type":"json","z":"417d6ad8.4260bc","name":"","x":891,"y":237,"wires":[["1242604a.2849"]]},{"id":"1242604a.2849","type":"http request","z":"417d6ad8.4260bc","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/my_sonde/sonde/{{{msg.payload}}}","tls":"","x":1028,"y":237,"wires":[["a1f39cb.525c66"]]},{"id":"a1f39cb.525c66","type":"debug","z":"417d6ad8.4260bc","name":"","active":false,"console":"false","complete":"false","x":1187,"y":236.5,"wires":[]},{"id":"e6069bd4.e2de78","type":"delay","z":"417d6ad8.4260bc","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"15","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":520,"y":237,"wires":[["fea3af57.c9eb28"]]},{"id":"300da508.f860aa","type":"json","z":"417d6ad8.4260bc","name":"","x":853,"y":360,"wires":[["e3ff8232.852078"]]},{"id":"e3ff8232.852078","type":"http request","z":"417d6ad8.4260bc","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/my_sonde/sonde/{{{msg.payload}}}","tls":"","x":990,"y":360,"wires":[["3a8004e9.33ec7c"]]},{"id":"3a8004e9.33ec7c","type":"debug","z":"417d6ad8.4260bc","name":"","active":false,"console":"false","complete":"false","x":1148,"y":359.5,"wires":[]},{"id":"a701927e.a7ef98","type":"delay","z":"417d6ad8.4260bc","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"15","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":506,"y":360,"wires":[["68e608f0.5649e8"]]},{"id":"7e9aafd6.cd6e5","type":"mqtt in","z":"417d6ad8.4260bc","name":"Billard/DHT/Humidity","topic":"Billard/DHT/Humidity","qos":"2","broker":"9c9224ce.733908","x":131,"y":360,"wires":[["e9f14114.ac176"]]},{"id":"90b1ddfe.70f17","type":"comment","z":"417d6ad8.4260bc","name":"Billard: T° + Hum ES write","info":"Ecriture 1 message toutes les 10mn\nLes sondes envoient 1 message toutes les 30s","x":150,"y":317,"wires":[]},{"id":"fd31de59.333a98","type":"mqtt in","z":"417d6ad8.4260bc","name":"Sous-sol/DHT/Humidity","topic":"Sous-sol/DHT/Humidity","qos":"2","broker":"9c9224ce.733908","x":139,"y":237,"wires":[["d1238f34.bf7588"]]},{"id":"68e608f0.5649e8","type":"function","z":"417d6ad8.4260bc","name":"T° Billard ES write","func":"d=new Date();\nmadate=d.toJSON()\nmyTemp = context.global.MyTemperatureBillard;\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"T-Billard\\\", \\\"My-Temperature\\\":\" + myTemp +  \",\\\"My-Humidity\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":693,"y":360,"wires":[["300da508.f860aa"]]},{"id":"fea3af57.c9eb28","type":"function","z":"417d6ad8.4260bc","name":"T° SousSol ES write","func":"d=new Date();\nmadate=d.toJSON()\nmyTemp = context.global.MyTemperatureSouSol;\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"T-SousSol\\\", \\\"My-Temperature\\\":\" + myTemp +  \",\\\"My-Humidity\\\":\" + msg.payload + \"}\";\n\nreturn msg;","outputs":1,"noerr":0,"x":719,"y":237,"wires":[["df942e50.21bfa"]]},{"id":"8e1fbe9.8e02fc","type":"http request","z":"417d6ad8.4260bc","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/my_sonde/sonde/{{{msg.payload}}}","tls":"","x":990,"y":977,"wires":[["7352e04b.9f3238"]]},{"id":"7352e04b.9f3238","type":"debug","z":"417d6ad8.4260bc","name":"","active":false,"console":"false","complete":"false","x":1148,"y":976.5,"wires":[]},{"id":"a0b35ccd.2e33","type":"function","z":"417d6ad8.4260bc","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmyTemp = context.global.MyTemperatureBureau;\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"T-Bureau\\\", \\\"My-Temperature\\\":\" + myTemp +  \",\\\"My-Humidity\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":701,"y":977,"wires":[["64decb21.9256b4"]]},{"id":"bbff438a.80c1d8","type":"comment","z":"417d6ad8.4260bc","name":"Bureau :T° + Hum  ES write   : désactivé","info":"","x":193,"y":937,"wires":[]},{"id":"64decb21.9256b4","type":"json","z":"417d6ad8.4260bc","name":"","x":853.5,"y":977,"wires":[["8e1fbe9.8e02fc"]]},{"id":"6bffdaec.70babc","type":"delay","z":"417d6ad8.4260bc","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"15","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":521,"y":977,"wires":[["a0b35ccd.2e33"]]},{"id":"99bba456.0a71d8","type":"mqtt in","z":"417d6ad8.4260bc","name":"Bureau/RFX/Humidity","topic":"Bureau/RFX/Humidity","qos":"2","broker":"9c9224ce.733908","x":139,"y":977,"wires":[["93fd1de.27069e"]]},{"id":"a310045c.792908","type":"comment","z":"c558fd3a.cad55","name":"Elastich Search écriture de données de sondes diverses","info":"","x":430,"y":20,"wires":[]},{"id":"76c2f2bb.404084","type":"http request","z":"417d6ad8.4260bc","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/my_sonde/sonde/{{{msg.payload}}}","tls":"","x":870,"y":1760,"wires":[["a68fbe19.d470f"]]},{"id":"a68fbe19.d470f","type":"debug","z":"417d6ad8.4260bc","name":"","active":false,"console":"false","complete":"false","x":1028,"y":1759.5,"wires":[]},{"id":"8d1b543e.5a903","type":"function","z":"417d6ad8.4260bc","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmyTemp = context.global.MyTemperatureChambreParents;\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"T-ChambreParents\\\", \\\"My-Temperature\\\":\" + myTemp +  \",\\\"My-Humidity\\\":\" + msg.payload + \"}\";\n\nreturn msg;","outputs":1,"noerr":0,"x":586,"y":1760,"wires":[["d3faea3d.7eb93","88ee46b5.6ecfe"]]},{"id":"d3faea3d.7eb93","type":"debug","z":"417d6ad8.4260bc","name":"","active":false,"console":"false","complete":"false","x":754,"y":1798,"wires":[]},{"id":"b2c8e87c.3df4b","type":"comment","z":"417d6ad8.4260bc","name":"Chambre Parents:T° + Hum  ES write","info":"","x":184,"y":1720,"wires":[]},{"id":"88ee46b5.6ecfe","type":"json","z":"417d6ad8.4260bc","name":"","x":734.5,"y":1760,"wires":[["76c2f2bb.404084"]]},{"id":"93abdea6.f0b278","type":"delay","z":"417d6ad8.4260bc","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"15","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":410,"y":1760,"wires":[["8d1b543e.5a903"]]},{"id":"6ef14645.e0a26","type":"mqtt in","z":"417d6ad8.4260bc","name":"ChambreParents/RFX/Humidity","topic":"ChambreParents/RFX/Humidity","qos":"2","broker":"9c9224ce.733908","x":170,"y":1760,"wires":[["93abdea6.f0b278"]]},{"id":"68c88e08.1cf848","type":"http request","z":"417d6ad8.4260bc","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/my_sonde/sonde/{{{msg.payload}}}","tls":"","x":867,"y":1880,"wires":[["48268b0c.782fbc"]]},{"id":"da7ead18.81d95","type":"function","z":"417d6ad8.4260bc","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmyTemp = context.global.MyTemperatureChambreAnais;\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"T-ChambreAnais\\\", \\\"My-Temperature\\\":\" + myTemp +  \",\\\"My-Humidity\\\":\" + msg.payload + \"}\";\n\nreturn msg;","outputs":1,"noerr":0,"x":583,"y":1880,"wires":[["643bac91.a76cc4","5960f07a.5d56f"]]},{"id":"643bac91.a76cc4","type":"debug","z":"417d6ad8.4260bc","name":"","active":false,"console":"false","complete":"false","x":751,"y":1918,"wires":[]},{"id":"f4ee49f8.52ba78","type":"comment","z":"417d6ad8.4260bc","name":"Chambre Anais :T° + Hum  ES write","info":"","x":181,"y":1840,"wires":[]},{"id":"5960f07a.5d56f","type":"json","z":"417d6ad8.4260bc","name":"","x":731.5,"y":1880,"wires":[["68c88e08.1cf848"]]},{"id":"57d64658.ffb2a8","type":"delay","z":"417d6ad8.4260bc","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"15","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":407,"y":1880,"wires":[["da7ead18.81d95"]]},{"id":"31eb4b2b.1fa1d4","type":"mqtt in","z":"417d6ad8.4260bc","name":"ChambreAnais/RFX/Humidity","topic":"ChambreAnais/RFX/Humidity","qos":"2","broker":"9c9224ce.733908","x":157,"y":1880,"wires":[["57d64658.ffb2a8"]]},{"id":"48268b0c.782fbc","type":"debug","z":"417d6ad8.4260bc","name":"","active":false,"console":"false","complete":"false","x":1025,"y":1879.5,"wires":[]},{"id":"812b3856.a5cac8","type":"http request","z":"417d6ad8.4260bc","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/my_sonde/sonde/{{{msg.payload}}}","tls":"","x":860,"y":2020,"wires":[["bef50cab.f4acd8"]]},{"id":"b2881cd3.8b7828","type":"function","z":"417d6ad8.4260bc","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmyTemp = context.global.MyTemperatureChambreSarah;\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"T-ChambreSarah\\\", \\\"My-Temperature\\\":\" + myTemp +  \",\\\"My-Humidity\\\":\" + msg.payload + \"}\";\n\nreturn msg;","outputs":1,"noerr":0,"x":576,"y":2020,"wires":[["9bcf6727.71ec48","924f6e56.5f64e8"]]},{"id":"9bcf6727.71ec48","type":"debug","z":"417d6ad8.4260bc","name":"","active":false,"console":"false","complete":"false","x":744,"y":2058,"wires":[]},{"id":"42907537.669c8c","type":"comment","z":"417d6ad8.4260bc","name":"Chambre Sarah:T° + Hum  ES write","info":"","x":174,"y":1980,"wires":[]},{"id":"924f6e56.5f64e8","type":"json","z":"417d6ad8.4260bc","name":"","x":724.5,"y":2020,"wires":[["812b3856.a5cac8"]]},{"id":"b41936b9.b3b0f","type":"delay","z":"417d6ad8.4260bc","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"15","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":400,"y":2020,"wires":[["b2881cd3.8b7828"]]},{"id":"cfee2617.de1f4","type":"mqtt in","z":"417d6ad8.4260bc","name":"ChambreSarah/RFX/Humidity","topic":"ChambreSarah/RFX/Humidity","qos":"2","broker":"9c9224ce.733908","x":150,"y":2020,"wires":[["b41936b9.b3b0f"]]},{"id":"bef50cab.f4acd8","type":"debug","z":"417d6ad8.4260bc","name":"","active":false,"console":"false","complete":"false","x":1018,"y":2019.5,"wires":[]},{"id":"6182c983.5195e","type":"function","z":"b882537d.e69738","name":"Global var MyTemperatureCuisine","func":"context.global.MyTemperatureCuisine=Math.trunc(msg.payload);\nmsg.payload = context.global.MyTemperatureCuisine;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":840,"y":2096,"wires":[[]]},{"id":"fbe14662.22b658","type":"function","z":"b882537d.e69738","name":"Global var MyTemperatureBureau","func":"context.global.MyTemperatureBureau=Math.trunc(msg.payload);\nmsg.payload = context.global.MyTemperatureBureau;\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":838,"y":2562,"wires":[[]]},{"id":"cb23ba39.695198","type":"http request","z":"417d6ad8.4260bc","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/my_sonde/sonde/{{{msg.payload}}}","tls":"","x":965,"y":1120,"wires":[["90da0f6b.23cdf"]]},{"id":"90da0f6b.23cdf","type":"debug","z":"417d6ad8.4260bc","name":"","active":true,"console":"false","complete":"false","x":1123,"y":1119.5,"wires":[]},{"id":"e27e8a0c.2c2b48","type":"function","z":"417d6ad8.4260bc","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmyTemp = context.global.myTemperaturesSalon;\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"T-Salon\\\", \\\"My-Temperature\\\":\" + myTemp +  \",\\\"My-Humidity\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":681,"y":1120,"wires":[["781103c8.ff2c4c"]]},{"id":"8a24279a.8585c","type":"comment","z":"417d6ad8.4260bc","name":"Salon :T° + Hum  ES write   : désactivé","info":"","x":172,"y":1080,"wires":[]},{"id":"781103c8.ff2c4c","type":"json","z":"417d6ad8.4260bc","name":"","x":829.5,"y":1120,"wires":[["cb23ba39.695198"]]},{"id":"b1df15dc.e84808","type":"delay","z":"417d6ad8.4260bc","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"15","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":505,"y":1120,"wires":[["e27e8a0c.2c2b48"]]},{"id":"9f028eee.551c8","type":"mqtt in","z":"417d6ad8.4260bc","name":"Salon/RFX/Humidity","topic":"Salon/RFX/Humidity","qos":"2","broker":"9c9224ce.733908","x":118,"y":1120,"wires":[["a83a2a5d.623ce"]]},{"id":"ff0797c3.301108","type":"http request","z":"417d6ad8.4260bc","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/my_sonde/sonde/{{{msg.payload}}}","tls":"","x":970,"y":1260,"wires":[["eac54aa0.e466f"]]},{"id":"eac54aa0.e466f","type":"debug","z":"417d6ad8.4260bc","name":"","active":false,"console":"false","complete":"false","x":1128,"y":1259.5,"wires":[]},{"id":"4c33f321.445584","type":"function","z":"417d6ad8.4260bc","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmyTemp = context.global.MyTemperatureCuisine;\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"T-Cuisine\\\", \\\"My-Temperature\\\":\" + myTemp +  \",\\\"My-Humidity\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":686,"y":1260,"wires":[["21b21ab.959d2e6"]]},{"id":"f3c2a8ea.6d4398","type":"comment","z":"417d6ad8.4260bc","name":"Cuisine :T° + Hum  ES write   : désactivé","info":"","x":182,"y":1220,"wires":[]},{"id":"21b21ab.959d2e6","type":"json","z":"417d6ad8.4260bc","name":"","x":834.5,"y":1260,"wires":[["ff0797c3.301108"]]},{"id":"98fad10e.9478c8","type":"delay","z":"417d6ad8.4260bc","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"15","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":510,"y":1260,"wires":[["4c33f321.445584"]]},{"id":"8dab2f52.4cb01","type":"mqtt in","z":"417d6ad8.4260bc","name":"Cuisine/RFX/Humidity","topic":"Cuisine/RFX/Humidity","qos":"2","broker":"9c9224ce.733908","x":128,"y":1260,"wires":[["95e55982.3b6ad"]]},{"id":"6befa49b.1ec29c","type":"inject","z":"97223981.e54958","name":"Every 24H","topic":"","payload":"","payloadType":"date","repeat":"86400","crontab":"","once":false,"onceDelay":"","x":110,"y":680,"wires":[["d2c8c931.cc13f8"]]},{"id":"79164ce1.4ce3c4","type":"comment","z":"97223981.e54958","name":"Verification MAJ Tasmota","info":"","x":150,"y":620,"wires":[]},{"id":"d2c8c931.cc13f8","type":"file in","z":"97223981.e54958","name":"tasmota.txt","filename":"/home/pi/versions-check/tasmota.txt","format":"utf8","sendError":true,"x":267,"y":680,"wires":[["48384d0c.c1a11c"]]},{"id":"48384d0c.c1a11c","type":"switch","z":"97223981.e54958","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"},{"t":"eq","v":"false","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":405,"y":680,"wires":[["90b0bd87.8f34c"],["c685205c.8923"]]},{"id":"cf69d9bf.e33fe","type":"comment","z":"97223981.e54958","name":"NewVersion : True","info":"","x":457,"y":640,"wires":[]},{"id":"5988a81.27e4d58","type":"comment","z":"97223981.e54958","name":"NewVersion :  False","info":"","x":445,"y":720,"wires":[]},{"id":"552632ef.d8384c","type":"e-mail","z":"97223981.e54958","server":"smtp.gmail.com","port":"465","secure":true,"name":"coyotte14@gmail.com","dname":"Tasmota Maj","x":719,"y":673,"wires":[]},{"id":"90b0bd87.8f34c","type":"function","z":"97223981.e54958","name":"Mailformat","func":"var m=\"<table style='font-family:arial; font-size:14px'><tr><td style='color:blue'><b>Tasmota</b></td></tr>\";\n\nm+=\"<tr><td style='color:green'>\";\n  //m+=\"</td><td>\";\n  m+=\"Tasmota mise à jour disponible\";\n  m+=\"</td><tr>\";\n  m+=\"https://github.com/arendst/Sonoff-Tasmota/releases/latest\";\n  m+=\"</td></tr>\";\nm+=\"</table>\";\nmsg.payload=m;\nreturn msg;","outputs":1,"noerr":0,"x":547,"y":673,"wires":[["552632ef.d8384c","2315a4ac.aa77f4"]]},{"id":"2315a4ac.aa77f4","type":"debug","z":"97223981.e54958","name":"","active":true,"console":"false","complete":"false","x":718,"y":634,"wires":[]},{"id":"c685205c.8923","type":"debug","z":"97223981.e54958","name":"","active":false,"console":"false","complete":"false","x":628,"y":720,"wires":[]},{"id":"3f963772.acfa","type":"ui_template","z":"29011ad1.210936","group":"b7bac8c3.504c4","name":"Nest","order":1,"width":"6","height":"6","format":"<div id=\"thermostat\"></div>\n\n<style>\n@import url(http://fonts.googleapis.com/css?family=Open+Sans:300);\n#thermostat {\n  margin: 0 auto;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n.dial {\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.dial.away .dial__ico__leaf {\n  visibility: hidden;\n}\n.dial.away .dial__lbl--target {\n  visibility: hidden;\n}\n.dial.away .dial__lbl--target--half {\n  visibility: hidden;\n}\n.dial.away .dial__lbl--away {\n  opacity: 1;\n}\n.dial .dial__shape {\n  -webkit-transition: fill 0.5s;\n  transition: fill 0.5s;\n}\n.dial__ico__leaf {\n  fill: #13EB13;\n  opacity: 0;\n  -webkit-transition: opacity 0.5s;\n  transition: opacity 0.5s;\n  pointer-events: none;\n}\n.dial.has-leaf .dial__ico__leaf {\n  display: block;\n  opacity: 1;\n  pointer-events: initial;\n}\n.dial__editableIndicator {\n  fill: white;\n  fill-rule: evenodd;\n  opacity: 0;\n  -webkit-transition: opacity 0.5s;\n  transition: opacity 0.5s;\n}\n.dial--edit .dial__editableIndicator {\n  opacity: 1;\n}\n.dial--state--off .dial__shape {\n  fill: #3d3c3c;\n}\n.dial--state--heating .dial__shape {\n  fill: #E36304;\n}\n.dial--state--cooling .dial__shape {\n  fill: #007AF1;\n}\n.dial__ticks path {\n  fill: rgba(255, 255, 255, 0.3);\n}\n.dial__ticks path.active {\n  fill: rgba(255, 255, 255, 0.8);\n}\n.dial text {\n  fill: white;\n  text-anchor: middle;\n  font-family: Helvetica, sans-serif;\n  alignment-baseline: central;\n}\n.dial__lbl--target {\n  font-size: 120px;\n  font-weight: bold;\n}\n.dial__lbl--target--half {\n  font-size: 40px;\n  font-weight: bold;\n  opacity: 0;\n  -webkit-transition: opacity 0.1s;\n  transition: opacity 0.1s;\n}\n.dial__lbl--target--half.shown {\n  opacity: 1;\n  -webkit-transition: opacity 0s;\n  transition: opacity 0s;\n}\n.dial__lbl--ambient {\n  font-size: 22px;\n  font-weight: bold;\n}\n.dial__lbl--away {\n  font-size: 72px;\n  font-weight: bold;\n  opacity: 0;\n  pointer-events: none;\n}\n#controls {\n  font-family: Open Sans;\n  background-color: rgba(255, 255, 255, 0.25);\n  padding: 20px;\n  border-radius: 5px;\n  position: absolute;\n  left: 50%;\n  -webkit-transform: translatex(-50%);\n          transform: translatex(-50%);\n  margin-top: 20px;\n}\n#controls label {\n  text-align: left;\n  display: block;\n}\n#controls label span {\n  display: inline-block;\n  width: 200px;\n  text-align: right;\n  font-size: 0.8em;\n  text-transform: uppercase;\n}\n#controls p {\n  margin: 0;\n  margin-bottom: 1em;\n  padding-bottom: 1em;\n  border-bottom: 2px solid #ccc;\n}\n</style>\n<script>\n    var thermostatDial = (function() {\n\t\n\t/*\n\t * Utility functions\n\t */\n\t\n\t// Create an element with proper SVG namespace, optionally setting its attributes and appending it to another element\n\tfunction createSVGElement(tag,attributes,appendTo) {\n\t\tvar element = document.createElementNS('http://www.w3.org/2000/svg',tag);\n\t\tattr(element,attributes);\n\t\tif (appendTo) {\n\t\t\tappendTo.appendChild(element);\n\t\t}\n\t\treturn element;\n\t}\n\t\n\t// Set attributes for an element\n\tfunction attr(element,attrs) {\n\t\tfor (var i in attrs) {\n\t\t\telement.setAttribute(i,attrs[i]);\n\t\t}\n\t}\n\t\n\t// Rotate a cartesian point about given origin by X degrees\n\tfunction rotatePoint(point, angle, origin) {\n\t\tvar radians = angle * Math.PI/180;\n\t\tvar x = point[0]-origin[0];\n\t\tvar y = point[1]-origin[1];\n\t\tvar x1 = x*Math.cos(radians) - y*Math.sin(radians) + origin[0];\n\t\tvar y1 = x*Math.sin(radians) + y*Math.cos(radians) + origin[1];\n\t\treturn [x1,y1];\n\t}\n\t\n\t// Rotate an array of cartesian points about a given origin by X degrees\n\tfunction rotatePoints(points, angle, origin) {\n\t\treturn points.map(function(point) {\n\t\t\treturn rotatePoint(point, angle, origin);\n\t\t});\n\t}\n\t\n\t// Given an array of points, return an SVG path string representing the shape they define\n\tfunction pointsToPath(points) {\n\t\treturn points.map(function(point, iPoint) {\n\t\t\treturn (iPoint>0?'L':'M') + point[0] + ' ' + point[1];\n\t\t}).join(' ')+'Z';\n\t}\n\t\n\tfunction circleToPath(cx, cy, r) {\n\t\treturn [\n\t\t\t\"M\",cx,\",\",cy,\n\t\t\t\"m\",0-r,\",\",0,\n\t\t\t\"a\",r,\",\",r,0,1,\",\",0,r*2,\",\",0,\n\t\t\t\"a\",r,\",\",r,0,1,\",\",0,0-r*2,\",\",0,\n\t\t\t\"z\"\n\t\t].join(' ').replace(/\\s,\\s/g,\",\");\n\t}\n\t\n\tfunction donutPath(cx,cy,rOuter,rInner) {\n\t\treturn circleToPath(cx,cy,rOuter) + \" \" + circleToPath(cx,cy,rInner);\n\t}\n\t\n\t// Restrict a number to a min + max range\n\tfunction restrictToRange(val,min,max) {\n\t\tif (val < min) return min;\n\t\tif (val > max) return max;\n\t\treturn val;\n\t}\n\t\n\t// Round a number to the nearest 0.5\n\tfunction roundHalf(num) {\n\t\treturn Math.round(num*2)/2;\n\t}\n\t\n\tfunction setClass(el, className, state) {\n\t\tel.classList[state ? 'add' : 'remove'](className);\n\t}\n\t\n\t/*\n\t * The \"MEAT\"\n\t */\n\n\treturn function(targetElement, options) {\n\t\tvar self = this;\n\t\t\n\t\t/*\n\t\t * Options\n\t\t */\n\t\toptions = options || {};\n\t\toptions = {\n\t\t\tdiameter: options.diameter || 400,\n\t\t\tminValue: options.minValue || 10, // Minimum value for target temperature\n\t\t\tmaxValue: options.maxValue || 30, // Maximum value for target temperature\n\t\t\tnumTicks: options.numTicks || 200, // Number of tick lines to display around the dial\n\t\t\tonSetTargetTemperature: options.onSetTargetTemperature || function() {}, // Function called when new target temperature set by the dial\n\t\t};\n\t\t\n\t\t/*\n\t\t * Properties - calculated from options in many cases\n\t\t */\n\t\tvar properties = {\n\t\t\ttickDegrees: 300, //  Degrees of the dial that should be covered in tick lines\n\t\t\trangeValue: options.maxValue - options.minValue,\n\t\t\tradius: options.diameter/2,\n\t\t\tticksOuterRadius: options.diameter / 30,\n\t\t\tticksInnerRadius: options.diameter / 8,\n\t\t\thvac_states: ['off', 'heating', 'cooling'],\n\t\t\tdragLockAxisDistance: 15,\n\t\t}\n\t\tproperties.lblAmbientPosition = [properties.radius, properties.ticksOuterRadius-(properties.ticksOuterRadius-properties.ticksInnerRadius)/2]\n\t\tproperties.offsetDegrees = 180-(360-properties.tickDegrees)/2;\n\t\t\n\t\t/*\n\t\t * Object state\n\t\t */\n\t\tvar state = {\n\t\t\ttarget_temperature: options.minValue,\n\t\t\tambient_temperature: options.minValue,\n\t\t\thvac_state: properties.hvac_states[0],\n\t\t\thas_leaf: false,\n\t\t\taway: false\n\t\t};\n\t\t\n\t\t/*\n\t\t * Property getter / setters\n\t\t */\n\t\tObject.defineProperty(this,'target_temperature',{\n\t\t\tget: function() {\n\t\t\t\treturn state.target_temperature;\n\t\t\t},\n\t\t\tset: function(val) {\n\t\t\t\tstate.target_temperature = restrictTargetTemperature(+val);\n\t\t\t\trender();\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(this,'ambient_temperature',{\n\t\t\tget: function() {\n\t\t\t\treturn state.ambient_temperature;\n\t\t\t},\n\t\t\tset: function(val) {\n\t\t\t\tstate.ambient_temperature = roundHalf(+val);\n\t\t\t\trender();\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(this,'hvac_state',{\n\t\t\tget: function() {\n\t\t\t\treturn state.hvac_state;\n\t\t\t},\n\t\t\tset: function(val) {\n\t\t\t\tif (properties.hvac_states.indexOf(val)>=0) {\n\t\t\t\t\tstate.hvac_state = val;\n\t\t\t\t\trender();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(this,'has_leaf',{\n\t\t\tget: function() {\n\t\t\t\treturn state.has_leaf;\n\t\t\t},\n\t\t\tset: function(val) {\n\t\t\t\tstate.has_leaf = !!val;\n\t\t\t\trender();\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(this,'away',{\n\t\t\tget: function() {\n\t\t\t\treturn state.away;\n\t\t\t},\n\t\t\tset: function(val) {\n\t\t\t\tstate.away = !!val;\n\t\t\t\trender();\n\t\t\t}\n\t\t});\n\t\t\n\t\t/*\n\t\t * SVG\n\t\t */\n\t\tvar svg = createSVGElement('svg',{\n\t\t\twidth: '100%', //options.diameter+'px',\n\t\t\theight: '100%', //options.diameter+'px',\n\t\t\tviewBox: '0 0 '+options.diameter+' '+options.diameter,\n\t\t\tclass: 'dial'\n\t\t},targetElement);\n\t\t// CIRCULAR DIAL\n\t\tvar circle = createSVGElement('circle',{\n\t\t\tcx: properties.radius,\n\t\t\tcy: properties.radius,\n\t\t\tr: properties.radius,\n\t\t\tclass: 'dial__shape'\n\t\t},svg);\n\t\t// EDITABLE INDICATOR\n\t\tvar editCircle = createSVGElement('path',{\n\t\t\td: donutPath(properties.radius,properties.radius,properties.radius-4,properties.radius-8),\n\t\t\tclass: 'dial__editableIndicator',\n\t\t},svg);\n\t\t\n\t\t/*\n\t\t * Ticks\n\t\t */\n\t\tvar ticks = createSVGElement('g',{\n\t\t\tclass: 'dial__ticks'\t\n\t\t},svg);\n\t\tvar tickPoints = [\n\t\t\t[properties.radius-1, properties.ticksOuterRadius],\n\t\t\t[properties.radius+1, properties.ticksOuterRadius],\n\t\t\t[properties.radius+1, properties.ticksInnerRadius],\n\t\t\t[properties.radius-1, properties.ticksInnerRadius]\n\t\t];\n\t\tvar tickPointsLarge = [\n\t\t\t[properties.radius-1.5, properties.ticksOuterRadius],\n\t\t\t[properties.radius+1.5, properties.ticksOuterRadius],\n\t\t\t[properties.radius+1.5, properties.ticksInnerRadius+20],\n\t\t\t[properties.radius-1.5, properties.ticksInnerRadius+20]\n\t\t];\n\t\tvar theta = properties.tickDegrees/options.numTicks;\n\t\tvar tickArray = [];\n\t\tfor (var iTick=0; iTick<options.numTicks; iTick++) {\n\t\t\ttickArray.push(createSVGElement('path',{d:pointsToPath(tickPoints)},ticks));\n\t\t};\n\t\t\n\t\t/*\n\t\t * Labels\n\t\t */\n\t\tvar lblTarget = createSVGElement('text',{\n\t\t\tx: properties.radius,\n\t\t\ty: properties.radius,\n\t\t\tclass: 'dial__lbl dial__lbl--target'\n\t\t},svg);\n\t\tvar lblTarget_text = document.createTextNode('');\n\t\tlblTarget.appendChild(lblTarget_text);\n\t\t//\n\t\tvar lblTargetHalf = createSVGElement('text',{\n\t\t\tx: properties.radius + properties.radius/2.5,\n\t\t\ty: properties.radius - properties.radius/8,\n\t\t\tclass: 'dial__lbl dial__lbl--target--half'\n\t\t},svg);\n\t\tvar lblTargetHalf_text = document.createTextNode('5');\n\t\tlblTargetHalf.appendChild(lblTargetHalf_text);\n\t\t//\n\t\tvar lblAmbient = createSVGElement('text',{\n\t\t\tclass: 'dial__lbl dial__lbl--ambient'\n\t\t},svg);\n\t\tvar lblAmbient_text = document.createTextNode('');\n\t\tlblAmbient.appendChild(lblAmbient_text);\n\t\t//\n\t\tvar lblAway = createSVGElement('text',{\n\t\t\tx: properties.radius,\n\t\t\ty: properties.radius,\n\t\t\tclass: 'dial__lbl dial__lbl--away'\n\t\t},svg);\n\t\tvar lblAway_text = document.createTextNode('AWAY');\n\t\tlblAway.appendChild(lblAway_text);\n\t\t//\n\t\tvar icoLeaf = createSVGElement('path',{\n\t\t\tclass: 'dial__ico__leaf'\n\t\t},svg);\n\t\t\n\t\t/*\n\t\t * LEAF\n\t\t */\n\t\tvar leafScale = properties.radius/5/100;\n\t\tvar leafDef = [\"M\", 3, 84, \"c\", 24, 17, 51, 18, 73, -6, \"C\", 100, 52, 100, 22, 100, 4, \"c\", -13, 15, -37, 9, -70, 19, \"C\", 4, 32, 0, 63, 0, 76, \"c\", 6, -7, 18, -17, 33, -23, 24, -9, 34, -9, 48, -20, -9, 10, -20, 16, -43, 24, \"C\", 22, 63, 8, 78, 3, 84, \"z\"].map(function(x) {\n\t\t\treturn isNaN(x) ? x : x*leafScale;\n\t\t}).join(' ');\n\t\tvar translate = [properties.radius-(leafScale*100*0.5),properties.radius*1.5]\n\t\tvar icoLeaf = createSVGElement('path',{\n\t\t\tclass: 'dial__ico__leaf',\n\t\t\td: leafDef,\n\t\t\ttransform: 'translate('+translate[0]+','+translate[1]+')'\n\t\t},svg);\n\t\t\t\n\t\t/*\n\t\t * RENDER\n\t\t */\n\t\tfunction render() {\n\t\t\trenderAway();\n\t\t\trenderHvacState();\n\t\t\trenderTicks();\n\t\t\trenderTargetTemperature();\n\t\t\trenderAmbientTemperature();\n\t\t\trenderLeaf();\n\t\t}\n\t\trender();\n\n\t\t/*\n\t\t * RENDER - ticks\n\t\t */\n\t\tfunction renderTicks() {\n\t\t\tvar vMin, vMax;\n\t\t\tif (self.away) {\n\t\t\t\tvMin = self.ambient_temperature;\n\t\t\t\tvMax = vMin;\n\t\t\t} else {\n\t\t\t\tvMin = Math.min(self.ambient_temperature, self.target_temperature);\n\t\t\t\tvMax = Math.max(self.ambient_temperature, self.target_temperature);\n\t\t\t}\n\t\t\tvar min = restrictToRange(Math.round((vMin-options.minValue)/properties.rangeValue * options.numTicks),0,options.numTicks-1);\n\t\t\tvar max = restrictToRange(Math.round((vMax-options.minValue)/properties.rangeValue * options.numTicks),0,options.numTicks-1);\n\t\t\t//\n\t\t\ttickArray.forEach(function(tick,iTick) {\n\t\t\t\tvar isLarge = iTick==min || iTick==max;\n\t\t\t\tvar isActive = iTick >= min && iTick <= max;\n\t\t\t\tattr(tick,{\n\t\t\t\t\td: pointsToPath(rotatePoints(isLarge ? tickPointsLarge: tickPoints,iTick*theta-properties.offsetDegrees,[properties.radius, properties.radius])),\n\t\t\t\t\tclass: isActive ? 'active' : ''\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\n\t\t/*\n\t\t * RENDER - ambient temperature\n\t\t */\n\t\tfunction renderAmbientTemperature() {\n\t\t\tlblAmbient_text.nodeValue = Math.floor(self.ambient_temperature);\n\t\t\tif (self.ambient_temperature%1!=0) {\n\t\t\t\tlblAmbient_text.nodeValue += 'u';\n\t\t\t}\n\t\t\tvar peggedValue = restrictToRange(self.ambient_temperature, options.minValue, options.maxValue);\n\t\t\tdegs = properties.tickDegrees * (peggedValue-options.minValue)/properties.rangeValue - properties.offsetDegrees;\n\t\t\tif (peggedValue > self.target_temperature) {\n\t\t\t\tdegs += 8;\n\t\t\t} else {\n\t\t\t\tdegs -= 8;\n\t\t\t}\n\t\t\tvar pos = rotatePoint(properties.lblAmbientPosition,degs,[properties.radius, properties.radius]);\n\t\t\tattr(lblAmbient,{\n\t\t\t\tx: pos[0],\n\t\t\t\ty: pos[1]\n\t\t\t});\n\t\t}\n\n\t\t/*\n\t\t * RENDER - target temperature\n\t\t */\n\t\tfunction renderTargetTemperature() {\n\t\t\tlblTarget_text.nodeValue = Math.floor(self.target_temperature);\n\t\t\tsetClass(lblTargetHalf,'shown',self.target_temperature%1!=0);\n\t\t}\n\t\t\n\t\t/*\n\t\t * RENDER - leaf\n\t\t */\n\t\tfunction renderLeaf() {\n\t\t\tsetClass(svg,'has-leaf',self.has_leaf);\n\t\t}\n\t\t\n\t\t/*\n\t\t * RENDER - HVAC state\n\t\t */\n\t\tfunction renderHvacState() {\n\t\t\tArray.prototype.slice.call(svg.classList).forEach(function(c) {\n\t\t\t\tif (c.match(/^dial--state--/)) {\n\t\t\t\t\tsvg.classList.remove(c);\n\t\t\t\t};\n\t\t\t});\n\t\t\tsvg.classList.add('dial--state--'+self.hvac_state);\n\t\t}\n\t\t\n\t\t/*\n\t\t * RENDER - away\n\t\t */\n\t\tfunction renderAway() {\n\t\t\tsvg.classList[self.away ? 'add' : 'remove']('away');\n\t\t}\n\t\t\n\t\t/*\n\t\t * Drag to control\n\t\t */\n\t\tvar _drag = {\n\t\t\tinProgress: false,\n\t\t\tstartPoint: null,\n\t\t\tstartTemperature: 0,\n\t\t\tlockAxis: undefined\n\t\t};\n\t\t\n\t\tfunction eventPosition(ev) {\n\t\t\tif (ev.targetTouches && ev.targetTouches.length) {\n\t\t\t\treturn  [ev.targetTouches[0].clientX, ev.targetTouches[0].clientY];\n\t\t\t} else {\n\t\t\t\treturn [ev.x, ev.y];\n\t\t\t};\n\t\t}\n\t\t\n\t\tvar startDelay;\n\t\tfunction dragStart(ev) {\n\t\t\tstartDelay = setTimeout(function() {\n\t\t\t\tsetClass(svg, 'dial--edit', true);\n\t\t\t\t_drag.inProgress = true;\n\t\t\t\t_drag.startPoint = eventPosition(ev);\n\t\t\t\t_drag.startTemperature = self.target_temperature || options.minValue;\n\t\t\t\t_drag.lockAxis = undefined;\n\t\t\t},1000);\n\t\t};\n\t\t\n\t\tfunction dragEnd (ev) {\n\t\t\tclearTimeout(startDelay);\n\t\t\tsetClass(svg, 'dial--edit', false);\n\t\t\tif (!_drag.inProgress) return;\n\t\t\t_drag.inProgress = false;\n\t\t\tif (self.target_temperature != _drag.startTemperature) {\n\t\t\t\tif (typeof options.onSetTargetTemperature == 'function') {\n\t\t\t\t\toptions.onSetTargetTemperature(self.target_temperature);\n\t\t\t\t};\n\t\t\t};\n\t\t};\n\t\t\n\t\tfunction dragMove(ev) {\n\t\t\tev.preventDefault();\n\t\t\tif (!_drag.inProgress) return;\n\t\t\tvar evPos =  eventPosition(ev);\n\t\t\tvar dy = _drag.startPoint[1]-evPos[1];\n\t\t\tvar dx = evPos[0] - _drag.startPoint[0];\n\t\t\tvar dxy;\n\t\t\tif (_drag.lockAxis == 'x') {\n\t\t\t\tdxy  = dx;\n\t\t\t} else if (_drag.lockAxis == 'y') {\n\t\t\t\tdxy = dy;\n\t\t\t} else if (Math.abs(dy) > properties.dragLockAxisDistance) {\n\t\t\t\t_drag.lockAxis = 'y';\n\t\t\t\tdxy = dy;\n\t\t\t} else if (Math.abs(dx) > properties.dragLockAxisDistance) {\n\t\t\t\t_drag.lockAxis = 'x';\n\t\t\t\tdxy = dx;\n\t\t\t} else {\n\t\t\t\tdxy = (Math.abs(dy) > Math.abs(dx)) ? dy : dx;\n\t\t\t};\n\t\t\tvar dValue = (dxy*getSizeRatio())/(options.diameter)*properties.rangeValue;\n\t\t\tself.target_temperature = roundHalf(_drag.startTemperature+dValue);\n\t\t}\n\t\t\n\t\tsvg.addEventListener('mousedown',dragStart);\n\t\tsvg.addEventListener('touchstart',dragStart);\n\t\t\n\t\tsvg.addEventListener('mouseup',dragEnd);\n\t\tsvg.addEventListener('mouseleave',dragEnd);\n\t\tsvg.addEventListener('touchend',dragEnd);\n\t\t\n\t\tsvg.addEventListener('mousemove',dragMove);\n\t\tsvg.addEventListener('touchmove',dragMove);\n\t\t//\n\t\t\n\t\t/*\n\t\t * Helper functions\n\t\t */\n\t\tfunction restrictTargetTemperature(t) {\n\t\t\treturn restrictToRange(roundHalf(t),options.minValue,options.maxValue);\n\t\t}\n\t\t\n\t\tfunction angle(point) {\n\t\t\tvar dx = point[0] - properties.radius;\n\t\t\tvar dy = point[1] - properties.radius;\n\t\t\tvar theta = Math.atan(dx/dy) / (Math.PI/180);\n\t\t\tif (point[0]>=properties.radius && point[1] < properties.radius) {\n\t\t\t\ttheta = 90-theta - 90;\n\t\t\t} else if (point[0]>=properties.radius && point[1] >= properties.radius) {\n\t\t\t\ttheta = 90-theta + 90;\n\t\t\t} else if (point[0]<properties.radius && point[1] >= properties.radius) {\n\t\t\t\ttheta = 90-theta + 90;\n\t\t\t} else if (point[0]<properties.radius && point[1] < properties.radius) {\n\t\t\t\ttheta = 90-theta+270;\n\t\t\t}\n\t\t\treturn theta;\n\t\t};\n\t\t\n\t\tfunction getSizeRatio() {\n\t\t\treturn options.diameter / targetElement.clientWidth;\n\t\t}\n\t\t\n\t};\n})();\n\n/* ==== */\n(function(scope) {\n    \n    var nest = new thermostatDial(document.getElementById('thermostat'),{\n    \tonSetTargetTemperature: function(v) {\n    \t\tscope.send({topic: \"target_temperature\", payload: v});\n    \t}\n    });\n\n\n    scope.$watch('msg', function(data) {\n        //console.log(data.topic+\"  \"+data.payload);\n        if (data.topic == \"ambient_temperature\") {\n            nest.ambient_temperature = data.payload;\n        } if (data.topic == \"target_temperature\") {\n            nest.target_temperature = data.payload;\n        } if (data.topic == \"hvac_state\") {\n            nest.hvac_state = data.payload;\n        } if (data.topic == \"has_leaf\") {\n            nest.has_leaf = data.payload;\n        } if (data.topic == \"away\") {\n            nest.away = data.payload;\n        }\n    });\n})(scope);\n\n</script>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":792,"y":374,"wires":[[]]},{"id":"cca647ff.4ff788","type":"mqtt in","z":"29011ad1.210936","name":"Temp Salon","topic":"Salon/RFX/Temperature","qos":"0","broker":"9c9224ce.733908","x":92,"y":90,"wires":[["b31350d6.cb48d8","bda9c484.c1be88"]]},{"id":"4390161c.968f28","type":"ui_slider","z":"29011ad1.210936","name":"Slider","label":"T° cible","group":"b7bac8c3.504c4","order":14,"width":0,"height":0,"passthru":false,"outs":"all","topic":"slider","min":"10","max":"30","step":1,"x":327,"y":464,"wires":[["e6071abb.4ae7f8"]]},{"id":"7774e370.aca854","type":"function","z":"29011ad1.210936","name":"Leaf Control","func":"x = flow.get('TempAmbient');\n\nif (x > 17 && x < 23){\n     flow.set('leaf', true);\n    msg.payload = true;\n    msg.topic = \"has_leaf\";\n    return msg;\n}\n    \nelse{flow.set('leaf', false);\n    msg.payload = false;\n    msg.topic = \"has_leaf\";\n    return msg;\n}\n\n","outputs":1,"noerr":0,"x":482,"y":329,"wires":[["3f963772.acfa"]]},{"id":"287270fa.a574f","type":"function","z":"29011ad1.210936","name":"Color ","func":"x = flow.get('TempTarget');   //target\nz = flow.get('TempAmbient');  //ambient\n\nif (z < x){\n    flow.set('heatingState', \"heating\");\n    flow.set('heatingSwitch', \"ON\");\n}\nif (z >= x){\n    flow.set('heatingState', \"off\");\n    flow.set('heatingSwitch', \"OFF\");\n}\nmsg.payload = z;\nmsg.topic = \"ambient_temperature\";\nreturn msg;","outputs":1,"noerr":0,"x":462,"y":284,"wires":[["3f963772.acfa"]]},{"id":"68321e5f.eeebf8","type":"mqtt out","z":"29011ad1.210936","name":"Control Sonoff","topic":"cmnd/sonoff-thermostat/POWER","qos":"0","retain":"","broker":"9c9224ce.733908","x":670,"y":614,"wires":[]},{"id":"c147d9ff.8e2f6","type":"function","z":"29011ad1.210936","name":"Control relay","func":"if (msg.command === \"TurnOffRequest\"){\n    msg.payload = \"OFF\";\n    return msg;\n}\n\nif (msg.command === \"TurnOnRequest\"){\n    msg.payload = \"ON\";\n    flow.set('TempTarget', 21);\n    return msg;\n}\nif (msg.topic === \"update\"){\n    msg.payload = flow.get('heatingSwitch');\n}\nreturn msg;","outputs":1,"noerr":0,"x":482,"y":614,"wires":[["68321e5f.eeebf8","7840d7e6.269fe","e92739b1.b6f788"]]},{"id":"aa000ee2.3b0aa8","type":"smooth","z":"29011ad1.210936","name":"Average temp","property":"payload","action":"mean","count":"15","round":"2","mult":"single","x":467,"y":107,"wires":[["601e31bb.419cb","7548d23c.127da4"]]},{"id":"e81b6663.bd8f7","type":"function","z":"29011ad1.210936","name":"colour -away override","func":"x = flow.get('away');\n\nif (x === true){\n    msg.topic = \"hvac_state\";\n    msg.payload = \"off\";\n    return msg;\n}\n\nmsg.topic = \"hvac_state\";\nmsg.payload = flow.get('heatingState');\n\nreturn msg;","outputs":1,"noerr":0,"x":512,"y":374,"wires":[["3f963772.acfa"]]},{"id":"9954f2a5.6fa238","type":"function","z":"29011ad1.210936","name":"Away Control","func":"x = flow.get('away');\n\nif (x === true){\n    flow.set('heatingSwitch', \"OFF\");\n    flow.set('heatingState', \"off\");\n}\n\nmsg.topic = \"away\";\nmsg.payload = flow.get('away');\nreturn msg;\n\n","outputs":1,"noerr":0,"x":482,"y":419,"wires":[["3f963772.acfa"]]},{"id":"e6071abb.4ae7f8","type":"function","z":"29011ad1.210936","name":"set temp target","func":"if (msg.topic === \"update\"){\n    msg.topic = \"target_temperature\";\n    msg.payload = flow.get('TempTarget');\n    return msg;\n}\n\nif (msg.command === \"SetTargetTemperatureRequest\") {\n    flow.set('away', false);\n    msg.topic = \"target_temperature\";\n    flow.set('TempTarget', msg.payload);\n    \n}\n\nif (msg.topic === \"slider\") {\n    flow.set('away', false);\n    msg.topic = \"target_temperature\";\n    flow.set('TempTarget', msg.payload);\n}\n\nif (msg.command === \"GetTemperatureReadingRequest\"){}\n\nreturn msg;","outputs":1,"noerr":0,"x":492,"y":464,"wires":[["3f963772.acfa"]]},{"id":"87e2d46b.51ee98","type":"inject","z":"29011ad1.210936","name":"Refresh every 5 sec","topic":"update","payload":"upate","payloadType":"str","repeat":"5","crontab":"","once":false,"onceDelay":0.1,"x":152,"y":284,"wires":[["e81b6663.bd8f7","9954f2a5.6fa238","e6071abb.4ae7f8","c147d9ff.8e2f6","287270fa.a574f","7774e370.aca854","4018b9f9.d1e71"]]},{"id":"4018b9f9.d1e71","type":"function","z":"29011ad1.210936","name":"Update slider","func":"msg.payload = flow.get('TempTarget');\nreturn msg;","outputs":1,"noerr":0,"x":182,"y":464,"wires":[["4390161c.968f28"]]},{"id":"fd90438d.26a588","type":"function","z":"29011ad1.210936","name":"test","func":"msg.ambinet = flow.get('TempAmbient');\nmsg.target = flow.get('TempTarget');\nmsg.leaf = flow.get('leaf');\nmsg.state = flow.get('heatingState');\nmsg.switch = flow.get('heatingSwitch');\nmsg.away = flow.get('away');\nreturn msg;","outputs":1,"noerr":0,"x":234,"y":780,"wires":[["c26fc6cb.be6668"]]},{"id":"c26fc6cb.be6668","type":"debug","z":"29011ad1.210936","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":360,"y":780,"wires":[]},{"id":"7720a238.b2951c","type":"inject","z":"29011ad1.210936","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":104,"y":780,"wires":[["fd90438d.26a588"]]},{"id":"601e31bb.419cb","type":"function","z":"29011ad1.210936","name":"Update the 'TempAmbient'","func":"flow.set('TempAmbient', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":693,"y":107,"wires":[[]]},{"id":"daf7d12.878203","type":"comment","z":"29011ad1.210936","name":"Measure DHT11 temp and update var","info":"Gets the Temp, averages last X readings \nand updates the variable for the next push","x":172,"y":45,"wires":[]},{"id":"cd174701.7861a8","type":"comment","z":"29011ad1.210936","name":"Update Dial ","info":"","x":92,"y":242,"wires":[]},{"id":"4b7c3a12.2d0cbc","type":"comment","z":"29011ad1.210936","name":"Control Relay","info":"","x":482,"y":569,"wires":[]},{"id":"168cdf2.99fa321","type":"comment","z":"29011ad1.210936","name":"Test the Flow Vars","info":"","x":112,"y":735,"wires":[]},{"id":"b31350d6.cb48d8","type":"debug","z":"29011ad1.210936","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":272,"y":146,"wires":[]},{"id":"bda9c484.c1be88","type":"change","z":"29011ad1.210936","name":"String2Number","rules":[{"t":"set","p":"payload","pt":"msg","to":"$number(payload)","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":287,"y":107,"wires":[["aa000ee2.3b0aa8"]]},{"id":"7548d23c.127da4","type":"debug","z":"29011ad1.210936","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":643,"y":147,"wires":[]},{"id":"7840d7e6.269fe","type":"debug","z":"29011ad1.210936","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":659,"y":568,"wires":[]},{"id":"e92739b1.b6f788","type":"mqtt out","z":"29011ad1.210936","name":"","topic":"cmnd/sonoff-thermostat/Ledpower","qos":"0","retain":"","broker":"9c9224ce.733908","x":728,"y":668,"wires":[]},{"id":"6e4ce13a.1c4b18","type":"mqtt in","z":"29011ad1.210936","name":"Temp bureau","topic":"Bureau/RFX/Temperature","qos":"0","broker":"9c9224ce.733908","x":92,"y":160,"wires":[["bda9c484.c1be88","b31350d6.cb48d8"]]},{"id":"a14deb26.96bb7","type":"debug","z":"659a812a.2160a","name":"","active":true,"console":"false","complete":"true","x":190,"y":920,"wires":[]},{"id":"53622784.bda7f","type":"mqtt out","z":"659a812a.2160a","name":"VMC/XIAOMI/MarcheForcee","topic":"VMC/XIAOMI/MarcheForcee","qos":"","retain":"true","broker":"9c9224ce.733908","x":815,"y":860,"wires":[]},{"id":"8897154c.28ec1","type":"mqtt out","z":"659a812a.2160a","name":"VMC/XIAOMI/Battery","topic":"VMC/XIAOMI/Battery","qos":"","retain":"","broker":"9c9224ce.733908","x":795,"y":920,"wires":[]},{"id":"73f435f6.a1089c","type":"mqtt out","z":"659a812a.2160a","name":"Garage2/XIAOMI/Door","topic":"Garage2/XIAOMI/Door","qos":"","retain":"true","broker":"9c9224ce.733908","x":815,"y":1040,"wires":[]},{"id":"5ef773b4.03367c","type":"mqtt out","z":"659a812a.2160a","name":"Garage2/XIAOMI/Battery","topic":"Garage2/XIAOMI/Battery","qos":"","retain":"","broker":"9c9224ce.733908","x":825,"y":1100,"wires":[]},{"id":"eedbd67c.307ed","type":"xiaomi-magnet","z":"659a812a.2160a","gateway":"a67ca531.70e5a8","name":"VMC-marche-forcée","sid":"158d00020910dd","x":155,"y":860,"wires":[["de55b4be.3a5478","a14deb26.96bb7","94c1af60.ba599"]]},{"id":"74115a69.2b860c","type":"debug","z":"9e51a2fa.b06ff","name":"","active":true,"console":"false","complete":"false","x":730,"y":760,"wires":[]},{"id":"44cd4a32.60b00c","type":"comment","z":"9e51a2fa.b06ff","name":"Marche forcée","info":"","x":100,"y":3760,"wires":[]},{"id":"22d30564.1eacda","type":"ui_switch","z":"9e51a2fa.b06ff","name":"","label":"Marche forcée","group":"8aa34793.811b08","order":8,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":150,"y":3860,"wires":[["827b7817.c76d6","11e27dd7.1b5b4a"]]},{"id":"861be2a9.4637b8","type":"delay","z":"9e51a2fa.b06ff","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":840,"y":3840,"wires":[["9d6401b0.971558"]]},{"id":"9d6401b0.971558","type":"change","z":"9e51a2fa.b06ff","name":"Set false","rules":[{"t":"set","p":"payload","pt":"msg","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":852,"y":3900,"wires":[["22d30564.1eacda"]]},{"id":"827b7817.c76d6","type":"switch","z":"9e51a2fa.b06ff","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":310,"y":3860,"wires":[["dc6bda3c.3d7c18","ae584bfb.7bae08"],["135e2184.b35e6e","c396da62.22004"]]},{"id":"cb30f36.c68b11","type":"comment","z":"9e51a2fa.b06ff","name":"on","info":"","x":350,"y":3820,"wires":[]},{"id":"76af9d51.3ee72c","type":"comment","z":"9e51a2fa.b06ff","name":"off","info":"","x":350,"y":3900,"wires":[]},{"id":"11e27dd7.1b5b4a","type":"debug","z":"9e51a2fa.b06ff","name":"","active":true,"console":"false","complete":"false","x":150,"y":3940,"wires":[]},{"id":"135e2184.b35e6e","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCMarcheForcee","func":"context.global.VMCMarcheForcee = \"OFF\";\nmsg.payload = context.global.VMCMarcheForcee;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":540,"y":3940,"wires":[[]]},{"id":"311993eb.99cd7c","type":"Sonoff device","z":"9e51a2fa.b06ff","mode":"0","broker":"9c9224ce.733908","device":"sonoff-vmc","name":"","onValue":"ON","offValue":"OFF","cmdPrefix":"cmnd","statPrefix":"stat","telePrefix":"tele","x":690,"y":3760,"wires":[["1c1224d7.3b52f3","9b8fa0fe.d1b91","861be2a9.4637b8"]]},{"id":"dc6bda3c.3d7c18","type":"function","z":"9e51a2fa.b06ff","name":"startVMC","func":"context.global.VMCState = \"ON\";\nmsg.payload = context.global.VMCState;\n    node.status({text:msg.payload});\nmsg.payload = \"ON\";\nreturn msg;","outputs":1,"noerr":0,"x":520,"y":3760,"wires":[["311993eb.99cd7c"]]},{"id":"bd0218a9.0ac75","type":"inject","z":"9e51a2fa.b06ff","name":"Test Hum 70","topic":"","payload":"70","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":110,"y":320,"wires":[["19ab9461.4eaef4","6010dd8a.8ddbac","c054c587.a0c29"]]},{"id":"c396da62.22004","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCStateLabel","func":"context.global.VMCStateLabel = \" \";\nmsg.payload = context.global.VMCStateLabel;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":520,"y":4000,"wires":[[]]},{"id":"1c1224d7.3b52f3","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCMarcheForcee","func":"context.global.VMCMarcheForcee = \"ON\";\nmsg.payload = context.global.VMCMarcheForcee;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":920,"y":3760,"wires":[[]]},{"id":"9b8fa0fe.d1b91","type":"function","z":"9e51a2fa.b06ff","name":"global.VMCStateLabel","func":"context.global.VMCStateLabel = \"Marche forcée\";\nmsg.payload = context.global.VMCStateLabel;\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":900,"y":3700,"wires":[[]]},{"id":"ccda0c39.b1c658","type":"inject","z":"9e51a2fa.b06ff","name":"","topic":"","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":true,"onceDelay":"","x":90,"y":3800,"wires":[["22d30564.1eacda"]]},{"id":"ae584bfb.7bae08","type":"debug","z":"9e51a2fa.b06ff","name":"","active":true,"console":"false","complete":"false","x":530,"y":3820,"wires":[]},{"id":"c6ba075f.78aa1","type":"function","z":"9e51a2fa.b06ff","name":"Update 'VMCStateLabel'","func":"flow.set('TempAmbient', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":40,"wires":[[]]},{"id":"9ac83449.e9318","type":"comment","z":"d36fb347.098c6","name":"Marche forcée OFF + Qualité de l'air pollué","info":"","x":210,"y":980,"wires":[]},{"id":"49bf8682.c68dd","type":"mqtt in","z":"d36fb347.098c6","name":"Humidité Salle de bain","topic":"Salledebain/RFX/Humidity","qos":"2","broker":"9c9224ce.733908","x":138,"y":460,"wires":[["86bf5b20.3cde88","786cae.e2376b54"]]},{"id":"e470644.ead9e98","type":"function","z":"d36fb347.098c6","name":"Update Humidity","func":"msg.payload = flow.set('Humidity', msg.payload);\n        node.status({text:flow.get('Humidity')});\nreturn msg;","outputs":"1","noerr":0,"x":500,"y":488,"wires":[[]]},{"id":"86bf5b20.3cde88","type":"function","z":"d36fb347.098c6","name":"populate-Template","func":"msg = {};\nmsg.t1 =  Math.trunc(context.global.MyTemperatureExt);\nmsg.h1 =  Math.trunc(flow.get('Humidity'));\nmsg.a1 =  flow.get('Qair');\n    node.status({text:msg.t1});\nreturn msg;","outputs":"1","noerr":0,"x":376,"y":426,"wires":[["58c44f28.46acc8"]]},{"id":"58c44f28.46acc8","type":"ui_template","z":"d36fb347.098c6","group":"8aa34793.811b08","name":"","order":2,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:0px; text-align: left; margin:2px; border:2px solid white;\">\n<span style=\"width:33%;padding-top:5px;padding-left:5px;\">{{\"Hum: \" + msg.h1 +\"%\"}}</span>\n<span style=\"width:33%;padding-top:5px;padding-left:5px;\">{{\"T° Ext: \" + msg.t1 + \"°c\"}}</span>\n<span style=\"width:33%;padding-top:5px;padding-left:5px;\">{{\"Q air: \" + msg.a1 }}</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":549,"y":426,"wires":[[]]},{"id":"642e02bb.409b54","type":"mqtt in","z":"d36fb347.098c6","name":"VMC/XIAOMI/MarcheForcee","topic":"VMC/XIAOMI/MarcheForcee","qos":"0","broker":"9c9224ce.733908","x":143,"y":752,"wires":[["7453963d.772fd8","ed57b821.0bc418"]]},{"id":"3064d44b.0350bc","type":"switch","z":"d36fb347.098c6","name":"VMCMarcheForcee","property":"VMCMarcheForcee","propertyType":"flow","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":645,"y":755,"wires":[["2c9b331b.0f49cc"],[]]},{"id":"30b3ec05.0cc7d4","type":"comment","z":"d36fb347.098c6","name":"on","info":"","x":690,"y":720,"wires":[]},{"id":"1c2c2b9a.2fa534","type":"comment","z":"d36fb347.098c6","name":"off","info":"","x":690,"y":800,"wires":[]},{"id":"ecfb8d88.6a80d8","type":"Sonoff device","z":"d36fb347.098c6","mode":"0","broker":"9c9224ce.733908","device":"sonoff-vmc","name":"","onValue":"ON","offValue":"OFF","cmdPrefix":"cmnd","statPrefix":"stat","telePrefix":"tele","x":890,"y":960,"wires":[["842e4f87.648258"]]},{"id":"1cea06d0.318ea9","type":"comment","z":"d36fb347.098c6","name":"VMC - Valeur en entrée : qualité de l'air T° ext, humidité sdb","info":"","x":253,"y":359,"wires":[]},{"id":"73e0e674.d5bd1","type":"comment","z":"d36fb347.098c6","name":"Marche forcée : appuie poussoir cuisine pour aspiration maxi","info":"","x":260,"y":618,"wires":[]},{"id":"af5cd443.7cd828","type":"delay","z":"d36fb347.098c6","name":"","pauseType":"delay","timeout":"1","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":980,"y":720,"wires":[["cebc7db7.7c5d2"]]},{"id":"2f7dbf89.1638a8","type":"inject","z":"d36fb347.098c6","name":"Test Q air =4 (correct)","topic":"","payload":"4","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":168,"y":1020,"wires":[["c4754d45.5e1618"]]},{"id":"b158e5c6.0f1768","type":"inject","z":"d36fb347.098c6","name":"Test Q air =5 (pollué)","topic":"","payload":"5","payloadType":"num","repeat":"","crontab":"","once":false,"x":166,"y":1061,"wires":[["c4754d45.5e1618"]]},{"id":"619cf2a9.bb6e1c","type":"inject","z":"d36fb347.098c6","name":"Test Q air =8 (très pollué)","topic":"","payload":"8","payloadType":"num","repeat":"","crontab":"","once":false,"x":177,"y":1098,"wires":[["c4754d45.5e1618"]]},{"id":"cebc7db7.7c5d2","type":"function","z":"d36fb347.098c6","name":"stopVMC","func":"flow.set('VMCMarcheForcee', \"OFF\");\nflow.set('VMCStateLabel', \"-\");\nflow.set('VMCState', \"OFF\");\nmsg.payload = \"OFF\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":1120,"y":720,"wires":[["ecfb8d88.6a80d8","820591ae.75fa48"]]},{"id":"826b4c58.c8f31","type":"inject","z":"d36fb347.098c6","name":"Test marche forcée ON (0)","topic":"","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":"","x":160,"y":658,"wires":[["7453963d.772fd8"]]},{"id":"d8d302ca.88f2d","type":"inject","z":"d36fb347.098c6","name":"Test marche forcée OFF (1)","topic":"","payload":"OFF","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":"","x":165,"y":701,"wires":[["7453963d.772fd8"]]},{"id":"2c9b331b.0f49cc","type":"function","z":"d36fb347.098c6","name":"startVMC","func":"flow.set('VMCMarcheForcee', msg.payload);\nflow.set('VMCStateLabel', \"Marche forcée\");\nflow.set('VMCState', \"ON\");\nmsg.payload = \"ON\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":820,"y":721,"wires":[["ecfb8d88.6a80d8","820591ae.75fa48","af5cd443.7cd828"]]},{"id":"b8cceba9.5d3e5","type":"inject","z":"d36fb347.098c6","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"x":138,"y":147,"wires":[["10e4f25f.918296","ac840012.cf2518","ac0875bb.ec25d8","215a0305.8f3c6c"]]},{"id":"786cae.e2376b54","type":"json","z":"d36fb347.098c6","name":"","pretty":false,"x":329.5,"y":488,"wires":[["e470644.ead9e98"]]},{"id":"7453963d.772fd8","type":"function","z":"d36fb347.098c6","name":"Status VMCMarcheForcee","func":"flow.set('VMCMarcheForcee', msg.payload);\n    node.status({text:flow.get('VMCMarcheForcee')});\nreturn msg;","outputs":"1","noerr":0,"x":417,"y":755,"wires":[["3064d44b.0350bc"]]},{"id":"3a0db1bb.bb6bc6","type":"comment","z":"d36fb347.098c6","name":"VMC - init valeurs flow","info":"","x":133,"y":49,"wires":[]},{"id":"a5b55e7b.fd6718","type":"inject","z":"d36fb347.098c6","name":"Test Hum 70","topic":"","payload":"70","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":"","x":130,"y":507,"wires":[["786cae.e2376b54","86bf5b20.3cde88"]]},{"id":"10e4f25f.918296","type":"function","z":"d36fb347.098c6","name":"Update 'VMCStateLabel'","func":"flow.set('VMCStateLabel', \"-\");\n        node.status({text:flow.get('VMCStateLabel')});\nreturn msg;","outputs":1,"noerr":0,"x":358,"y":100,"wires":[[]]},{"id":"ac840012.cf2518","type":"function","z":"d36fb347.098c6","name":"Update 'VMCState'","func":"flow.set('VMCState', \"OFF\");\n    node.status({text:flow.get('VMCState')});\nreturn msg;","outputs":1,"noerr":0,"x":338,"y":146,"wires":[[]]},{"id":"ac0875bb.ec25d8","type":"function","z":"d36fb347.098c6","name":"Update 'VMCMarcheForcee'","func":"flow.set('VMCMarcheForcee', \"OFF\");\n    node.status({text:flow.get('VMCMarcheForcee')});\nreturn msg;","outputs":1,"noerr":0,"x":368,"y":192,"wires":[[]]},{"id":"94f9173.db7cd68","type":"function","z":"d36fb347.098c6","name":"test","func":"msg.VMCStateLabel = flow.get('VMCStateLabel');\nmsg.VMCState = flow.get('VMCState');\nmsg.Qair = flow.get('Qair');\nmsg.Temp = context.global.MyTemperatureExt;\nmsg.Humidity = flow.get('Humidity');\n\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":100,"wires":[["8017996c.010fc"]]},{"id":"8017996c.010fc","type":"debug","z":"d36fb347.098c6","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":896,"y":100,"wires":[]},{"id":"c2082a53.207c38","type":"inject","z":"d36fb347.098c6","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":640,"y":100,"wires":[["94f9173.db7cd68"]]},{"id":"bfd5928.b5387f","type":"comment","z":"d36fb347.098c6","name":"Test the Flow Vars","info":"","x":648,"y":55,"wires":[]},{"id":"215a0305.8f3c6c","type":"file in","z":"d36fb347.098c6","name":"qair.txt","filename":"/var/www/html/qair/qair.txt","format":"utf8","sendError":true,"x":298,"y":243,"wires":[["ab1fc8bc.6faec"]]},{"id":"ab1fc8bc.6faec","type":"json","z":"d36fb347.098c6","name":"","pretty":false,"x":421,"y":243,"wires":[["fb69524a.99f5b","f0a7b145.976db"]]},{"id":"fb69524a.99f5b","type":"mqtt out","z":"d36fb347.098c6","name":"qair/value","topic":"qair/value","qos":"","retain":"","broker":"9c9224ce.733908","x":580,"y":223,"wires":[]},{"id":"f0a7b145.976db","type":"function","z":"d36fb347.098c6","name":"Update 'Qair'","func":"flow.set('Qair', msg.payload);\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":586,"y":274,"wires":[[]]},{"id":"ed57b821.0bc418","type":"debug","z":"d36fb347.098c6","name":"","active":true,"tosidebar":true,"console":false,"complete":"false","x":370,"y":805,"wires":[]},{"id":"820591ae.75fa48","type":"mqtt out","z":"d36fb347.098c6","name":"","topic":"cmnd/sonoff-vmc/Ledpower","qos":"0","retain":"","broker":"9c9224ce.733908","x":1100,"y":800,"wires":[]},{"id":"842e4f87.648258","type":"function","z":"d36fb347.098c6","name":"Status VMCMarcheForcee","func":"msg.payload = flow.get('VMCMarcheForcee');\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":180,"y":1340,"wires":[["f95d4517.937648"]]},{"id":"5b38d249.593b14","type":"switch","z":"d36fb347.098c6","name":"Select air quality","property":"Qair","propertyType":"flow","rules":[{"t":"btwn","v":"0","vt":"num","v2":"4","v2t":"num"},{"t":"btwn","v":"5","vt":"num","v2":"7","v2t":"num"},{"t":"gt","v":"7","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":472,"y":1180,"wires":[["ea4501ba.d34f38"],["f0183c6e.8421a"],["764d6ec4.1b00a8"]]},{"id":"8b90e324.824cc","type":"comment","z":"d36fb347.098c6","name":"Air 0-4 : OK runVMC","info":"","x":473.699951171875,"y":1138.2000122070312,"wires":[]},{"id":"3599b54.0000eca","type":"comment","z":"d36fb347.098c6","name":"Air 5-10 : Pollué stopVMC","info":"","x":470.699951171875,"y":1222.2000122070312,"wires":[]},{"id":"c409400.e3c3d4","type":"comment","z":"d36fb347.098c6","name":"1 action max par heure","info":"","x":940,"y":1240,"wires":[]},{"id":"7512a32e.bf7a5c","type":"delay","z":"d36fb347.098c6","name":"1 message/H","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"","rateUnits":"hour","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":915,"y":1203,"wires":[["6995eb5e.735c1c"]]},{"id":"6995eb5e.735c1c","type":"function","z":"d36fb347.098c6","name":"stopVMC","func":"flow.set('VMCMarcheForcee', \"OFF\");\nflow.set('VMCStateLabel', \"-\");\nflow.set('VMCState', \"OFF\");\nmsg.payload = \"OFF\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":1063.699951171875,"y":1203.2000122070312,"wires":[["1f5b1d07.5e341b","896a341c.e440c"]]},{"id":"1f5b1d07.5e341b","type":"debug","z":"d36fb347.098c6","name":"","active":false,"console":"false","complete":"false","x":1213.5,"y":1185,"wires":[]},{"id":"896a341c.e440c","type":"Sonoff device","z":"d36fb347.098c6","mode":"0","broker":"9c9224ce.733908","device":"sonoff-vmc","name":"","onValue":"ON","offValue":"OFF","cmdPrefix":"cmnd","statPrefix":"stat","telePrefix":"tele","x":1215.699951171875,"y":1223.2000122070312,"wires":[[]]},{"id":"f0183c6e.8421a","type":"function","z":"d36fb347.098c6","name":"Update VMCStateLabel","func":"msg.payload = flow.set('VMCStateLabel', \"air pollué\");\n        node.status({text:flow.get('VMCStateLabel')});\nreturn msg;","outputs":"1","noerr":0,"x":713,"y":1180,"wires":[["7512a32e.bf7a5c"]]},{"id":"764d6ec4.1b00a8","type":"function","z":"d36fb347.098c6","name":"Update VMCStateLabel","func":"msg.payload = flow.set('VMCStateLabel', \"air très pollué\");\n        node.status({text:flow.get('VMCStateLabel')});\nreturn msg;","outputs":"1","noerr":0,"x":715.699951171875,"y":1231.2000122070312,"wires":[["7512a32e.bf7a5c"]]},{"id":"ca662610.ae1768","type":"inject","z":"d36fb347.098c6","name":"Refresh every 30 sec","topic":"update","payload":"upate","payloadType":"str","repeat":"30","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":1180,"wires":[["842e4f87.648258"]]},{"id":"f95d4517.937648","type":"switch","z":"d36fb347.098c6","name":"VMCMarcheForcee","property":"VMCMarcheForcee","propertyType":"flow","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":410,"y":1340,"wires":[[],["5b38d249.593b14"]]},{"id":"3916d4dd.4f4efc","type":"comment","z":"d36fb347.098c6","name":"on","info":"","x":437,"y":1299,"wires":[]},{"id":"90088a3f.65d18","type":"comment","z":"d36fb347.098c6","name":"off","info":"","x":436,"y":1377,"wires":[]},{"id":"c4754d45.5e1618","type":"function","z":"d36fb347.098c6","name":"Update Qair","func":"msg.payload = flow.set('Qair', msg.payload);\n    node.status({text:msg.payload});\nreturn msg;","outputs":"1","noerr":0,"x":390,"y":1060,"wires":[["5b38d249.593b14"]]},{"id":"d7bacc2e.3fb4c","type":"comment","z":"d36fb347.098c6","name":"Marche forcée OFF + Qualité de l'air sain","info":"","x":200,"y":1460,"wires":[]},{"id":"1c64e4f4.0d67b3","type":"comment","z":"d36fb347.098c6","name":"Marche forcée OFF et Qalité air OK - Saison ?","info":"","x":220,"y":1540,"wires":[]},{"id":"5bacc692.24d71","type":"switch","z":"d36fb347.098c6","name":"Select humidity","property":"Humidity","propertyType":"flow","rules":[{"t":"lt","v":"SeuilHumid","vt":"flow"},{"t":"gte","v":"SeuilHumid","vt":"flow"}],"checkall":"true","repair":false,"outputs":2,"x":180,"y":2280,"wires":[["880271a7.33f9a","4ae62646.e89ba8"],["880271a7.33f9a","ca38ed9f.2766b8"]]},{"id":"b85b8a00.e35cd8","type":"comment","z":"d36fb347.098c6","name":"Humidity < Update SeuilHumid : stopVMC","info":"","x":225,"y":2240,"wires":[]},{"id":"83bd9c8f.f004b8","type":"comment","z":"d36fb347.098c6","name":"Humidity >  Update SeuilHumid : runVMC","info":"","x":215,"y":2320,"wires":[]},{"id":"ca38ed9f.2766b8","type":"switch","z":"d36fb347.098c6","name":"Select T°Ext","property":"MyTemperatureExt","propertyType":"global","rules":[{"t":"lt","v":"SeuilTemp","vt":"flow"},{"t":"gte","v":"SeuilTemp","vt":"flow"}],"checkall":"true","repair":false,"outputs":2,"x":445,"y":2287,"wires":[["b3420302.27e138"],["2a7e5b04.5f8134"]]},{"id":"7d0df260.f42b64","type":"comment","z":"d36fb347.098c6","name":"T°Ext <global.SeuilTemp : stopVMC","info":"","x":557,"y":2241,"wires":[]},{"id":"e40448cc.edf6","type":"comment","z":"d36fb347.098c6","name":"T°Ext >global.SeuilTemp : runVMC","info":"","x":558,"y":2327,"wires":[]},{"id":"7675f758.b4d068","type":"delay","z":"d36fb347.098c6","name":"1 message/H","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":865,"y":2239,"wires":[["bffc2cdc.7a762"]]},{"id":"2a7e5b04.5f8134","type":"delay","z":"d36fb347.098c6","name":"1 message/H","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":634,"y":2372,"wires":[["f5a28749.91ae6"]]},{"id":"6991bd54.2bc77c","type":"comment","z":"d36fb347.098c6","name":"1 action max par heure","info":"","x":893,"y":2191,"wires":[]},{"id":"bffc2cdc.7a762","type":"function","z":"d36fb347.098c6","name":"stopVMC","func":"flow.get('VMCMarcheForcee', msg.payload);\nflow.get('VMCStateLabel', msg.payload);\nflow.set('VMCState', \"OFF\");\nmsg.payload = \"OFF\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":1023,"y":2238,"wires":[["ade990d4.292c2"]]},{"id":"ade990d4.292c2","type":"Sonoff device","z":"d36fb347.098c6","mode":"0","broker":"9c9224ce.733908","device":"sonoff-vmc","name":"","onValue":"ON","offValue":"OFF","cmdPrefix":"cmnd","statPrefix":"stat","telePrefix":"tele","x":1202,"y":2299,"wires":[[]]},{"id":"62fe35e5.9c1fb4","type":"function","z":"d36fb347.098c6","name":"startVMC","func":"flow.get('VMCMarcheForcee', msg.payload);\nflow.get('VMCStateLabel', msg.payload);\nflow.set('VMCState', \"ON\");\nmsg.payload = \"ON\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":1036,"y":2373,"wires":[["ade990d4.292c2"]]},{"id":"4ae62646.e89ba8","type":"function","z":"d36fb347.098c6","name":"Update VMCStateLabel","func":"msg.payload = flow.set('VMCStateLabel', \"Humidité \" + Math.trunc(flow.get('Humidity')) + \"% < seuil \" + Math.trunc(flow.get('SeuilHumid'))+ \"%\");\n        node.status({text:flow.get('VMCStateLabel')});\nreturn msg;","outputs":"1","noerr":0,"x":661,"y":2189,"wires":[["7675f758.b4d068"]]},{"id":"f5a28749.91ae6","type":"function","z":"d36fb347.098c6","name":"Update VMCStateLabel","func":"msg.payload = flow.set('VMCStateLabel', \"Humidité \" + Math.trunc(flow.get('Humidity')) + \"% >= seuil \" + Math.trunc(flow.get('SeuilHumid'))+ \"%\");\n        node.status({text:flow.get('VMCStateLabel')});\nreturn msg;","outputs":"1","noerr":0,"x":848,"y":2373,"wires":[["62fe35e5.9c1fb4"]]},{"id":"c9abf4d3.056cb8","type":"time-range-switch","z":"d36fb347.098c6","name":"Nuit","lat":"49.213999","lon":"-0.400256","startTime":"21:00","endTime":"06:00","startOffset":0,"endOffset":0,"x":130,"y":1920,"wires":[["ad3143da.6072c"],["5bacc692.24d71"]]},{"id":"b61dbd58.5488b","type":"comment","z":"d36fb347.098c6","name":"Non","info":"","x":210,"y":1974,"wires":[]},{"id":"8e908b52.04c52","type":"comment","z":"d36fb347.098c6","name":"Oui","info":"","x":224,"y":1880,"wires":[]},{"id":"ea4501ba.d34f38","type":"http request","z":"d36fb347.098c6","name":"HTTP sunrise","method":"GET","ret":"txt","url":"http://domogeek.entropialux.com/season","tls":"","x":460,"y":1620,"wires":[["b1d18c16.295998"]]},{"id":"b1d18c16.295998","type":"switch","z":"d36fb347.098c6","name":"Switch season","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"winter","vt":"str"},{"t":"eq","v":"summer","vt":"str"},{"t":"eq","v":"autumn","vt":"str"},{"t":"eq","v":"spring","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":5,"x":641,"y":1619,"wires":[["e84546b9.8307","c9abf4d3.056cb8"],["b9fee2cc.212ba8","e84546b9.8307"],["e84546b9.8307","5bacc692.24d71"],["e84546b9.8307","5bacc692.24d71"],["e84546b9.8307"]]},{"id":"e84546b9.8307","type":"debug","z":"d36fb347.098c6","name":"","active":false,"console":"false","complete":"false","x":1050,"y":1620,"wires":[]},{"id":"3aa07cce.582334","type":"comment","z":"d36fb347.098c6","name":"Hivers","info":"","x":110,"y":1860,"wires":[]},{"id":"e5d9fae7.fe233","type":"comment","z":"d36fb347.098c6","name":"Eté","info":"","x":810,"y":1860,"wires":[]},{"id":"54172847.eb6778","type":"comment","z":"d36fb347.098c6","name":"Hiver-Nuits - VMC off","info":"","x":260,"y":2010,"wires":[]},{"id":"e120a516.ae6a88","type":"function","z":"d36fb347.098c6","name":"stopVMC","func":"flow.set('VMCMarcheForcee', \"OFF\");\nflow.set('VMCStateLabel', \"-\");\nflow.set('VMCState', \"OFF\");\nmsg.payload = \"OFF\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":519,"y":1914,"wires":[["b1a90ea2.7a6918"]]},{"id":"b1a90ea2.7a6918","type":"Sonoff device","z":"d36fb347.098c6","mode":"0","broker":"9c9224ce.733908","device":"sonoff-vmc","name":"","onValue":"ON","offValue":"OFF","cmdPrefix":"cmnd","statPrefix":"stat","telePrefix":"tele","x":550,"y":1962,"wires":[[]]},{"id":"b9fee2cc.212ba8","type":"time-range-switch","z":"d36fb347.098c6","name":"Nuit","lat":"49.213999","lon":"-0.400256","startTime":"21:00","endTime":"06:00","startOffset":0,"endOffset":0,"x":830,"y":1920,"wires":[["e80d6125.02fc08"],["5bacc692.24d71"]]},{"id":"b8690b6d.f42b48","type":"comment","z":"d36fb347.098c6","name":"Non","info":"","x":910,"y":1966,"wires":[]},{"id":"65968e03.97ac38","type":"comment","z":"d36fb347.098c6","name":"Oui","info":"","x":918,"y":1882,"wires":[]},{"id":"727d5023.4d6e5","type":"function","z":"d36fb347.098c6","name":"startVMC","func":"flow.set('VMCMarcheForcee', msg.payload);\nflow.set('VMCStateLabel', \"Marche forcée\");\nflow.set('VMCState', \"ON\");\nmsg.payload = \"ON\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":1237,"y":1913,"wires":[["21094292.86dc16"]]},{"id":"e7ccc7a.ee15a38","type":"comment","z":"d36fb347.098c6","name":"été-Nuits - VMC on","info":"","x":950,"y":2000,"wires":[]},{"id":"ad3143da.6072c","type":"function","z":"d36fb347.098c6","name":"Update VMCStateLabel","func":"msg.payload = flow.set('VMCStateLabel', \"Nuit d'hiver, VMC OFF\");\n        node.status({text:flow.get('VMCStateLabel')});\nreturn msg;","outputs":"1","noerr":0,"x":330,"y":1914,"wires":[["e120a516.ae6a88"]]},{"id":"e80d6125.02fc08","type":"function","z":"d36fb347.098c6","name":"Update VMCStateLabel","func":"msg.payload = flow.set('VMCStateLabel', \"Nuit d'été, VMC ON\");\n        node.status({text:flow.get('VMCStateLabel')});\nreturn msg;","outputs":"1","noerr":0,"x":1050,"y":1913,"wires":[["727d5023.4d6e5"]]},{"id":"fea7a6e3.ecfa1","type":"ui_text","z":"d36fb347.098c6","group":"8aa34793.811b08","order":7,"width":0,"height":0,"name":"Raison VMC","label":"Raison","format":"{{msg.payload}}","layout":"row-spread","x":470,"y":2519,"wires":[]},{"id":"88d538d1.4c5cc8","type":"function","z":"d36fb347.098c6","name":"Get VMCStateLabel","func":"msg.payload = flow.get('VMCStateLabel');\n    node.status({text:flow.get('VMCStateLabel')});\nreturn msg;","outputs":"1","noerr":0,"x":393,"y":2579,"wires":[["fea7a6e3.ecfa1","15f822de.7a184d"]]},{"id":"f9adb6cf.fe143","type":"comment","z":"d36fb347.098c6","name":"Saison ?","info":"","x":440,"y":1580,"wires":[]},{"id":"f7609357.69e5b8","type":"comment","z":"d36fb347.098c6","name":"Printemps - automne - VMC on si Hum > seuil, et T° ext > seuil","info":"","x":250,"y":2120,"wires":[]},{"id":"880271a7.33f9a","type":"debug","z":"d36fb347.098c6","name":"","active":false,"console":"false","complete":"false","x":370,"y":2380,"wires":[]},{"id":"370ce3a2.c6fb5c","type":"inject","z":"d36fb347.098c6","name":"Test hiver","topic":"","payload":"winter","payloadType":"str","repeat":"","crontab":"","once":false,"x":120,"y":1580,"wires":[["ea4501ba.d34f38"]]},{"id":"6250204c.e2ad78","type":"inject","z":"d36fb347.098c6","name":"Test été","topic":"","payload":"summer","payloadType":"str","repeat":"","crontab":"","once":false,"x":110,"y":1617,"wires":[["ea4501ba.d34f38"]]},{"id":"dd83d021.fdab6","type":"inject","z":"d36fb347.098c6","name":"Test printemps","topic":"","payload":"spring","payloadType":"str","repeat":"","crontab":"","once":false,"x":140,"y":1655,"wires":[["ea4501ba.d34f38"]]},{"id":"a16a4c7f.45343","type":"inject","z":"d36fb347.098c6","name":"Test automne","topic":"","payload":"autumn","payloadType":"str","repeat":"","crontab":"","once":false,"x":132,"y":1694,"wires":[["ea4501ba.d34f38"]]},{"id":"b3420302.27e138","type":"function","z":"d36fb347.098c6","name":"Update VMCStateLabel","func":"msg.payload = flow.set('VMCStateLabel', \"T° ext \" + context.global.MyTemperatureExt + \"° < T° seuil \" + Math.trunc(flow.get('SeuilTemp')) +\"°\");\n        node.status({text:flow.get('VMCStateLabel')});\nreturn msg;","outputs":"1","noerr":0,"x":665,"y":2281,"wires":[["7675f758.b4d068"]]},{"id":"52130606.3287c","type":"switch","z":"d36fb347.098c6","name":"VMC ON OFF ?","property":"VMCState","propertyType":"flow","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"eq","v":"OFF","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":792,"y":2579,"wires":[["1dcaab27.c59bb5","36d916fc.b7c74a","7b09852a.dde2ec"],["c98093f1.7f972","36d916fc.b7c74a","7b09852a.dde2ec"]]},{"id":"1dcaab27.c59bb5","type":"change","z":"d36fb347.098c6","name":"URL VMC icon on","rules":[{"t":"set","p":"payload","pt":"msg","to":"http://domobox/icones/vmc_on3.png","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1022,"y":2559,"wires":[["feb1b1f9.e12518"]]},{"id":"c98093f1.7f972","type":"change","z":"d36fb347.098c6","name":"URL VMC icon off","rules":[{"t":"set","p":"payload","pt":"msg","to":"http://domobox/icones/vmc_off3.png","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":2605,"wires":[["feb1b1f9.e12518"]]},{"id":"feb1b1f9.e12518","type":"ui_template","z":"d36fb347.098c6","group":"8aa34793.811b08","name":"TPL-VMC-On-Off","order":5,"width":0,"height":0,"format":"<div layout=\"row\" layout-align=\"space-between\" style=\"padding:5px; text-align: left; margin:2px; border:2px solid white;\">\n<span style=\"width:90%;padding-top:5px;padding-left:1px;\">{{\"Etat VMC\"}}\n\n</span>\n<span style=\"width:10%; padding-right:2px;\">\n    <img class=\"lightup\" src=\"{{msg.payload}}\" height=\"34px\"/>&nbsp;\n</span>\n</div>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":1225,"y":2576,"wires":[[]]},{"id":"36d916fc.b7c74a","type":"mqtt out","z":"d36fb347.098c6","name":"","topic":"cmnd/sonoff-vmc/Ledpower","qos":"0","retain":"","broker":"9c9224ce.733908","x":872,"y":2651,"wires":[]},{"id":"37f2ff7c.e74668","type":"comment","z":"d36fb347.098c6","name":"Hiver-Nuits - VMC off","info":"","x":140,"y":1800,"wires":[]},{"id":"7f14f1a9.62ddc","type":"comment","z":"d36fb347.098c6","name":"winter","info":"","x":830,"y":1560,"wires":[]},{"id":"85cf2668.073ad8","type":"comment","z":"d36fb347.098c6","name":"summer","info":"","x":830,"y":1600,"wires":[]},{"id":"33299857.16d42","type":"comment","z":"d36fb347.098c6","name":"été-Nuits - VMC on","info":"","x":850,"y":1800,"wires":[]},{"id":"21094292.86dc16","type":"Sonoff device","z":"d36fb347.098c6","mode":"0","broker":"9c9224ce.733908","device":"sonoff-vmc","name":"","onValue":"ON","offValue":"OFF","cmdPrefix":"cmnd","statPrefix":"stat","telePrefix":"tele","x":1290,"y":1960,"wires":[[]]},{"id":"80a1cead.cc2ee","type":"comment","z":"d36fb347.098c6","name":"Dashboard - icone ON OFF - Raison VMC","info":"","x":180,"y":2499,"wires":[]},{"id":"16242777.1ba449","type":"comment","z":"d36fb347.098c6","name":"autumn","info":"","x":830,"y":1640,"wires":[]},{"id":"f067a86d.95bf1","type":"comment","z":"d36fb347.098c6","name":"spring","info":"","x":830,"y":1680,"wires":[]},{"id":"1bdc814a.8a062f","type":"function","z":"d36fb347.098c6","name":"Update SeuilHumid","func":"flow.set('SeuilHumid', msg.payload) || 50;\n        node.status({text:flow.get('SeuilHumid')});\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":3040,"wires":[["d91d2426.6cd6","3f443e9.3963042"]]},{"id":"f0b1d888.c8d29","type":"debug","z":"d36fb347.098c6","name":"","active":false,"console":"false","complete":"false","x":405,"y":2957,"wires":[]},{"id":"7cc5d604.8be5c8","type":"comment","z":"d36fb347.098c6","name":"Sélection seuil humidité","info":"","x":132,"y":2936,"wires":[]},{"id":"4508c0cb.68ed88","type":"function","z":"d36fb347.098c6","name":"Update SeuilTemp","func":"flow.set('SeuilTemp', msg.payload);\n        node.status({text:flow.get('SeuilTemp')});\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":2840,"wires":[["c5e4106c.bcc8b8","be8260de.3ff51"]]},{"id":"c5e4106c.bcc8b8","type":"ui_text","z":"d36fb347.098c6","group":"8aa34793.811b08","order":10,"width":0,"height":0,"name":"Seuil T° lancement VMC","label":"Seuil T° lancement VMC : ","format":"{{msg.payload}}°","layout":"row-spread","x":390,"y":2800,"wires":[]},{"id":"ebbab5d8.06ac6","type":"comment","z":"d36fb347.098c6","name":"Sélection seuil température","info":"","x":146.99998474121094,"y":2709,"wires":[]},{"id":"d91d2426.6cd6","type":"ui_text","z":"d36fb347.098c6","group":"8aa34793.811b08","order":14,"width":0,"height":0,"name":"Seuil humidité lancement VMC","label":"Seuil humidité lancement VMC : ","format":"{{msg.payload}}%","layout":"row-spread","x":461,"y":3001,"wires":[]},{"id":"be8260de.3ff51","type":"ui_slider","z":"d36fb347.098c6","name":"","label":"Seuil T°","group":"8aa34793.811b08","order":12,"width":"6","height":"1","passthru":true,"topic":"","min":"-5","max":"12","step":1,"x":137,"y":2780,"wires":[["d1abd452.710a48","4508c0cb.68ed88","c5e4106c.bcc8b8"]]},{"id":"d1abd452.710a48","type":"debug","z":"d36fb347.098c6","name":"","active":false,"console":"false","complete":"false","x":350,"y":2760,"wires":[]},{"id":"3f443e9.3963042","type":"ui_slider","z":"d36fb347.098c6","name":"","label":"Seuil Hum","group":"8aa34793.811b08","order":16,"width":"6","height":"1","passthru":true,"topic":"","min":"0","max":"100","step":"5","x":140,"y":2980,"wires":[["1bdc814a.8a062f","f0b1d888.c8d29","d91d2426.6cd6"]]},{"id":"a5c3957d.1e4148","type":"inject","z":"d36fb347.098c6","name":"Refresh every 10 sec","topic":"update","payload":"stat","payloadType":"str","repeat":"10","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":2579,"wires":[["88d538d1.4c5cc8"]]},{"id":"7b09852a.dde2ec","type":"debug","z":"d36fb347.098c6","name":"","active":false,"console":"false","complete":"false","x":890,"y":2519,"wires":[]},{"id":"15f822de.7a184d","type":"function","z":"d36fb347.098c6","name":"Get VMCState","func":"msg.payload = flow.get('VMCState');\n    node.status({text:flow.get('VMCState')});\nreturn msg;","outputs":"1","noerr":0,"x":607,"y":2579,"wires":[["52130606.3287c"]]},{"id":"d6b42179.a8613","type":"debug","z":"9efb7b65.fb0c98","name":"","active":false,"console":"false","complete":"false","x":310,"y":1280,"wires":[]},{"id":"8058486d.05ab38","type":"debug","z":"9efb7b65.fb0c98","name":"","active":false,"console":"false","complete":"false","x":310,"y":1440,"wires":[]},{"id":"d3a6a0dc.1836f8","type":"comment","z":"659a812a.2160a","name":"Cablage Poussoir appuyer --> Marche forcée ON","info":"","x":860,"y":820,"wires":[]},{"id":"d7e1b415.3898b8","type":"comment","z":"c5a9ff80.1cad58","name":"Batterie Capteurs ouverture porte VMC marche forcée  2 ES index sondeBatterie","info":"","x":300,"y":1960,"wires":[]},{"id":"f5f4a452.af0ae8","type":"mqtt in","z":"c5a9ff80.1cad58","name":"VMC/XIAOMI/Battery","topic":"VMC/XIAOMI/Battery","qos":"2","broker":"9c9224ce.733908","x":110,"y":2008,"wires":[["c0e953e8.789018"]]},{"id":"399a97c.fe74e68","type":"json","z":"c5a9ff80.1cad58","name":"","x":755,"y":2067,"wires":[["6b052b7e.0d8934"]]},{"id":"6b052b7e.0d8934","type":"http request","z":"c5a9ff80.1cad58","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondebatterie/sonde/{{{msg.payload}}}","tls":"","x":891,"y":2067,"wires":[["77b1db3d.8e5ac4"]]},{"id":"77b1db3d.8e5ac4","type":"debug","z":"c5a9ff80.1cad58","name":"","active":false,"console":"false","complete":"false","x":1048,"y":2066.5,"wires":[]},{"id":"413b2437.536d2c","type":"function","z":"c5a9ff80.1cad58","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"VMCmarcheforcee\\\", \\\"battery\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":609,"y":2067,"wires":[["399a97c.fe74e68"]]},{"id":"2bef8f92.26e3c8","type":"inject","z":"c5a9ff80.1cad58","name":"","topic":"Test ES Write","payload":"70","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":189,"y":2060,"wires":[["c0e953e8.789018"]]},{"id":"1546882b.417e78","type":"delay","z":"c5a9ff80.1cad58","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"5","nbRateUnits":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":598,"y":2016,"wires":[["413b2437.536d2c"]]},{"id":"34bc9e64.01c062","type":"comment","z":"c5a9ff80.1cad58","name":"No change","info":"","x":434,"y":2000,"wires":[]},{"id":"c0e953e8.789018","type":"function","z":"c5a9ff80.1cad58","name":"Has value Changed?","func":"context.lastvalueVMCMarcheForceebattery = context.lastvalueVMCMarcheForceebattery || 'initial';\nvar currentvalueVMCMarcheForceebattery = msg.payload;\n\nif (context.lastvalueVMCMarcheForceebattery == currentvalueVMCMarcheForceebattery) \n{\n    context.lastvalueVMCMarcheForceebattery = currentvalueVMCMarcheForceebattery;\n    msg.payload = currentvalueVMCMarcheForceebattery;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvalueVMCMarcheForceebattery != currentvalueVMCMarcheForceebattery) \n{\n    msg.payload = currentvalueVMCMarcheForceebattery;\n    context.lastvalueVMCMarcheForceebattery = currentvalueVMCMarcheForceebattery;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvalueVMCMarcheForceebattery});","outputs":2,"noerr":0,"x":411,"y":2037,"wires":[["1546882b.417e78"],["413b2437.536d2c"]]},{"id":"d8b641e2.580e8","type":"comment","z":"c5a9ff80.1cad58","name":"Change","info":"","x":444,"y":2075,"wires":[]},{"id":"68b15549.1e4cbc","type":"Sonoff device","z":"d36fb347.098c6","mode":"0","broker":"9c9224ce.733908","device":"sonoff-vmc","name":"","onValue":"ON","offValue":"OFF","cmdPrefix":"cmnd","statPrefix":"stat","telePrefix":"tele","x":110,"y":3200,"wires":[["3612ddd9.d2ce8a","86f519c3.86a6c"]]},{"id":"640c49a5.159e5","type":"comment","z":"d36fb347.098c6","name":"Etat MQTT VMC","info":"","x":100,"y":3140,"wires":[]},{"id":"3612ddd9.d2ce8a","type":"mqtt out","z":"d36fb347.098c6","name":"","topic":"VMC/state","qos":"0","retain":"","broker":"9c9224ce.733908","x":294,"y":3180,"wires":[]},{"id":"86f519c3.86a6c","type":"debug","z":"d36fb347.098c6","name":"","active":true,"console":"false","complete":"false","x":290,"y":3229,"wires":[]},{"id":"2f545c8.a7d1b24","type":"comment","z":"c558fd3a.cad55","name":"Etat VMC 2 ES index vmc","info":"","x":150,"y":2640,"wires":[]},{"id":"99c3cd6a.8e84c8","type":"json","z":"c558fd3a.cad55","name":"","x":943,"y":2757,"wires":[["fb204fa.225093"]]},{"id":"fb204fa.225093","type":"http request","z":"c558fd3a.cad55","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondevmc/sonde/{{{msg.payload}}}","tls":"","x":1079,"y":2757,"wires":[["f2d4d0a4.963c18"]]},{"id":"84e6f9b7.638d4","type":"function","z":"c558fd3a.cad55","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"vmc\\\", \\\"status\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":788,"y":2757,"wires":[["99c3cd6a.8e84c8"]]},{"id":"e992ed73.08597","type":"inject","z":"c558fd3a.cad55","name":"","topic":"Test ES off Write","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":387,"y":2792,"wires":[["62e2e05f.9749c8"]]},{"id":"6cace4ce.8c9184","type":"delay","z":"c558fd3a.cad55","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"5","nbRateUnits":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":789,"y":2691,"wires":[["84e6f9b7.638d4"]]},{"id":"a758a2a4.331468","type":"inject","z":"c558fd3a.cad55","name":"","topic":"Test ES on Write","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":388,"y":2831,"wires":[["62e2e05f.9749c8"]]},{"id":"62e2e05f.9749c8","type":"function","z":"c558fd3a.cad55","name":"Has value Changed?","func":"context.lastvalueVMCstate = context.lastvalueVMCstate || 'initial';\nvar currentvalueVMCstate = msg.payload;\n\nif (context.lastvalueVMCstate == currentvalueVMCstate) \n{\n    context.lastvalueVMCstate = currentvalueVMCstate;\n    msg.payload = currentvalueVMCstate;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvalueVMCstate != currentvalueVMCstate) \n{\n    msg.payload = currentvalueVMCstate;\n    context.lastvalueVMCstate = currentvalueVMCstate;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvalueVMCstate});","outputs":2,"noerr":0,"x":594,"y":2719,"wires":[["6cace4ce.8c9184"],["84e6f9b7.638d4"]]},{"id":"5f5573d3.5dbb94","type":"comment","z":"c558fd3a.cad55","name":"No change","info":"","x":614,"y":2682,"wires":[]},{"id":"88b2ae37.23cf08","type":"comment","z":"c558fd3a.cad55","name":"Change","info":"","x":621,"y":2756,"wires":[]},{"id":"222c9942.f74ca6","type":"mqtt in","z":"c558fd3a.cad55","name":"VMC/state","topic":"VMC/state","qos":"2","broker":"9c9224ce.733908","x":95,"y":2720,"wires":[["33bdefcc.7cf54"]]},{"id":"b375e84a.231be8","type":"change","z":"c558fd3a.cad55","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":387,"y":2702,"wires":[["62e2e05f.9749c8"]]},{"id":"33bdefcc.7cf54","type":"switch","z":"c558fd3a.cad55","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"},{"t":"eq","v":"false","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":233,"y":2720,"wires":[["b375e84a.231be8"],["a6fe77e2.db56c8"]]},{"id":"a6fe77e2.db56c8","type":"change","z":"c558fd3a.cad55","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":386,"y":2745,"wires":[["62e2e05f.9749c8"]]},{"id":"5b2af538.92623c","type":"comment","z":"c558fd3a.cad55","name":"on","info":"","x":241,"y":2680,"wires":[]},{"id":"a295e92b.d81738","type":"comment","z":"c558fd3a.cad55","name":"off","info":"","x":221,"y":2761,"wires":[]},{"id":"f2d4d0a4.963c18","type":"debug","z":"c558fd3a.cad55","name":"","active":false,"console":"false","complete":"false","x":1235,"y":2756.5,"wires":[]},{"id":"46fa0ebf.ff9dd8","type":"inject","z":"9efb7b65.fb0c98","name":"Init","topic":"PT2262/guir","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":710,"y":1680,"wires":[["217dce2c.64c7ba"]]},{"id":"217dce2c.64c7ba","type":"rfx-PT2262-out","z":"9efb7b65.fb0c98","name":"","port":"154cb229.a4d1fe","deviceList":"37f65fc8.5bf318","topicSource":"msg","retransmit":"none","retransmitInterval":20,"topic":"PT2262/guir","x":890,"y":1640,"wires":[]},{"id":"3a6ac17c.3032ae","type":"debug","z":"9efb7b65.fb0c98","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":750,"y":1580,"wires":[]},{"id":"2abd6f9d.6c6168","type":"mqtt in","z":"9efb7b65.fb0c98","name":"Salon/XIAOMI/Motion","topic":"Salon/XIAOMI/Motion","qos":"2","broker":"9c9224ce.733908","x":140,"y":1640,"wires":[[]]},{"id":"ad60c23e.9c942","type":"change","z":"9efb7b65.fb0c98","name":"","rules":[{"t":"set","p":"topic","pt":"msg","to":"PT2262/guir","tot":"str"},{"t":"set","p":"payload","pt":"msg","to":"","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":556,"y":1640,"wires":[["3a6ac17c.3032ae","217dce2c.64c7ba"]]},{"id":"5576c6a.f18c3b8","type":"comment","z":"9efb7b65.fb0c98","name":"Sonof-rf controle","info":"1 : allumer\n0 : éteindre","x":100,"y":1600,"wires":[]},{"id":"f221d88b.3cf6f8","type":"delay","z":"9efb7b65.fb0c98","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"1","nbRateUnits":"30","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":353,"y":1640,"wires":[["ad60c23e.9c942"]]},{"id":"cced110f.f12ec8","type":"comment","z":"9efb7b65.fb0c98","name":"Sonof-rf ch état toutes les 30mn","info":"1 : allumer\n0 : éteindre","x":370,"y":1600,"wires":[]},{"id":"955e6b9.9ba3518","type":"comment","z":"9efb7b65.fb0c98","name":"Sonof-rf ch éteindre après 30mn sans mouvements","info":"","x":250,"y":1860,"wires":[]},{"id":"ff327832.995fe","type":"comment","z":"9efb7b65.fb0c98","name":"init allumage pour synchro","info":"1 : allumer\n0 : éteindre","x":310,"y":1700,"wires":[]},{"id":"e0b09619.3b3178","type":"mqtt in","z":"9efb7b65.fb0c98","name":"Salon/XIAOMI/no_motion","topic":"Salon/XIAOMI/no_motion","qos":"2","broker":"9c9224ce.733908","x":150,"y":1760,"wires":[["ece1296d.afe958"]]},{"id":"ece1296d.afe958","type":"debug","z":"9efb7b65.fb0c98","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":370,"y":1820,"wires":[]},{"id":"599d3f08.e9ef9","type":"switch","z":"9efb7b65.fb0c98","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"1800","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":350,"y":1760,"wires":[["ad60c23e.9c942","1f7275c4.029e7a"],["aabdede1.863f7"]]},{"id":"1f7275c4.029e7a","type":"debug","z":"9efb7b65.fb0c98","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":550,"y":1740,"wires":[]},{"id":"aabdede1.863f7","type":"debug","z":"9efb7b65.fb0c98","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":550,"y":1780,"wires":[]},{"id":"806906f6.2c4bd8","type":"mqtt in","z":"9efb7b65.fb0c98","name":"Salon/XIAOMI/Motion","topic":"Salon/XIAOMI/Motion","qos":"2","broker":"9c9224ce.733908","x":140,"y":1980,"wires":[["53c12876.991ac"]]},{"id":"af1f93.af32087","type":"Sonoff device","z":"9efb7b65.fb0c98","mode":"0","broker":"9c9224ce.733908","device":"Sonoff-inter","name":"","onValue":"ON","offValue":"OFF","cmdPrefix":"cmnd","statPrefix":"stat","telePrefix":"tele","x":1090,"y":2280,"wires":[[]]},{"id":"6aa311bb.c730f","type":"http request","z":"9efb7b65.fb0c98","name":"Power status","method":"GET","ret":"txt","url":"http://192.168.1.73/cm?cmnd=POWER","tls":"","x":336,"y":2142,"wires":[["25bd2937.6d0d36"]]},{"id":"25bd2937.6d0d36","type":"switch","z":"9efb7b65.fb0c98","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"{\"POWER1\":\"ON\"}","vt":"str"},{"t":"eq","v":"{\"POWER1\":\"OFF\"}","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":489,"y":2142,"wires":[["334cb4a2.6e570c"],["5d76351a.a2f1e4","32e1392e.454386"]]},{"id":"cf701e7c.b529d","type":"comment","z":"9efb7b65.fb0c98","name":"on","info":"","x":528,"y":2097,"wires":[]},{"id":"c45be7b0.6f9048","type":"comment","z":"9efb7b65.fb0c98","name":"off","info":"","x":513,"y":2177,"wires":[]},{"id":"2fe486d7.25a36a","type":"comment","z":"9efb7b65.fb0c98","name":"Sonof-inter guirlande Noel","info":"","x":130,"y":1940,"wires":[]},{"id":"4d689f2b.08e2e8","type":"change","z":"9efb7b65.fb0c98","name":"to OFF","rules":[{"t":"set","p":"payload","pt":"msg","to":"OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1020,"y":2160,"wires":[["af1f93.af32087"]]},{"id":"5d76351a.a2f1e4","type":"change","z":"9efb7b65.fb0c98","name":"to ON","rules":[{"t":"set","p":"payload","pt":"msg","to":"ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":2166,"wires":[["af1f93.af32087","d33e4f76.9b9ba"]]},{"id":"bc009d0a.b07d38","type":"inject","z":"9efb7b65.fb0c98","name":"Test","topic":"PT2262/guir","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":190,"y":2023,"wires":[["53c12876.991ac"]]},{"id":"334cb4a2.6e570c","type":"debug","z":"9efb7b65.fb0c98","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":663,"y":2123,"wires":[]},{"id":"d33e4f76.9b9ba","type":"delay","z":"9efb7b65.fb0c98","name":"Delay OFF 20mn","pauseType":"delay","timeout":"20","timeoutUnits":"minutes","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":850,"y":2160,"wires":[["4d689f2b.08e2e8"]]},{"id":"a8e1b494.92ade","type":"time-range-switch","z":"9efb7b65.fb0c98","name":"On 17h-22h30","lat":"","lon":"","startTime":"17:15","endTime":"22:30","startOffset":0,"endOffset":0,"x":320,"y":2080,"wires":[["6aa311bb.c730f"],[]]},{"id":"53c12876.991ac","type":"http request","z":"9efb7b65.fb0c98","name":"HTTP vacances scolaires","method":"GET","ret":"txt","url":"http://192.168.1.30:81/schoolholiday/B/now","tls":"","x":370,"y":1980,"wires":[["453cd9bb.33eb6"]]},{"id":"453cd9bb.33eb6","type":"switch","z":"9efb7b65.fb0c98","name":"Vacances?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"True","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":116,"y":2131,"wires":[["a8e1b494.92ade"],["75898678.5141a8","137bc9bb.2b873e"]]},{"id":"b5cfc547.f542a8","type":"comment","z":"9efb7b65.fb0c98","name":"True","info":"","x":135,"y":2165,"wires":[]},{"id":"7d32e306.2cbb14","type":"comment","z":"9efb7b65.fb0c98","name":"False","info":"","x":147,"y":2095,"wires":[]},{"id":"137bc9bb.2b873e","type":"time-range-switch","z":"9efb7b65.fb0c98","name":"On 10h-22h30","lat":"","lon":"","startTime":"10:15","endTime":"22:30","startOffset":0,"endOffset":0,"x":300,"y":2188,"wires":[["6aa311bb.c730f"],[]]},{"id":"1870dc8d.315c73","type":"debug","z":"c558fd3a.cad55","name":"","active":true,"console":"false","complete":"false","x":630,"y":1740,"wires":[]},{"id":"28094304.309ca4","type":"comment","z":"c5a9ff80.1cad58","name":"Batterie Tablette","info":"","x":100,"y":2160,"wires":[]},{"id":"eaa5fcf9.717008","type":"mqtt in","z":"c5a9ff80.1cad58","name":"Cuisine/tablette/Battery","topic":"Cuisine/tablette/Battery","qos":"2","broker":"9c9224ce.733908","x":120,"y":2208,"wires":[["250dd926.d864c6"]]},{"id":"3b758151.6e6fd6","type":"json","z":"c5a9ff80.1cad58","name":"","x":755,"y":2267,"wires":[["fde534ac.a00898"]]},{"id":"fde534ac.a00898","type":"http request","z":"c5a9ff80.1cad58","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondebatterie/sonde/{{{msg.payload}}}","tls":"","x":891,"y":2267,"wires":[["2cd999b8.08fe7e"]]},{"id":"2cd999b8.08fe7e","type":"debug","z":"c5a9ff80.1cad58","name":"","active":false,"console":"false","complete":"false","x":1048,"y":2266.5,"wires":[]},{"id":"a8c926cf.a2c8e","type":"function","z":"c5a9ff80.1cad58","name":"Index ES write","func":"d=new Date();\nmadate=d.toJSON()\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"tablette\\\", \\\"battery\\\":\" + msg.payload + \"}\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":609,"y":2267,"wires":[["3b758151.6e6fd6"]]},{"id":"609207f0.2c372","type":"inject","z":"c5a9ff80.1cad58","name":"","topic":"Test ES Write","payload":"70","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":"","x":189,"y":2260,"wires":[["250dd926.d864c6"]]},{"id":"10ebb4eb.f4ac53","type":"delay","z":"c5a9ff80.1cad58","name":"","pauseType":"rate","timeout":"1","timeoutUnits":"hours","rate":"5","nbRateUnits":"1","rateUnits":"day","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"x":610,"y":2200,"wires":[["a8c926cf.a2c8e"]]},{"id":"ba247e48.3b8868","type":"comment","z":"c5a9ff80.1cad58","name":"No change","info":"","x":434,"y":2200,"wires":[]},{"id":"250dd926.d864c6","type":"function","z":"c5a9ff80.1cad58","name":"Has value Changed?","func":"context.lastvalueTablettebattery = context.lastvalueTablettebattery || 'initial';\nvar currentvalueTablettebattery = msg.payload;\n\nif (context.lastvalueTablettebattery == currentvalueTablettebattery) \n{\n    context.lastvalueTablettebattery = currentvalueTablettebattery;\n    msg.payload = currentvalueTablettebattery;\n    // no change\n    return [ msg, null ];\n}\nelse if (context.lastvalueTablettebattery != currentvalueTablettebattery) \n{\n    msg.payload = currentvalueTablettebattery;\n    context.lastvalueTablettebattery = currentvalueTablettebattery;\n    // change\n    return [ null, msg ];\n    //return msg;\n}\n    node.status({text:currentvalueTablettebattery});","outputs":2,"noerr":0,"x":411,"y":2237,"wires":[["10ebb4eb.f4ac53"],["a8c926cf.a2c8e"]]},{"id":"145b57a.e95cf28","type":"comment","z":"c5a9ff80.1cad58","name":"Change","info":"","x":444,"y":2275,"wires":[]},{"id":"75898678.5141a8","type":"debug","z":"9efb7b65.fb0c98","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":550,"y":2040,"wires":[]},{"id":"32e1392e.454386","type":"debug","z":"9efb7b65.fb0c98","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":650,"y":2260,"wires":[]},{"id":"ce6be1ef.e9d8d","type":"inject","z":"c558fd3a.cad55","name":"Every 30mn","topic":"","payload":"","payloadType":"date","repeat":"1800","crontab":"","once":true,"onceDelay":0.1,"x":114,"y":1800,"wires":[["dd33da28.2c156"]]},{"id":"a5946971.6a6078","type":"inject","z":"c558fd3a.cad55","name":"Every 30mn","topic":"","payload":"","payloadType":"date","repeat":"1800","crontab":"","once":true,"onceDelay":0.1,"x":114,"y":1976,"wires":[["cad04884.22a8"]]},{"id":"9a1da42b.92571","type":"bigtimer","z":"9efb7b65.fb0c98","outtopic":"","outpayload1":"","outpayload2":"OFF","name":"Guirlande off 22h55","comment":"","lat":"49.213999","lon":"-0.400256","starttime":"1365","endtime":"1365","startoff":"0","endoff":"+10","offs":0,"outtext1":"","outtext2":"OFF","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":false,"mar":false,"apr":false,"may":false,"jun":false,"jul":false,"aug":false,"sep":false,"oct":false,"nov":false,"dec":false,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":"","month6":"","d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":"","w6":"","xday1":"","xmonth1":"","xday2":"","xmonth2":"","xday3":"","xmonth3":"","xday4":"","xmonth4":"","xday5":"","xmonth5":"","xday6":"","xmonth6":"","xd1":"","xw1":"","xd2":"","xw2":"","xd3":"","xw3":"","xd4":"","xw4":"","xd5":"","xw5":"","xd6":"","xw6":"","suspend":false,"random":false,"repeat":false,"atstart":false,"odd":false,"even":false,"x":137,"y":2308,"wires":[["af1f93.af32087"],[],[]]},{"id":"32a6250c.807f22","type":"file in","z":"7a8f2b34.bdf7c4","name":"month_diff.json","filename":"/home/pi/gazpar/domoticz_gaspar/month_diff.json","format":"utf8","sendError":true,"x":264,"y":120,"wires":[["ecc3c61a.91dcc8"]]},{"id":"6acb1224.d58a0c","type":"json","z":"7a8f2b34.bdf7c4","name":"","property":"payload","action":"","pretty":false,"x":732,"y":120,"wires":[["fa651e9d.1e1a1","890d6895.b8a16"]]},{"id":"fa651e9d.1e1a1","type":"debug","z":"7a8f2b34.bdf7c4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":743,"y":76,"wires":[]},{"id":"ab6723c2.3021c8","type":"inject","z":"7a8f2b34.bdf7c4","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":160,"wires":[["32a6250c.807f22"]]},{"id":"58fce24f.50e7f4","type":"file in","z":"7a8f2b34.bdf7c4","name":"day_diff.json","filename":"/home/pi/gazpar/domoticz_gaspar/day_diff.json","format":"utf8","sendError":true,"x":255,"y":480,"wires":[["76970cbe.af7704"]]},{"id":"cc28ae61.92f3b8","type":"json","z":"7a8f2b34.bdf7c4","name":"","property":"payload","action":"","pretty":false,"x":655,"y":480,"wires":[["ab39144c.94f328","fcc7eee.3ed189"]]},{"id":"ab39144c.94f328","type":"debug","z":"7a8f2b34.bdf7c4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":695,"y":440,"wires":[]},{"id":"29038a30.e4fa0e","type":"inject","z":"7a8f2b34.bdf7c4","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":105,"y":508,"wires":[["58fce24f.50e7f4"]]},{"id":"ecc3c61a.91dcc8","type":"split","z":"7a8f2b34.bdf7c4","name":"","splt":"\\n","spltType":"str","arraySplt":"1","arraySpltType":"len","stream":false,"addname":"","x":418,"y":120,"wires":[["fd251ff4.9575e8"]]},{"id":"1ae61e4e.fceff2","type":"debug","z":"7a8f2b34.bdf7c4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":333,"y":278,"wires":[]},{"id":"890d6895.b8a16","type":"function","z":"7a8f2b34.bdf7c4","name":"Var formater","func":"madate = msg.payload.time;\nflow.set('maconso', msg.payload.conso);\n    //node.status({text:flow.get('maconso')});\n\nmsg.payload = \"01/\" + madate;\n    node.status({text:msg.payload + \"  conso : \" + flow.get('maconso')});\nreturn msg;","outputs":1,"noerr":0,"x":116,"y":223,"wires":[["bbbb89b5.ffc968"]]},{"id":"c7b7d86d.4b8d6","type":"function","z":"7a8f2b34.bdf7c4","name":"ES write","func":"madate=msg.payload;\nmaconso=parseInt(flow.get('maconso'));\n//msg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"gazparmonth\\\", \\\"conso\\\":\\\"\" + maconso + \"\\\" }\";\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"gazparmonth\\\", \\\"conso\\\":\" + maconso + \" }\";\n//msg.payload = madate;    \n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":509,"y":223,"wires":[["da5d151a.05f4b8"]]},{"id":"da5d151a.05f4b8","type":"json","z":"7a8f2b34.bdf7c4","name":"","x":640,"y":223,"wires":[["e9fb0b81.24f4f8","2b876274.59531e"]]},{"id":"1bf820b1.eba497","type":"debug","z":"7a8f2b34.bdf7c4","name":"","active":true,"console":"false","complete":"false","x":951,"y":223,"wires":[]},{"id":"e9fb0b81.24f4f8","type":"http request","z":"7a8f2b34.bdf7c4","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondegazpar/sonde/{{{msg.payload}}}","tls":"","x":788,"y":223,"wires":[["1bf820b1.eba497"]]},{"id":"5475b4db.3fb304","type":"comment","z":"7a8f2b34.bdf7c4","name":"ElasticSearch gazparmonth index sondegazpar","info":"","x":860,"y":184,"wires":[]},{"id":"95b1899c.df3278","type":"inject","z":"97223981.e54958","name":"Every 24H","topic":"","payload":"","payloadType":"date","repeat":"86400","crontab":"","once":false,"onceDelay":"","x":112,"y":860,"wires":[["d4e3a088.6de87"]]},{"id":"1d69f78a.5714b","type":"comment","z":"97223981.e54958","name":"Verification MAJ miio-xiaomi","info":"","x":162,"y":800,"wires":[]},{"id":"d4e3a088.6de87","type":"file in","z":"97223981.e54958","name":"miio.txt","filename":"/home/pi/versions-check/miio.txt","format":"utf8","sendError":true,"x":249,"y":860,"wires":[["428262dc.8516a4"]]},{"id":"428262dc.8516a4","type":"switch","z":"97223981.e54958","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"},{"t":"eq","v":"false","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":392,"y":860,"wires":[["fcbcd248.c11ab8"],["3a6343d8.94ed94"]]},{"id":"81467114.5d75e","type":"comment","z":"97223981.e54958","name":"NewVersion : True","info":"","x":444,"y":820,"wires":[]},{"id":"d15aba1c.40d958","type":"comment","z":"97223981.e54958","name":"NewVersion :  False","info":"","x":432,"y":900,"wires":[]},{"id":"c7f53b48.c25f78","type":"e-mail","z":"97223981.e54958","server":"smtp.gmail.com","port":"465","secure":true,"name":"coyotte14@gmail.com","dname":"Miio Maj","x":696,"y":853,"wires":[]},{"id":"fcbcd248.c11ab8","type":"function","z":"97223981.e54958","name":"Mailformat","func":"var m=\"<table style='font-family:arial; font-size:14px'><tr><td style='color:blue'><b>Tasmota</b></td></tr>\";\n\nm+=\"<tr><td style='color:green'>\";\n  //m+=\"</td><td>\";\n  m+=\"Miio-Xiaomi mise à jour disponible\";\n  m+=\"</td><tr>\";\n  m+=\"https://python-miio.readthedocs.io/en/latest/\";\n  m+=\"</td></tr>\";\nm+=\"</table>\";\nmsg.payload=m;\nreturn msg;","outputs":1,"noerr":0,"x":534,"y":853,"wires":[["c7f53b48.c25f78","99e1f986.5965e8"]]},{"id":"99e1f986.5965e8","type":"debug","z":"97223981.e54958","name":"","active":true,"console":"false","complete":"false","x":705,"y":814,"wires":[]},{"id":"3a6343d8.94ed94","type":"debug","z":"97223981.e54958","name":"","active":false,"console":"false","complete":"false","x":615,"y":900,"wires":[]},{"id":"eb88ecf7.7ba388","type":"exec","z":"b882537d.e69738","command":"/home/pi/soca-restart.sh","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"Socat restart","x":1170,"y":120,"wires":[["e2126359.7a516"],[],[]]},{"id":"e2126359.7a516","type":"debug","z":"b882537d.e69738","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":1170,"y":180,"wires":[]},{"id":"e283af00.15d0a","type":"inject","z":"b882537d.e69738","name":"socat","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1160,"y":65,"wires":[["eb88ecf7.7ba388"]]},{"id":"c1e1b2e7.77432","type":"exec","z":"b882537d.e69738","command":"ssh root@192.168.1.254 /root/serTonet-restart.sh","addpay":true,"append":"","useSpawn":"false","timer":"","oldrc":false,"name":"ser2net restart","x":940,"y":120,"wires":[["5df1e998.8d11e"],[],[]]},{"id":"5df1e998.8d11e","type":"debug","z":"b882537d.e69738","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"topic","x":930,"y":180,"wires":[]},{"id":"291634bb.6602dc","type":"inject","z":"b882537d.e69738","name":"ser2net Openwrt","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":950,"y":65,"wires":[["c1e1b2e7.77432"]]},{"id":"ccbf8101.52d96","type":"inject","z":"97223981.e54958","name":"Every 24H","topic":"","payload":"","payloadType":"date","repeat":"86400","crontab":"","once":false,"onceDelay":"","x":110,"y":1060,"wires":[["4a9d8f7d.6bca7"]]},{"id":"969d1542.f9ae6","type":"comment","z":"97223981.e54958","name":"Verification rfxcom","info":"","x":130,"y":1000,"wires":[]},{"id":"4a9d8f7d.6bca7","type":"file in","z":"97223981.e54958","name":"rfxcom.txt","filename":"/home/pi/versions-check/rfxcom.txt","format":"utf8","sendError":true,"x":257,"y":1060,"wires":[["d95ddf2f.6df46"]]},{"id":"d95ddf2f.6df46","type":"switch","z":"97223981.e54958","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"},{"t":"eq","v":"false","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":390,"y":1060,"wires":[["6c22d13f.485008"],["91170610.0c6598"]]},{"id":"ce998e29.4bd2e8","type":"comment","z":"97223981.e54958","name":"NewVersion : True","info":"","x":442,"y":1020,"wires":[]},{"id":"3c3ddb6b.bc488c","type":"comment","z":"97223981.e54958","name":"NewVersion :  False","info":"","x":430,"y":1100,"wires":[]},{"id":"523b33b4.142334","type":"e-mail","z":"97223981.e54958","server":"smtp.gmail.com","port":"465","secure":true,"name":"coyotte14@gmail.com","dname":"Miio Maj","x":694,"y":1053,"wires":[]},{"id":"6c22d13f.485008","type":"function","z":"97223981.e54958","name":"Mailformat","func":"var m=\"<table style='font-family:arial; font-size:14px'><tr><td style='color:blue'><b>RFXcom</b></td></tr>\";\n\nm+=\"<tr><td style='color:green'>\";\n  //m+=\"</td><td>\";\n  m+=\"Rfxcom mise à jour disponible\";\n  m+=\"</td><tr>\";\n  m+=\"http://www.rfxcom.com/downloads.htm\";\n  m+=\"</td></tr>\";\nm+=\"</table>\";\nmsg.payload=m;\nreturn msg;","outputs":1,"noerr":0,"x":532,"y":1053,"wires":[["523b33b4.142334","df5450a9.917028"]]},{"id":"df5450a9.917028","type":"debug","z":"97223981.e54958","name":"","active":true,"console":"false","complete":"false","x":703,"y":1014,"wires":[]},{"id":"91170610.0c6598","type":"debug","z":"97223981.e54958","name":"","active":true,"console":"false","complete":"false","x":613,"y":1100,"wires":[]},{"id":"bbbb89b5.ffc968","type":"moment","z":"7a8f2b34.bdf7c4","name":"","topic":"","input":"payload","inputType":"msg","inTz":"Europe/Paris","adjAmount":"1","adjType":"days","adjDir":"add","format":"","locale":"fr_FR","output":"payload","outputType":"msg","outTz":"Europe/Paris","x":309,"y":223,"wires":[["c7b7d86d.4b8d6","1ae61e4e.fceff2"]]},{"id":"fd251ff4.9575e8","type":"switch","z":"7a8f2b34.bdf7c4","name":"Not empty","property":"payload","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":578,"y":120,"wires":[["6acb1224.d58a0c"]]},{"id":"afbff84e.61fd58","type":"http request","z":"861fd1d6.432808","name":"Update FreeDNS","method":"GET","url":"http://freedns.afraid.org/dynamic/update.php?MVhubEc2QjBwQnIzZzlMYjNBNFB3UzF1O","tls":"","x":1010,"y":280,"wires":[[]]},{"id":"7854f976.cda938","type":"comment","z":"7a8f2b34.bdf7c4","name":"Gazpar consommation mensuelle vers Elasticsearch","info":"","x":210,"y":20,"wires":[]},{"id":"49923e1f.00854","type":"comment","z":"7a8f2b34.bdf7c4","name":"Gazpar consommation jour vers Elasticsearch","info":"","x":190,"y":400,"wires":[]},{"id":"76970cbe.af7704","type":"split","z":"7a8f2b34.bdf7c4","name":"","splt":"\\n","spltType":"str","arraySplt":"1","arraySpltType":"len","stream":false,"addname":"","x":395,"y":480,"wires":[["b1fa6f1a.348718"]]},{"id":"b1fa6f1a.348718","type":"switch","z":"7a8f2b34.bdf7c4","name":"Not empty","property":"payload","propertyType":"msg","rules":[{"t":"nempty"}],"checkall":"true","repair":false,"outputs":1,"x":525,"y":480,"wires":[["cc28ae61.92f3b8"]]},{"id":"e31efe7f.f7b39","type":"debug","z":"7a8f2b34.bdf7c4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":310,"y":660,"wires":[]},{"id":"384ab89c.56f1a8","type":"function","z":"7a8f2b34.bdf7c4","name":"ES write","func":"madate=msg.payload;\nmaconso=parseInt(flow.get('maconso'));\nmsg.payload = \"{\\\"date\\\":\\\"\" + madate + \"\\\", \\\"source\\\":\\\"gazparday\\\", \\\"conso\\\":\" + maconso + \" }\";\n    node.status({text:msg.payload});\nreturn msg;","outputs":1,"noerr":0,"x":507,"y":605,"wires":[["718a689.f6a6798"]]},{"id":"718a689.f6a6798","type":"json","z":"7a8f2b34.bdf7c4","name":"","x":638,"y":605,"wires":[["4f8468a5.dff888","395654e6.cf6b4c"]]},{"id":"92db4e74.3c3d38","type":"debug","z":"7a8f2b34.bdf7c4","name":"","active":true,"console":"false","complete":"false","x":949,"y":605,"wires":[]},{"id":"4f8468a5.dff888","type":"http request","z":"7a8f2b34.bdf7c4","name":"Save Data","method":"POST","ret":"obj","url":"http://graylog:9200/sondegazpar/sonde/{{{msg.payload}}}","tls":"","x":786,"y":605,"wires":[["92db4e74.3c3d38"]]},{"id":"e4fa29c6.fd57c","type":"comment","z":"7a8f2b34.bdf7c4","name":"ElasticSearch gazparday index sondegazpar","info":"","x":848,"y":566,"wires":[]},{"id":"84f4faf0.7da558","type":"moment","z":"7a8f2b34.bdf7c4","name":"","topic":"","input":"payload","inputType":"msg","inTz":"Europe/Paris","adjAmount":"2","adjType":"hours","adjDir":"add","format":"","locale":"fr_FR","output":"payload","outputType":"msg","outTz":"Europe/Paris","x":307,"y":605,"wires":[["e31efe7f.f7b39","384ab89c.56f1a8"]]},{"id":"fcc7eee.3ed189","type":"function","z":"7a8f2b34.bdf7c4","name":"Var formater","func":"madate = msg.payload.time;\nflow.set('maconso', msg.payload.conso);\n    //node.status({text:flow.get('maconso')});\n\nmsg.payload = madate;\n    node.status({text:msg.payload + \"  conso : \" + flow.get('maconso')});\nreturn msg;","outputs":1,"noerr":0,"x":110,"y":605,"wires":[["84f4faf0.7da558"]]},{"id":"395654e6.cf6b4c","type":"debug","z":"7a8f2b34.bdf7c4","name":"","active":true,"console":"false","complete":"false","x":810,"y":660,"wires":[]},{"id":"2b876274.59531e","type":"debug","z":"7a8f2b34.bdf7c4","name":"","active":true,"console":"false","complete":"false","x":790,"y":276,"wires":[]},{"id":"455bd5b2.4ed0fc","type":"inject","z":"7a8f2b34.bdf7c4","name":"At 0h30","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"30 00 * * *","once":false,"onceDelay":"","x":97,"y":120,"wires":[["32a6250c.807f22"]]},{"id":"ac9495ba.ad8d88","type":"switch","z":"417d6ad8.4260bc","name":"Entre 0 & 100 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"100","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":337,"y":680,"wires":[["464e9be1.091124"]]},{"id":"abc65c89.6a7fe8","type":"switch","z":"417d6ad8.4260bc","name":"Entre 0 & 100 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"100","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":344,"y":817,"wires":[["8db2f30.8a2f59"]]},{"id":"69e7a779.b6c4d8","type":"switch","z":"417d6ad8.4260bc","name":"Entre 0 & 100 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"100","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":320,"y":516,"wires":[["e0c72df6.af1e08"]]},{"id":"e9f14114.ac176","type":"switch","z":"417d6ad8.4260bc","name":"Entre 0 & 100 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"100","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":321,"y":360,"wires":[["a701927e.a7ef98"]]},{"id":"d1238f34.bf7588","type":"switch","z":"417d6ad8.4260bc","name":"Entre 0 & 100 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"100","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":340,"y":237,"wires":[["e6069bd4.e2de78"]]},{"id":"7d898fac.27d76","type":"switch","z":"417d6ad8.4260bc","name":"Entre 0 & 100 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"100","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":340,"y":109,"wires":[["9530da31.c8dab8"]]},{"id":"93fd1de.27069e","type":"switch","z":"417d6ad8.4260bc","name":"Entre 0 & 100 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"100","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":340,"y":977,"wires":[["6bffdaec.70babc"]]},{"id":"a83a2a5d.623ce","type":"switch","z":"417d6ad8.4260bc","name":"Entre 0 & 100 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"100","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":320,"y":1120,"wires":[["b1df15dc.e84808"]]},{"id":"95e55982.3b6ad","type":"switch","z":"417d6ad8.4260bc","name":"Entre 0 & 100 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"100","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":330,"y":1260,"wires":[["98fad10e.9478c8"]]},{"id":"a9387cb4.7527f8","type":"switch","z":"b882537d.e69738","name":"Entre -30 & 50 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"-30","vt":"num","v2":"50","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":340,"wires":[["4b639897.e6fe48","aae33d8d.57b7f8"]]},{"id":"ba61ea2e.1574d","type":"switch","z":"b882537d.e69738","name":"Entre -30 & 50 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"-30","vt":"num","v2":"50","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":782,"wires":[["6563f5e6.74d1a4","7fdb265c.c0664"]]},{"id":"b28f186d.92a36","type":"switch","z":"b882537d.e69738","name":"Entre -30 & 50 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"-30","vt":"num","v2":"50","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":550,"y":1202,"wires":[["87636074.4b8e2","da8f519f.837bf"]]},{"id":"1061be7e.9b4f02","type":"switch","z":"b882537d.e69738","name":"Entre 0 & 100 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"100","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":540,"y":1367,"wires":[["b1026479.6ae11"]]},{"id":"550b902f.f56a18","type":"switch","z":"b882537d.e69738","name":"Entre 0 & 100 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"100","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":540,"y":885,"wires":[["76f96112.f7b618"]]},{"id":"82e585d3.c40c3","type":"switch","z":"b882537d.e69738","name":"Entre 0 & 100 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"100","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":537,"y":443,"wires":[["21484f89.be18c8"]]},{"id":"13224558.8f3083","type":"switch","z":"b882537d.e69738","name":"Entre 0 & 100 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"100","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":563,"y":2243,"wires":[["58e31e90.d03a08"]]},{"id":"8741e211.9aa788","type":"switch","z":"b882537d.e69738","name":"Entre -30 & 50 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"-30","vt":"num","v2":"50","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":570,"y":2140,"wires":[["6182c983.5195e","34ca7efa.3d4892"]]},{"id":"2a8e09e5.17b036","type":"switch","z":"b882537d.e69738","name":"Entre 0 & 100 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"100","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":560,"y":2720,"wires":[["a9d266df.52bb38"]]},{"id":"b00dff67.eb3a3","type":"switch","z":"b882537d.e69738","name":"Entre -30 & 50 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"-30","vt":"num","v2":"50","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":570,"y":2612,"wires":[["19f9f29.a2da58d","fbe14662.22b658"]]},{"id":"f05f6ec8.d2aeb8","type":"switch","z":"b882537d.e69738","name":"Entre -30 & 50 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"-30","vt":"num","v2":"50","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":610,"y":2980,"wires":[["9996ff3.7a71f","c98ff141.30f058"]]},{"id":"e9975f64.e47c88","type":"switch","z":"b882537d.e69738","name":"Entre 0 & 100 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"100","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":596,"y":3080,"wires":[["afcecc8.dc0bbb"]]},{"id":"ad68a86a.fdfcb8","type":"comment","z":"b882537d.e69738","name":"------------------ Run socat ser2net ------------------ ","info":"Pour trouver l'identifiant des sondes de température","x":1028,"y":20,"wires":[]},{"id":"d7260057.642148","type":"switch","z":"b882537d.e69738","name":"Entre -30 & 50 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"-30","vt":"num","v2":"50","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":604,"y":3340,"wires":[["5554e314.f4b0bc","8d970f37.c800b"]]},{"id":"df6066c4.394838","type":"switch","z":"b882537d.e69738","name":"Entre 0 & 100 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"100","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":593,"y":3440,"wires":[["b26733c4.87098"]]},{"id":"e37561aa.60baa8","type":"switch","z":"b882537d.e69738","name":"Entre -30 & 50 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"-30","vt":"num","v2":"50","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":583,"y":3699,"wires":[["ee052765.e4488","241d15cc.298cd2"]]},{"id":"658c3f30.fbec4","type":"switch","z":"b882537d.e69738","name":"Entre 0 & 100 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"100","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":574,"y":3801,"wires":[["f19b261d.c4607"]]},{"id":"a89b603a.949378","type":"switch","z":"b882537d.e69738","name":"Entre -30 & 50 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"-30","vt":"num","v2":"50","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":580,"y":4080,"wires":[["e6305ac2.e8e8d","ed24bb69.eb6628"]]},{"id":"dc689720.e3842","type":"switch","z":"b882537d.e69738","name":"Entre 0 & 100 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"0","vt":"num","v2":"100","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":573,"y":4180,"wires":[["186e6b76.12a9bd"]]},{"id":"1fc13295.38e375","type":"switch","z":"b882537d.e69738","name":"Entre -30 & 50 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"-30","vt":"num","v2":"50","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":495,"y":4460,"wires":[["cc0c4011.df5a1"]]},{"id":"997c9e48.4907d8","type":"inject","z":"7a8f2b34.bdf7c4","name":"At 0h35","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"35 00 * * *","once":false,"onceDelay":"","x":100,"y":463,"wires":[["58fce24f.50e7f4"]]},{"id":"844f5a61.741898","type":"switch","z":"b882537d.e69738","name":"Entre -30 & 50 ?","property":"payload","propertyType":"msg","rules":[{"t":"btwn","v":"-30","vt":"num","v2":"50","v2t":"num"}],"checkall":"true","repair":false,"outputs":1,"x":450,"y":4680,"wires":[["e58add31.c5f83"]]}]